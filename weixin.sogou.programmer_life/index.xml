<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>程序人生</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/</link>
<description>十年漫漫程序人生,打过各种杂,也做过让我骄傲的软件;管理过数十人的团队,还带领一班兄弟姐妹创过业,目前在硅谷一家创业公司担任 VP.关注程序人生,了解程序猿,学做程序猿,做好程序猿,让我们的程序人生精...</description>
<language>zh-cn</language>
<lastBuildDate>Thu, 15 Mar 2018 11:57:28 +0800</lastBuildDate>
<item>
<title>量子计算对 bitcoin 的威胁</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-03-11-1000000098.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsASPQrHaQ-85krl0PRDxgBBOxv*WB6xg2WCIa*BzOuP0CAYHht71fl6Vh6N9dOq2NmeYQgEeppOsuNdOHj5HWsro=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    量子计算对 bitcoin 的威胁                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-03-11&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;在奉上有关「共识机制」的文章前，我们先来点甜点。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;在两周前的 BBL 上，我给团队介绍了 bitcoin，相关的 slides 见：&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;color: rgb(0, 82, 255);&quot;&gt;github.com/tyrchen/unchained&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;其中花了点时间谈论了 quantum computing 对 bitcoin 的威胁。上周 google 发布了 72 量子比特通用量子计算机，引发了大家的热议 —— 尤其是，看上去牢不可破的 cryptocurrency，是不是到了快要被终结的时刻？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;下图是当时我 talk 时讲的内容：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.846875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ096iaRRkpUyw1PnlziaiaEmfWJMzUlPtUkRBlxyNlZN6SfG51JxB5ll3zGWe04iaicePdbSkb3hhucPqvA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;首先我们看量子计算中已经比较成型的算法：Shor’s algorithm（下文简称 Shor） 和 Grover’s algorithm（下文简称为 Grover）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;Shor 不是通用的算法，它解决因式分解的问题 —— 给定一个整数 N，找到其质因数。以下是 Wikipedia 的介绍：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;On a quantum computer, to factor an integer N, Shor’s algorithm runs in polynomial time (the time taken is polynomial in log N, which is the size of the input).[1] Specifically it takes quantum gates of order O((log N)&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;3&lt;/sup&gt;) using fast multiplication,[2] demonstrating that the integer factorization problem can be efficiently solved on a quantum computer and is thus in the complexity class BQP. This is substantially faster than the most efficient known classical factoring algorithm, the general number field sieve, which works in sub-exponential time – about O(pow(e, 1.9(log N)&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;1/3&lt;/sup&gt;(log log N)&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;2/3&lt;/sup&gt;)).[3] The efficiency of Shor’s algorithm is due to the efficiency of the quantum Fourier transform, and modular exponentiation by repeated squarings.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;简单说，Shor 就是把指数级的时间复杂度降维成了 polynomial time，也就是多项式时间。所谓多项式时间，就是 O(n&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;k&lt;/sup&gt;)，其中 k 是个常量。下图是时间复杂度的对比，大家可以看到，指数（2&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;n&lt;/sup&gt;）到多项式（n&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;&quot;&gt;2&lt;/sup&gt;）差异非常大：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.58&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ096iaRRkpUyw1PnlziaiaEmfWJ5Equ2HIlzibLNvkcweD8ONpVaofIdIZib0jwuXmJaOsk3px1G9GbbhPA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;550&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;虽然 Shor 只能加速因式分解，但如果你了解非对称加密的算法，你会记得 RSA 的基石就是两个大质数 p 和 q 的合数很难被因式分解出 p 和 q。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.59921875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ096iaRRkpUyw1PnlziaiaEmfWJuwFQbrTLQZicMfAPfXKlCV4quu0DfTLW61icDpnBHrD8TIjS4nojwabA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;大概五到十年前，人类通过通用计算机分解出来的最大的整数是 768 bit，因而理论上 RSA 密钥低于这个数字就是不安全的。实际生活中，我们基本会用 4096 长度的密钥：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;$ &lt;span class=&quot;fu&quot;&gt;ssh-keygen&lt;/span&gt; -t rsa -b &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;4096&lt;/span&gt; -C &lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;tyr@awesome.com&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;对于一个 768bit（二进制）大小的整数，我们对比两个算法的复杂度：&lt;/p&gt;&lt;pre class=&quot;sourceCode javascript&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode javascript hljs&quot; style=&quot;;&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; n &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;1.2301866845301178e+231&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; logn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(n)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;532.1043224155328&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; loglogn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(logn)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;6.276839564883618&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; pow1 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;pow&lt;/span&gt;(logn&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;8.103368625868256&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; pow2 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;pow&lt;/span&gt;(loglogn&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3.402728919940164&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;1.9&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; pow1 &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; pow&lt;br&gt;2&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;52.389776867137634&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;pow&lt;/span&gt;(e&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;52.389776867137634&lt;/span&gt;&lt;/span&gt;)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;5.65706279069233e+22&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;pow&lt;/span&gt;(logn&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;150657362.61267015&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;span style=&quot;color: rgb(84, 84, 84);&quot;&gt;前者是 10&lt;/span&gt;&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;color: rgb(84, 84, 84);&quot;&gt;22&lt;/sup&gt;&lt;span style=&quot;color: rgb(84, 84, 84);&quot;&gt;，后者 10&lt;/span&gt;&lt;sup style=&quot;font-size: 1.4ex;line-height: 1;top: -0.5em;height: 0px;color: rgb(84, 84, 84);&quot;&gt;9&lt;/sup&gt;&lt;span style=&quot;color: rgb(84, 84, 84);&quot;&gt;，如果&lt;/span&gt; 1ns 完成一个 operation（当然两个算法一次 operation 的时间是不等的，但是常量），前者需要 180 万年，后者需要 1s。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;由此可见，Shor 对 RSA 体系的破坏性是显而易见的，而且，它的变种，对基于椭圆双曲线的 ECDSA 也有类似的降维杀伤力。从这个角度上讲，量子计算机不断走向成熟，整个非对称加密体系下的算法都会受到巨大的冲击 —— PKI 将坍塌，你访问 chase.com，CA 已经无法证明 chase.com 的 cert 属于 Chase；你也无法使用公钥去验证某个私钥的签名，因为私钥变得可以被公钥推导出来。所以，岌岌可危的并非 bitcoin，而是整个 internet。你无法信任你的银行的网站，银行无法信任你的 USB token 里的私钥提供出来的签名。我们的数字化生活会走向暗黑时代。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;然而你还是能信任你的 bitcoin 钱包。虽然 bitcoin 钱包的私钥和钱包地址都来源于 ECDSA 的私钥和公钥，然而钱包地址并非直接是公钥，而是公钥的 hash。因而，你给一个钱包打钱，并不会需要钱包的公钥；只有这个钱包使用里面的钱（给别人打钱）时，才需要把自己的公钥放在 transaction 里。如果一个钱包只是收钱，那么它是安全的 —— 即便 Shor 算法也需要公钥去逆向私钥。因为公钥没有暴露出来，Shor 算法无法使用。因而即便量子计算破解了非对称加密算法，对于那些没有使用过的冷钱包（code wallet），也无法破解。对于那些需要 multisig 的钱包，也是类似。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;如果非得破解冷钱包，那么需要先把钱包地址逆向出来其公钥，而这个操作 Shor 无法完成，只能借助其他算法。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;这个算法是 Grover。先看 Wiki：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;Grover’s algorithm is a quantum algorithm that finds with high probability the unique input to a black box function that produces a particular output value, using just O(sqrt N) evaluations of the function, where N is the size of the function’s domain. It was devised by Lov Grover in 1996.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;基本上，Grover 对于函数 f(x) = y，只要给定 y，以及 x 取值的一个列表，它可以以 O(sqrt N) 的时间复杂度，找到这个 x。换句话说，随便一个算法，正常情况下暴力破解（在算法的定义域里一个个试），是 O(N)，Grover 将其降低成 O(sqrt N)，对于时间复杂度来说，这算法虽然看上去不错，但大多数情况下只是聊胜于无。下图是它和 log N 对比：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.7588652482269503&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ096iaRRkpUyw1PnlziaiaEmfWJnW3YcSd6fdcCgcNQ99fxDlSKWg5szREBmNfS7wDiaWhWliciaF0QnQySA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;705&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;我们看一个 256bit 的公钥，其 O(sqrt N) 是多大。我们先得找 256bit 数字的取值范围：&lt;/p&gt;&lt;pre class=&quot;sourceCode javascript&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode javascript hljs&quot; style=&quot;;&quot;&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; n_max &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0&lt;/span&gt;b111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;5.78960446186581e+76&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;sqrt&lt;/span&gt;(n_max)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;2.4061596916800453e+38&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;Math&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;at&quot;&gt;log&lt;/span&gt;(n_max)&lt;br&gt;&lt;span class=&quot;fl&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;176.75253104278605&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;可以看到，虽然 sqrt 后量级已经大大减少，但还是 trillion trillion trillion 级别，在一个可以预见的时间内无法破解。所以，即便使用了 Grover 算法，也无法有效地通过钱包地址破解出公钥，进而进一步使用 Shor 算法从公钥破解出私钥。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;从这个意义上讲，bitcoin 对 quantum computing 还是有一定免疫力的。在大家担忧量子时代到来后（可能二三十年到来，也可能三五十年） bitcoin 的前景时，还是先担忧一下现有的 PKI 体系吧，毕竟，信用卡，网银，微信支付，支付宝等所有基于非对称加密来保证安全的系统，可能都会变得不再可信。你以为你大爷是你大爷，可是你大爷真的不再是你大爷了。&lt;/p&gt;&lt;p&gt;iOS 用户赞赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;566127868&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;android 用户打赏通道&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;android 用户打赏通道&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-03-11-1000000098</guid>
<pubDate>Sun, 11 Mar 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>谈谈如何做研究</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-03-07-1000000097.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAcFLaCJ*w7j41j6v-o3xu81YR8gwj0XpkoO5Z8vJq505I3yEO8nN2zQlWJEuoMvl3kpvhkBMEzmGTN-Mw2VfHs8=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    谈谈如何做研究                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-03-07&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;今天谈谈我自己做研究的方法 —— 它跟随我多年，且一直在演进和完善中。我虽然没有读过 PhD（希望有生之年能够尝试一下），但我自认为这法子并不算差 —— 至少，它让我能够更加高效地进入一个新的领域，并且扎根于其中。如果你一直在读我的文章，好奇为何程序君涉猎范围这么广（就是这么爱给自己贴金），又扎得比较深（被自己帅哭了），那么，你可以仔细读读本文 —— 还是那就话，希望它对你有用，能给你哪怕一点点启发。&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;从问自己「为什么」开始&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;Simon Sneak 说 Great leaders start with why。要进入一个新的领域，你要问清楚自己为什么要进来 —— 它可以是热爱，也可以是恐惧，两种情感都能把你推得很远。热爱是正向的情感，它表达了你的兴趣；恐惧是负向的情感，它意味着你担心失去某些东西。我们当然希望正向的情感促使我们前进，然而如果你做一件事情出于恐惧，也不必太过在意甚至自责，因为情感会随着境遇而转化。有多少人真的热爱加班？对失去一份前途无量的工作的担心，对自己在技术领域会落后于周围的人的忧虑让我们加班，我们投入了时间，做出了成就，这超出预期的反馈让我们开心，从而更愿意投入额外的时间在技术上。我大女儿刚开始学琴的时候很抗拒练习，哭着喊着不配合 —— 是对妈妈威胁弹不好就要在作业上画八叉，然后老师对作业上有八叉的小朋友会批评，且不给 sticker 的这种恐惧让她不得不完成练习。久而久之，练习得到了回报，弹出的乐曲优美动人，于是她渐渐对弹琴从恐惧到热爱，时不时会主动去练习，甚至研究同一首曲子的不同变调，把若干曲子 remix 起来，试图发明新的曲子。所以我们看到，恐惧支配下的努力，在得到回报后，很有机会转化成热爱。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以好的研究方向，要么是足够前沿（激发热情），要么是能够弥补你目前所缺失部分（化解恐惧）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;当你选好一个方向后，下一步，就是 &lt;strong&gt;了解这个方向的 big picture 和 status-quo&lt;/strong&gt;。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;提纲挈领，掌握全貌&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这一步很重要。上来就扎到细节里并不是一件好事 —— 这就跟画画一样，你先从左上到右下进行构图，把大的形状勾勒出来，然后对此不断递归，直到想要的细节被雕琢出来。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们以 blockchain 为例。从技术角度来说，最大的 picture 可能是这样的：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.60546875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0879Weu6mzecpF6qyqO9icIZQVEtjx3qQ920L1MsfgPulKSDtrj9boA71NNIErYnnAgr47eurTmnBw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个 picture 下，有些是你比较熟识的，比如 TCP/IP stack，可以先放在一边；有些是新的技术，如 open ledger，可以对此递归，进一步细化。在这个过程中，要问自己很多问题：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;为什么需要这个技术？它解决什么已知的问题？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;它涉及到哪些内容？（下一步再递归）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;整个技术发展的历史是什么样子？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果有多个 solutions，每个 solution 的优缺点是什么？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;给我一页白纸，我能否画出这个技术所涵盖的 big picture？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;这个技术将何去何从？最新的方向是什么？&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这些问题都很直观，我就不一一细说，他们都是很重要的问题，你需要在研究的时候对此进行回答，但更重要的是，找到你认为更重要的问题。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这里我讲三个要点：问问题，找历史，对比/类比。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;忘记是谁说的了，&lt;strong&gt;问对问题比找对答案更重要&lt;/strong&gt;。问问题的能力反应一个人的科学素养，经常能问到点子上的人科学素养会更高一些。问对问题依赖两个方面：1) 先验知识 2) 问问题的方法。前者需要慢慢累积，后者有方法，比如《麦肯锡方法》里面谈到问问题的方法，以及前人的经验可寻，比如我上文中的这个列表。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;如果你也在看 bitcoin，你也许会有这些问题：&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;和数字相关：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;为什么 block 设计为 1M？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么总体供给是 2100w，不是 2048w，不是 4096w，是 2100w 这样一个奇怪的数字？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么 10 分钟出一个区块？为什么 6 个区块之后就可以认为之前生成的区块被确认了？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么用 base58（WTF）？为什么不用我们熟知的 base64？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么交易速度如此之慢，只有若干 tx / s？&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;如果你不对数字问为什么，你只能是数字的奴隶，是记忆者而难说理解者。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;和思想相关：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;为什么要搞 open ledger？优点？缺点？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么搞 chain？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么 PoW？现有的方法为什么不可用？（呃，现有有什么方法？）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么给矿工生成看似无意义的空区块的空间？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么钱包的地址要 hash 一遍，而不是直接用 public key 的 base58?&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么设计 UTXO？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么需要 merkle tree？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么用 ECDSA 而不是 RSA？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么 double hash？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么用 little endian，而不是 big endian（network order）？&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个列表可以很长很长。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;找历史是一个寻根溯源的动作，它能够让你的知识建立地更加体系化。这个世界上产生的每一样新的知识和理论都有前人的影子，就像牛顿说自己是站在巨人的肩膀上，他这不是谦虚，是事实。我们如果针对一个点去学习，学到的东西是孤立的，很难触发进一步思考的，然而，如果我们将历史代入，把一个个散落的点连成线和面，那么，我们可以更好地比较，综合，抽象。从而获取到属于自己的知识。比如说你看到 bitcoin 的 consensus，了解了 PoW 后，可以看看整个 consensus 的发展历程，知道 bitcoin PoW 来自于 hashcash，而 consensus 的基础问题是 Byzantine generals problem。那么还有什么处在这个 category 之下的 consensus 算法呢？PoS（Proof of Stake），PoI（Proof of Importance），DPoS（Delegated Proof of Stake），PoD（Proof of Devotion），PBFT（Practical Byzantine Fault Tolerance）…。等等，这些都是 blockchain 世界里的 consensus，也就是一个不信任的环境下的 consensus；那么，如果一个可信环境下的 consensus，是怎么解决的？于是，你了解了Paxos，Raft，还有 Zookeeper 所用的 ZAB（Zookeeper Atomic Broadcast Protocol）等等。这样，关于 consensus 的树状知识就有了。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在寻根溯源的过程中注意一点，不要过早耽于细节而迷失了方向。先找到 big picture，然后再细化，永远都是适用的。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;追溯历史之后，我们得到一大堆的新名词，新知识，接下来要对他们进行对比和类比，从而归纳总结。对比/类比可以在很多维度上进行，让知识真正成为你的知识 —— 因为，在这个过程中，更多的问题在更多的角度被发现出来。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;下面是我在看 blockchain 这种 fully unmanaged distributed system 时，想到的和 solo system，以及 managed distributed system (cloud computing) 的对比：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.63046875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0879Weu6mzecpF6qyqO9icIZNzqyDY87Cibic40nJ5juTOL0fue1iaFCJicc06lgAK1YSPrQeSlrg4xPhw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这虽然只有寥寥数行的比较，但其中凝结了很多思考 —— 纵轴究竟该选取什么维度？我相信你和我会得出不同的列表 —— 这是一个非常开放的思考，没有标准答案，只要有思考，只要去比较，就会有收获。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;虽然我把对比和类比放在一起，这两者差别还是蛮大的。对比强调分类，归纳，总结，而类比更多强调引申，演绎。现在大家谈起 blockchain 都将其和九十年代的互联网类比，那么，九十年代的互联网出现了哪些成功的方向，现在 blockchain 又出现了哪些成功的方向？我们是否可以把早期的雅虎（网站的索引）和如今的币安（cryptocurrency 的索引）类比？那么新浪可以和什么类比？google 可以和什么类比？geocities 又可以和什么类比？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;很多好的想法都是从类比中获得的，我前几天的文章里提到的 ArcBlock，其将 blockchain 的百家争鸣类比数据库技术的百花齐放，那么 ArcBlock 要做的就是 ODBC/JDBC 做的事情。ArcBlock 提供的服务是 aws for blockchain，清晰，明了。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;了解现状&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;其实如果 big picture 按照上文的思路撸过，那么，status quo 就不攻自破了。还是以 blockchain 为例，其 status-quo 是什么？下面这张 slide 说的很清楚，我们在整理某个技术的 status quo 时也可以采用类似的方式：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.6799645390070922&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ0879Weu6mzecpF6qyqO9icIZ1BWjhyFTgOWPggfBQI6PU9wwQ0T838JgvNnT3FjxuIgLGMnGHjCIog/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1128&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;（图片来源：https://gomedici.com/an-overview-of-blockchain-technology/）&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;以教促学&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我在其他场合也提到过，我自己是「以练促学，以教促学」的的忠实拥趸和受益者。分享（知识）是一种快乐，也能让自己收获更多 —— 这便是所谓的「天下皆知取之为取，而莫知与之为取」。当我对所要研究的内容有个 big picture 后，深入细节时我会从如何把我所学到的知识教给别人这个角度研究学习。这个方法主要对我有这些帮助：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;促使我更好地记笔记，将学过的内容汇总起来&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;强迫我用自己的话将知识复述一遍，巩固之余，还能防止「我以为我懂了实际没懂」的尴尬场景出现。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;在将其传授给别人时，要么自己会意识到某些地方是 “I don’t know that I don’t know”，要么是听众问的你自己不会问的「小白」问题，促使自己意识到 “I don’t know that I don’t know”，从而得以对知识查漏补缺。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;(副作用) 提高自己的 public speaking 能力&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;偷师&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;前面说到，这个世界上产生的每一样新的知识和理论都有前人的影子。要想有所突破，仅仅在想突破的那个点发力是远远不够的，我们得先偷师前人，构建一棵完整的知识树。这里的偷师，不仅仅是学习，还包括复制，或者说刻意模仿。我丫头学琴，按着老师教的指法，学着视频里的动作，照着一篇篇乐谱，一遍遍练 —— 这便是模仿，非常非常刻意的模仿。人类（或者说所有生物）非常不善于模仿，花再多的功夫，也仅仅是无限接近原作 —— 比如你无法复刻我的笔迹，甚至我自己，抄十遍咏鹅，三十只鹅，每只都形态各异，总能发现些许的差别。然而，我们要感谢造物主为我们提供的这种 incapable / imperfect，他让我们能够活成我们自己。刚刚拿到奥斯卡的科比，在成为巨星的路上偷师过很多人，包括在投篮上偷师过乔丹和司机，在脚步上偷师过大梦等：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0879Weu6mzecpF6qyqO9icIZmQPPkx6Lkib6ylnb1Px6icHMtLSVwrYxImBHL1fhlibV9u2yicMXx3O5OQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;可是科比发现自己的身高，体型，臂展，肌肉力量等等所有这些特性都和他所仰慕的前辈不同，因而他无法精确复制（即便上图已经接近像素级），他需要调整很多来让他复制的技巧适应他的身体。即便每个经过改进的动作都有他所复制的巨星的影子，但这一切加起来，谁也不像，它只属于科比这个名字。这印证了那句老话：&lt;strong&gt;如果从一个作者身上拷贝，那是剽窃；但从很多人那里拷贝，那是创新。&lt;/strong&gt; 当然，拷贝并非复制粘贴那么简单，就像科比，迎着凌晨四点钟的太阳，一遍又一遍苦练，并且不断思索：为什么这个动作要如此展开？姿势要如此角度？如何让这个动作更加适合我？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;于是他拷贝的不仅仅是 style，还是背后的思考过程 —— 这是内化（internalize）的一部分。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;模仿，拷贝，思考（问问题），内化，博观约取，厚积薄发。之后你就拥有了你的 branch：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.34921875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0879Weu6mzecpF6qyqO9icIZG9ribN0ujgmgja7MKNzeibjG5d7AVBhgwf1EaIu0TA43icPqQ5RqlCpkw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这是我们自出生那一刻（或者说成为受精卵那一刻），花一辈子要做的事情：在继承了父母九成多的基因后，点亮一个新的分支：你自己。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个话题我再多啰嗦两句。最近突然流行起了「古典互联网」和「古典区块链」之说。有个朋友小窗问我怎么看 xxx 白皮书，我说我还在吭哧吭哧看 bitcoin。朋友来了一句：现在都 3.0 了，你怎么还在研究 1.0 的「古典区块链」？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;WTF！Are u OK？Are u zhende OK?&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;你可以用「古典互联网」和「古典区块链」自嘲，但不可以自我否定（如果你身处其中），也不该粗暴地蔑视那些并不在风口浪尖的东西。我们要对前人的智慧保持敬畏，而对满嘴 buzzword，堆叠概念却不求甚解的行为远离 —— 大大不是总告诫我们：见善如不及，见不善如探汤么？没有树根，树干，树枝支撑的树冠是个空中楼阁，无法长存的。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;尾声&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;其实还有很多内容可以讲，但是我想就此打住。最后一点：给自己一点点耐心，再来一点点耐心。莎翁说：人生如舞台，有时候你在前台，有时候在后台。做研究，大部分的时间都是吭哧吭哧慢火细熬的功夫，是后台，是里子，是鲲化成鹏之前的沉潜浮动。水击三千里，抟扶摇而上九万里固然轰轰烈烈，气吞山河，但在那之前，要耐得住寂寞，留得住青山。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;然而事情并不一定按照你预期的方向去走，终于轮到你上台时，盛宴也许已经结束。这你得认。君不见 bitcoin 矿工空算几亿亿次 hash，最后竹篮打水一场空么？那矿工们还是照样抖抖衣襟上的泥土，心疼电表一秒钟，继续算下一个 block，直到属于自己的时机到来呢。王家卫用「一代宗师」告诉我们：人活一世，有的人活成了面子，有的人活成了里子，都是时势使然。Neil Gaiman 说 &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=401127730&amp;amp;idx=1&amp;amp;sn=11ca3c73adc4f0821f387d1e4514a011&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;Make good arts&lt;/a&gt;。这是做研究要有的态度。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1578894514&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;仰望星空，脚踏实地&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;仰望星空，脚踏实地&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-03-07-1000000097</guid>
<pubDate>Wed, 07 Mar 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>谈谈分布式系统</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-03-03-1000000096.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAaPawkh1d5EC-EDkaLMENTD-bM8zu9Cv-GkMKzH1y3LDoaKYaY7myXzPFAXApdCSDxeYjxlT4618NtiewjtiCxE=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    谈谈分布式系统                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-03-03&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;先讲个黑色笑话：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;半年前，一个谁也没见过的日本浪人推出的理财产品突然在七侠镇火爆起来，据说买上点屯着，不出几月就能把同福客栈，甚至龙门镖局都盘下。我们家小六的七舅老爷，卖掉祖宅也嚷嚷着要 all in。我觉得这事吧很是蹊跷，好歹也是自家人嘛，不能让老人家上当受骗 —— 所以 … 放着我来。我用我无双的智慧，和堪比丞相的三寸不烂之舌给七舅老爷拦下来，让他打消了念头。没出半年，小六七舅老爷全家就和我们斩了联系，死生不复相见。 – 摘自《无双日记》 2018.1.1&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;最近一个多月，谈论 blockchain 的人如此之多，以至于连菜头叔都写了篇文章「韭菜席地而坐」。我在朋友圈里转了这篇文章，评论说：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;区块链是对此钻研的技术人，场内人士，以及为所有参与者提供服务的人的盛宴，因为他们对此深思熟虑，并且有金钱以外的付出。那些听风就是雨的参与者，仅仅花费时间在 telegram 里打听小道消息，盯盘讨论涨跌的人，都是韭菜，大小而已。&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;有朋友问，那做技术的，怎么入行？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;我虽不算入行，但知道技术是一脉相承的 —— blockchain 不是像孙猴子凭空从石头里蹦出来的，它有它的根。如果把一门门技术看做一棵棵拔地而起，随时间渐渐丰腴而枝繁叶茂的榕树，那么 blockchain 是若干棵已然成年的榕树交织而成的新枝（branch） —— 它快速成长，活力无限，树冠已然盖住了其它 branch 的锋芒。如果你直接爬到它的树冠上，想要抓其脉络，在纷繁复杂面前，会迷失方向；但若你从根部细细往上捋，线索就如钱老笔下的「真理」，赤裸裸而一览无遗。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;今天我们先寻其最重要的一个根：分布式系统。这个题目对互联网从业者来说，看着可笑，谁敢说自己不了解分布式系统啊？然而，如果你只是躲在 load balancer 后面做些 stateless 的 service，而没有真正去面对分布式系统那种让人愉悦并忧伤着的不确定性，那么，你可能并不真正了解分布式系统，因而本文还是值得一读。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;依旧例，我们还是先看 wikipedia，把概念先熟络起来：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;A distributed system is a model in which components located on networked computers &lt;strong&gt;communicate and coordinate&lt;/strong&gt; their actions by &lt;strong&gt;passing messages&lt;/strong&gt;.[1] The components interact with each other in order to achieve a common goal. Three significant characteristics of distributed systems are: &lt;strong&gt;concurrency of components&lt;/strong&gt;, &lt;strong&gt;lack of a global clock&lt;/strong&gt;, and &lt;strong&gt;independent failure of components&lt;/strong&gt;. - Wikipedia&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;其中的的关键词我已经勾勒出来：communication / coordinate，message passing，concurrency，lack of global clock，independent failure。我们看看这些东西，是如何引发不确定性的。&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;global clock&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们先说说全局时钟 —— global clock。它是分布式系统诸多难题的根源之一。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在单机系统里，无论是 SMP 还是 NUMA，有且只有唯一的全局时钟，这个很容易办到。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;时间是什么？抛开相对论，在狭义的局部时空中，时间是因果的表象 —— 一个 cause 引发了一个 effect，这种因果产生了时间的概念：用时间（过去，现在，未来）可以更好地描绘因果。我们在 t0 执行一条指令，t1 得到结果，这结果不可能出现在指令执行之前，这便是时间带给我们的确定性。所以，一个系统有一致的，大家都认可和遵循的时间，非常重要。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在分布式系统里，每个系统都有自己的时钟，即便用 NTP（Network Time Protocol）同步，大家也无法严格步调一致；就算时钟的差异小到可以忽略不计，但取决于带宽，当时的拥塞程度，CPU 的繁忙程度，多个系统互相之间发送消息的延迟还是非常地不确定。就跟一个团队去会议室开会一样，如果都根据自己的手表来决定进入会议室的时间，那么肯定会不一致；即便手表时间一致，大家的走路的速度不同，最终进入会议室的时间，也是不一致。这种不一致会带来很多问题，比如说 out of sync —— 大家都散会了，Alice 才抵达会场，所以她缺失了很多状态的更新，于是她不知道手上的下一件事该做还是不该做。所以在分布式系统里很多时候我们需要一致性，来确保某些东西是有序的，大家在同一个 page，否则这个系统会走入歧途。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;要解决因为时钟不同，步调不一致而导致的 out of sync 的问题，我们需要设法形成一个逻辑上的「时钟」，让大家都认可这个「时钟」而不是自己的时钟。这个逻辑时钟的第一个实现是 Lamport timestamps（请记住 Lamport 这位图灵奖获得者，分布式系统的先驱，下文他还会上镜）。Lamport timestamps 学术价值大于实际价值，并没有系统实际使用，然而在它之上演进出的 vector clock 广泛被 AWS S3，DynamoDB，Riak 等系统采用，用于确保同一个 object 的因果关系。我们看看 vector clock 的实现：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.6859375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpB1C5RBDjqsJiaKxejCw5JJVgPxH605SGE89C3mI4gLNvDdazbcoYRIQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个算法的思想很简单：所有 node 都有一个包含所有 timestamp 的 vector，这是个逻辑「时钟」。每个独立的 node 自行处置属于自己的 timestamp，使其有序；但当需要 coordinate 的时候（A 发消息给 B），node A 要发送自己对「时钟」的掌握情况，node B 收到后，更新 vector 里所有比自己已知更大的 timestamp。算法如下（请自行 wiki 以获得更准确的信息）：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;每个 node 都有一个 timestamp vector，初始化为全 0。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果某个 node k发生了某个事件，将其对应的 vector[k] + 1。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果 node k 给 node j 发消息，那么先将 node k 自己的 vector[k] + 1，然后将整个 vector 连同 message 一起发给 node j，node j 将自己原有的 vector[j] + 1，再把 node k 发来的 vector 和自己合并（找最大值）。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;通过 vector clock，虽然没有绝对的 global clock，但是我们在分布式系统里能够保证因果，从而消灭了在这个维度上的不确定性（还有其他不确定性！）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们可以看到，vector clock 的算法严重依赖于节点间的信任，所以它只适用于一个可信赖的分布式环境。而作为运行在节点间互相并不信任的 P2P 网络上的 bitcoin，无法确保这一点。那么，类似 bitcoin 这样的分布式系统，是怎么决定时间（因果）的呢？中本聪在 bitcoin 的设计中，巧妙地应用了 PoW 的产物，block 来作为系统的逻辑时间：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;The solution we propose begins with a timestamp server. A timestamp server works by taking a hash of a block of items to be timestamped and widely publishing the hash, such as in a newspaper or Usenet post [2-5]. The timestamp proves that the data must have existed at the time, obviously, in order to get into the hash. Each timestamp includes the previous timestamp in its hash, forming a chain, with each additional timestamp reinforcing the ones before it.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以，blockchain 不但承载了 ledger 的功能，chain 上的一个个 block 还是一个个 timestamp，代表着这个系统的过去，现在，以及未来，从而协调整个分布式系统步调一致地前进（且让我再奶一下聪哥）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;看到这里，我相信很多人有个疑问 —— 程序君，为什么我做的分布式系统既不用关心 vector clock，也不用 PoW，整个系统也木有 global clock，怎么还一样运行得好好的？没错。你没有感知，并不代表它不存在或者不重要 —— 你的系统里的 postgres，consul，kafka，或者说，分布式系统里一切看似中心化的部分，都使用了类似的机制，只不过它们帮你把这些细节屏蔽掉而已。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;coordination / communication&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;好，了解了 lack of global clock 带来的不确定性，以及如何应对这种不确定性，我们再看分布式系统里下一个会引发不确定性的基础组成部分：沟通协作。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;单机系统，协作和沟通也是件轻而易举的事情 —— 同一个线程，在 stack / register 上同步（取决于 ABI）；不同线程，semaphore；不同 CPU，spin lock，memory barrier，反正大家生活在一个屋檐（时钟）下，咋都有办法。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;分布式系统下就尴尬了。隔壁老王之所以被称作隔壁老王，是因为你们两家之间至少有一堵墙（住大 house 的有两堵墙），所以在无法四目相对的情况下，你们沟通基本靠吼。吼是个文言文，在现代计算机文明中，我们管它叫：发消息（message passing）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;发消息前先要确保有合适的信道，你得先确保这个信道建立成功并且可以信赖：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.71875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpAF4TIOTgIsdDGyRv3mqTaJrQBwIWCicFVq6UvuaAiciavJiaGKWG29Iynw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所谓可信赖，就是消息在网络上不会丢失，我只要发了，对方的 application 就一定能收到（避免下图所示的不确定性）：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.3140625&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpiavbD69sSaaTUFeGNvottdy2s6DydxwzOkibtvOmLdAYWYEibd4qdVRicg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;而且既不会像下面这样乱序，也不会把 partial message 交付给 application（保证消息的完整性）：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.39453125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpyI2QASzJz4NC8RwktzGBsMzfoibP775Wk2QhEPJAKF4J3gn9WicNU3bQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;有了可信赖的信道，我们可以通过 message 来达成共识。我们先看两个人达成共识会遇到什么障碍：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.334375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpqIAxPQPmhNc036mIVXwtGJ5zXdibfgwPeibAfJnicMJSnia4ibpFY5N6Kbw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;发送的节点或者接收的节点可能会 crash —— 即便网络层保证了 application 一定会收到消息，但我们无法避免 application 在处理消息的时候挂掉。因而，message delivery 有两种策略：&lt;strong&gt;at least once&lt;/strong&gt; 或者 &lt;strong&gt;at most once&lt;/strong&gt;。at least once 是指同一个消息会被传输 1 到 n 次，而 at most once 是指同一个消息会被传输 0 到 1 次。这很好理解，如果 messaging system 内建了重传机制，并且将消息持久化到磁盘中以保证即便进程崩溃消息依旧能够送达，那么这就是 at least once。反之，如果没有构建任何上述的机制，消息送出后就并不理会，这是 at most once。在一个网络环境中，消息的送达只能是上述两种情况，不可能 exactly once，如果有人这么说，那么一定是在误导。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;at least once / at most once 并没有解决不确定性的问题，所以我们还得再努努力 —— kafka / AWS kenisis / AWS SQS 实现了 essentially once 的 message delivery 机制。essentially once 是 at least once 的变种，它需要消息层和应用层同心协力 —— 应用层处理完消息，主动告知消息层，令其删除对应的消息。如果你用过 SQS，应该能感受到这一点：SQS 保证当一个 application 在处理某个消息时，消息对分布式系统里的其他人是不可见的，如果 application crash，消息会在 visibility timeout 后重新可见，如果 application 处理完毕，需要显式地删除这条消息。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;最终，我们可以通过消息传递的机制，来达成一致：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.634375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDp5AXU4dIN5KDvF7D78oz5RGn8H4WCBfBSuVfGFEzlXtXPUlEhUicSPGQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;到目前为止，我们所谈论的还主要是仅有你和老王参与的 message delivery 的问题。在一个分布式系统里，任意两两节点间都可能有消息往来，而由于缺乏全局的时钟，我们无法保证消息是全局有序的（TCP 只能保证相同发起人发送的消息时有序的），通过 vector clock 或者类似的机制，我们可以进一步保证消息在因果关系上是有序的。这在大多数情况下，已经足够好。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;然而，在众多参与者的情况下，即便我们保证了消息局部以及在因果关系上有序，我们还是无法保证所有参与者达成共识。如果大家就该不该做一件事情（比如来了一条数据，怎么写，写到哪，谁来写等）无法达成共识，那么，这样的系统依旧是不确定的。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;于是有了 2PC（2 phase commit），3PC，Paxos，Raft 等在可信环境下的共识机制；同样的，对于 blockchain 所面临的不可信环境下（Byzantine General probelm），诞生了 BFT / PBFT，以及 PoW，PoS，DPoS，PoI，PoD，PoDDOS 等一堆 P 字辈靠谱或者不靠谱的共识算法（很快，P 都不够用了）。限于篇幅，关于共识算法，我将另行撰文讨论。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;如果你更多了解消息系统及消息传递的 pattern，可以看看我之前的文章：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827495&amp;amp;idx=1&amp;amp;sn=1016abef2a23ab43c6c6253228f7960c&amp;amp;chksm=8704aabbb07323adbfcfcd19b9f65527067f175220b8bf02d86012f96d08ff117255920a82e0&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;ZeroMQ及其模式&lt;/a&gt;（再沉痛悼念一下 Pieter Hintjens）。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;分布式系统中的坑&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;上文中我们已经把分布式系统中最基本的要素过了一下。接下来我们踩踩坑。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;坑一：network is reliable。我们在消息传递中，费尽心思做了很多事情，就是在跟并不 reliable 的 network 斗争。其实 packet loss / out of order 是属于还好解决的问题；不那么好解决的问题是：split brain（脑裂）。split brain 是基于 asymmetric consensus 的分布式系统（亦即常见的 master-slave cluster）的梦魇，一旦 master 过忙，导致 slave 认定它应该卸任，slave 接管后，因为冷启动，也变得太忙，于是又切换回去 —— 于是 master / slave 都在一定时间内异常繁忙，replication 失败，数据出现不一致，接下来双方都认为对方 down 掉，自己成为 master。这就是 split brain。这种级别的问题，修复起来都麻烦（尤其是对于使用了 autoincrement，然后又被 foreign key 引用的数据）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;坑二：消息传递的 latency 可以忽略不计。我们知道网络的 latency 是大致等于两点间距离除以光速。北京到旧金山，极其理想的情况下，一个 round trip 也要 63ms（9516 x 2 / 300, 000），这是一个不小的时间了，如果使用停等的方式互相确认详细，1s 仅仅能打十几个来回。下图是一个完整的计算机系统里各个部分的 latency 的量级的介绍，大家都应该读读，心里有个谱：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.5&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpTh4HH8JsLf96yBFQDDlBx2J7oAv6JoOtmdrt87I326Lib59vCyrt0og/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1024&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;坑三：网络带宽不是问题。在 cloud 里，带宽不是问题。但由众多家庭用户参与的 P2P network，带宽，尤其是上行带宽是明显受限的。我家的百兆网络，上行经常也就是 12Mbps。我在上一篇文章 &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827914&amp;amp;idx=1&amp;amp;sn=dd991eaef0e108cb9362f6ed9b135bef&amp;amp;chksm=8704a856b073214005b2cc52d2ee7667a02832aa17a676953265b6099696d9dff33fc762ccd0&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;比特币浅析&lt;/a&gt; 里谈到为何比特币使用 1M block，是因为如果这个网络的初衷是所有人都可以参与进来，那么，要考虑到普通用户的带宽承受能力。假设你的电脑费劲巴拉算出一个区块，你要立刻将其广播到 7 个邻居，如果 30s 内完成广播，那么你需要 1.86 Mbps（1MB x 8bit x 7 peers / 30 sec）的带宽；如果 block 是 8M，那么你需要 15 Mbps 的上行带宽。所以，如果设计运行在 cloud 里（&amp;gt; 1Gbps）的分布式系统，可以不必太过在意带宽，但是要做一个人人都用的起的 blockchain，起码不要拍脑门设定 block 大小。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;坑四：参与的节点是同构的。像 bitcoin 这样的分布式系统，参与的节点小到手机（钱包软件），大到专门开发的带有 ASIC 或者 GPU 阵列的矿机，不一而足。它们所使用的网络，从 wired，wireless 一路到 cellular，satellite。所以我们要考虑到区别如此之大，范围如此之广的参与者。矿机自然要获取全部数据，但你让手机用户还下载 160G 的 chain，那就是强人所难。bitcoin 对此专门考虑到 blocker headers + merckle tree path + SPV 的方案，允许小型设备只需下载少量数据（几百兆），就可以充当钱包，验证和自己相关的交易。这是我们需要学习的。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;CAP 理论&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;分布式系统中，绕不过去的一个话题是 CAP 理论：即对于 Consistency，Availability 和 Partition tolerance，你只能保证其中两个，而牺牲第三个。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.74375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ098IVdTkjM2T3xiaXMwaSGDpHQMZbEXlnpFepFW3bngGKicxHcIXclw3wRZCkE6vsNfdGhRzC3NDF5w/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我来简单解释一下：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Consistency：所有客户端看到的同样的数据。这里所说的 consistency，是指 atomic consistency (linearizability)。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Availability：每个客户端任何时候都可以读写。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Partition tolerance：当网络出现 partition（split brain）时，系统仍旧可以工作。换句话说，为了能够支持 Partition tolerance，系统需要能够容忍任意多的消息的丢失。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;谈论一个系统是 CA，CP，还是 AP，其实是把复杂的问题过分简化。但分类有分类的好处：它便于比较和记忆。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;MongoDB 在上图中被我归到了 CP，这是因为写入是缺省 safe=true，也就是牺牲了 Availability，只能写入 master。然而，这种情况下，MongoDB 仍然难说是 Consistency 的，只有当 readConcern 设为 linearizability，才算得上 Consistency。所以，MongoDB 的 CP 属性很勉强，不同的设置下很难将其归属到某一个分类中。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;现在的分布式系统，其实对 CAP 三者都有考虑，只不过是优先级的问题 —— 我更看重哪两个，而愿意牺牲第三个？MySQL 在 master/slave 的配置下，牺牲了 partition tolerance，但我们也可以将其配置成 cluster，牺牲 Availability，才成全 Partition Tolerance。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;考大家一个小问题：bitcoin 是 CA，还是 CP，还是 AP？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;先写到这里。有机会再写本文没有展开讲的共识机制，它是分布式系统的基石。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;iOS 用户赞赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;2090357198&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;android 用户赞赏专属通道&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;android 用户赞赏专属通道&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-03-03-1000000096</guid>
<pubDate>Sat, 03 Mar 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>比特币浅析</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-02-23-1000000095.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAT62suffC1uGBtWjvZNzgGZOtsJ05OBPj3JX*rRy1Lgl12Uhk1-wDbgnPOGvpQzTc88hG8pcDyRyT*2*yx4hkZI=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    比特币浅析                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-02-23&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;与比特币首次结缘大概是 2013 年我结束创业，回到 Juniper 时。有阵子，饭桌上我的同事东哥经常会眉飞色舞地谈起很多关于比特币和中本聪的轶事，还有他做量化交易的有趣经历，并常常劝我也看看这个主题 —— 即便那时我对此并没有太大的感觉。经历过一次如梦般的创业历程，我还在艰难适应朝九晚六的坐班身份，以及，谋划着未来肉身翻墙的事宜。我浅浅看了网上有关比特币的中文资料，简单将其和电子货币画上了等号，根本没有阅读中本聪的论文，也没有关注任何一篇比特币的技术文章，就将其抛诸脑后。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;再度被拉回比特币的世界，是去年八九月的事了。有朋想尝试量化交易 —— 我想起了东哥曾经做过这事，又觉得这玩意挺有意思，就拉他一起，业余时间用 elixir 和 datadog 草草做了个 demo（见我的文章：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827794&amp;amp;idx=1&amp;amp;sn=7e968057cf4ba72f775dde454d89a0ce&amp;amp;chksm=8704abceb07322d8bacc40389e4a0fce0955f7da9b72c0c4a4b613541d6fa69fc65234a8567d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;闲扯比特币套利交易系统的设计&lt;/a&gt;）。后来大家觉得这事投入资金不小，扣除交易手续费后的收益不大，我们又没有太多的时间仔细打磨，就没有继续下去。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;这两次和比特币都是擦肩而过，并没有触及其核心，我所有关于比特币和 blockchain 的知识都源自非技术圈的小道消息。直到最近，朋友老冒的 ArcBlock 引起我的注意 —— ArcBlock ICO 公募启动后不到二十分钟便宣告售罄，还因为散客们投资热情过分高涨，让 ethereum tx 大量积压，引发震动。老冒谈起他入坑的心路历程，是这么说的：『一件事情如果我看不懂，要么是这事本身不靠谱，要么是我能力有限，没看透。但是如果靠谱的人做一件不靠谱的事情，那么可能是我错了，事情本身靠谱，我没看透而已。当我微软的同事，我所敬仰的大牛 Flavien Charlon 也出来做 colored coin 时，我被震动了。我开始严肃看待 blockchain。』&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0icbWiaUAJllLTHxNfiaqrP58WicTvI352IDuqmR03PAnpZAw7INQb6LmIYrm32RC7K1wDq51PBEW8nfg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;（ethereum tx 拥塞）&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;我一时呆若木鸡，我对比特币和 blockchain 技术的漠不关心，是否也是我并没有看懂看透这本来靠谱的技术？在老冒的鼓动下，我决定真正深入 blockchain 的技术细节，去探究这种让牛人纷纷为其痴迷（我指技术上）的真正原因。我圈了一批 paper 和白皮书，下载了若干源码，找了若干文章后，开始在周末的时间里撸袖子看起来。在草草一刷比特币创世论文（Bitcoin: A Peer-to-Peer Electronic Cash System），一些白皮书，还有各种文章和视频后，我越来越觉得我有必要把那些基础的问题搞懂 —— 尤其是在主流的技术解读都是流于表面的情况下，比如说：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;为什么用 PoW？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;blockchain 的数据结构长什么样子？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么一个 block 要设计成 1M，而一个 block 生成的时间限定为 10min？超过或者小于这个时间怎么办？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么币的总量 21M？（为什么 TM 不是 2 的幂？或者一个更大/更小的数字？）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;tx 为何设计得如此奇特，可以多 input 多 output？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为何 verification 这样一个看似简单的过程要用 opcode 来完成？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果使用 open ledger，security 和 privacy 是如何保证的？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;WTF base58？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么钱包不直接用 public key，而是 hash 一下多此一举？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么会允许不包含任何 tx（除了 incentive tx 外）的 empty block 存在？为什么大家不借此 game system，获取先发优势？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;钱包是怎么回事？钱包需要整条链的数据么？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;量子计算是否是比特币的终结？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么，为什么一个 2008 年的学者，能如此清晰冷静地面向未来思考，面向未来编程？十年后，他所提出的架构仅仅是小修小补，作为一个 ledger，并无大的问题（Ethereum 解决的问题 bitcoin 本来也没打算解决）？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;…&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;这个问题列表几乎是无穷的。带着这些令人兴奋的问题，我重读了中本聪的论文。和上一次的漫不经心相比，这次，我几乎是跪着读完的。为了吃透小小的 8 页文字，我还翻阅了不少他当年向旁人解释论文的邮件（感谢 mail-archive），以及 V 神早期对此解读的一些文章。我发现我陷入了 the more you know, the more you don’t know 的狂喜 —— 有点 Alice 掉进 rabbit hole 的感觉，或者，一种言语难以形容的 serendipity。我终于从以前那种懵懂无知，步入到了知耻后勇的境地。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;按照我的 learning by teaching 的尿性，二刷比特币创世论文后，我便忙不迭地做了 slides，给 team 讲 bitcoin 里面那些激动人心的思考和实现。slides 我就一一不贴了，下面是其中一页：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.7109375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0icbWiaUAJllLTHxNfiaqrP58WRC5x6PB9eCb9fg02BhmnLUqbMic59MB1kXQqJLLJU0MFQrgMCUSEZCg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;单单就这一页，就有好多好多值得问的问题：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;为什么这个数据结构里面的值要用 little endian？这是设计缺陷还是别有用心？（别轻易下结论，考虑约定俗成的网络序都是 big endian）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么计算 nounce 时，不用整个 block，而是选择了这些域（尽管 integrity 还是通过 merkle root得到了保证）？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为什么要费力把 tx 组织成 Merkle Tree 的形式？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;…&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;不多说，大家自行去 &lt;span style=&quot;color: rgb(2, 30, 170);&quot;&gt;github.com/tyrchen/unchained&lt;/span&gt; 或者点击「阅读原文」下载阅读（我会根据我所学随时更新它）。&lt;/p&gt;&lt;hr&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;说些题外话。互联网时代，做网络协议开发的工程师（简称网工）是个吃力不讨好的差事。价值链的上移让网络设备和基础设施管道化，应用赚够了钱而基础设施也就温饱。虽然不应该用「造原子弹的不如卖茶叶蛋的赚钱」来比喻，但有着十年经验的网工收入比不过两三年经验的脚本小哥是不争的事实。论工作的难度，常年跟红黑树，skiplist，ager ring，hash table 打交道，写段代码不得不考虑 endian issue，定义个数据结构要想着 fit in cache line，有时恨不得一个 bit 一个 bit 扣的网工，要比不管三七二十一，什么都塞到一个 object (dict/map) 里，cache line 啥玩意没听过，传个 bit 都用 json 的脚本小哥工作起来困难的多。可惜的是，你不在价值链的上游，你所有的努力，所有的 proof of work，在互联网，移动互联网的浪潮里，好像荷叶上泻过的水，留不下一点痕迹。这很不幸，但这就是现状。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;然而 blockchain 在试图扭转这个价值链，让网络层和传输层，而不是应用层，重新变得重要起来：在这次洪流中，网络开发（及系统开发）的价值重新凸显 —— 你看，比特币的设计中处处体现着对网络的深刻理解，对内存的精妙使用，对数据结构和基础知识的无比重视 —— 别的不说，光是 block header 的结构，那个 0xD9B4BEF9 的 magic number 就让人嗅到了初恋的味道（0xdeadbeef，你丫可好？）&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;所以，blockchain 可能是网工最好的翻身仗 —— 上不上车不重要，先入坑吧，搞些技术储备总归是好的。没准就相当于 44 年入党了呢？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;（谨以此段题外话献给那些和程序君打过交道的，或者没打过交道过的网工们）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;IOS 用户赞赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1478427717&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;上不上车的，先入坑吧&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;上不上车的，先入坑吧&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;https://github.com/tyrchen/unchained?files=1&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-02-23-1000000095</guid>
<pubDate>Fri, 23 Feb 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>猿来三十五</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-02-14-1000000092.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsARKnti1jpQGJ*nPRcQU5ySNUM5463pbO0aao2T8yzPrYCFQPwaWKeJVlb6NboUNY99coUAs0InZPPEKNd*6Lpls=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    猿来三十五                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-02-14&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;本命年，人生的第四个 iteration 已经开启。今天被朋友发的一段文字给戳中了，本来想在公众号里胡乱写点什么纪念一下，结果 gitbook init 生成的 36-years.md 前，静静躺着一个 35-year.md。打开看看，才忆起这是去年生日前后胡乱写的文章，不知怎的，写下一半便就此搁笔，只是把其中的一个片段单独成文，标题是：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827599&amp;amp;idx=1&amp;amp;sn=978fe8d2cf396a814463552ab2fac97b&amp;amp;chksm=8704ab13b0732205007723b246a744102624053b95c49b7a5e8b3df2f4ca505656c679516bfb&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;标签&lt;/a&gt;。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;痴长了一岁，更加豁达了些，勇敢了些，脸皮也因着加州的阳光晒厚了些，所以，36-years.md 暂时不写了，把 35 岁的我拎出来溜溜。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;（一）&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;无可奈何花落去&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个二月，对我的整个人生而言，是一个特殊的月份，因为，我终于要跨过那个程序猿们闻之变色的三十五岁魔咒了。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在程序猿的远古年代（89-05），坊间流传着这样一个魔咒：程序猿这种职业，干不过三十五。换句话说，三十五你还没转不写代码「只动动脑子」的 architect，PLM，或者转不写代码「只动动嘴皮子」的 manager，sales，那么你一定会被25岁的后浪拍死在沙滩上。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;十几年前，我真的为这事惶恐过。在回龙观居住的日子里，案头和书柜里摆满了企业管理的书。附在案几上，我时常想，努力个九年，在三十岁前，逃离做码农的苦海。啊，对了，上古年代程序猿好像还不被称为码农，倒是 CSDN 上一篇文章 「程序员和妓女」，把程序员这个在国内仅仅诞生十余年的职业硬生生拔高到和那个最古老的职业一样香艳的位置。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;三十岁前，我还真如愿以偿，做上了 manager。我喜欢管理的工作，喜欢定战略，搭班子，做产品的挑战，喜欢将周围的人培养起来的那种成就感，但不知怎的，我还是不愿放下手中的键盘。当平日的工作渐渐不允许我写代码时，我开始利用周末，或在国图，或在清华科技园，挤出时间写上些许代码，聊以自慰。这种状态有时候让我揪心：我的这种游移究竟是被内心对 coding 的热爱所驱使，还是出于对脱离一线，未来可能「绕树三匝，无枝可依」的恐惧？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们知道，尽管驱动力不同，爱与惧都能起到激励作用，让人干好一件事。但我不希望生活这五光十色的大泡泡被戳破后，溅出的都是对未来的恐惧。如若这样，那还不如当机立断，换个真正喜爱的职业，开开心心地施展抱负，而非战战兢兢地守候。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;幸运的是，后来在创业的日子里，我在创新工场遇到了远古时代被敬为天人的程序员：简晶。如果你听说过 UCDOS 和联众，那么你应该能够回忆起这个名字。那时他已经早早地跨越了三十五岁魔咒 —— 在结束联众的创业后，他做了一段时间的天使投资人，然后开始做一个叫「拨号精灵」的项目。和他寥寥几次对话中，我得知，他还在写代码。后来我看到一篇对他的采访的报道，心有戚戚，便誊了下来：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;离开技术已经有十年左右了，但是当我再次接触技术的一瞬间，所有东西都回来了，好像我从来没有离开过，那些东西可能是被我刻意掩盖的。我最终决定跟随内心的指引，选择继续回到过去的生活方式，而不是去做一个旅行家，天天过着“另类”的日子。&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我的心结彻底被解开了。从那时起，我不再游移彷徨。三十五岁魔咒，至少，和我无关。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;（二）&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;十年一觉扬州梦&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;人生在世，不得已被打上许多标签。有些人的被他们的朋友打上了高富帅，白富美的标签。而朋友们给我打的标签是：土肥黑圆 —— 土肥圆的黑化加强版。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在工作中，我当下被贴上的标签是 VP。VP 是个感人的标签，因为它 P 都不是。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在公众号上，我的标签是程序君。程序君，程序君，听上去儒雅倜傥，羽扇纶巾，谈笑间，八阿哥灰飞烟灭。可读者给我的画像是：一个岣嵝着背，扶着厚厚的镜片对着屏幕上的代码流哈喇子的中年抠脚大叔。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;回到家里，我的标签总算变得尊荣起来。女儿动不动就封我做国王，因为这给她当 THE princess 法理上铺平了道路。为了这个高贵的标签，我得付出一点点微不足道的代价：她不当公主的闲暇，我需要随时变身为她的坐骑 —— 就是那种趴在地上摇头晃脑，看上去比牛魔王的碧水金睛兽智商略高的萌物。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;标签是个很有意思的存在，每个人终其一生都在为了一个又一个的标签而奋斗。别以为自己淡泊名利，无欲无求就没标签，也许你不自觉得给自己打上了 :“赛刘伶”，而你的朋友们私下里亲昵地称你为 :“八戒”。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;过去的十余年，我很努力，也很幸运，先后为自己打上了 :husband， :manager，:inventor，:“房奴”，:father，:entrepreneur，:author，:“硅谷码农” 等标签。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;然而，标签就跟用过的卫生巾一样，无论之前是多么的洁白光鲜，用过了，履行了它的历史使命，就该扔进垃圾桶，封存在故纸堆里了。一个人不该守着她们让其变成生活的全部 —— 人生还有辣么多新标签去夺取哩！这一点，我得像老费学习 —— 他那闪瞎我的狗眼的大满贯奖杯是儿女们嬉戏时的玩具，而不久前费了九牛二虎之力拿回了丢失了七年之久的澳网奖杯，女儿们却大咧咧地想用它盛汤。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;（三）&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;任陌头、年少争旗鼓&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;生活是一场接着一场地赶路。经常旅行的人都有一个感受：要用最好的心情接纳最糟糕的事件。因为你很难预料一路上会发生什么。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;07年，我和老婆去欧洲旅游，开车从德国过境奥利地时，天气突变，原本湛蓝的天空被一大片黑云裹盖，暴雨如尼亚加拉大瀑布一样倾泻而下，下午四五点的大白天瞬间裹上了黑幕，像是深夜时分。过境时，我们本打算在边境处的休息站歇息片刻，再去下一个目的地，但临时变了主意，想一鼓作气结束战斗，不料却被暴雨困在了高速路上艰难前行。当时雨大到雨刷器最大档疯狂工作都无法让雨水短暂让出视线，而能见度差到只能靠分辨前车微弱的灯光来确保自己的车道。就这么屏着呼吸战战兢兢地开了约莫半小时，天际出现了一条奇妙的分隔线，一半湛蓝，一半黝黑，远处挂着一道美丽的彩虹，和高速路边鳞次栉比，绿意浓浓的小村子相互辉映，美得让人动容。旅途中的惊心动魄换来了难得一见的美景。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;但生活中很多时候不会给你这种 happy ending。有时候赶路走了半天又回到了原点，苦心经营却一无所获。然而这好比香料，捣的越碎，磨得越细，香得越浓烈。乔布斯讲 connecting the dots，我是岁数越大，对此就越有感触。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;一五年十一月某个阳光明媚的周五，我休了假。把小宝送去幼儿园后，我跟老婆沿着 Cupertino library 附近的一条小路漫无目的地散步。蓝蓝的天，路两旁醉人的红叶，书写着秋景瑰艳。我们难得放松，挽着手享用属于我们的即将变得稀缺的二人世界 —— 隔周的周一，我就要去 Tubi TV 报道，重新回到忙碌的 startup 的世界。未来有多少艰难险阻，谁也不知道。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;现在再回想这一年多的征途，我竟然就这么熬了过来：我熬过了加入早期几乎每晚黄金时段准时来一发的 outage；熬过了把整个 API 系统重写的艰难时刻；熬过了同事来来走走；熬过了每天三个半小时的通勤；熬过了一个又一个 offer 对我的诱惑，甚至，熬到了娃儿上 pre-K 的年龄。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;冯仑说伟大是熬出来的。熬即坚持。本来普普通通的事情，坚持让其变得与众不同。我写了三年公众号，这三年写下的这些文字，成就了我；我跑了三年步，现在仍坚持跑着。写字和跑步本身没什么特别的意义，只是坚持赋予了它不一样的意义。在这些日复一日，周复一周的坚持中，我的雄心不会被生活中的起起伏伏所磨平，我的热情也不会因他人的看法而高涨或者消亡。如果说早期我写文章还总去迎合一些热点，现在我写的时候一定是我想写的时候，写出来上万阅读的文字，固然很好，如果只有寥寥数百的阅读，我也不会因此沮丧而切换话题。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这就跟我选择用 Elixir，用 Clojure 做一些喜欢的事情一样。我喜欢他们，是因为我真的喜欢他们，无关大众小众，无关工作机会或者薪水多寡。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;（去年的文字，并未真正完结，现在即便给它补写下去也顶多是狗尾续貂，因为心境不同了。所以未完就未完吧，咱们不待续）&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;IOS 赞赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1619850170&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;春节过后，今年 1/6 就画上句号&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;春节过后，今年 1/6 就画上句号&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-02-14-1000000092</guid>
<pubDate>Wed, 14 Feb 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>分布式系统中的监工：Overseer</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-02-13-1000000091.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAeofHOJUAff32fWe3MWEPqHlD9QjJKfPwIqjN7LMQmTmVWSraKKriG-ZdIlfj*2lc*WbC1UQt4ybzSgZlBFarAw=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    分布式系统中的监工：Overseer                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-02-13&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;最近从无趣的工作中发现了有趣的事情，工作和业余时间都扑了些精力上去，本待上周末最终的成果出来后再写文章的，无奈事情太多，代码还没写完，二月上旬已过，再不写文章春节就过去了，所以这次程序君先上车，再补票。&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;需求&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;事情是这样的：两周前同事催促我升级我之前做的一个轮子 merlin - 见我去年的文章：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827801&amp;amp;idx=1&amp;amp;sn=7ac5e18b2330feab536bda1c0c803adc&amp;amp;chksm=8704abc5b07322d32d72260f6ab1f450a8df88db9015dcc195f54073cc831ca01d3c9d6ec650&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;停下来，歇口气，造轮子&lt;/a&gt;。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在那篇文章里我提到了为什么会有需要做这样一个内部的 release 构建工具。自那时起，merlin 为我们内部的几个 elixir service 的 release 保驾护航几个月，总体表现不错。然而，当时在需求和设计上的一些缺陷，导致这款产品有这些问题：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;太依赖 github release —— 如果不生成新的 release，就无法自动构建。这对依赖 staging 进行集成测试的服务不友好。使用者需要在 pull request 里升级版本（才能生成一个 build）。因此，多个开发者间需要在 pull request 中把版本错开，很不方便。开发频繁的时候，我们一天的 patch version（SemVar 里第三位），五个十个地狂跳，比旧金山 TaxiCab 的计价器跳动还要可怕。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;merlin 使用的两台机器都是 t2.medium，一次 release build（还包括一次 release upgrade build）花费十来分钟。当构建繁忙的时候，在队列后面的请求要很久才能排到（Latency 不友好）。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以我要在下一个版本中，将这些问题解决。初步的考虑是，当构建请求来临时，启动一个强大的 spot instance，处理构建任务，构建完成并上传 S3 后，spot instance 自行了断。构建请求可以是来自 github release message（兼容上一版本），也可以是 API —— 进而，我们可以制作 CLI 工具，让用户在 shell 下对任意 git commit 触发构建。有了粗浅的想法后，我们理一理需求：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;用户（包括 github）可以通过 API 触发构建&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;构建被触发后，启动一个 spot instance（或 ECS fargate，不过 spot instance 实在太便宜了，如 C5.large $0.03/hour，所以 ECS 没有啥价格优势）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;spot instance 基于一个 prebuild 的 AMI（如果 ECS，则 docker）启动，AMI 里包含处理构建的软件。这样启动起来之后，就能自动处理构建任务&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;描述构建任务的 metadata 放置于 spot instance 启动时的 user data 中，构建软件通过 &lt;code style=&quot;;&quot;&gt;http://169.254.169.254/latest/user-data&lt;/code&gt; 访问之&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;构建过程中可能要发送一些 telemetry 到 merlin&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;构建完成，把状态和构建的信息（比如 tarball 在哪里）发回给 merlin，然后自尽&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个需求算是比较清晰，实现起来也没有什么难点，无非就是时间问题 —— 对于像我们这样的 startup 来说，它是可以立即撸起袖子干活，逢山开路遇水填桥的那种活儿。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;merlin 之前的坑是我埋的，这个业务即不性感，也不紧急；backend 的队友们都扑在一些 visibility 高的，光是名字听起来就热血沸腾的项目上，腾不出手，且我也不舍得就这么浪费他们的时间 —— 所以我只能 eat my own dogshit。我这人白天瞎忙，晚上躲懒 —— 除非有什么能戳到 G 点让我不吃不喝不睡觉也要搞的创意，否则像 merlin 这种一眼就从头看到脚，没有太多挑战的项目，激发不出我的小宇宙。于是需求定下，反正也不着急，我就懒懒地，有一搭没一搭地在脑海中想着。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;事实证明，这种懒散，而非全力以赴，促成了我更多，更深的思考。有功夫我把整个思考的过程撰写成文，相信对大家也能有小小的启发。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;实现&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在上面的需求中，merlin 由一个服务被拆成了两个部分：control plane 和 data plane（请饶恕一个曾经的网络工程师对区分路径的这种骨子里的执着）。简单来说，control plane 负责派活和监控，是个 scheduler，类似于老鸨；data plane 负责干活，是一堆 resource，就好像苏小小，柳如是，李师师们。而一个个构建任务，是要完成的 task，就是赵佶，柳永，阮郁等的不期而至。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;把 merlin 的需求稍稍泛化一下：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;调用者可以通过 API 触发一个 task&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Control plane 接到 task 后，分配到 data plane 上的某个 resource 上执行&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;data plane 向 control plane 汇总 telemetry&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;data plane 完成 task 之后，向 control plane 汇报结果，进入到 idle 状态等待下次调度&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;为了符合社会主义核心价值观，我们换个比喻：Control plane 类似于 erlang/OTP 里的 Supervisor；data plane 类似于 GenServer。对于 erlang 不太熟悉的同学可以看我的文章：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827691&amp;amp;idx=1&amp;amp;sn=8d6854f91bb9d16470ef6eed9d3ad8ec&amp;amp;chksm=8704ab77b0732261eb63217ad03740a3433cde4491826eeec020f4bbebb8b18837c27ac3e74d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;上帝说：要有一门面向未来的语言，于是有了 erlang&lt;/a&gt;。你不必理解代码，但需要理解思想。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;然而，erlang/OTP 里的 Supervisor 只负责启动和监控 process，如果要启动和监控 node，有很多问题：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;如何在 cloud 里动态启动一个节点？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如何让这个节点自动加入到 cluster 里？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如何让这个节点有运行 task 所必须的软件？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;control plane 如何和 data plane 方便地通信？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如何把上面的所有细节屏蔽起来，启动和监控一个节点，像 Supervisor 启动和监控一个 GenServer 一样简单，且对程序员友好？&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;1/2/3 如果解决，4 可以直接通过封装 RPC 解决。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;2 我们上文中提过 —— 我们可以通过给新启动的 instance 提供 UserData 来解决 —— 在 AWS 里，当我们启动一个新的 instance，可以预设一些 json 数据进去，本地访问 &lt;code style=&quot;;&quot;&gt;http://169.254.169.254/latest/user-data&lt;/code&gt; 即可获得，因而，我们可以把 cluster 的 cookie，control plane node 的 node name 都放进去，以便于新的节点可以自己加入 cluster。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们看 1 和 3。最简单解决 1/3 的方法是使用 prebuild AMI —— 把所有相关的，处理 data plane 的软件都烧到 AMI 里，用 request-spot-instance 的 AWS API 创建节点即可。不过，这意味着每次 data plane 的代码改变，我们都要重烧 AMI，即便烧 AMI 的动作 CI 自动化处理了，每次 control plane 还是需要确保使用正确的 AMI 启动 data plane。有些麻烦。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;程序员最不爽的就是麻烦。&lt;strong&gt;虚心使人进步，麻烦让程序员创新&lt;/strong&gt;。咋办？我们能不能做个 loader，把一个编译好的 module，甚至一个 release 动态加载到远端的一个 node 上？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;bingo！这是一个好问题，而&lt;strong&gt;好问题的价值远胜于好的答案&lt;/strong&gt;。于是大概两周前的一个周末，我写了几百行代码，做了一个初始版本的 ex_loader。见 github: tubitv/ex_loader。代码已开源，MIT license。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;ex_loader 让你可以很简单地干这样的事情：&lt;/p&gt;&lt;pre class=&quot;sourceCode elixir&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode elixir hljs perl&quot; style=&quot;;&quot;&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;:ok&lt;/span&gt;, module} &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;ExLoader&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;load_module(&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;hello.beam&quot;&lt;/span&gt;&lt;/span&gt;, :&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;awesome-node&lt;span class=&quot;hljs-variable&quot;&gt;@awesome&lt;/span&gt;.io&quot;&lt;/span&gt;&lt;/span&gt;)&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;va&quot;&gt;:ok&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;ExLoader&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;load_release(&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;https://awesome.io/example_complex_app.tar.gz&quot;&lt;/span&gt;&lt;/span&gt;, :&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;awesome-node&lt;span class=&quot;hljs-variable&quot;&gt;@awesome&lt;/span&gt;.io&quot;&lt;/span&gt;&lt;/span&gt;)&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;你即使不理解 elixir 代码，大概也能猜到第一句它将一个本地的 module 加载到同一个 cluster 里的叫 awesome-node@awesome.io 的节点上；第二句，则将一个在某个 website 上的 erlang release，加载到相同的节点上。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;Joe Armstrong 曾经在一次会议上开心地谈到过他自己会在 erlang node 上运行很多空的，什么也不做，也不知道该做什么的 process，但当他有需要的时候，让这些 process 加载新的 module，就摇身一变让其成为拥有某种特定功能 process。ex_loader 在此基础上更进一步，你可以开一些空的 erlang node，有需要的时候，让这些 node 加载你想让其运行的 release，使其成为特定功能的 server。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;ex_loader 简化了 control plane 往 data plane 发布软件的工作，我们有了一个更好的解决 1 和 3 的方案。然而，我们还没有触及到上文中所提到的 5。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这就是 Overseer，一个新的，类比 Supervisor 的 OTP behavior。我们先看怎么用 Overseer：&lt;/p&gt;&lt;pre class=&quot;sourceCode elixir&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode elixir hljs bash&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;local&lt;/span&gt;_adapter &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {&lt;span class=&quot;cn&quot;&gt;Overseer&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Adapters&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Local&lt;/span&gt;, [&lt;span class=&quot;va&quot;&gt;prefix:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;test_local_&quot;&lt;/span&gt;&lt;/span&gt;]}&lt;/p&gt;&lt;p&gt;opts &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;va&quot;&gt;strategy:&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;:simple_one_&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;for&lt;/span&gt;_one&lt;/span&gt;,&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;va&quot;&gt;max_nodes:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;]&lt;/p&gt;&lt;p&gt;release &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {&lt;span class=&quot;va&quot;&gt;:release&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;OverseerTest&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Utils&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;get_fixture_path(&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;&quot;apps/tarball/example_app.tar.gz&quot;&lt;/span&gt;&lt;/span&gt;)}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;cn&quot;&gt;MyOverseer&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;start_link({&lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;local&lt;/span&gt;_adapter, release, opts}, &lt;span class=&quot;va&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;MyOverseer&lt;/span&gt;)&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;cn&quot;&gt;MyOverseer&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;start_child()&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;定义一个 Overseer 很简单：&lt;/p&gt;&lt;pre class=&quot;sourceCode elixir&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode elixir hljs ruby&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;MyOverseer&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;im&quot;&gt;  use&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;Overseer&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;im&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  require&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;Logger&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  &lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;start_link(spec, options) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;    Overseer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;start_link(__MODULE_&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;_&lt;/span&gt;, spec, options)&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  &lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;init(&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;_&lt;/span&gt;) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;%{}&lt;/span&gt;}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;&lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;handle_connected(node, state) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;    Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;info(&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&quot;node &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&lt;span class=&quot;hljs-subst&quot; style=&quot;color: black;&quot;&gt;node&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt; up: state &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&lt;span class=&quot;hljs-subst&quot; style=&quot;color: black;&quot;&gt;inspect(state)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;)&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, state}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  &lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;handle_disconnected(node, state) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;cn&quot;&gt;&lt;span class=&quot;hljs-constant&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;    Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;info(&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&quot;node &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&lt;span class=&quot;hljs-subst&quot; style=&quot;color: black;&quot;&gt;node&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt; down: state &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&lt;span class=&quot;hljs-subst&quot; style=&quot;color: black;&quot;&gt;inspect(state)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;color: rgb(136, 136, 255);&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;)&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, state}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;handle_telemetry(_data, state) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, state}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;&lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;handle_terminated(_node, state) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, state}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;&lt;br&gt;  def&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot;&gt; &lt;/span&gt;handle_event(_event, _node, state) &lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;{&lt;span class=&quot;va&quot;&gt;&lt;span class=&quot;hljs-symbol&quot; style=&quot;color: rgb(136, 0, 0);&quot;&gt;:ok&lt;/span&gt;&lt;/span&gt;, state}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;  end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;kw&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们大概讲讲 Overseer 干些什么：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;start_link：启动时，它接受一些参数，关于我们要启动的 node 的 spec。node 目前支持两种 adapter，local 和 ec2。我将其做成 adapter，是为了日后支持更多类型的 node（比如 ECS）。strategy 目前仅支持 simple_one_for_one，亦即所有 node 使用相同的 spec，在需要的时候由 Overseer 创建。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;start_child：Overseer 可以根据预置的 spec 启动一个 node —— 比如 ec2 spot instance。这个 node 启动成功之后，初始的代码会使用 UserData 里面的 node_name 和 cookie 连接 Overseer。当 Overseer 监测到一个 node_up 的消息后，会在内部创建一个 Labor 的数据结构，并且把 spec 里面定义的 release 发给这个 labor node 加载和运行。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;pairing：比 Supervisor 复杂的是，Overseer 不但需要监听 node up / down 的事件，做相应的决策（比如重启一个新的 node）外，还需要接受 node 传过来的 telemetry，所以 Overseer 所在的 process 要和 labor node 上面的某个 process 建立起关系。我把这个过程称作为 pairing，类比蓝牙设备间的配对。当 start_child 成功后，Overseer 会把自己的 pid 发送给 labor node 上的一个指定的接口，然后 labor node 会在这个接口里显示地给 Overseer 发送 pair 请求，之后，两个 process 就 link 起来。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;作为一个类似于 Supervisor 的 GenServer，Overseer 把 labort node 监控的细节和状态机都屏蔽掉，只暴露 connected / disconnected / telemetry 等一些上层软件关心的事件。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;下图是大概一周前我手绘的 sequential diagram，当时名字还不叫 Overseer，叫 GenConnector，但基本思路一致：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.68203125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ09LDtEo5K5j6WABNZyEsjYjIFDjJjpfdn8KfyDtwibEm6a0mZST4Y8lG1MvJmruj0vYpp8XjKtqW3w/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;Overseer 的源码会在这几天完成后释出，敬请期待。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;有了 ex_loader 和 Overseer，merlin 剩下要做的事情就简单很多了：把代码库分割成 control plane 和 data plane，control plane 用 Overseer，data plane 沿用之前的代码，稍作修改后我们就有了一个分布式的，可以随意 scale 的构建系统。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;最妙的是，ex_loader 和 Overseer 虽为 merlin 而生，却由于不错的抽象程度，能适用于几乎任何 control plane + dynamic data plane 的这种分布式任务处理结构。在我之前的思考中，其实还更进一步，将这个系统设计成了一个叫 Fleet / Carrier / Fighter 结构的分布式系统，Carrier 是 Fleet 的 labor node，Fighter 是 Carrier 的 labor node，类比 Star War 中的帝国舰队。在这个蓝图中，merlin 只是 Fleet 的一个 Carrier 而已（这个估计短期没工夫实现）：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.5834862385321101&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ09LDtEo5K5j6WABNZyEsjYjZIZOMuxSDNezrO1c8yfN9zZBFVv8PczHtv0BJL9ntHlTbAiakpGYe7g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1090&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;好了，不说废话了，我还是抓紧写代码去。提前祝各位叔叔阿姨哥哥姐姐弟弟妹妹，春节快乐！也祝各位同处本命年「伏吟」的小伙伴们，狗年红红火火，不犯太岁！:)&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;IOS 小伙伴打赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1233303258&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;祝大家新年快乐！&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;祝大家新年快乐！&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-02-13-1000000091</guid>
<pubDate>Tue, 13 Feb 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>谈谈调度 - Linux O(1)</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-01-31-1000000090.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAbCBjsisH8ydP4XvyRNIXSNU4ZmGN4FiCGHBhS2e*aUYxPcwVKz9AxS-lwfcLARhpPB8WOzZqwCGeVPQKEgNypo=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    谈谈调度 - Linux O(1)                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-01-31&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;约莫十五年前，当我刚刚开始参加工作时，赶上 Linux 发布划时代的 2.6 内核。在这个大家都翘首期盼的内核版本中，最令人兴奋的便是 O(1) scheduler。本文来谈谈这个算法是如何实现的。不过，在详细讲解 O(1) scheduler 之前，我们先简单回顾一下让人诟病许久的 2.4 scheduler，了解其传承，同时以史为镜。&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;2.4 scheduler 的问题&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;Linux 2.4 scheduler 支持 SMP（Symmetric Multi-Processing），然而，由于只用一个 global runqueue，各个 core 需要竞争同一个 runqueue 里面的任务，所以可伸缩性（scalability）不好。我在上一篇文章中提过：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;任务如何组织？是所有的资源共享一个任务的 runqueue，调度器调度时通过加锁来保证互斥，还是针对每个资源，我们都为其设置一个 runqueue，以减少锁带来的损耗？那么问题又来了，如果某个资源上的任务列表空了，资源是就此闲置，还是可以去别的资源的 runqueue 上「偷」任务给自己执行？&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个问题 2.6 O(1) scheduler 用 per core runqueue 解决这个问题，我们放下不表。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;global runqueue 带来的性能问题其实还可以忍受，毕竟只是在 dequeue 的过程需要加锁；接下来这个问题，就很要命 —— 2.4 scheduler 的时间复杂度是 O(N)。我们知道，现代操作系统都能运行成千上万个进程，O(N) 的算法意味着每次调度时，对于当前执行完的 process，需要把所有在 expired queue 中的 process 过一遍，找到合适的位置插入。这不仅仅会带来性能上的巨大损失，还使得系统的调度时间非常不确定 —— 根据系统的负载，可能有数倍甚至数百倍的差异。我们知道，不确定性是软件系统的大敌，尤其是实时系统。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;对于那些对2.4 scheduler 不太了解的同学咱们多说两句：2.4 scheduler 维护两个 queue：runqueue 和 expired queue。两个 queue 都永远保持有序，一个 process 用完时间片，就会被插入 expired queue；当 runqueue 为空时，只需要把 runqueue 和 expired queue 交换一下即可。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;注意，所有调度系统的难点不在于寻找下一个可执行的 process，这个操作一般都是 O(1)，因为我们只要妥善对 runqueue 排序，使其第一个 process 永远是下次需要调度的 process 即可。难点在于执行完的 process —— 怎样插入到合适的位置使得 runqueue 是有序的？&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;满足 O(1) &lt;span style=&quot;color: rgb(0, 179, 138);font-size: 24px;font-weight: 700;&quot;&gt;的数据结构&lt;/span&gt;？&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;根据我们在数据结构课程里学到的知识可以知道，大多数算法的时间复杂度，O(log N) 基本上就是最好的结果，那么，2.6 的 O(1) scheduler 是怎么做到的？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在回答这个问题之前，我们先回顾一下数据结构的四种基本操作以及其时间复杂度：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;access：随机访问。array 是唯一能够达到，且平均情况和最坏情况均能达到 O(1) 随机访问的数据结构。其它的结构，linked list 是 O(N)，tree 一般是 O(log N)。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;search：搜索。谈到搜索，大家第一反应是 hash table 是 O(1) 时间复杂度的。然而，它在最坏情况下是 O(N) 的。除此之外，没有任何算法能在最坏情况下 search 也是 O(1)。大部分 tree（b-tree / red-black tree）平均和最坏情况都是 O(log N)，其实很不错了。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;insert/deletion：插入和删除。插入删除是对等的操作，这里放在一起讲。linked list，stack，queue 在平均和最坏情况下都是 O(1)，而大家脑海里的 hash table，同样的，虽然平均是 O(1)，但最坏情况是 O(N)。大部分 tree（b-tree / red-black tree）平均和最坏情况都是 O(log N)，也还不错。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以我们看到，如果想要达成 O(1) scheduler 的目标，操作只能包含纯粹的 access，insert 和 deletion。一定不能有 search。2.4 scheduler 在将执行完的 process insert 回 expired queue 时使用 search，大大拉低整个算法的时间复杂度。这是其一。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;此外，对于 scheduler，我们选择算法，尽量要选择平均情况和最坏情况表现一致的算法。如果平均情况是 O(1)，最坏情况是 O(n)，那么这个 scheduler 会给系统带来很大的不确定性，这很伤脑筋 —— 毕竟谁也不愿意面对一个大部分时候表现乖巧，极端情况抽风到不可理喻的系统。这是其二。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;在这两个先决条件下，我们可选择的范围就很窄 —— access 只能用 array，insert / deletion 只能用 linked list / queue / stack。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;接下来，我们把调度的场景简化一下：假设系统中有六个 process，三种优先级：high，medium，low。没有 preemption，严格按照优先级的顺序执行 process。那么，我们怎么组合上述的数据结构，让 scheduling 是 O(1) 的？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;思考一下。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;再思考一下。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;2.6 O(1) scheduler&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;OK，我们直接看看大神给出的是什么样的答案。先看图：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.73125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ09xcaHjpT0fIMqM5UddWnZdLJdrkJgG1moicthnXGmprQaxL22RycXOEEjFFPQN1hyc2jK0n6NRhtA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;看到这里，估计有部分读者已经领会到其中的奥义。2.6 kernel 里有 140 种优先级，所以我们就用长度为 140 的 array 去记录优先级。每个优先级下面用一个 FIFO queue 管理这个优先级下的 process。新来的插到队尾，先进先出。在这种情况下，insert / deletion 都是 O(1)。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;那么，我们怎么找到当前最高优先级下面的可执行的 process 呢？如果从 0 开始一直遍历下去，算法虽然不是 O(N)，但是是跟优先级多寡相关的 O(M)，也不能算作 O(1)。在 2.6 scheduler 里，聪明的先贤们采用 bitarray。它为每种优先级分配一个 bit，如果这个优先级队列下面有 process，那么就对相应的 bit 染色，置为 1，否则置为 0。这样，问题就简化成寻找一个 bitarray 里面最高位是 1 的 bit（left-most bit），这基本上是一条 CPU 指令的事（fls）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;好，大致的思路齐备，我们来捋一捋完整的步骤：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;在 active bitarray 里，寻找 left-most bit 的位置 x。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;在 active priority array（APA）中，找到对应队列 APA[x]。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;从 APA[x] 中 dequeue 一个 process。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;对于当前执行完的 process，重新计算其 priority，然后 enqueue 到 expired priority array（EPA）相应的队里 EPA[priority]。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果 priority 在 expired bitarray 里对应的 bit 为 0，将其置 1。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果 active bitarray 全为零，将 active bitarray 和 expired bitarray 交换一下。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;当然，这里面还有一些细节，比如如果是 process 被抢占，其时间片没用完，那么第 4 步，enqueue 回 active priority queue 中。不过这和算法本身没太大关系，我们略过不表。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;历史地位&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;2.6 O(1) scheduler 目前已经被性能略输一筹，同时更加强调公平性的 CFS（Completely Fair Scheduler）取代，但其以独特的设计，简单的算法，影响很多系统。在其刚问世时，很多 linux 发行版就迫不及待将其移植回 2.4 kernel。而程序君整个职业生涯中接触过的一些调度器中，都能见到 bitarray + priority queue 的身影。它让我感慨算法之美，同时也告诉我：你手中即便拿着一副并不那么出众的牌，历经辗转腾挪，也能打出精彩。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;iOS 用户赞赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;本系列其他文章：&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827885&amp;amp;idx=1&amp;amp;sn=619120f508c2750c9b7bdd7da69182e4&amp;amp;chksm=8704a831b0732127bad66cdbf0eb55f46a3071d458581a4ac191ae522b67a5dd24428664e5f6&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;当我谈 scheduling 时我在谈什么？&lt;/a&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1387094586&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;十年前的老知识重见天日&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;十年前的老知识重见天日&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-01-31-1000000090</guid>
<pubDate>Wed, 31 Jan 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>当我谈 scheduling 时我在谈什么？</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-01-29-1000000089.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAcXqLMCuPnWb3eSJJo*L3bhqY51VUKfVpoPepyiliQYu1GknC77UBI6LwOi-3gQ9ZkI0-D8BWnGVtP*jDlvcYuE=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    当我谈 scheduling 时我在谈什么？                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-01-29&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;题记&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这是我 1/25 日 Tubi TV 内部 BBL 的一个主题。scheduling 有很多很多可以谈论的地方，随便一个点就可以做一次讲座。这次我只是讲一个概述。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;说两句题外话。我常常在 code review 中评论某某代码要 DRY (don’t repeat yourself)。其实这一原则也适用于生活的其它方面 —— 一成不变的事情，久而久之就会失去色泽，无论其曾经多么光鲜靓丽。所以我们要催动自己的好奇心，让生活保鲜。16 年我做 BBL，基本上都是 markdown + reveal.js（一套 makefile 用 pandoc 编译完成传到 S3），17 年我主动将其换成更加赏心悦目的 shower.js。新年伊始，我把我的 presentation 全面换成使用 paper + notability 手绘 + 实时演示，再度跟过去道别。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.7541666666666667&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibBe0RaHoapAHx2SIPiaYl0lYuW42ZcntgH2azuXibKvJptTn70sEr6eIdkTpTjsKx4qib80noztkm9A/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;什么是 scheduling？&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;wikipedia 上是这么说的：&lt;/p&gt;&lt;blockquote style=&quot;margin-top: 15px;margin-bottom: 15px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);padding-right: 15px;padding-left: 15px;color: rgb(119, 119, 119);&quot;&gt;&lt;p style=&quot;margin-right: 10px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;In computing, scheduling is the method by which &lt;strong&gt;work&lt;/strong&gt; specified by some means is assigned to &lt;strong&gt;resources&lt;/strong&gt; that complete the work.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这话有点晦涩，我们要拿出初中英语期末考试阅读理解中寻找主谓宾的技巧和专注去面对。这里我给大家用程序员最喜欢的语言翻译翻译：&lt;strong&gt;scheduling 是一个函数，它把一组任务的集合映射到一组资源。&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们举个例子 —— 拿大家最耳熟能详的 linux CPU scheduler（以下简称 linux scheduler）说事 —— 就是把一系列 process (workload) 映射到一个个 CPU core：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.43671875&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibBe0RaHoapAHx2SIPiaYl0lWm5PAutqrl7b4p7BvJUFprauWL6B1jF0niaWAOJZBRmsm0ez1yDvuuQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这里面，主要的 task 有：常驻系统的服务，各种各样的 agent，一次性的脚本，周期性的任务。对于 linux scheduler 来说，其 scheduling 函数，承受着巨大的功能性的压力：公平，优先级，抢占（交互任务要能得到立刻执行），高效，可扩展（从 single core -&amp;gt; multi core -&amp;gt; NUMA），等等。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;除去 linux scheduler，我们的生活中还有很多很多你都没有意识到的 scheduler，我们随便举几例：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;erlang scheduler，erlang processes 到 threads 间的映射。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;nginx，http/https 请求到 processes / application 间的映射。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Memory manager，virtual memory 到 physical memory 间的映射。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;hypervisor，VM 到物理机器间的映射。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;AWS EC2 service，VM 到 hypervisor 间的映射。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Spark，map/reduce job 到计算节点间的映射。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;通过这些映射，我们得到很多好处：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;资源得到更高效的利用&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;由于增加一层 indirection，任务和任务所需要的资源间得到解耦&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;更好的服务质量（QoS）&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;仔细观察上面的例子，我们不难发现，待处理任务的数量往往远大于资源的数量，甚至，二者相差好几个数量级。这种用少量的资源打肿脸充胖子完成大量的任务的无耻行为，在计算机领域有一个漂亮的名字，叫 over subscription。你仔细琢磨，其实很多商业领域尤其是互联网，其秘密就在于 over subscription 这个小小的词语中。比如运营商给你的 50M 包月网络；早期 gmail 提供的不断增长的 1G 邮箱容量；aws 拍着胸脯对每个客户宣传：老表，来我们这场子，S3 管够，EC2 想要多少就有多少。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;反过来，我们要想支持 over subscription，那么，通过添加一个 scheduler 把资源的两端解耦，就可以解决。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;到目前为止，大家对 scheduling 已有一个粗浅的认知 —— 这时我们的脑海里便会浮现出很多很多的疑问。这其中，最重要的问题是：这世上没有无缘无故的便宜给你占。享受到 scheduler 的马杀鸡，代价是什么？&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;scheduling 究竟有多快（多慢）？&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;还是拿 linux scheduler 说事。scheduler 本身的运行会消耗资源，这边是其最主要的代价。自然，我们希望这代价越小越好。于是，下一个问题是：当 linux 做一次 reschedule 的动作时，究竟耗费多少资源（CPU 时间）？&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.32890625&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibBe0RaHoapAHx2SIPiaYl0l0lQqvm8Xw4TbVFK1hXqvPHAiaQXW4TibZEyEDKIoQ9QCcibNybwfs4FzQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;要想回答这个问题，我们先得回答另一个问题：怎么测量？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;要测量上图中桔色的部分，有两个直观的方法。一种方法是在入口和出口记录时间，然后计算 diff，最后求平均值 —— 然而 scheduling 的动作并不受你我掌控，用户态下很难找到其入口和出口。另一种方法是我们让青色的区域无限接近零，让整个时间片都被桔色的区域占满，这样，任务运行的时长便是 scheudling 花费的总时长。按照这个思路，用户态的代码需要被简化到只做一件事情：一旦被执行就立刻阻塞自己，让 scheduler 毫不犹疑地把 CPU 让给小伙伴们。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这个思路 linux 下面的 perf 工具已经给你实现好，直接调用即可：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ perf bench &lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;sched&lt;/span&gt; pipe&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;co&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;color: rgb(136, 136, 136);&quot;&gt;# Running &#39;sched/pipe&#39; benchmark:&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;co&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;color: rgb(136, 136, 136);&quot;&gt;# Executed 1000000 pipe operations between two processes&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Total&lt;/span&gt; time: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;20.026&lt;/span&gt; [sec]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;20.026324&lt;/span&gt;&lt;/span&gt; usecs/op&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;49934&lt;/span&gt;&lt;/span&gt; ops/sec&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;其原理是两个 process 相互 pipe，礼尚往来，scheduler 夹在其间来回奔波。这里有个问题，由于 process 可能分布在不同的 core 上，测出的性能失真，所以我们应该用 taskset 将其 affinity 到某一个 CPU core 下：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ taskset -c &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0&lt;/span&gt; perf bench &lt;span class=&quot;hljs-built_in&quot; style=&quot;font-weight: bold;&quot;&gt;sched&lt;/span&gt; pipe&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;co&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;color: rgb(136, 136, 136);&quot;&gt;# Running &#39;sched/pipe&#39; benchmark:&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;co&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;color: rgb(136, 136, 136);&quot;&gt;# Executed 1000000 pipe operations between two processes&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Total&lt;/span&gt; time: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3.104&lt;/span&gt; [sec]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;3.104995&lt;/span&gt;&lt;/span&gt; usecs/op&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;322061&lt;/span&gt;&lt;/span&gt; ops/sec&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;有同学问，kernel 的 scheduler 有工具可以让你偷懒不写代码，那么，用户态的 scheduler，比如 erlang VM process scheduler 的性能，你怎么测量？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我是这么做的：首先启动 100k 个 processes，每个 process 的入口函数传入上一个 process 的 pid（第一个启动的就放 &lt;code style=&quot;;&quot;&gt;self()&lt;/code&gt;），启动完成后，self 给最后一个 process 发一个最简单的 message，比如 &lt;code style=&quot;;&quot;&gt;:hello&lt;/code&gt;，每个 process 接到 &lt;code style=&quot;;&quot;&gt;:hello&lt;/code&gt; 后，就给它知道的 pid 发 &lt;code style=&quot;;&quot;&gt;:hello&lt;/code&gt;，直到消息回到 self。这样完成一个循环，循环 100 次之后，也就是 10M 次 scheduling，我们计算所花费的时间：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.6953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibBe0RaHoapAHx2SIPiaYl0l4zQvvppaPrsglv6pHhSSyOaxCwNzAKVMo1DUAibXJqD2X3Zj5VXCZoA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;最终的结果是：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;~/pingpong/elixir&lt;/span&gt; master [!]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ ./pingpong&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Start&lt;/span&gt; &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;100000&lt;/span&gt; actors&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;All&lt;/span&gt; actors are started&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Time&lt;/span&gt; elapsed &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;10000000&lt;/span&gt; runs &lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;for&lt;/span&gt; message passing: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;5.913704&lt;/span&gt;s&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Single&lt;/span&gt; op spent: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0.5913704&lt;/span&gt;us&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;有趣的是，当我们使用 CPU affinity 后，其性能几乎不变：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;~/pingpong/elixir&lt;/span&gt; master [!]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ taskset -c &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0&lt;/span&gt; ./pingpong&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Start&lt;/span&gt; &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;100000&lt;/span&gt; actors&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;All&lt;/span&gt; actors are started&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Time&lt;/span&gt; elapsed &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;10000000&lt;/span&gt; runs &lt;span class=&quot;hljs-keyword&quot; style=&quot;font-weight: bold;&quot;&gt;for&lt;/span&gt; message passing: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;6.199335&lt;/span&gt;s&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;Single&lt;/span&gt; op spent: &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0.6199335&lt;/span&gt;us&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;同样的，我们在两个 goroutine 间 ping/pong：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;~/pingpong/go&lt;/span&gt; master [!]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ ./pingpong&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;2.895870&lt;/span&gt;s&lt;/span&gt; elapsed&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0.144793&lt;/span&gt;&lt;/span&gt; us per switch&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;CPU affinity 后，性能也几乎不变：&lt;/p&gt;&lt;pre class=&quot;sourceCode bash&quot; style=&quot;font-family: monospace, serif;font-size: 13px;white-space: pre-wrap;margin-top: 15px;margin-bottom: 15px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);line-height: 19px;overflow: auto;padding: 6px 10px;border-radius: 3px;&quot;&gt;&lt;code class=&quot;sourceCode bash hljs&quot; style=&quot;;&quot;&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;~/pingpong/go&lt;/span&gt; master [!]&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;staging&lt;/span&gt;$ taskset -c &lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0&lt;/span&gt; ./pingpong&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;2.880224&lt;/span&gt;s&lt;/span&gt; elapsed&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;ex&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;color: rgb(0, 136, 0);&quot;&gt;0.144011&lt;/span&gt;&lt;/span&gt; us per switch&lt;/p&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;代码见：&lt;span style=&quot;color: rgb(64, 118, 0);&quot;&gt;&lt;strong&gt;tyrchen/pingpong&lt;/strong&gt;&lt;/span&gt;。我就不贴出来详细说。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;经过这几组 benchmark，我们学到些什么？&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;首先，这些测试都不算严谨。我们并未消除系统里其它 process 的影响，因而测量的结果并不精确。但是，我们大概可以了解其处理速度的量级。知道这个量级，非常重要，因为，scheduler 把 CPU 时间切出来的 time slice 应该要高于这个量级，否则，便没有意义。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;其次，与其说它是 scheduling 的性能，不若说是 context switch 的性能，不过这两者在非专门对 scheduler 算法 profiling 的我们来说，是可以划上等号的，因为我们关心的是，scheduling 前前后后所处理的各种琐事（从上一个 task 结束执行，到下一个 task 开始执行），挤占多少 CPU 时间。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;再次，对比三者，我们可以有些推断 —— linux scheduler 做了大量的工作，这其中耗费的绝大多数时间是在 context switch 上：SAVE-n-LOAD，切换页表等等，所以它的性能最差。erlang scheduler 的性能差不多是 linux scheduler 的 5 倍，这是因为在用户态下切换自身定义的 “process”，无需打扰 kernel，也不涉及到页表的切换，SAVE-n-LOAD 也是处理 VM 上的状态，比较简单，scheduling 本身又没有那么复杂的需求，所以胜出是理所当然 —— 如果不能胜出，反倒是有问题。golang 的 scheduler 性能最好，是 linux scheduler 的 20 倍，erlang scheduler 的 4 倍。和 erlang 一样，golang 用户态下的 scheduler 没有诸多纷繁复杂，性能自然是很好。至于比 erlang 还要好上这么多倍，应该是两个原因导致的：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;golang scheduler 最简单，没有优先级，也没有抢占，高度优化（甚至不惜牺牲系统总体效率在没事可干时 spinning thread）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;没有运行时解释执行 bytecode 的累赘 —— golang 直接编译成 binary，而 erlang 编译成 beam 解释执行&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以，golang scheduler 的胜出无可厚非。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;Patterns / Trade-offs&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们只是简单地讨论了三个不同的 scheduler，便发现它们的实现根据其业务需求有不同的 pattern 或 trade-off。在考虑一个 scheduler 时，我们要考虑这些问题：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;任务如何组织？是所有的资源共享一个任务的 runqueue，调度器调度时通过加锁来保证互斥，还是针对每个资源，我们都为其设置一个 runqueue，以减少锁带来的损耗？那么问题又来了，如果某个资源上的任务列表空了，资源是就此闲置，还是可以去别的资源的 runqueue 上「偷」任务给自己执行？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;资源如何利用？是 run to completion，还是 time slicing？run to completion 对于计算密集，且在意 latency 的场景非常有价值，因而在网络设备中，除 traffic shaping 的需求外，报文的处理大多采用 run to completion。time slicing 则适用于 I/O 密集，或者在意系统总体的利用率的场景。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;用什么数据结构组织 runqueue？是 FIFO queue (linked list)，还是 rb tree，还是 bitmap + FIFO queue，各种结构的优劣如何？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;使用什么算法？是用一个 while loop 去 O(N) 地遍历来寻找最合适的任务，还是对于任意任务 round robin（weighted round robin）？Linux 2.6 O(1) scheduler 使用的是什么样的算法？CFS (Completely Fair Scheduler) 为何又将其取而代之？对于目前大集群下的 cluster scheduling，scheduler 如何处理，borg / mesos /omega 这些先后名噪江湖的算法是怎么回事，该怎么选用？&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.659375&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibBe0RaHoapAHx2SIPiaYl0l7QXB5oSaeZGGiabzQ91UrT2KoqI39TYZvhbia4IC6gcrF2n8mO1iaWF6Q/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;未完待续&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;当我写这篇文章的时候，我只是想着把我 BBL 所讲，大致做个摘录。结果一不小心开个头，就碎碎念这么长。也罢，那咱们就干脆趁热打铁，做个系列，希望有功夫能讲一讲 2.6 O(1) scheduler，erlang scheduler，以及 mesos。下篇文章我们讲讲一出江湖就名震天下的 &lt;strong&gt;linux&lt;/strong&gt;&lt;strong&gt; 2.6 O(1) scheduler&lt;/strong&gt;，敬请期待。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;谢谢大家欣赏。iOS 打赏通道：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.9953125&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;640&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1893967611&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;指挥若定，调度有方&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;指挥若定，调度有方&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-01-29-1000000089</guid>
<pubDate>Mon, 29 Jan 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>2017，程序人生大串烧</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2018-01-15-1000000088.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAXdTUOYH2AOMAnPPLXrdf2*dLGKxPKJcplr5XHirtecVQr6YDcLhpDgNv*nSjgEfx8XEI9g2N1LN6VKZ7b*nbUE=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    2017，程序人生大串烧                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-01-15&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;从 2014 年第一篇公众号文章开始，三年多时间我竟然已经写下了 386 篇文章，涵盖技术，管理，创业和一些莫名其妙的感悟。这便是小小的坚持迸发出的能量：不经意间，&lt;strong&gt;日拱一卒的零零碎碎&lt;/strong&gt;汇集出这般美妙的结果。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;我常说：读自己的日记，仿佛在跟过去的自己对话。读自己的文章也是如此。早上在 4S 店保养小车，闲来翻翻自己的文字，感觉很棒 —— 这并不是说我觉得我的文字有多棒，而是文字中透出的我的想法，成熟的不成熟的，都承载着我的成长。有这些文字（以及少量日记）作伴，我的 2017 虽不完美，好些计划也没完成，但起码留下了些什么。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;2017 年我的第一篇文章 &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827567&amp;amp;idx=1&amp;amp;sn=a001443824781ee8fa02ebd0d9b6d289&amp;amp;chksm=8704aaf3b07323e5dc9b29ed954aff78482de9dd7192917daea06e1619afc0de392c6eefd206&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;Policy Engine 的前世今生&lt;/a&gt; 就振聋发聩 —— 火车上的一次突发奇想加上接下来三天的各种实验，奠定了 Tubi TV 这一年诸多工作的基石，也埋下了一些神坑让 team，甚至 elixir 1.7 去填（比如这个：https://github.com/elixir-lang/elixir/issues/7047）。现在我们线上奔跑的代码已经和文中描述的大大不同，单 policy 一次编译时间也从 10 分钟，优化到几秒钟，但其中的思路，还是值得大家一看，甚至，文中提到的 &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=210542047&amp;amp;idx=1&amp;amp;sn=9c813595c727c0fa028651b9dcdbab12&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;如何愉快地撰写 Parser&lt;/a&gt;，也值得大家重读。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;elixir 是我在 2015 年就在跟进的语言，但一路来都是写写小的 side project，直到 2017 年，在 Policy Engine 尝到甜头后，才正式在生产环境中大规模使用。这一年中，团队累积了很多经验，尤其在 cluster deployment / release / hot upgrade / rolling upgrade 方面 —— 2018 年 3 月份我会在旧金山的 Code BEAM 2018 大会上谈谈我们在这些方面的收获，希望大家捧场。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;学一门新的语言并非学习它的语法那么简单。去年年初我写下了 &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827570&amp;amp;idx=1&amp;amp;sn=fe6ca628a5295d52746ff62f2bf84fe2&amp;amp;chksm=8704aaeeb07323f8c0381932a7696917d6d04f3596438e7d7b6083fa26a825c2628a83d8ad67&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;如何使用一门新的语言&lt;/a&gt;，介绍了我的一些思考。它不仅仅适用于 elixir，也适用于其他的语言。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;如果你对 elixir / erlang 感兴趣，那么， &lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827596&amp;amp;idx=1&amp;amp;sn=9fb32f42760462109143ece34859043e&amp;amp;chksm=8704ab10b07322064f04d0fcb76b9eea929eaf18dcb5a0bac383609ee56b69a13e9584e359bd&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;Let it crash：因为误解，所以瞎说&lt;/a&gt;，&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827636&amp;amp;idx=1&amp;amp;sn=ae805b1b7c41bcfbffe2bcbf992b87db&amp;amp;chksm=8704ab28b073223e8ffb831d12187bb1a7ef7bfff0e4b4dce760c9228ee189dbcdfd6e6d548a&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;Phoenix 1.3，迈向正确的道路&lt;/a&gt;，&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827691&amp;amp;idx=1&amp;amp;sn=8d6854f91bb9d16470ef6eed9d3ad8ec&amp;amp;chksm=8704ab77b0732261eb63217ad03740a3433cde4491826eeec020f4bbebb8b18837c27ac3e74d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;上帝说：要有一门面向未来的语言，于是有了 erlang&lt;/a&gt;，你也许不想错过。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827578&amp;amp;idx=1&amp;amp;sn=8c68f89f51a48a0e11ec52aa51438285&amp;amp;chksm=8704aae6b07323f063e45b709cd20e948fc516fbd858d0c439b5c014eea74ea9accb95928543&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;如何用正确的姿势打开 TDD 这篇文章&lt;/a&gt;，详细地探讨了我使用 TDD 的一些心得，里面还涵盖了很多和 design/arch 相关的思考。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827625&amp;amp;idx=1&amp;amp;sn=76b275e9c4895d94f7ca963bedca7564&amp;amp;chksm=8704ab35b073222313df7222a944dcccc315ed852ab8390ab016d58bf5f373469e7a3f9084ae&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;是时候想想怎么删除代码了&lt;/a&gt; 是一篇很有争议的文章，但他给你一个独特的视角考虑如何写出更好的代码。如果你赞同 Begin with end in mind，那么，我们要好好考虑这个问题：&lt;strong&gt;有没有可能，我们在架构之初，就考虑到这个代码有可能在将来成为一种负债，因此在设计上考虑到如何能轻松地将其删除或者替换？&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;去年 3 月份，我参加了 erlang solutions 的一个 OTP 培训，写下了这样的文字：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827661&amp;amp;idx=1&amp;amp;sn=d516a615364c9226356c2f538d643425&amp;amp;chksm=8704ab51b0732247186e98170b465e37bf64c932aca98c36be01baa06980d359b5e05484135b&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;当我参加培训时，我在想些什么？&lt;/a&gt;同样的一件事，不同人眼里有不同的价值，就看我们怎么样去发掘了。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;很多人写了很多代码。但是，绝大多数人读过的代码还没有自己写过的代码多。这是一个很奇怪的现象 —— 我们从小到大，少说也读了几百几千万字的书，工作数年甚至十数年，还没有读过同样体量的代码。&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827664&amp;amp;idx=1&amp;amp;sn=9d8570026349398fedb0aecd05dedc3b&amp;amp;chksm=8704ab4cb073225a43c85bf7daab723985f9a56cb4dd611dade9007dac35f73f233c4497a82d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;为什么我们要阅读源码？&lt;/a&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827677&amp;amp;idx=1&amp;amp;sn=c50072121269e7d11fdf23bb7b76d95a&amp;amp;chksm=8704ab41b073225742403e3959435205d31a388114a050e8805d5ed5defe1ae21d6b546b6288&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;如何阅读一份源码？&lt;/a&gt;希望能让你重燃对读优秀代码的兴趣。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;提高软件开发的能力，除了多读代码之外，还要下苦功夫。&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827805&amp;amp;idx=1&amp;amp;sn=f15ed2e753337af039fc5b2a88d35b8a&amp;amp;chksm=8704abc1b07322d7e5db27d69136ce3aa6adcbbf2bcb5bbca02971dded0d0e2ffb7637a4e3c8&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;在提高代码能力这事上，没有银弹&lt;/a&gt; 就是这个意思。停下来，歇口气，造轮子 告诉你，没完没了打零工（do chores），如果不能把它们串起来，时不时来个从零到一，你会陷入 &lt;strong&gt;你以为你知道了但其实你并不知道你不知道的&lt;/strong&gt; 的窘境。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;软件开发是个从起点到终点的高级寻路游戏，考究的是个解决问题的综合能力 —— 虽说条条大路通罗马，但有的路一马平川势如破竹，有的路如临深渊如履薄冰。我们要寻找的是时间空间俱优，还节省开发效率的妥协（compromise）之路。妥协不是件简单的事情 —— Rich Hickey 说，&lt;strong&gt;你起码要有两个以上的 solution，才谈得上妥协&lt;/strong&gt; —— 所以，见识丰富必不可少。也许下面几篇文章可以帮到你：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827819&amp;amp;idx=1&amp;amp;sn=1d7da4a332c267a625ee5196985ab3e7&amp;amp;chksm=8704abf7b07322e17ebcfede920497ff1c5246be36e6a4494706aa35ac3f112b0e41796162c0&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;bash 的威力&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827770&amp;amp;idx=1&amp;amp;sn=d370f79f5c82bb439583828321e1a74c&amp;amp;chksm=8704aba6b07322b08f3d950b2eed3989cbff65b0cddbc84857cdd469ca5a414b74f7199e8f95&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;谈谈状态机&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827728&amp;amp;idx=1&amp;amp;sn=b8ea0e7d62d747c7736949431d483fd8&amp;amp;chksm=8704ab8cb073229a892aa49a9056bd92619106b68f09bee5fc536596b04443cc877d0e20b8ff&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;谈谈数据结构&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827646&amp;amp;idx=1&amp;amp;sn=9319811a7738d55f97bcb33a80f11c59&amp;amp;chksm=8704ab22b07322343221f938dc57c17f38ca8d75e549411a139e9d9e8f552780b311e0beaa0d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;谈谈边界&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827718&amp;amp;idx=1&amp;amp;sn=39921d8913b4d72160382f7dac46753b&amp;amp;chksm=8704ab9ab073228c178ffa33e2bd266b51c48c6060b4b656df67d91ca807fdfcca022d30a786&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;思考：快与慢&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827699&amp;amp;idx=1&amp;amp;sn=e97071f2f049b8027c3105b8bd4ade70&amp;amp;chksm=8704ab6fb0732279f3c1b463653a812bbaef4d921fe65fe82cfb397765b01a9c5552a18307fe&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;service performance 101&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827704&amp;amp;idx=1&amp;amp;sn=176e84212578b175b88765a9a21df7a9&amp;amp;chksm=8704ab64b0732272b6d1d71e5b31b405fa9c10a687088c39b11c3c86b3be0c542dd5114a06f6&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;浪费内存？多大个事？&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;看技术文章看累了，换换脑子，我们扯扯淡：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827824&amp;amp;idx=1&amp;amp;sn=2ddf0612f1d25f68dab11ab3f5db02be&amp;amp;chksm=8704abecb07322fa92a4d97b1683c551928389cdb25fe2c005a6fbf92e5f3facb07107d91a1b&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;美帝面试二三事&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827862&amp;amp;idx=1&amp;amp;sn=3544c7f82ececdca36c7285fb77dfceb&amp;amp;chksm=8704a80ab073211cfcc2bf6f942e2d7c0b2a2f361c66de8eb8903cf277e0481085a6acf6a0ef&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;社会我梅姐：美女兼劳模&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827772&amp;amp;idx=1&amp;amp;sn=10407d51a4779fc11a3b46bd5edad3c4&amp;amp;chksm=8704aba0b07322b66c803b39b7aad80fa1fd918ce08daaccb02456ca30d785a5dbf6ecef5497&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;软件工程师成长之路&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827682&amp;amp;idx=1&amp;amp;sn=c96d8a72e6535238cb4b45a35f15b9af&amp;amp;chksm=8704ab7eb073226847dca3ccdd95f9bf6a9ab40697677ba343c9a51bfea0e83e028797162fda&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;创业公司如何组建技术团队&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827735&amp;amp;idx=1&amp;amp;sn=cc684a300386e7c6446a10d4ad753dcd&amp;amp;chksm=8704ab8bb073229db518703c1cf5c5bb79212b1ab504131604312753d03bcb4a0f5c64ff35c7&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;程序员为什么会忧虑自己的未来&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827812&amp;amp;idx=1&amp;amp;sn=8b2389d4c7221cb439ab0e705dd6e8e9&amp;amp;chksm=8704abf8b07322eee8aecb3bd6ad6f71f2673072feb0ed5b6f2f2fee97f0b0d11411526cc8ef&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;程序员的好日子何时才能到头？&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827870&amp;amp;idx=1&amp;amp;sn=50ad123859bc7b3d5b912e19bc98ad67&amp;amp;chksm=8704a802b0732114e5fc45035498f119309d70530c82b11e10989b95c4c7e12099003641a000&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;不要等客户来通知问题&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;或者开拓一下视野：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827757&amp;amp;idx=1&amp;amp;sn=1b5ee89840ccb9c59ec971bd6f4681a4&amp;amp;chksm=8704abb1b07322a72928ed9cdcd01ed9d9e68a951657d0e30f7ea97f95646edafc2c49847ef0&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;red，不红不专，但性感&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827782&amp;amp;idx=1&amp;amp;sn=122c74dfb32eefc5f9dc9aa648f16b98&amp;amp;chksm=8704abdab07322cc552fff20455549b56ed1ce34cb56e82e5f58b3937aa87032bb87a528311e&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;sound of silence：数据传输的小众黑科技&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827794&amp;amp;idx=1&amp;amp;sn=7e968057cf4ba72f775dde454d89a0ce&amp;amp;chksm=8704abceb07322d8bacc40389e4a0fce0955f7da9b72c0c4a4b613541d6fa69fc65234a8567d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;闲扯比特币套利交易系统的设计&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827653&amp;amp;idx=1&amp;amp;sn=1d736cfe77ed32babf58ed955f50c2fc&amp;amp;chksm=8704ab59b073224fdfda47376a457be140ef7631ef3f85c7742e2c886b7fc6885de21e9ba010&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;alexa：梦中的女神&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827838&amp;amp;idx=1&amp;amp;sn=e8f12c1631c831cbe6d02c4cd5a82e86&amp;amp;chksm=8704abe2b07322f4fdf8cce03fd5285129f3ac717a88675e56688af515981620ba13f3f11996&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;pixel 2 XL：软件为王&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;或者回顾一下 2017 年发生的灾难性大事件，以史为镜：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827593&amp;amp;idx=1&amp;amp;sn=7cc4aa992210b2a1f0a9cd533250b48b&amp;amp;chksm=8704ab15b07322038d14b8bd38bdbd50b2dc7ff951f0241eb790e84fa61b33fd158699ae848e&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;从 gitlab 事件中吸取的教训&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827622&amp;amp;idx=1&amp;amp;sn=f13648a3f38752f6822026873a2783b2&amp;amp;chksm=8704ab3ab073222c05050a5a1f36c6d74b083b9bacb7f0dd6b99462b8ec4b87e885569e5276e&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;北美互联网哀鸿遍野：号称 99.9% 可用性的 S3 挂了&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;然后，躺在懒人沙发上，想想，作为一个程序员，自己眼中牛逼的自己该是什么样？如果没头绪，参看程序君吐血推荐的这篇：&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827589&amp;amp;idx=1&amp;amp;sn=b10f3d0979fd5eda86ebb656fd38186d&amp;amp;chksm=8704ab19b073220f1b4d18cb0aabcb1b4fc34bc0ffa85df1a73bac7502bef42775b9404e8ce8&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;程序员字典：「牛逼」&lt;/a&gt;。然后，再想想。&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;2018 我会格外忙一些 —— 过去几年输入和输出都不算少，但主要在夯实自己的舒适区。2018 我将会深入踏足一些之前我只有粗鄙认知的领域：ML/DL 和 blockchain (主要是基于智能合约的去中心化应用)。我报了些线下和线上的课程，一季度每周大概有 10 个小时要用来上课，估计也要用同样体量的时间来夯实所学。所以我的原创文章产量会大大削减，争取每旬一更，最差也要双周更。请大家体谅。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;希望这些文章能对对你有用。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;iOS 用户打赏通道：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0ibT2n2n2J6ynxxHINO8NGtBOGyQSm6BibECInurPpyrFul8ickQxDNCia9LNxneL9bCpClicpvKzxCMuA/0?wx_fmt=jpeg&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.9953125&quot; data-w=&quot;640&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;往期文章：&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=2649827562&amp;amp;idx=1&amp;amp;sn=c7c8a2d4d638fb8eb3d60577829c1034&amp;amp;chksm=8704aaf6b07323e0d3253f6486f25a03bf074636318dd0b6114ff166f249cbfb7016d9fa9e2c&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;2016 程序人生大串烧&lt;/a&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA3NDM0ODQwMw==&amp;amp;mid=401107581&amp;amp;idx=1&amp;amp;sn=502830373629d22e5808a8a17dfdf8ae&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot;&gt;2015程序人生大串烧&lt;/a&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;537038134&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;希望对你有用&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;希望对你有用&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2018-01-15-1000000088</guid>
<pubDate>Mon, 15 Jan 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>不要等客户来通知问题</title>
<link>https://henix.github.io/feeds/weixin.sogou.programmer_life/2017-12-12-1000000086.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1521086248&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=dGDRsUwIdXbAA7EPRr3lhcuPIduzmARNDtBBEoBb8iR6r8CXQ6ZdOFfxJIV*aY3LekRdfmXamSpZUZ7jNDLsAZ7wkcJQLnRhU*IYU97iCN6XBv-RuEH1cmPQfRD9mfy6K6hIl*Y6NAAPzHwfCvb*XM7vDUl-nuLae9RY8E942Ak=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    不要等客户来通知问题                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2017-12-12&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;陈天&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;程序人生&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;程序人生&lt;/span&gt;


                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;程序人生&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;programmer_life&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;十年漫漫程序人生，打过各种杂，也做过让我骄傲的软件；管理过数十人的团队，还带领一班兄弟姐妹创过业，目前在硅谷一家创业公司担任 VP。关注程序人生，了解程序猿，学做程序猿，做好程序猿，让我们的程序人生精彩满满。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;引子&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;周日早上爬完香山回来，想起还和一位朋友约了咖啡，赶忙打开微信扫路边的一辆单车。摩拜的小程序提醒我开锁中，请勿关闭小程序。然而这开锁的进度在百分之零的位置停留若干分钟，毫无变化。等了许久，我怀疑网络不畅，于是关闭小程序又重新打开扫描，这下可好，小程序直接告诉我：「您上次用的车还未关锁，暂时不能在用其它车哦」。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这就傻逼了。我对着一辆明明没开锁却被认为已开锁的车扫了又扫，我期望聪明的系统能够发现这一异常行为 —— 如果一辆被认定是开锁使用中的车被同一个用户扫了又扫，那一定是这部车没有正常开锁 —— 尤其对一个信用分有 160，人品还算扎实的老同志来说。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;可是摩拜就是固执地不让我用车，每次扫码后那句相同的文案，尤其是最后一个用来卖萌的「哦」字，无情地嘲弄在寒风中拖着鼻涕的我。没办法，周日一天，若干本没有必要打车的短途，我都不得已使用滴滴，给北京人民添了赌加了霾。我在朋友圈吐槽两句，有摩拜的朋友要下我的手机号，看了看后说等后台的任务处理到就能给我解锁。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;周一早上，算算过去有二十多小时，再慢的任务也该处理完闭，上班路上我想试试账号是否已恢复正常，就顺手扫了一辆车，结果问题依旧。我出离愤怒，写下这样的话准备和摩拜道别：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0icUrNickcAKaUMd7CzvTC5YvR4Pp9xibuZGdKAiad5icFXo7psuaZGJ6wBHnzRaX7KvD40HJ5MPcMkBhw/0?wx_fmt=jpeg&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.6796875&quot; data-w=&quot;1280&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;很快地，我被两位朋友分别拉进两个群。一个里有 BD director，一个里是某部门的 head of engineering，在大佬们的亲切关切下，我的问题瞬间解决 —— 在我「骑行」1273 分钟，也就是 21 小时之后，那幽灵一般的车子终于「成功关锁」：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/SER9L29WQ0icUrNickcAKaUMd7CzvTC5Yv83XUaWSYfox5NakavlLqBdtIN55xa3hL0LBNARdLfIvDYnPTev8jag/0?wx_fmt=jpeg&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.9949392712550608&quot; data-w=&quot;988&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;问题解决，该退我的钱也退还给我，借此感谢一下帮忙的各位朋友。在这样一个黑天鹅事件中，我的一众微信好友，还有我在程序员圈子里小小的名气，帮上了大忙。如果换一个用户，这事肯定就没有这么顺利。她的牢骚也许石沉大海，只能通过客服，耗时耗力，才能追回不该产生的费用。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;换做别人，这事可能就这么揭过，顶多变成茶余饭后的谈资。但对于一个闲的蛋疼没事就瞎琢磨的程序员来说，没有什么比这样的事情更有趣，跟值得思考。周一晚上回到酒店，在游泳池里消磨脂肪，打发卡路里的时间里，我的脑海里反反复复萦绕着一个问题：如何让系统更好地自行监测和处理类似的问题，而不是由愤怒的用户反馈上报？&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;如何更快地发现和处理类似问题？&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;作者按：以下分析纯属扯淡 —— 它并非基于一系列真实的数据，而是做了诸多很可能不靠谱的假设，分析也并非深思熟虑，就是半个多小时的突发奇想。套用菜头叔的一句话：我所说的，都是错的。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;按照已公开的专利：一种基于物联网的公共自行车租赁系统（https://www.google.com/patents/CN105354935A?cl=zh）的描述，借车的流程是这样子的（略修改）：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;利用手机APP扫描车身上的二维码，手机APP获取该自行车的唯一标识信息，并把借用请求发送到后台控制系统。后台控制系统同时给自行车的车载控制器发送开锁指令。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;车锁打开后，车载控制器会向系统发送开锁成功信息（同时附带GPS定位信息），自行车进入借用状态。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我的情况显然是车载控制器向系统发送开锁成功的信息，系统认为自行车进入到借用状态，而车锁实际并未真正打开。这在实际应用中是很难杜绝的问题，因为机械的开关动作无法完美地和发送开锁成功消息的芯片形成有一个完整的事务（transaction）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;上文中吐槽过，如果一个信誉良好的用户在「刷开」一辆车后，又重新扫相同的车，那么，非常非常大的几率是车锁并未真正打开。从产品的角度上讲，不应该阻止用户用车，而是再次尝试重新开锁，如果用户反复扫码，则应该在 app 中问问用户这辆车是不是无法正常开锁，并提示其汇报问题车辆。用户此时可以扫别的自行车骑行。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;当然，这一优化对信誉一般的用户，或者扫一辆车没扫开，便换一辆车来扫的用户来说，不太适用。很多时候还是会出现系统认为你正在用车进而无法借车的问题，我们需要更快地，更妥善地解决它。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们先做些定义：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;session：每次开锁后，到用户使用完毕关锁前是一个 session。session 有下面若干种。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;active session：正在进行中的 session，当用户扫码开锁借用一部车时，就产生一个 active session。一个用户只能有一个 active session。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;abnormal session：不正常的 active session，比如开锁后三十分钟却无产生位移。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;finished session：结束的 session。当用户关锁后，会结束当前的 active session，用户有资格继续借车。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;还有假设：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;90% 的 session 不超过 1 小时。最长的 session 不会超过 1 天。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果一个 session 在半小时（1800s）没有任何活动（意味着用户既没有关锁，又没有真正在骑行），那么这个 session 应该做异常处理。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;开锁后，车载的智能锁每 N 秒（假定 N=10）会向服务器发送心跳信息 —— 其中包含车辆编号，用户id，当前的地理位置，产生的位移（位移可以通过车轮的转速和周长算出）等。如果用户的 app 处于打开状态，也会以相同的节奏发送类似的数据，包含车辆编号，用户id，当前地理位置，以及根据 4G / WiFi / GPS 的信号来计算产生的位移。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;给定这些定义和假设，我们可以讨论下 session scan 的方法。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;&lt;strong&gt;方案一&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;最传统的方式是将 active session 组织成一个双向链表，当一个 active session 结束后，将其从链表中拿出释放。然后，后台有一个定时任务扫描这个链表，如果发现 abnormal session，将其拉出来 &lt;strong&gt;打上标记&lt;/strong&gt; 并插入一个 abnormal session 的双向链表，当其再度达到 timeout 时，进行异常处理。比如说再次关锁并结束这个 session，修正计费问题，或者进而加入到一个有待线下人工处理的队列。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;&lt;strong&gt;方案二&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;方案一简单易行，但最大的问题是 scan 本身是个线性的操作，O(N) 的复杂度避无可避。如果 N 在千万甚至上亿量级，其效果将会很差，可能一次完整的 scan 要数个小时完成，那么很多异常只有在数个小时后才能发现。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;所以我们需要更高效的数据结构来避免这种全表的扫描。我们知道，业界使用很多，效果很好，时间复杂度是 O(1) 数据结构是 timer wheel。她大概长这个样子：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ0icUrNickcAKaUMd7CzvTC5YvMvKjdIjica1dE6jianhvJcJU1Plt9PFVPffgdpwv7mfQt2PaWdsHQ4BQ/0?wx_fmt=png&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.4968684759916493&quot; data-w=&quot;479&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;根据业务的需要，timer wheel 可以有不同大小的总槽数（total slots）。slot 和 slot 的间隔我们称为一个 tick。假设一个 tick 是 1s，total slots 128k，那么这个 timer wheel 可以承载最多 1.5 天（128 x 1024 / 86400）内超时的 session，这可以满足我们上述的假定。timer wheel 保持一个 current tick，表明现在时钟走到哪里。时钟走到的位置，如果对应的链表中有 session，那么，这些都是超时的 session，需要被拉下来，由一个或者若干个 worker 来处理。如果在某个 tick 下有一个新的 session 产生，按照上述假设，我们为 session 设置 1800s 的超时时间，那么这个 session 会被安插在 current tick + 1800s 的位置，用双向链表组织起来。下次 current tick 指到这个位置时，这个 session 会被处理。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;timer wheel 逻辑上是上面的表述形式，实现上是数组 + 链表，如下：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/SER9L29WQ0icUrNickcAKaUMd7CzvTC5YvmIBrIZMCSAV4Vjy01DRHYS4JibPxQjXy5ppVKQJaUOI94DZQK9uwPBA/0?wx_fmt=png&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.5476772616136919&quot; data-w=&quot;409&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;timer wheel 的好处是，处理超时的 session 是 O(1) 的动作，current tick 指向的位置就是要处理的超时的 session 的列表，非常高效，不用全表扫描来找出需要处理的 session。不过她有一些额外的更新成本，比如说，用户在骑行过程中，每 10s 发送心跳，我们可以通过 GPS 位置的变化，产生的位移来决定是否要刷新这个 session。如果要刷新，那么需要把 session 从 timer wheel 的当前位置取出，放入一个新的位置，从而延缓超时任务对这个 session 的处理。千万级的 session 每 10s 刷新一下，那么每秒有百万级的链表操作，插来插去，非常不经济。一种办法是我们刷新 session 时，在 session 里记录 time diff，当 current tick 到达，worker 处理链表上的超时 session 时，如果发现 session 的 time diff 不为 0，则将其插回到 timer wheel 相应的位置，这样大大节省刷新时的处理（见 patent：www.google.com/patents/US8805988）。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;timer wheel 还有一个优化是，如果每个 slot 上链表很长，可以在 slot 上用 array + linklist 的方式，把 session hash 到 array 的不同位置，然后再 link 起来，比如说 array 长度为 32，原来一个 1024 长度的链表，可以被分布在 32 个链表下，每个链表平均 32 个 session。这样，我们可以用 32 个 worker 并发处理这些超时的 session。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这样下来，我们可以把异常 session 的处理时间大大缩短，从而挽回一个个悲痛欲绝的用户。&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;level2&quot; style=&quot;;&quot;&gt;&lt;h2 style=&quot;margin-top: 38px;margin-bottom: 10px;font-weight: bold;-webkit-font-smoothing: subpixel-antialiased;cursor: text;font-size: 24px;border-bottom: 2px solid rgb(0, 179, 139);color: rgb(0, 179, 138);height: 57px;line-height: 62px;display: inline-block;&quot;&gt;技术之外的一些思考&lt;/h2&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin-right: 10px;margin-bottom: 20px;margin-left: 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;我们常说，工程师要对其所负责产品有 ownership。这 ownership 说起来简单，但做起来，要付出很多额外的心血。一个业务线的功能做起来并不麻烦，麻烦的是：&lt;/p&gt;&lt;ol type=&quot;1&quot; style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;哪些路径上的哪些 data point 要送到监控系统（如 statsd）？上线后要在监控平台（如 datadog）上的哪些 dashboard 中添加哪些 graph，monitor，alert？潜在问题发生时的执行手册是什么？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;哪些 error log 送错误追踪系统（如 sentry）？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;这个功能如何 provision？如何 deploy？如果使用新的资源，如何描述这些资源（infrastructure as code）？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如何保证 performance 不会恶化？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;是否有必要要做 A/B testing，做多大的量？&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;现有的 analytics event（数据埋点）是否完备，如果不够，如何扩展，ETL job 是否要变更，谁来分析处理新收集的数据？&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;这里面，1 和 2 都是用来帮助我们在问题显现时，能够及时发现和处理。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;系统的问题由客户发现，并「被迫发出最后的吼声」，对开发这个系统的程序员来说，不啻是一种耻辱。一个问题为什么由用户报告给我们，我们才开始应对？是我们知道问题的存在假装视而不见？还是压根不知道问题的存在？前者看上去是人品的问题，但八成是程序员被 burn out 之后的自然反应，后者则是技术团队平时对监控和报警不注意导致的。平日里，我们对 UT 没有捕捉到的问题会非常在意，第一时间会补上相关的 UT，让 CI 能够在下次同样的问题发生时，异常退出；然而，对于线上的问题，我们却很少追根溯源，从相应的 data point 是否缺失开始，一路追查到 monitor 和 alert 是否齐备。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;前两天，在回顾 11 月我们 Tubi TV 线上问题时，一位同事总结他之前在微软中国 bing team 处理线上问题的一些收获，给大家普及了 TTD / TTA / TTE / TTR 的概念，我觉得很有帮助，列在这里：&lt;/p&gt;&lt;ul style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;TTD（Time To Detect）：问题从发生到被监测出来的时间（可以是通过工具，工程团队，甚至用户发现的）。TTD 越短越好，由工具发现远胜于用户发现并反馈。我们现在大部分问题 TTD 都在 5 分钟之内。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;TTA（Time to Aware）：问题从被监测出来到第一个能对此负责的人知道这个问题的时间。TTA 也是越短越好，然而这里有人这个因素的存在，有很多变数。我们用 opsgenie，它接收到报警再通过短信和电话通知到 oncall 的 dev，再到 dev 意识到问题，往往会有 5-10 分钟的间隔；如果 20 分钟无人响应，那么 opsgenie 会打电话给 dev team 的每一个人。所以，绝大多是情况，我们的 TTA 波动很大，大概在 5 - 40 分钟内。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;TTE（Time To Engage）：从有人知道发生问题到开始处理问题的时间。有时候，oncall 的 dev 可能在开车，在没有网络的环境，或者手头没有电脑，所以她需要联系下一个她能联系到的，且有资源处理问题的人，这里面也有很多人的因素，我们的 TTE 波动也很大，大致在 5 - 30 分钟之内。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;TTR（Time to Resolve）：问题从开始处理到解决。线上的问题，往往是一些固定类型的问题，我们也有相应的处理手册，所以，简单的问题（如重启一下服务）几分钟能够处理完成；中等的问题（如添置更多的资源），半小时内；复杂的问题，可能一下子没有合适的方案，但我们可以 workaround，也在半小时到一小时间可以解决。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;对于研发团队来说，我们要尽可能缩小 TTD / TTA / TTE / TTR，这样才能尽可能先于用户发现问题，在用户抓狂前，把问题解决掉。要缩小 TTD / TTA / TTE / TTR，我们需要知道，how good/bad we are —— 我们目前这些指标的的 max / min / mean 都是什么，这样才能有的放矢地改进。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;比如说，TTD 太长，那么，是监控数据收集地不够充分，还是收集好数据却没有设置相应的警报，还是设置好警报，但阈值过于宽泛，这样一层层追溯下来，我们就能够找到并修复监控的问题，进而可以观察下几次事故发生时，TTD 的曲线是否在下降。&lt;/p&gt;&lt;p style=&quot;margin: 20px 10px;max-width: 100%;min-height: 1em;white-space: pre-wrap;color: rgb(84, 84, 84);text-align: justify;line-height: 28px;box-sizing: border-box !important;word-wrap: break-word !important;&quot;&gt;以上。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;61505335&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_reward_area&quot; style=&quot;display:none;&quot;&gt;
                                        &lt;p class=&quot;tips_global reward_tips&quot;&gt;见贤思齐&lt;/p&gt;
                                        &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_reward_avatar&quot;&gt;&lt;img src=&quot;http://wx.qlogo.cn/mmhead/Q3auHgzwzM4CnP6qibI9pxcsoPWXVswUTzTFDegAVdFtkC9ic2FcOrcA/0&quot; alt=&quot;&quot;&gt;&lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; style=&quot;display: none;&quot; id=&quot;js_reward_author&quot;&gt;陈天&lt;/div&gt;
                    &lt;p&gt;
                        
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;&lt;span id=&quot;js_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                        
                    &lt;/p&gt;
                    &lt;div id=&quot;js_reward_inner&quot; class=&quot;reward_area_inner&quot; style=&quot;display:none;&quot;&gt;
                        &lt;p class=&quot;tips_global reward_user_tips&quot;&gt;&lt;a href=&quot;##&quot; id=&quot;js_reward_total&quot;&gt;&lt;/a&gt;人赞赏&lt;/p&gt;
                        &lt;div id=&quot;js_reward_list&quot; class=&quot;reward_user_list&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                                        &lt;p class=&quot;reward_tips&quot;&gt;见贤思齐&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                
                                
                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                
                                
                                
            &lt;/div&gt;</description>
<author>陈天</author>
<guid isPermaLink="false">2017-12-12-1000000086</guid>
<pubDate>Tue, 12 Dec 2017 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>
