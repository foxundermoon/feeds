<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>肉眼识别二维码？你也可以</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1507861511&amp;src=3&amp;ver=1&amp;signature=IiTKVFwsUImK1B99mwMKD0L1mwyGAXHO1q2bsa9tXw7uKcxPjWymkQbPSjhGce-7cVvRwTJgusNyy1*U2evDAVWE8U0KSfY8UiRiRVvvBKJYKKm4NzfHNn3KL9ZcdtlNCqeIe504XHPIiWmfwDmqZcq0vuRaGi3xgZKDsKXgh8g=">原文</a></p>
<div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    肉眼识别二维码？你也可以                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <em id="post-date" class="rich_media_meta rich_media_meta_text">2017-10-13</em>

                                        <em class="rich_media_meta rich_media_meta_text">Clerk</em>
                                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="##" id="post-user">利维坦</a>
                    <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">利维坦</span>

                    <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">利维坦</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">liweitan2014</span>
                            </p>

                            <p class="profile_meta">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">乱七八糟的，什么都有。</span>
                            </p>
                            
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p><br></p><p style="line-height: 1.5em;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 14px;color: rgb(0, 122, 170);">利维坦按：一个开关的开合状态可以对应“0、1”两个信号，莱布尼茨三百多年前留下的这个制式影响深远。日常语言依赖于思维逻辑，与之类似，数字语言的流通则依赖于数学逻辑，但本质上仍然只是无数个与非门的逻辑计算。因此相比于计算机，我们的计算能力虽然在效率方面有点难以启齿，但这并不代表有些事情我们注定办不到。</span></p><p><br></p><p style="line-height: 1.5em;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 14px;color: rgb(0, 122, 170);"><span style="color: rgb(0, 122, 170);font-size: 14px;">比如靠肉眼识别二维码？</span>虽然人类大脑的计算效率早已落后家用计算机好几个量级，但这并不妨碍我们光靠人脑去完成一件“看似只有电子设备才能完成的事情”的尝试。</span></p><p><br></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 14px;color: rgb(0, 122, 170);">毕竟生活已经够无聊了。</span></p><p><br></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-family: 'lucida Grande', Verdana;font-variant-ligatures: normal;orphans: 2;widows: 2;background-color: rgb(255, 255, 255);color: rgb(0, 122, 170);font-size: 12px;">本文由利维坦与每天扫码支付都有奖励的支付宝联合出品</span></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 16px;color: rgb(255, 255, 255);background-color: rgb(0, 122, 170);">支付就用支付宝</span></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 16px;color: rgb(255, 255, 255);background-color: rgb(0, 122, 170);"><br></span></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 16px;color: rgb(255, 255, 255);background-color: rgb(0, 122, 170);"><br></span></p><p style="line-height: 1.5em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);font-size: 12px;">扫码还得靠手机</span></p><p><br></p><hr><p><br></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">我们在生活中消费、转账时用手机扫的二维码，属于<strong>QR code（Quick Response）</strong>。但除了QR code之外，二维码还有其他多种制式标准，比如Data Matrix、PDF417、Ultra-code——本文只讨论QR码这个生活场景中最常见的二维码制，因为……其他的我也不会。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">条码技术最早需要追溯到上世纪20年代，当时美国威斯汀豪斯（Westinghouse）实验室的发明家约翰·科芒德（John Kermode）为了实现对邮政单据的自动分检，发明了一种<strong>用条码对单据做标记的机制<span style="font-size: 15px;color: rgb(136, 136, 136);">（一个条表示数字“1”，二个条表示数字“2”，称为模块比较法）</span></strong>，以及相应的译码器。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">但是这种始祖鸟级别的制式所蕴含的信息量极低，不久后科芒德的合作者道格拉斯·杨（Douglas Young）对此进行了改进，<strong>利用黑条之间空隙的尺寸变化来编码数据</strong>。两人在1949年获得了世界上第一个条码专利，这种最早期的条码由黑白相间的同心圆组成，被称为<strong>牛眼式条码</strong>。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPv3WO5IiamPg15vwkFQe1SsyAqzJZ1t1E12Mg3uye1TmVySjS3RP5rDw/0?wx_fmt=jpeg" class="" data-ratio="0.546875" data-w="1280"></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 14px;color: rgb(0, 122, 170);">另一说法称，牛眼式条纹是由工程师诺曼·伍德兰（Norman J. Woodland）发明的</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">现如今，我们已经对扫码购物的行为非常习惯了，但在条码技术普及之前，超市的出纳员只能靠敲键盘来输入商品价格，操作成本高不说，患有腱鞘炎的人也不在少数，简直成了职业病。<strong>条码技术的出现无疑节省了很多工作成本，更何况条码本身也伴随着硬件技术实现一次次的更迭和普及。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">欲求不满是人类的美好品德。条形码虽然带来了极大的便利，但是容量依旧有限，只容纳20个英文和数字，且无法编码汉字和假名。当时的制码人员几乎分成了两类，一类研究怎么往条码里塞更多的信息，一类研究怎么更快解码。大多数人属于第一类，而当时正在日本丰田子公司DensoWave从事条形码读取机研发的原昌宏开始尝试研发<strong>更快速的编码制式</strong>，进过一年半的研发过程，才有了1994年QR code码制的发明。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">码如其名，这一码制的最大特点便是“Quick Response”——快速响应，读取速度比其他编码制式快10倍以上，最先被用在汽车零部件生产行业的电子看板管理<span style="font-size: 15px;color: rgb(136, 136, 136);">（负责传递信息和生产管理的系统之一）</span>中，大大提高了生产、出货乃至单据的管理效率。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">作为一个男性程序员，原昌宏对于“快”有着独特的理解。<strong>他认为要想在应用条码的过程中实现快速，核心是解决识别的问题，剩下的内容只是计算。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);font-size: 14px;letter-spacing: 0.5px;">——如何才能让机器快速找到目标码区？</span></p><p style="text-align: right;margin-left: 8px;margin-right: 8px;"><span style="text-align: justify;font-size: 14px;letter-spacing: 0.5px;color: rgb(171, 25, 66);">用特殊形状的符号标记区域。——</span><span style="color: rgb(0, 122, 170);text-align: justify;font-size: 14px;letter-spacing: 0.5px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);text-align: justify;font-size: 14px;letter-spacing: 0.5px;">——如何确定码区所在平面？<br></span></p><p style="text-align: right;margin-left: 8px;margin-right: 8px;"><span style="text-align: justify;font-size: 14px;letter-spacing: 0.5px;color: rgb(171, 25, 66);">用三个特殊形状的标记（三点确定一个平面）。——</span></p><p style="text-align: start;margin-left: 8px;margin-right: 8px;"><span style="text-align: justify;color: rgb(0, 122, 170);font-size: 14px;letter-spacing: 0.5px;">——如何确定机器读取码区的方向？</span></p><p style="text-align: right;margin-left: 8px;margin-right: 8px;"><span style="font-size: 14px;letter-spacing: 0.5px;color: rgb(171, 25, 66);"><span style="letter-spacing: 0.5px;font-size: 14px;text-align: justify;">设置好</span><span style="letter-spacing: 0.5px;font-size: 15px;text-align: justify;">从某一标记出发，以及出发的方向就可以了。——</span></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">逻辑没有问题，剩下要解决的就是<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>标记的形状</strong></span>。如果编码周围有相同的图案，读取时就会被误认为是编码信息，从而导致误读，因此定位图案一定要保证特殊性。原昌宏为此收罗了大量广告单、杂志等印刷品，从各个方向进行扫描，并做了黑白色的二值处理，分析黑白占比，从而得出结论：<strong>黑白间隔比为1:1:3:1:1的比例定位的时，在印刷品中出现的概率最低。</strong></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><strong><br></strong></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPxDvht4av09ZnBd4ykZyDnibvQrP4TXc7c6rHw5gFpjKgvUjthY5E6Ug/0?wx_fmt=jpeg" class="" data-ratio="0.2388888888888889" data-w="720"></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">以下方二维码为例，三个分别位于二维码的左上角、右上角、左下角的“回”字形符号，便是规定了尺寸、读取方向的位置探测图形。有这三个识别符号放在二维码的三个角上后，解码的时间响应就可以很快，比同时代的技术要快20倍。 <span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>这便是肉眼识别二维码所要了解的第一个知识点：</strong></span></span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(171, 25, 66);"><strong><br></strong></span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>用位置探测图形确定码区。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPcAN6A4ibolye7lDzNe1sdKuJ650CA4ibmUNial6yAadd4tD5ezSLDxIug/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">此外，该制式还规定在与位置探测图形接壤的码区部分均为空白，以防止对位置探测图形产生识别干扰，这便是<strong><span style="font-size: 15px;color: rgb(171, 25, 66);">位置探测图形分隔符</span></strong><span style="font-size: 15px;color: rgb(136, 136, 136);">（下图中蓝色区域）</span>。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPP2gqhjicFc075KLVck4XK7TRI5dZHqjgSibibwS2bCoGZYlR0yCVOO1C6Q/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">再考虑到印有二维码的载体在实际应用场景中可能会发生的扭曲、移位和破损，制式还规定了一种与位置探测图形相类似的“回”字形图案（1:1:1:1:1），<strong>用来辅助定位减少误差</strong>，这便是<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>校正图形</strong></span><span style="font-size: 15px;color: rgb(136, 136, 136);">（仅在版本2以上存在）</span>。</span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPP5PwQibkuZX7ySWMl6iaLwI8w6yibLOZfXGGU4DUibRqRiaZXNDZtVAXaibmw/0?wx_fmt=png" class="" data-ratio="0.24265208475734792" data-w="1463"></p><p style="text-align:center;"><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;text-align: justify;">但如果连校正图形也被污染了呢？还有<span style="font-size: 15px;text-align: justify;color: rgb(171, 25, 66);"><strong>定位图形</strong><span style="font-size: 15px;text-align: justify;color: rgb(136, 136, 136);">（下图黄色区域）</span></span>，这是平行于二维码边缘的两条黑白交替出现的直线，与位置探测图形分隔符相接，<strong>用于确定二维码的角度，纠正扭曲。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPrrf0bq3VxxAzCE807EQrvazjbccH7AqYlPic1IsKxG6lMwTQlGeeyAw/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;">上面介绍的四个图形均属于功能区域，都是为了保证QR码能被读码设备正确获取，不存储具体数据信息。</span></strong><span style="font-size: 15px;">在学习肉眼识别二维码的过程中，我们只要找得到它们就够了。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">那么在剩下来的编码区里，究竟可以存储多少信息？答案是试规格而定。为了节省空间，QR码符号共有40种规格的矩阵，从最小的21x21（版本1）到最大177x177（版本40），每一版本符号比前一版本每边增加4个模块。<strong>版本1的二维码最多可以储存25个字符或41个数字，而版本40的二维码最多可以储存4296个字符或7089个数字。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPR1uyvZwtCBNH7NqpTVq0lfwErc80uQHhIiaCsbET6qR3Edonh5clcaA/0?wx_fmt=png" class="" data-ratio="0.671875" data-w="1024"></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;">在下图的版本1二维码中，只有未被红黄蓝三色填充的几块码区为我们所需要的数据存储区。</span></strong><span style="font-size: 15px;">信息将通过特定算法转换成黑色和白色的小方格填充其中，但即便我们知道了该看哪些区域，离最终解码还有些距离。</span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPLkZZHic7IwjSMDdG6Zt0p1TrlAvQYhIqThOzS2LjWlC6RHM0fIzibSLg/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">再往下细分，<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>数据存储区又可以分成三类：数据编码、纠错编码，以及代表格式字符串的码区。</strong></span>第一种自然不必说，是我们最终需要使用的区域。至于纠错编码，这里不得不提到QR码的另外一大特点——<strong>高容错率</strong>。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">日常生活里，沿街餐馆里贴在桌角用于收款的二维码大概是最容易受损的了。印有二维码的小纸片这边磨破一个角，那边沾了点酱油，码区可能早已不再完整。纠错编码的作用便体现在这里，通过对数据码进行RS纠错计算（里德-所罗门码算法）得到与之对应的纠错码，以此来保证二维码的可读性。<strong>当数据码区受到污染的时候，读码器依旧可以凭借纠错码得到正确信息。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">根据纠错能力的不同，纠错码共分成L、M、Q、H 4个级别，分别可修正7%、15%、25%、30%的字码。关于纠错码的级别信息便记录在数据区的第三块内容——<strong><span style="font-size: 15px;color: rgb(171, 25, 66);">格式字符串</span></strong>中<span style="font-size: 15px;color: rgb(136, 136, 136);">（即下图红色部分）</span>，这是我们需要处理的第一组数据。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPY2yYFEnv117gpg1YHrT1Z6wQ3YD2FXL1yEYpNDICpHwZFLC5QcLpHw/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span><br></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">格式字符串所蕴含的信息除了纠错等级以外，还包括表示<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>掩码类型</strong></span>的信息。所谓的掩码，粗暴理解是为了让二维码更加容易被机器识别而定义的一次计算过程，降低了二维码本身被误读的可能性，使整个二维码码区排列更均匀，更容易被识别。</span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">QR码制式中一共定义了7种掩码类型，每一种又可以根据4个纠错码级别产生4个变种，对于同一个信息便有了4*7=28种加工可能。<strong>因此只有确定了纠错等级和掩码类型，才能正式进入对数据的处理阶段，而我们首先需要得到的便是<span style="font-size: 15px;color: rgb(171, 25, 66);">掩码的类型</span>。</strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">黑块为“1”，白块为“0”。格式字符串数据的翻译方向为从上往下<span style="font-size: 15px;color: rgb(136, 136, 136);">（或从右到左）</span>，需注意当从右往左进行翻译的时候，<strong>右边半段红色区域的左端与左边半段红色区域的右端是重复信息，只取其中一位。</strong>基于上述算法法则，我们很快可以得到格式字符串信息<span style="font-size: 15px;color: rgb(136, 136, 136);">（红色区域，如上图所示）</span>——<strong>110011000101111</strong>，再查阅格式字符串表可得出结论：<strong><span style="font-size: 15px;color: rgb(171, 25, 66);">该二维码所采用的纠错级别为L，掩码模式4（下图正中所示掩码模式）。</span></strong></span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPh4C2U4Vic9LfuJqe4mpGQgxqxN75ibCg29NcXLDyyyoaY3icO3fsLwKTQ/0?wx_fmt=png" class="" data-ratio="0.8978805394990366" data-w="519"></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">接下来便需要对掩码进行逆向计算。<strong>所谓掩码其实很好理解——这是一个把数据区里的黑白小方块拆散的过程</strong>，每种掩码类型所规定的图像模型中，<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>黑色区域表示原始码区的该位置需要颠倒一次黑白（数值反转），白色区域保持不变</strong></span>，以此来打散码区。因此我们可以根据掩码模式4的图形来推算这个二维码在掩码处理之前的状态。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPnTRXNWMM61MhlaDgWuYd6dd5YwLjEFXe2gpvJuFdJnxvdyqYyU2mfg/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">终于等到从图形码变成数字的一刻。对于上图左侧我们得出的结论图，我们定义白块为0，黑块为1，从最右下角的模块开始进行记录，可以很轻易得到一串数列。下图是一个附带校正图形<span style="font-size: 15px;color: rgb(136, 136, 136);">（紫色部分）</span>与版本信息<span style="font-size: 15px;color: rgb(136, 136, 136);">（蓝色部分）</span>的二维码示意图，红线所示为阅读方向。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPJwkYzJeWlXGLUIsS7b4Z1DqUFMrJI42lbJicC6pjqx8Sxp8xjrD20Qw/0?wx_fmt=jpeg" class="" data-ratio="0.45" data-w="720"><span style="font-size: 15px;text-align: justify;">该数列为：</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">01000000  00110110</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">01010110  11100110</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">01000000  ……</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">接下来的工作便是对这串数字进行换算。无论是编码还是解码，我们都希望二维码能够以最短的比特串记录数据，因此<strong>编码开始之前便会对四种数据形式<span style="font-size: 15px;color: rgb(136, 136, 136);">（数字、字母数字、汉字，8位字节）</span>进行编码方式的选择</strong>，在后期得到的二进制数列中也能找到每<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>一个编码方式独有的二进制标识</strong></span>，这些标识会记录在数据区的前端（即图中右下角四个小方块的位置），使得解码器可以根据二维码使用的编码方式对数据进行解码。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">编码方式通常用4位数字表示，因此我们单拎出开头的4个数字“0100”，对照下表可查到对应的模式为字节模式。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"></span></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img data-s="300,640" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPnGLPbBHjibaSICxakmNN6b1zRjoWHKbFPku0N4KSk1eqpbded6mf55Q/0?wx_fmt=png" class="" data-ratio="0.15434083601286175" data-w="1555"></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">8位字节模式所使用的是ASCII字符集，每个字符都需要用8位二进制码进行表示。而在代表编码模式的4个数字后面，我们仍需要再拎出来8个数字“00000011”，<span style="font-size: 15px;color: rgb(171, 25, 66);"><strong>这组数字所表示的是原数据的字符数，十进制为3，即原数据共有三个字节。</strong></span></span></p><p><br></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">因此这组数据应该这样排列：</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">0100  00000011</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">01100101  01101110</span></p><p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">01100100  0000……</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;">在二维码的解码过程中，“0000”代表的是原始数据的结束。</span></strong><span style="font-size: 15px;">但QR码对每种版本都规定了具体位数，因此后面的数据码往往由补齐码和大量纠错码组成。</span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">补齐码的设置其实特别有意思。在终止符出现后，需要先将位数用“0”补到8的倍数。如果还不够，则需要往后头重复两组字节：<strong>11101100 、00010001。这些字节分别等于236和17，在二维码里的地位有如开普勒常数之于太阳系，自然常数之于自然。</strong>具体为何如此规定，若悉知，望告知。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">至于纠错码，虽然本文不多做介绍，但是由于在大容量二维码中<span style="font-size: 15px;color: rgb(136, 136, 136);">（版本高于4）</span>，最后呈现出来的码是通过将数据码和纠错码进行重新排布，再套用掩码模型制作出来的，因此无法用前文的方法进行计算。</span></p><p><br></p><p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">最后的最后，我们最后倒腾出来的三组字节换算成10进制后分别是<strong>101、110、100</strong>，查询下表就可以看到这张二维码的数据信息，<strong><span style="font-size: 15px;color: rgb(171, 25, 66);">肉眼识别二维码——目标达成。</span></strong></span></p><p><br></p><p style="text-align: center;margin-left: 8px;margin-right: 8px;">…</p><p style="text-align: center;margin-left: 8px;margin-right: 8px;">…</p><p style="text-align: center;margin-left: 8px;margin-right: 8px;"><span style="background-color: rgb(0, 122, 170);color: rgb(255, 255, 255);">     至于支付，真的还是用支付宝吧     </span></p><p style="text-align: center;"><br></p><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;">自2011年首次将扫码支付引入国内以来，支付宝借助智能手机行业的高速发展迅速成长，从条码到二维码甚至到无人商店，至今已然重塑了很大一部分人的支付习惯。无论是吃饭购物，还是刷公交租单车，二维码俨然成为连接线上与线下的窗口，越来越多人选择使用支付宝在线下进行支付。</span></p><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;"><img data-s="300,640" data-type="jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/H22VlVkibh3tpEaEdgjApdhsBm0EgsVPPlyxd6fEdmo4Un0LwxIgJm300yH1skPxabvaVaibPP38ibgyWE08cGjyA/0?wx_fmt=jpeg" data-copyright="0" class="" data-ratio="0.49609375" data-w="1280" style="text-align: center;white-space: normal;"></span></p><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><p><span style="font-size: 15px;">此外，支付宝还赋予了扫码支付额外的意义——他们在内蒙古阿拉善盟包了六块地，只要有足够的扫码支付行为来支持低碳，蚂蚁森林里的树苗长成之后，支付宝就会到那真的种下一棵树。</span></p><p><br></p><p><span style="font-size: 15px;">2015年的春节，一波春晚集五福活动让更多人开始拿起手机扫码，而根据中国互联网络信息中心的数据，截止去年6月，中国使用网上支付的用户规模达到4.55亿。</span></p><p><br></p><p><span style="font-size: 15px;">所以剩下的8.45亿，便捷、迅速、安全——还在等什么？</span></p>
                </div>
                <script nonce="1328355472" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc" id="js_preview_reward" style="display:none;">
                    <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                    <p>
                        <a class="reward_access" id="js_preview_reward_link" href="##">赞赏</a>
                    </p>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div><div class="rich_media_tool" id="js_toobar3">
                                            <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div><div class="rich_media_tool" id="js_sg_bar">
                                
            </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
</body>
</html>
