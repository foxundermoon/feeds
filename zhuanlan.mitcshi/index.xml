<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>川流不息</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/</link>
<description>北京量信投资管理有限公司是一家在中国基金业协会备案登记的专业私募基金管理人。本专栏作者石川是量信投资的联合创始人。希望通过这个平台和各位小伙伴分享我们在量化投资领域的知识和心得。原创不易，请保护版权，请在获得授权后转载。已委托“维权骑士”(http://rightknights.com) 为进行维权行动。</description>
<language>zh-cn</language>
<lastBuildDate>Tue, 14 Aug 2018 19:17:27 +0800</lastBuildDate>
<item>
<title>为什么要进行因子正交化处理？</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-14-41993542.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41993542&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-ffeb3a745e02996636484b501d9b0604_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;摘要&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;选股多因子模型中常进行因子正交化处理。如果因子之间不满足正交性，则它们会相互影响各自的回归系数，这可能造成回归系数过大的估计误差，对因子的评价产生负面影响。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 多因子模型求解&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在选股多因子模型中，人们常提到的一个概念是&lt;b&gt;因子正交化处理&lt;/b&gt;。本文就从多因子截面回归求解的角度来简单说说为什么我们喜欢相互正交的因子，以及如果因子之间不正交对回归系数会有什么影响。&lt;/p&gt;&lt;p&gt;一个多因子模型可以写成如下的形式：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf y=\mathbf X\mathbf b+\mathbf ε&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;equation&gt;\mathbf y&lt;/equation&gt; 是 &lt;equation&gt;N × 1&lt;/equation&gt; 阶股票下一期的收益率向量， &lt;equation&gt;\mathbf X&lt;/equation&gt; 为 &lt;equation&gt;N × K&lt;/equation&gt; 阶当期的因子暴露矩阵， &lt;equation&gt;\mathbf b&lt;/equation&gt; 为 &lt;equation&gt;K × 1&lt;/equation&gt; 阶待通过回归求解得到的因子收益率向量， &lt;equation&gt;\mathbf ε&lt;/equation&gt;  为 &lt;equation&gt;N × 1&lt;/equation&gt; 阶残差向量。假设  &lt;equation&gt;\mathbf X&lt;/equation&gt; 满足列满秩，则上述模型的 OLS（ordinary least squares）回归求解为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf b=\left(\mathbf X^T\mathbf X\right)^{-1}\mathbf{X}^T\mathbf y&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;需要注意的是，在上面这个模型以及  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的表达式中，&lt;b&gt;因子向量 &lt;/b&gt;&lt;equation&gt;\mathbf X&lt;/equation&gt;&lt;b&gt; 已经包括了所有的 regressors，因此回归模型右侧没有额外的截距项&lt;/b&gt;。这意味着，如果我们假设截距项也是一个因子，则它对应的 &lt;equation&gt;N × 1&lt;/equation&gt; 阶向量 &lt;equation&gt;[1,1,…,1]^T&lt;/equation&gt; 已经作为  &lt;equation&gt;\mathbf X&lt;/equation&gt;  的某一列（通常是第一列）存在于  &lt;equation&gt;\mathbf X&lt;/equation&gt;  之中了；如果我们假设截距项不是一个因子，则  &lt;equation&gt;\mathbf X&lt;/equation&gt;  中没有 &lt;equation&gt;[1,1,…,1]^T&lt;/equation&gt; 这一列。&lt;/p&gt;&lt;p&gt;在 Barra 的多因子模型 CNE5 中考虑了国家因子，所有个股在该因子上的暴露都是 1，因此它的作用就相当于一个截距因子； &lt;equation&gt;[1,1,…,1]^T&lt;/equation&gt; 这个向量在 Barra 模型中正是  &lt;equation&gt;\mathbf X&lt;/equation&gt;  的第一列。另外，对于我们最熟悉的 simple regression model，它的右侧只有一个截距和一个解释变量：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;y_i=a+bx_i+\varepsilon_i&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;按照上述说明，该模型对应的矩阵  &lt;equation&gt;\mathbf X&lt;/equation&gt;  包括两列：一列对应截距，一列对应真正的解释变量  &lt;equation&gt;\mathbf x&lt;/equation&gt; ：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf X=\left[ \begin{array}{cc} 1&amp;amp;x_1\\ 1&amp;amp;x_2\\ \vdots&amp;amp;\vdots\\ 1&amp;amp;x_N \end{array} \right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;从  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的表达式来看，它和 &lt;equation&gt;\mathbf X^T\mathbf X&lt;/equation&gt; 有关。&lt;b&gt;当 &lt;/b&gt;&lt;equation&gt;\mathbf X&lt;/equation&gt;&lt;b&gt; 的各列（即回归模型中的不同解释变量，或我们研究问题中的不同因子暴露向量）之间不正交时，则在计算&lt;/b&gt; &lt;equation&gt;\mathbf X^T\mathbf X&lt;/equation&gt;&lt;b&gt; 乃至最终的 &lt;/b&gt;&lt;equation&gt;\mathbf b&lt;/equation&gt;&lt;b&gt; 时，&lt;/b&gt; &lt;equation&gt;\mathbf X&lt;/equation&gt; &lt;b&gt; 不同列之间是相互影响的，而这种影响不是什么好事儿。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 简单一元回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;让我们从最简单的一元回归（simple univariate regression）说起。&lt;/p&gt;&lt;p&gt;假设有一元回归模型 &lt;equation&gt;\mathbf y = b\mathbf x + \mathbf ε&lt;/equation&gt; （模型右侧只有一个解释变量，&lt;b&gt;没有截距项&lt;/b&gt;）。对于两个同阶向量 &lt;equation&gt;\mathbf m&lt;/equation&gt; 和  &lt;equation&gt;\mathbf n&lt;/equation&gt; ，令 &lt;equation&gt;\langle\mathbf m, \mathbf n\rangle&lt;/equation&gt; 表示它们的內积，即 &lt;equation&gt;\langle\mathbf m, \mathbf n\rangle=\sum m_in_i&lt;/equation&gt; ，则该一元回归模型的 OLS 解为（求解对象就是标量  &lt;equation&gt;b&lt;/equation&gt; ）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\displaystyle b=\frac{\langle\mathbf x,\mathbf y\rangle}{\langle\mathbf x,\mathbf x\rangle}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;这个结论非常简单，但是它十分重要。在上一节中，我们给出了多元回归 OLS 求解的表达式：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf b=\left(\mathbf X^T\mathbf X\right)^{-1}\mathbf{X}^T\mathbf y&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;比较一元回归模型的标量  &lt;equation&gt;b&lt;/equation&gt;  和多元回归模型的向量  &lt;equation&gt;\mathbf b&lt;/equation&gt;  不难发现如下现象：在多元回归模型中，如果所有的解释变量两两正交，即 &lt;equation&gt;\langle\mathbf x_i, \mathbf x_j\rangle=0,i\ne j&lt;/equation&gt; ，则向量  &lt;equation&gt;\mathbf b&lt;/equation&gt;  中的每一个系数  &lt;equation&gt;b_i&lt;/equation&gt;  恰恰等于：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\displaystyle b_i=\frac{\langle\mathbf x_i,\mathbf y\rangle}{\langle\mathbf x_i,\mathbf x_i\rangle}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;这是因为 &lt;equation&gt;\langle\mathbf x_i, \mathbf x_j\rangle=0&lt;/equation&gt; 保证了 &lt;equation&gt;\mathbf X^T\mathbf X&lt;/equation&gt; 的所有非对角元素都是 0，因此它是一个对角阵。对角阵的逆矩阵就是把该对角阵对角线上的元素都取倒数，所以逆矩阵仍然是对角阵。因此， &lt;equation&gt;\mathbf X^T\mathbf X&lt;/equation&gt;  的第 &lt;equation&gt;i&lt;/equation&gt; 个对角元素为 &lt;equation&gt;1/\langle\mathbf x_i, \mathbf x_i\rangle&lt;/equation&gt; 。另一方面， &lt;equation&gt;\mathbf X^T\mathbf y&lt;/equation&gt; 是一个 &lt;equation&gt;K × 1&lt;/equation&gt; 向量，它的第 &lt;equation&gt;i&lt;/equation&gt; 个元素是 &lt;equation&gt;\mathbf x_i&lt;/equation&gt; &lt;equation&gt;\mathbf y&lt;/equation&gt; 和 &lt;b&gt;y&lt;/b&gt; 的內积，即 &lt;equation&gt;\langle\mathbf x_i, \mathbf y\rangle&lt;/equation&gt; 。最终，多元回归的 &lt;equation&gt;b_i&lt;/equation&gt; 正是 &lt;equation&gt;\langle\mathbf x_i, \mathbf y\rangle/\langle\mathbf x_i, \mathbf x_i\rangle&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;怎么样？ &lt;equation&gt;b_i&lt;/equation&gt; 和一元回归中的 &lt;equation&gt;b&lt;/equation&gt; 的表达式一模一样，说明&lt;b&gt;当所有解释变量相互正交时，不同的因子（即 &lt;/b&gt;&lt;equation&gt;\mathbf x_i&lt;/equation&gt; &lt;b&gt;）对彼此的参数估计（即&lt;/b&gt; &lt;equation&gt;b_i&lt;/equation&gt; &lt;b&gt;，因子收益率）没有任何影响。&lt;/b&gt;这便是正交的好处。&lt;/p&gt;&lt;p&gt;那么，当因子（解释变量）之间不正交时又会怎样呢？为了回答这个问题，我们首先来看看回归的几何意义。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 回归的几何意义&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;将  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的表达式代入回归模型得到  &lt;equation&gt;\mathbf ε&lt;/equation&gt;  的表达式，并计算  &lt;equation&gt;\mathbf X&lt;/equation&gt;  和  &lt;equation&gt;\mathbf ε&lt;/equation&gt;  的內积有；&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \mathbf X^T\mathbf\varepsilon&amp;amp;=&amp;amp;\mathbf X^T(\mathbf y-\mathbf X\mathbf b)\\ &amp;amp;=&amp;amp;\mathbf X^T(\mathbf y-\mathbf X\left(\mathbf X^T\mathbf X\right)^{-1}\mathbf{X}^T\mathbf y)\\ &amp;amp;=&amp;amp;\mathbf X^T\mathbf y-\left(\mathbf X^T\mathbf X\right)\left(\mathbf X^T\mathbf X\right)^{-1}\mathbf{X}^T\mathbf y\\ &amp;amp;=&amp;amp;\mathbf X^T\mathbf y-\mathbf X^T\mathbf y\\ &amp;amp;=&amp;amp;\mathbf 0 \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上式说明，OLS 的残差  &lt;equation&gt;\mathbf ε&lt;/equation&gt;  和解释变量  &lt;equation&gt;\mathbf X&lt;/equation&gt;  正交。来看看这在几何上意味着什么。&lt;/p&gt;&lt;p&gt;首先考虑最简单的情况，即一元回归 &lt;equation&gt;\mathbf y = b\mathbf x + \mathbf ε&lt;/equation&gt; （再次提醒，没有截距项）。它的几何意义如下图所示：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-185db899e9c6f53b227b89ad493572d3_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;251&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-185db899e9c6f53b227b89ad493572d3&quot; data-watermark-src=&quot;v2-0f1ed0d3b9202ea4cd7de3fd6908685f&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这个图说明，OLS 回归实际上将  &lt;equation&gt;\mathbf y&lt;/equation&gt; &lt;b&gt;垂直投影到（orthogonally projected onto）&lt;/b&gt; &lt;equation&gt;\mathbf x&lt;/equation&gt; &lt;b&gt; 之上&lt;/b&gt;，使得 &lt;equation&gt;\mathbf y&lt;/equation&gt; 和其在 &lt;equation&gt;\mathbf x&lt;/equation&gt; 上的投影之间的距离（ &lt;equation&gt;\mathbf ε&lt;/equation&gt;  的长度）最短（残差平方和最小）。这就是 OLS 的几何意义。&lt;/p&gt;&lt;p&gt;再来看看二元回归 &lt;equation&gt;\mathbf y = b_1\mathbf x_1 + b_2\mathbf x_2 + \mathbf ε&lt;/equation&gt; ，并首先&lt;b&gt;假设 &lt;/b&gt;&lt;equation&gt;\mathbf x_1&lt;/equation&gt; &lt;b&gt;和 &lt;/b&gt;&lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;之间是正交的&lt;/b&gt;。该回归的几何意义如下：&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ccc579278e4407ffdb1f948524cfc859_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;601&quot; data-rawheight=&quot;442&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ccc579278e4407ffdb1f948524cfc859&quot; data-watermark-src=&quot;v2-567923869b016a6a04053f7258459c2b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;对于二元回归，它的几何意义是将 &lt;equation&gt;\mathbf y&lt;/equation&gt; 垂直投影到由 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_2&lt;/equation&gt; 生成的超平面内，其投影正如上图中绿色向量所示。此外，我们可以分别、独立的将  &lt;equation&gt;\mathbf y&lt;/equation&gt;  投影到 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_2&lt;/equation&gt; 上（图中两个橘黄色向量）。在本例中，&lt;b&gt;由于 &lt;/b&gt;&lt;equation&gt;\mathbf x_1&lt;/equation&gt; &lt;b&gt;和 &lt;/b&gt;&lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;相互正交（垂直），因此绿色向量恰好等于两个橘黄色向量之和。&lt;/b&gt;这说明当 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_2&lt;/equation&gt; 正交时，回归系数 &lt;equation&gt;b_i&lt;/equation&gt; 仅由 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf y&lt;/equation&gt; 决定、其他任何解释变量 &lt;equation&gt;\mathbf x_j (j ≠ i)&lt;/equation&gt; 对 &lt;equation&gt;b_i&lt;/equation&gt; 均没有影响。&lt;/p&gt;&lt;p&gt;下面来看看 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;非正交&lt;/b&gt;的情况。该二元回归的几何意义如下：&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-63a95ce036a4d0c955e92dfc0d6d2458_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;444&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-63a95ce036a4d0c955e92dfc0d6d2458&quot; data-watermark-src=&quot;v2-0884ca75f3adae05eb3615cdd6e9ea4d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;它和前一种情况最大的区别是，&lt;b&gt;当 &lt;/b&gt;&lt;equation&gt;\mathbf x_1&lt;/equation&gt; &lt;b&gt;和 &lt;/b&gt;&lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;非正交时，&lt;/b&gt; &lt;equation&gt;\mathbf y&lt;/equation&gt; &lt;b&gt; 在由 &lt;/b&gt;&lt;equation&gt;\mathbf x_1&lt;/equation&gt; &lt;b&gt;和 &lt;/b&gt;&lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;生成的超平面内的投影不等于 &lt;/b&gt; &lt;equation&gt;\mathbf y&lt;/equation&gt; &lt;b&gt; 分别在 &lt;/b&gt;&lt;equation&gt;\mathbf x_1&lt;/equation&gt; &lt;b&gt;和 &lt;/b&gt;&lt;equation&gt;\mathbf x_2&lt;/equation&gt; &lt;b&gt;上的投影之和。&lt;/b&gt;在这种情况下，解释变量之间对各自的回归系数有不同的作用，因此 OLS 的回归系数 &lt;equation&gt;b_i&lt;/equation&gt; &lt;b&gt;不再等于&lt;/b&gt; &lt;equation&gt;\langle\mathbf x_i, \mathbf y\rangle/\langle\mathbf x_i, \mathbf x_i\rangle&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;非正交 &lt;equation&gt;\mathbf x_i&lt;/equation&gt; 之间的相互作用如何影响回归系数 &lt;equation&gt;b_i&lt;/equation&gt; 呢？通过连续正交化来求解多元线性回归可以回答这个问题。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 用正交化过程求解多元回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;还是拿我们最熟悉的 simple regression model 为例；该模型有两个解释变量 —— 截距项和  &lt;equation&gt;\mathbf x&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;&lt;equation&gt;y_i=a+bx_i+\varepsilon_i&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;令 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 表示截距项对应的解释变量，即 &lt;equation&gt;\mathbf x_0 = [1,1,…,1]^T&lt;/equation&gt; ； &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 表示上式中的解释变量  &lt;equation&gt;\mathbf x&lt;/equation&gt; 。假设 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 非正交（正交的话我们就不用费劲了）。对于简单回归模型，回归系数  &lt;equation&gt;a&lt;/equation&gt; （对应 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; ）和 &lt;equation&gt;b&lt;/equation&gt; （对应 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; ）的解为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} b&amp;amp;=&amp;amp;\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum x_i^2-\frac{1}{n}(\sum x_i)^2}\\ a&amp;amp;=&amp;amp;\displaystyle\frac{1}{n}\sum y_i-b\left(\frac{1}{n}\sum x_i\right) \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;下面就来看看如何通过正交化求解 &lt;equation&gt;a&lt;/equation&gt; 和 &lt;equation&gt;b&lt;/equation&gt; 。由于 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 非正交，首先需要构造出一组正交向量。令 &lt;equation&gt;\mathbf z_0 = \mathbf x_0&lt;/equation&gt; 为其中的一个向量，将 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 用 &lt;equation&gt;\mathbf z_0&lt;/equation&gt; 进行一元回归（不带截距）得到的残差就是和 &lt;equation&gt;\mathbf z_0&lt;/equation&gt; 互相垂直（正交）的向量，记为 &lt;equation&gt;\mathbf z_1&lt;/equation&gt; 。由一元回归的性质可知：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf z_1=\displaystyle\mathbf x_1-\frac{\langle\mathbf z_0,\mathbf x_1\rangle}{\langle\mathbf z_0,\mathbf z_0\rangle}\mathbf z_0=\mathbf x_1-\bar x\mathbf 1&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;equation&gt;\bar x&lt;/equation&gt; 表示  &lt;equation&gt;\mathbf x&lt;/equation&gt;  的均值， &lt;equation&gt;\mathbf 1&lt;/equation&gt; 表示列向量 &lt;equation&gt;[1,1,…,1]^T&lt;/equation&gt; ，即 &lt;equation&gt;\mathbf z_0&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;So far so good？接下来，注意了：&lt;/p&gt;&lt;p&gt;&lt;b&gt;将 &lt;/b&gt; &lt;equation&gt;\mathbf y&lt;/equation&gt; &lt;b&gt; 用上面得到的 &lt;/b&gt;&lt;equation&gt;\mathbf z_1&lt;/equation&gt; &lt;b&gt;进行一元回归（不带截距），得到的回归系数就是上述 simple regression model 中解释变量 &lt;/b&gt; &lt;equation&gt;\mathbf x&lt;/equation&gt; &lt;b&gt; 的回归系数&lt;/b&gt; &lt;equation&gt;b&lt;/equation&gt; &lt;b&gt;！&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} b&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_1,\mathbf y\rangle}{\langle\mathbf z_1,\mathbf z_1\rangle}=\displaystyle\frac{\langle\mathbf x_1-\bar x\mathbf 1,\mathbf y\rangle}{\langle\mathbf x_1-\bar x\mathbf 1,\mathbf x_1-\bar x\mathbf 1\rangle}\\ &amp;amp;=&amp;amp;\displaystyle\frac{\sum x_iy_i-\bar x\sum y_i}{\sum(x_i-\bar x)^2}=\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum(x_i^2-2x_i\bar x+\bar x^2)}\\ &amp;amp;=&amp;amp;\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum x_i^2-2(\sum x_i)\bar x+n\bar x^2}=\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum x_i^2-2n\bar x^2+n\bar x^2}\\ &amp;amp;=&amp;amp;\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum x_i^2-n\bar x^2}=\displaystyle\frac{\sum x_iy_i-\frac{1}{n}\sum x_i\sum y_i}{\sum x_i^2-\frac{1}{n}(\sum x_i)^2} \end{array}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;怎么样？我们并没有直接对该模型求解，而是通过正交化的方式就求出了解释变量 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 的回归系数  &lt;equation&gt;b&lt;/equation&gt; 。反应快的小伙伴也许马上会问  &lt;equation&gt;a&lt;/equation&gt;  呢？ &lt;equation&gt;a&lt;/equation&gt;  是否等于 &lt;equation&gt;\langle\mathbf z_0, \mathbf y\rangle/\langle\mathbf z_0, \mathbf z_0\rangle&lt;/equation&gt; 呢？别急，我们一会儿就聊 &lt;equation&gt;a&lt;/equation&gt; ，但是在那之前先来看一个&lt;b&gt;通过连续正交化求解多元回归的算法&lt;/b&gt;（Hastie et al. 2016）：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-4ebccf87b8461860673a45e28cc187e5_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;924&quot; data-rawheight=&quot;499&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-4ebccf87b8461860673a45e28cc187e5&quot; data-watermark-src=&quot;v2-48dc8bfabe3410e71700b618533b16f9&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;该算法的核心是通过连续的正交化计算把一组非两两正交的向量 &lt;/b&gt;&lt;equation&gt;\mathbf x_i&lt;/equation&gt; &lt;b&gt;转换成一组两两正交的向量 &lt;/b&gt;&lt;equation&gt;\mathbf z_i&lt;/equation&gt; &lt;b&gt;，并以此方便的求出最后一个被正交化的解释变量的多元回归系数。&lt;/b&gt;虽然它只有三步，但是每一步都值得解读一下：&lt;/p&gt;&lt;p&gt;&lt;b&gt;1.&lt;/b&gt; 第一步是初始化，在所有解释变量中（如果回归中有截距项，就把 &lt;equation&gt;[1,1,…,1]^T&lt;/equation&gt; 看做一个解释变量）任意挑选一个当作 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 进行初始化 &lt;equation&gt;\mathbf z_0 = \mathbf x_0&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.&lt;/b&gt; 第二步是&lt;b&gt;根据我们自己选定的递归顺序（任意顺序都可以）&lt;/b&gt;，对 &lt;equation&gt;\mathbf x_1, \mathbf x_2,\cdots, \mathbf x_p&lt;/equation&gt; 依次进行正交化。例如，对 &lt;equation&gt;\mathbf x_j&lt;/equation&gt; 的正交化处理就是用它和之前已经被处理过后的正交向量 &lt;equation&gt;\mathbf z_0, \mathbf z_1,\cdots, \mathbf z_{j-1}&lt;/equation&gt; &lt;b&gt;逐一独立&lt;/b&gt;一元回归得到系数  &lt;equation&gt;\langle\mathbf z_k, \mathbf x_j\rangle/\langle\mathbf z_k, \mathbf z_k\rangle, k=0,1,\cdots,j-1&lt;/equation&gt; ，进而用  &lt;equation&gt;\mathbf x_j&lt;/equation&gt;  减去 &lt;equation&gt;(\langle\mathbf z_k, \mathbf x_j\rangle/\langle\mathbf z_k, \mathbf z_k\rangle)\mathbf z_k, k=0,1,\cdots,j-1&lt;/equation&gt; 之和，得到的残差就是最新的正交化后的向量  &lt;equation&gt;\mathbf z_j&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;&lt;b&gt;3.&lt;/b&gt; 使用  &lt;equation&gt;\mathbf y&lt;/equation&gt;  和 &lt;equation&gt;\mathbf z_p&lt;/equation&gt; 进行一元回归，得到的系数 &lt;equation&gt;\langle\mathbf z_p, \mathbf y\rangle/\langle\mathbf z_p, \mathbf z_p\rangle&lt;/equation&gt; 正是这个多元回归 OLS 求解中原始解释变量 &lt;equation&gt;\mathbf x_p&lt;/equation&gt; 的回归系数 &lt;equation&gt;b_p&lt;/equation&gt; 。注意，这一结论仅对&lt;b&gt;最后一个&lt;/b&gt;（第 &lt;equation&gt;p&lt;/equation&gt; 个）被正交化后的解释变量成立。换句话说，对于别的解释变量 &lt;equation&gt;j&amp;lt;p&lt;/equation&gt; ， &lt;equation&gt;\langle\mathbf z_j, \mathbf y\rangle/\langle\mathbf z_j, \mathbf z_j\rangle&lt;/equation&gt; 并不是多元回归中原解释变量 &lt;equation&gt;\mathbf x_j&lt;/equation&gt; 的回归系数。&lt;/p&gt;&lt;p&gt;看到这里，有的小伙伴可能会问，这个算法确实不错，但是费了半天劲算出了一大堆相互正交的向量 &lt;equation&gt;\mathbf z_j&lt;/equation&gt; ，但是求解回归系数的结论仅对最后一个被正交化的解释变量成立，这不是坑爹吗？&lt;/p&gt;&lt;p&gt;答案是并不坑爹！这是因为上述算法中的关键一点是，&lt;b&gt;正交化这些解释变量的顺序是任意的&lt;/b&gt;。我们可以选任何一个来初始化，也可以选任何一个作为最后一个被正交化的解释变量。无论我们怎么选，上述过程都保证了最后一个被正交化的解释变量的回归系数满足 &lt;equation&gt;b_p=\langle\mathbf z_p, \mathbf y\rangle/\langle\mathbf z_p, \mathbf z_p\rangle&lt;/equation&gt; 。因此，&lt;b&gt;我们只需要依次挑选这些解释变量作为最后一个被正交化的，就可以通过上述步骤方便的求出它们的回归系数。&lt;/b&gt;而它所反映出来的本质是：&lt;/p&gt;&lt;p&gt;&lt;b&gt;在多元线性回归中，解释变量 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt; &lt;b&gt;的回归系数 &lt;/b&gt;&lt;equation&gt;b_j&lt;/equation&gt; &lt;b&gt;等于 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt; &lt;b&gt;在被其他 &lt;/b&gt;&lt;equation&gt;\mathbf x_0, \mathbf x_1,\cdots, \mathbf x_{j-1}, \mathbf x_{j+1},\cdots, \mathbf x_p&lt;/equation&gt; &lt;b&gt;调整之后（即正交化，从而排除其他 &lt;/b&gt;&lt;equation&gt;\mathbf x_i&lt;/equation&gt; &lt;b&gt;对 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt; &lt;b&gt;的影响）仍能够对 &lt;/b&gt; &lt;equation&gt;\mathbf y&lt;/equation&gt; &lt;b&gt; 产生的增量贡献。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;这个算法叫作多元回归的 Gram-Schmidt（格拉姆-施密特）正交化过程。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;本小节开始的 simple regression model 已经验证了上述结论。我们使用 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 将 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 正交化处理得到 &lt;equation&gt;\mathbf z_1&lt;/equation&gt; ，然后用 &lt;equation&gt;\mathbf y&lt;/equation&gt; 和 &lt;equation&gt;\mathbf z_1&lt;/equation&gt; 回归得到的正是 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 的回归系数  &lt;equation&gt;b&lt;/equation&gt; ；如果将 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 选为 &lt;equation&gt;\mathbf z_0&lt;/equation&gt; ，然后用它正交化 &lt;equation&gt;\mathbf x_0 = [1,1,…,1]^T&lt;/equation&gt; ，就可以方便的求出回归系数  &lt;equation&gt;a&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;让我们来好好审视一下这个结论，即：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\displaystyle b_p=\frac{\langle\mathbf z_p,\mathbf y\rangle}{\langle\mathbf z_p,\mathbf z_p\rangle}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上式说明，解释变量 &lt;equation&gt;\mathbf x_p&lt;/equation&gt; 的回归系数 &lt;equation&gt;b_p&lt;/equation&gt; 和正交化后的 &lt;equation&gt;\mathbf z_p&lt;/equation&gt; 的大小（ &lt;equation&gt;\mathbf z_p&lt;/equation&gt; 自己的內积为分母）有关。&lt;b&gt;如果 &lt;/b&gt;&lt;equation&gt;\mathbf x_p&lt;/equation&gt; &lt;b&gt;和其他解释变量高度相关（即非常不正交），那么 &lt;/b&gt;&lt;equation&gt;\mathbf z_p&lt;/equation&gt; &lt;b&gt;就会很小，则会导致&lt;/b&gt; &lt;equation&gt;b_p&lt;/equation&gt; &lt;b&gt;非常不稳定（一点点样本数据的变化都会导致&lt;/b&gt; &lt;equation&gt;b_p&lt;/equation&gt; &lt;b&gt;的大幅变化）。&lt;/b&gt;当 &lt;equation&gt;y_i&lt;/equation&gt; 满足独立同分布时，假设它的方差为 &lt;equation&gt;\sigma^2&lt;/equation&gt; ，可以证明回归系数 &lt;equation&gt;b_p&lt;/equation&gt; 的方差和 &lt;equation&gt;\mathbf z_p&lt;/equation&gt; 的大小成反比，即 &lt;equation&gt;\|\mathbf z_p\|^2&lt;/equation&gt; 越小， &lt;equation&gt;b_p&lt;/equation&gt; 的误差越大：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\displaystyle \mbox{var}(b_p)=\frac{\sigma^2}{\langle\mathbf z_p,\mathbf z_p\rangle}=\frac{\sigma^2}{\|\mathbf z_p\|^2}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;在多因子模型中， &lt;equation&gt;b_p&lt;/equation&gt; 代表的是因子  &lt;equation&gt;p&lt;/equation&gt;  的收益率。&lt;b&gt;为避免因子收益率的估计非常不稳定，要求不同的因子之间尽量满足正交化。&lt;/b&gt;举例来说，在 Barra 的 CNE5 模型中，非线性规模因子和规模因子之间进行了正交化处理；残差波动率因子和规模以及 BETA 因子也进行了正交化处理。&lt;/p&gt;&lt;p&gt;在结束本小节的讨论之前，我还想介绍一个有意思也有用的特性。本节的论述说明我们可以任选一个解释变量作为最后一个，然后根据连续正交化方便的求出它的回归系数。这意味着如果我们有 20个解释变量，需要进行 20 次上述操作。那么，&lt;b&gt;是否存在什么办法仅通过进行一次连续正交化就求出所有的回归系数&lt;/b&gt; &lt;equation&gt;b_j, j = 0, 1,\cdots, p&lt;/equation&gt; &lt;b&gt;呢？答案是肯定的。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;假设我们按照某给定顺序 &lt;equation&gt;\mathbf x_0, \mathbf x_1,\cdots, \mathbf x_p&lt;/equation&gt; 进行了连续正交化过程，得到了 &lt;equation&gt;\mathbf z_0, \mathbf z_1,\cdots, \mathbf z_p&lt;/equation&gt; ，且我们现在知道 &lt;equation&gt;b_p=\langle\mathbf z_p,\mathbf y\rangle/\langle\mathbf z_p,\mathbf z_p\rangle&lt;/equation&gt; 。由于 &lt;equation&gt;b_p&lt;/equation&gt; 正是解释变量 &lt;equation&gt;\mathbf x_p&lt;/equation&gt; 的回归系数，因此 &lt;equation&gt;b_p\mathbf x_p&lt;/equation&gt; 正是 &lt;equation&gt;\mathbf x_p&lt;/equation&gt; 所解释的 &lt;equation&gt;\mathbf y&lt;/equation&gt; 的部分。如果从 &lt;equation&gt;\mathbf y&lt;/equation&gt; 中剔除 &lt;equation&gt;b_p\mathbf x_p&lt;/equation&gt; ，并把得到的 &lt;equation&gt;\mathbf y-b_p\mathbf x_p&lt;/equation&gt; 用 &lt;equation&gt;\mathbf x_0, \mathbf x_1,\cdots, \mathbf x_{p-1}&lt;/equation&gt; 回归，则结果就和 &lt;equation&gt;\mathbf x_p&lt;/equation&gt; 无关了。在这个新的回归中， &lt;equation&gt;\mathbf x_{p-1}&lt;/equation&gt; 就变成了最后一个被正交化的解释变量，其对应的正交向量为 &lt;equation&gt;\mathbf z_{p-1}&lt;/equation&gt; 。因此， &lt;equation&gt;\mathbf x_{p-1}&lt;/equation&gt; 的回归系数就是用新的 &lt;equation&gt;\mathbf y-b_p\mathbf x_p&lt;/equation&gt; 和 &lt;equation&gt;\mathbf z_{p-1}&lt;/equation&gt; 回归的结果：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\displaystyle b_{p-1}=\frac{\langle\mathbf z_{p-1}, \mathbf y-b_p\mathbf x_p\rangle}{\langle\mathbf z_{p-1}, \mathbf z_{p-1}\rangle}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;以此类推，我们可以按照 &lt;equation&gt;b_p, b_{p-1},\cdots, b_0&lt;/equation&gt; 的&lt;b&gt;倒序&lt;/b&gt;求解出多元回归中所有解释变量的回归系数 &lt;equation&gt;b_j&lt;/equation&gt; （Drygas 2011）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} b_p&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_{p}, \mathbf y\rangle}{\langle\mathbf z_{p}, \mathbf z_{p}\rangle}\\ \displaystyle b_{j}&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_{j}, \mathbf y-\sum_{i=j+1}^p b_i\mathbf x_i\rangle}{\langle\mathbf z_{j}, \mathbf z_{j}\rangle},~j=p-1,p-2,\cdots,0 \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;最后用本小节开始的 simple regression model 检验一下。我们用上述方法求解截距项的回归系数  &lt;equation&gt;a&lt;/equation&gt;  看看。根据定义有 &lt;equation&gt;\mathbf z_0 = \mathbf 1&lt;/equation&gt; 并假设已知  &lt;equation&gt;b&lt;/equation&gt; 。则根据上面的表达式可得：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} a&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf 1,\mathbf y-b\mathbf x\rangle}{\langle\mathbf 1,\mathbf 1\rangle}\\ &amp;amp;=&amp;amp;\displaystyle\frac{\sum y_i-b\sum x_i}{n}\\ &amp;amp;=&amp;amp;\displaystyle\frac{1}{n}\sum y_i-b\left(\frac{1}{n}\sum x_i\right) \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;这正是直接求解 simple regression model 得到的回归系数  &lt;equation&gt;a&lt;/equation&gt; （请往前滚屏比较看看）。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5 一个例子&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本节用一个例子来验证一下上一节的各种公式。假设有四个解释变量 &lt;equation&gt;\mathbf x_0&lt;/equation&gt; 到 &lt;equation&gt;\mathbf x_3&lt;/equation&gt; ，以及  &lt;equation&gt;\mathbf y&lt;/equation&gt; ：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf x_0=\left[\begin{array}{c} 1\\1\\1\\1\\1\\1\\1\\1 \end{array}\right], \mathbf x_1=\left[\begin{array}{c} 1\\2\\4\\3\\7\\6\\3\\5 \end{array}\right], \mathbf x_2=\left[\begin{array}{c} 0\\1\\2\\8\\9\\4\\6\\2 \end{array}\right], \mathbf x_3=\left[\begin{array}{c} 1\\3\\3\\2\\5\\8\\0\\4 \end{array}\right], \mathbf y=\left[\begin{array}{c} 3\\1\\4\\1\\5\\9\\2\\6 \end{array}\right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;直接使用回归系数  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的表达式求解，则它们的回归系数分别为：&lt;equation&gt;b_0 = 0.38548073&lt;/equation&gt;, &lt;equation&gt;b_1 = 0.96332683&lt;/equation&gt;, &lt;equation&gt;b_2 = -0.36300685&lt;/equation&gt;, &lt;equation&gt;b_3 = 0.37189391&lt;/equation&gt;。按照 &lt;equation&gt;\mathbf x_0, \mathbf x_1, \mathbf x_2, \mathbf x_3&lt;/equation&gt; 的顺序进行连续正交化，得到的正交向量为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \mathbf z_0&amp;amp;=&amp;amp;\mathbf x_0\\ \mathbf z_1&amp;amp;=&amp;amp;\displaystyle\mathbf x_1-\frac{\langle\mathbf x_1,\mathbf z_0\rangle}{\langle\mathbf z_0,\mathbf z_0\rangle}\mathbf z_0\\ \mathbf z_2&amp;amp;=&amp;amp;\displaystyle\mathbf x_2-\frac{\langle\mathbf x_2,\mathbf z_0\rangle}{\langle\mathbf z_0,\mathbf z_0\rangle}\mathbf z_0-\frac{\langle\mathbf x_2,\mathbf z_1\rangle}{\langle\mathbf z_1,\mathbf z_1\rangle}\mathbf z_1\\ \mathbf z_3&amp;amp;=&amp;amp;\displaystyle\mathbf x_3-\frac{\langle\mathbf x_3,\mathbf z_0\rangle}{\langle\mathbf z_0,\mathbf z_0\rangle}\mathbf z_0-\frac{\langle\mathbf x_3,\mathbf z_1\rangle}{\langle\mathbf z_1,\mathbf z_1\rangle}\mathbf z_1-\frac{\langle\mathbf x_3,\mathbf z_2\rangle}{\langle\mathbf z_2,\mathbf z_2\rangle}\mathbf z_2 \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mathbf z_0=\left[\begin{array}{c} 1\\1\\1\\1\\1\\1\\1\\1 \end{array}\right], \mathbf z_1=\left[\begin{array}{r} -2.875\\-1.875\\ 0.125\\-0.875\\3.125\\ 2.125\\ -0.875\\ 1.125 \end{array}\right], \mathbf z_2=\left[\begin{array}{r} -1.51082251\\-1.37662338\\-2.10822511\\ 4.75757576\\2.29437229\\-1.83982684\\2.75757576\\-2.97402597 \end{array}\right], \mathbf z_3=\left[\begin{array}{r} -0.00844984\\1.08972192\\-1.02611768\\1.06099247\\-0.48286987\\2.17022584\\-1.56337379\\-1.24012905 \end{array}\right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;使用 Drygas (2011) 提出的解法按照 &lt;equation&gt;b_3, b_2, b_1, b_0&lt;/equation&gt; 的顺序求解各个回归系数 &lt;equation&gt;b_j&lt;/equation&gt; ：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} b_3&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_3,\mathbf y\rangle}{\langle\mathbf z_3,\mathbf z_3\rangle}\\ b_2&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_2,\mathbf y-b_3\mathbf x_3\rangle}{\langle\mathbf z_2,\mathbf z_2\rangle}\\ b_1&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_1,\mathbf y-b_3\mathbf x_3-b_2\mathbf x_2\rangle}{\langle\mathbf z_1,\mathbf z_1\rangle}\\ b_0&amp;amp;=&amp;amp;\displaystyle\frac{\langle\mathbf z_0,\mathbf y-b_3\mathbf x_3-b_2\mathbf x_2-b_1\mathbf x_1\rangle}{\langle\mathbf z_0,\mathbf z_0\rangle} \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上述公式求出 &lt;equation&gt;b_0 = 0.38548073&lt;/equation&gt;, &lt;equation&gt;b_1 = 0.96332683&lt;/equation&gt;, &lt;equation&gt;b_2 = -0.36300685&lt;/equation&gt;, &lt;equation&gt;b_3 = 0.37189391&lt;/equation&gt;，和使用回归系数  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的表达式求解的结果完全一致。另外，我们也可以分别选择 &lt;equation&gt;\mathbf x_0, \mathbf x_1, \mathbf x_2&lt;/equation&gt; 替换 &lt;equation&gt;\mathbf x_3&lt;/equation&gt; 作为最后一个被正交化的解释变量（前三个变量的顺序也不重要），并利用 &lt;equation&gt;b_p=\langle\mathbf z_p,\mathbf y\rangle/\langle\mathbf z_p,\mathbf z_p\rangle&lt;/equation&gt; 求解，得出的 &lt;equation&gt;b_j&lt;/equation&gt; 也和上面的完全相同。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;6 正交等于不相关？&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在我们平常说因子之间正交的时候，另一个常用的词汇是因子之间“不相关”（这里不相关指的是不同因子的 Pearson 相关系数为零）。那么“正交”和“不相关”是否等价呢？&lt;/p&gt;&lt;p&gt;从定义出发，两个因子向量 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和  &lt;equation&gt;\mathbf x_2&lt;/equation&gt;  正交意味着它们的內积，即 &lt;equation&gt;\langle\mathbf x_1, \mathbf x_2\rangle&lt;/equation&gt; 为零。而 &lt;equation&gt;\mathbf x_1&lt;/equation&gt; 和 &lt;equation&gt;\mathbf x_2&lt;/equation&gt; 的相关系数为零则意味着 &lt;equation&gt;\langle\mathbf x_1-\mbox{E}[x_1]\cdot \mathbf 1, \mathbf x_2-\mbox{E}[x_2]\cdot \mathbf 1\rangle&lt;/equation&gt; 为零，因为在计算相关系数时，必须先分别减去其均值，这就是个 centering 的过程。由于 &lt;equation&gt;\langle\mathbf x_1, \mathbf x_2\rangle&lt;/equation&gt; 为零不一定意味着 &lt;equation&gt;\langle\mathbf x_1-\mbox{E}[x_1]\cdot \mathbf 1, \mathbf x_2-\mbox{E}[x_2]\cdot \mathbf 1\rangle&lt;/equation&gt; 也为零，因此正交不一定等于不相关。&lt;/p&gt;&lt;p&gt;举个例子， &lt;equation&gt;[4, 2]^T&lt;/equation&gt; 和 &lt;equation&gt;[3, -6]^T&lt;/equation&gt; 的內积为零，这两个向量正交。而各自减去均值后， &lt;equation&gt;[4, 2]^T&lt;/equation&gt; 和 &lt;equation&gt;[3, -6]^T&lt;/equation&gt; 分别变为 &lt;equation&gt;[1, -1]^T&lt;/equation&gt; 和 &lt;equation&gt;[4.5, -4.5]^T&lt;/equation&gt; 。这两个新向量在一条直线上、內积不为零，因此 &lt;equation&gt;[4, 2]^T&lt;/equation&gt; 和 &lt;equation&gt;[3, -6]^T&lt;/equation&gt; 的相关系数不为零（事实上，它们的相关系数等于 1）。从多元回归求解的角度来说，我们在乎的是他们是否正交，而非 centering 之后的內积是否为零（即是否不相关）。&lt;/p&gt;&lt;p&gt;不过对于因子暴露向量来说，因为个股在每个因子上的暴露都经过 demean 处理了，所以每个因子向量的均值已经是零了（这里考虑的就是简单等权均值的情况，而不是像 Barra 那种用市值作为权重进行去均值的情况）。从这个意义上说，因子向量之间正交和它们之间不相关等价。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;7 结语&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;一不留神又写了这么长。从阅读体验来说，实在抱歉。&lt;/p&gt;&lt;p&gt;本文掰扯了一大堆公式其实就是想说明下面这句话：&lt;/p&gt;&lt;p&gt;&lt;b&gt;在多元线性回归中，解释变量 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt;&lt;b&gt;的回归系数 &lt;/b&gt;&lt;equation&gt;b_j&lt;/equation&gt;&lt;b&gt;等于 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt;&lt;b&gt;在被其他 &lt;/b&gt;&lt;equation&gt;\mathbf x_0, \mathbf x_1,\cdots, \mathbf x_{j-1}, \mathbf x_{j+1},\cdots, \mathbf x_p&lt;/equation&gt;&lt;b&gt;调整之后（即正交化，从而排除其他 &lt;/b&gt;&lt;equation&gt;\mathbf x_i&lt;/equation&gt;&lt;b&gt;对 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt;&lt;b&gt;的影响）仍能够对 &lt;/b&gt;&lt;equation&gt;\mathbf y&lt;/equation&gt;&lt;b&gt; 产生的增量贡献。如果 &lt;/b&gt;&lt;equation&gt;\mathbf x_j&lt;/equation&gt; &lt;b&gt;和其他解释变量高度相关，则它的回归系数&lt;/b&gt; &lt;equation&gt;b_j&lt;/equation&gt; &lt;b&gt;会有很大的估计误差。这对于多因子模型中评价因子收益非常不利。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;如果看完之后你对这句话有一定的体会，那我的功夫就没白花。&lt;/p&gt;&lt;p&gt;在计算机算法进行多元回归求解的时候，并不是试图按照  &lt;equation&gt;\mathbf b&lt;/equation&gt;  的公式计算  &lt;equation&gt;\mathbf X^T\mathbf X&lt;/equation&gt;  的逆矩阵，而采用的正是正交化的思路。在正交化的过程中可以非常容易的得到  &lt;equation&gt;\mathbf X&lt;/equation&gt;  的 QR 分解，其中 &lt;equation&gt;\mathbf Q&lt;/equation&gt; 是正交阵、 &lt;equation&gt;\mathbf R&lt;/equation&gt;  是上三角阵。这也极大的化简了回归系数  &lt;equation&gt;\mathbf b&lt;/equation&gt;  以及 &lt;equation&gt;\mathbf y&lt;/equation&gt; 预测值的求解。由于篇幅原因（我也好意思说篇幅……），本文就不给出 QR 分解的具体表达式了，感兴趣的读者请参考 Hastie et al. (2016)。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Drygas, H. (2011). On the Relationship between the Method of Least Squares and Gram-Schmidt Orthogonalization. &lt;i&gt;Acta et Commentationes Universitatis Tartuensis de Mathematica&lt;/i&gt;, Vol. 15(1), 3 – 13.&lt;/li&gt;&lt;li&gt;Hastie, T., R. Tibshirani, and J. Friedman (2016). &lt;i&gt;The Elements of Statistical Learning: Data Mining, Inference, and Prediction&lt;/i&gt;, 2nd Ed. Springer.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com/&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-14-41993542</guid>
<pubDate>Tue, 14 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>中国股市日历异象之换月效应</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-09-41687401.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41687401&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9885c41660b29ff5fc65baf5ec865b95_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;写在前面&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文写于 2018 年 2 月 8 日，因此实证数据仅到该日期之前。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 引言&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;股市中有许多流传已久的&lt;b&gt;日历效应（calendar effect）&lt;/b&gt;，它指的是市场的收益率在一年中的一些特定日子或者特定月份有高于平时的收益率。这其中最大名鼎鼎的当属&lt;b&gt;换月效应（turn-of-the-month effect）&lt;/b&gt;，它指的是&lt;b&gt;股票在每月的最后 1 个交易日到下一个月的第 3 个交易日这个窗口内的收益率显著高于一个月中的其他交易日&lt;/b&gt;（具体的换月窗口可以和上述略有不同，但一般的实证中使用的是从每月的最后一个交易日到下月的第三个交易日这四天）。&lt;/p&gt;&lt;p&gt;以美股为例，Xu and McConnell (2016) 指出在 1926 到 2005 间，仅在上述换月窗口内买入标普 500 指数的 ETF 就可以取得年化 7.20% 的收益率且该策略的夏普率高达 1.04（在非换月窗口内的其他交易日，它们的均值几乎为零）。Carchano and Pardo Tornero (2011) 以美国标普 500 指数、德国法兰克福指数和日经指数为研究对象，分析了潜在的 188 中日历效应，并发现&lt;b&gt;在统计上和经济上同时显著的只有换月效应。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;研究中国股市换月效应的文献也自不在少数。大量针对A股的实证说明，中国股市确实存在换月效应。&lt;b&gt;但我们也看到，换月效应的作用正在减弱（2017 年开始就几乎消失），且换月的时间窗口也似乎在收窄。&lt;/b&gt;针对换月效应，学术界和业界一直在努力寻找各种合理的解释，包括&lt;b&gt;更多现金流假说、额外风险假说、流动性假说，以及基金经理在月末的窗饰（window dressing）现象。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;本文就来使用我国股市的六大指数（上证指数、上证 50、沪深 300、中证 500、中小板、创业板）来对换月效应进行实证。具体的实证内容包括：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;指数在全部十二个月的换月效应。&lt;/li&gt;&lt;li&gt;指数在换年月（12 月底到 1 月初）和非换年月（其他 11 个月）内的换月效应。&lt;/li&gt;&lt;li&gt;指数在换季月（3 月底到 4 月初、6 月底到 7 月初、9 月底到 10 月初、12 月底到 1 月初）和非换季月（其他 8 个月）内的换月效应。&lt;/li&gt;&lt;li&gt;换月效应是否可以被交易量解释（更多现金流假说）。&lt;/li&gt;&lt;li&gt;换月效应是否被额外风险解释。&lt;/li&gt;&lt;li&gt;换月效应是否被更高的无风险收益率解释（流动性假说）。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;此外，文章会简单讨论基金经理的窗饰效应，并在最后就换月效应是否足以成为一个交易策略给出我们的看法。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 换月窗内的“超额”收益&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本节以上证指数为例，通过假设检验来分析其在换月窗口内的收益率是否显著为正。上证指数的实证期全长为 2001 年 1 月 1 日至 2018 年 2 月 6 日。在这段窗口中，月内不同交易日内的收益率均值如下：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-287756dde54cf333d09641467ae15058_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;551&quot; data-rawheight=&quot;298&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-287756dde54cf333d09641467ae15058&quot; data-watermark-src=&quot;v2-3b8d64f72a4a81ac06fe080c8c4a4f67&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;从上图直观来看，换月窗口内的 4 个交易日的收益率均值明显大于零且高于其他交易日。下面就是用假设检验定量看看。为了探究换月效应是否在不同的时期持续有效，我们把回测期分为三部分：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;第一部分：2001 年 1 月 1 日 – 2010 年 12 月 31 日&lt;/li&gt;&lt;li&gt;第二部分：2011 年 1 月 1 日 – 2016 年 12 月 31 日&lt;/li&gt;&lt;li&gt;第三部分：2017 年 1 月 1 日 – 2018 年 2 月 6 日&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;假设检验的原假设为这换月窗内的交易日的收益率以及这 4 个交易日的收益率均值为零。&lt;/b&gt;我们看看能否拒绝原假设。假设检验的结果如下。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e2303af2f5d310bd77329ddda500fe24_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;725&quot; data-rawheight=&quot;423&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e2303af2f5d310bd77329ddda500fe24&quot; data-watermark-src=&quot;v2-14af95110e83a3379fb2b0fec3d5af3d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;上面的结果表明，在 2017 年之前上证指数在换月窗口内的平均收益率均值为正，其显著性水平在 5% 以下。然而从 2017 年开始，换月效应似乎在统计上失效。当然，在 2017 年之后其 t 统计值较小的另外一个原因是样本点较少，因此均值估计中 standard error 较大。&lt;/p&gt;&lt;p&gt;对于其他五大指数的分析见附录 A 和 B，从中也可总结出类似的结论。&lt;b&gt;这说明换月效应对各市值的股票均有效，而非仅仅是小市值股的特性。但是，从 2017 年开始换月效应在统计意义上失效，且切换月窗口由 -1 到 +3 缩窄至 -1 到 +1（即每月的最后一个交易日到下个月的第一个交易日），这种现象在小市值板块上更加明显。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 换年和换季能否解释换月？&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;接下来，我们尝试将换季和换年效应从换月中剥离开，从而分析换年和换季是否对能够解释换月收益率。同样，以上证指数为例，对于换年效应，考察 12 月底到下一年 1 月初这个换月窗口内指数的收益率均值，以及除了换年之外的 11 个换月窗口内的收益率均值；对于换季效应，考察 4 个换季窗口（3 月底到 4 月初、6 月底到 7 月初、9 月底到 10 月初、以及 12 月底到下一年 1 月初）内和非换季时的 8 个换月窗口内的收益率均值。&lt;/p&gt;&lt;p&gt;上证指数换年效应假设检验结果如下：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-f701a6de9e8b34d0cce8f9355c450c57_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;632&quot; data-rawheight=&quot;315&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f701a6de9e8b34d0cce8f9355c450c57&quot; data-watermark-src=&quot;v2-3cb85eb39604c2947e74df7d5ea86883&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;上证指数换季效应假设检验结果如下：&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-7f3ee4a8220aaa18eaca3821c4ec6e48_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;628&quot; data-rawheight=&quot;322&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-7f3ee4a8220aaa18eaca3821c4ec6e48&quot; data-watermark-src=&quot;v2-7b0f016c3e97229da3e667eaf95e9cd4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;其他五个指数的假设检验结果见附录 C。对于&lt;b&gt;换年&lt;/b&gt;是否能够解释换月效应的假设检验结果如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;六大指数&lt;b&gt;均没有&lt;/b&gt;表现出统计意义上显著的换年月窗口间正收益（部分原因是因为样本比较少）。由于 2016 年 1 月初由熔断造成的大跌，创业板甚至在换年月窗口内表现出了负收益。&lt;/li&gt;&lt;li&gt;在除去换年月的剩余 11 个月中，六大指数均表现出统计意义上显著性水平 5% 以下的换月正收益（大多数显著性水平在 1% 以下）。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;上述结果说明，换年效应无法为换月效应提供解释。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;对于&lt;b&gt;换季&lt;/b&gt;是否能够解释换月效应的假设检验结果如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;当仅考虑换季的 4 个月份时，六大指数体现出了统计意义上的显著正收益（显著性多为 5% 以下）。&lt;/li&gt;&lt;li&gt;当考虑除换季之外的 8 个月份时，六大指数体现出了统计意义上更加显著的正收益（显著性多为 1% 以下）。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;上述结果说明，换季效应在换季月份中与换月效应重合，但是它无法为非换季月的换月效应提供解释。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 解释换月效应的假说&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;上面的实证表明，A 股中确实存在换月效应。学术界和业界对这个日历异象的解释主要从以下四个方面：&lt;b&gt;更多现金流假说、额外风险补偿假说、流动性假说，以及基金经理在月末的窗饰现象。&lt;/b&gt;下面逐一介绍。&lt;/p&gt;&lt;p&gt;&lt;b&gt;4.1 更多现金流假说&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;流动性假说假设月末个人投资者有更多的资金（可能是发了工资或者奖金），从而会在换月期内购买股票，造成上涨。&lt;/b&gt;按照这个逻辑，我们预期在换月窗口内股市的成交量明显高于月内其他日的成交量。&lt;/p&gt;&lt;p&gt;以下为六大指数的月内平均交易量。计算时，我们将每日的交易量用包含它的 30 日窗口的均值做了归一化。&lt;b&gt;可以看到，月内每日的交易量基本非常平均，说明更多现金流假说无法解释换月效应。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-ea2c8f4fb08f28cc5a9647499eb77a90_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;867&quot; data-rawheight=&quot;732&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ea2c8f4fb08f28cc5a9647499eb77a90&quot; data-watermark-src=&quot;v2-ecd6e873139c3195a86ee0309546b05a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;4.2 额外风险补偿假说&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;换月效应的另一个假说是股票在换月窗口内承担了更高的风险，因此有更高的风险溢价。&lt;/b&gt;采用收益率的标准差来衡量风险可计算出月内不同日期的收益率波动率。结果表明（下图），&lt;b&gt;波动率在换月窗口内并没有高于月内其他日期，这种假说也不成立。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d9439102eee25254d0ac125ae74ed15b_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;900&quot; data-rawheight=&quot;728&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d9439102eee25254d0ac125ae74ed15b&quot; data-watermark-src=&quot;v2-2d2b62130b7dc1b75904a94b6325329e&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;4.3 流动性假说&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;流动性假说假设换月窗口内有流动性风险，导致无风险利率上升，从而引发风险资产收益率上升。通过考察 GC001 的收益率（国债逆回购利率，流动性风险的代理指标）发现，在换月窗口内其收益率并不高，因此这种解释也不成立。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;不过值得注意的是，在换月窗口的前一天，即每个月的倒数第二个交易日，GC001 的收益率显著的高于其他日期。对于此，可能的解释是月底最后一天是发工资结账的时候，真正最紧的是各种筹措准备发工资结账的倒数第二天。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-59ab8e7684ed6ab33a351de190ba73fc_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;526&quot; data-rawheight=&quot;295&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-59ab8e7684ed6ab33a351de190ba73fc&quot; data-watermark-src=&quot;v2-cbb44d8b37a3689ae36cd760622d58b4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;4.4 基金经理的窗饰现象&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;窗饰（window dressing）现象指的是基金经理在季末以及年末，由于有需要向投资人进行业绩汇报的压力，通过卖出自己投资组合中亏损的股票而买入市场中大涨的股票、或者通过拉升自己投资组合中股票的价格，来达到粉饰业绩目的的非理性投资行为。&lt;/b&gt;基金经理与投资者之间存在信息不对称，基金管理人往往为了个人利益（如个人薪酬、名誉等），牺牲投资者的利益，实现自身利益的最大化（Jiao 2011）。&lt;/p&gt;&lt;p&gt;Jiao (2011) 通过研究中国的开放是股票基金，发现了&lt;b&gt;市场中存在着显著的季度窗饰现象&lt;/b&gt;，在不同时间区间，窗饰程度不一。此外，窗饰现象与基金经理的工作经验、任职时间长短有密切关系；对于基金特征变量而言，窗饰现象更容易发生在规模小、以往表现差的基金中，而成立时间、投资风格、赎回压力等变量对窗饰程度并无显著影响。&lt;/p&gt;&lt;p&gt;&lt;b&gt;虽然窗饰现象可以从一定程度上解释季末股票的“超额”收益，但它仍然不能完全解释月末的换月效应，因为基金经理在普通的换月窗口内并无进行窗饰业绩的动机。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5 换月效应是否值得成为独立策略&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本节来看看既然换月效应在 A 股中存在，那么我们利用它来构建策略会有怎样的表现。利用换月效应，构建策略如下：&lt;b&gt;在每个月的换月窗口内持有指数（即每个月的最后倒数第二个交易日收盘时买入，在下个月的第三个交易日收盘时卖出），在其他交易日空仓。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;下图反应了该策略于 2005 年到 2016 年 2 月底之间在这六大指数上的表现。&lt;b&gt;很明显，换月策略无法捕捉大牛市，在大牛市中远远跑输市场。&lt;/b&gt;这很容易理解，因为牛市中市场几乎天天涨，而该策略在每个月的 23 个交易日中的绝大多数选择空仓。&lt;b&gt;从行为金融学的角度来说，在大牛市中依本策略操作、看着指数“绝尘而去”是非常痛苦的，这种痛苦足以让投资者放弃该策略。&lt;/b&gt;可喜的是，在 2010 年至 2014 年市场震荡下行的时候，该策略却呈现出了十足的韧性，稳健上行。&lt;b&gt;如果未来市场仍然是震荡下行，那么只要换月效应不失效，这个策略就会战胜市场本身。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f50469ea10933ab0ef59aea6ed74b706_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;881&quot; data-rawheight=&quot;660&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f50469ea10933ab0ef59aea6ed74b706&quot; data-watermark-src=&quot;v2-76ab9f7e785a22449bfb2d241c506390&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;再来看看股灾 3.0 之后（即从 2016 年 3 月 1 日开始），换月策略的表现（下图）。&lt;b&gt;虽然换月效应在这六大指数上均能录得正收益，但是不难发现这些收益主要来自 2016 年，而其在 2017 年几乎失效，特别是对于大盘股如上证 50 和沪深 300。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-bcf610bd29bea2c56e903c83596451fd_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;882&quot; data-rawheight=&quot;684&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bcf610bd29bea2c56e903c83596451fd&quot; data-watermark-src=&quot;v2-033bb427e12af8f5ca46aba99e997143&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;对于上证 50 和沪深 300，换月策略的表现远远差于指数本身。换月策略本质上是一种“择时”。Jusselin et al. (2017) 的研究表明，对于市场上最流行的趋势追踪择时策略，&lt;b&gt;如果标的本身的夏普率高于 0.35，那么择时策略的净值就无法战胜标的本身了。&lt;/b&gt;换月策略虽然不是趋势追踪，但由于也是一种择时，因此类似的结论也对它有效。在股灾 3.0 之后，上证 50 和沪深 300 经历了近两年的牛市，这两者的夏普率都高达 1 以上，因此换月策略大幅跑输指数本身实属必然。对于中证 500、中小板以及创业板，由于指数本身的表现很差，换月策略战胜了指数。&lt;/p&gt;&lt;p&gt;&lt;b&gt;随着价值投资理念的回归，人们对大盘股在可预见的未来抱有“长期慢牛”的判断。在这种判断下，从获得尽量高的收益率来说，任何择时都是没有必要的。&lt;/b&gt;因此，如果我们未来以上证 50、沪深 300 的成分股为投资标的，那么换月策略显然远不如买入持有策略。在这种预期下，正确的路子无疑是选股。&lt;/p&gt;&lt;p&gt;由于每个月仅仅交易 4 天（或者由于换月窗口的缩窄而更少），换月策略的风险和波动率远低于指数本身。这也是显而易见的，因为它毕竟是一种择时，是一个 β 策略。交易次数少、低波动是它的优点，但对一些活跃交易者来说这也是它的缺点。毕竟，如果市场在非换月窗内的交易日上涨时，我们只能眼巴巴看着。此外，由于一年只有 12 个换月窗口，这意味着一年只有 12 个交易样本。因此，想要判断这个换月效应是否失效需要几年的时间。从这些角度来说，&lt;b&gt;换月效应虽然有不错的统计意义，但是作为独立策略来说，它的交易结构有些逆人性（交易次数太少，需要很长时间判断其是否有效或者失效）、收益率不够吸引人（特别是在对标具备长期慢牛走势的标的时），实在是有些“食之无味”。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;换月效应代表着市场的某种非有效性。本文的实证表明这种异象存在于 A 股之中且尚未完全失效，现存的各种假说也无法很好的解释它。因此，我们应该对它保持开放的心态，关注它的表现。虽然它不足以成为一个独立的策略，但是努力理解它背后揭示出来的市场的非有效性，有助于我们加深对市场的理解。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Carchano, O. and A. Pardo Tornero. (2011). &lt;i&gt;Calendar Anomalies in Stock Index Futures.&lt;/i&gt; SSRN, https://ssrn.com/abstract=1958587.&lt;/li&gt;&lt;li&gt;Jiao, L. (2011). Research on window-dressing of fund and its influencing factors – evidence from Chinese open-end stock fund market. &lt;i&gt;Science Technology and Engineering&lt;/i&gt;, Vol. 11(35), 1671 – 1815 (in Chinese).&lt;/li&gt;&lt;li&gt;Jusselin, P., E. Lezmi, H. Malongo, C. Masselin, T. Roncalli, and T-L. Dao. (2017). &lt;i&gt;Understanding the momentum risk premium: an in-depth journey through trend-following strategies.&lt;/i&gt; SSRN, https://ssrn.com/abstract=3042173.&lt;/li&gt;&lt;li&gt;Xu, W. and J. J. McConnell (2006). &lt;i&gt;Equity Returns at the Turn of the Month.&lt;/i&gt; SSRN, https://ssrn.com/abstract=917884.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;附录&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;A. 其他指数在月内不同交易日的平均收益率&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-95f61580ba73199a5355ecf102db6a0a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;775&quot; data-rawheight=&quot;647&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-95f61580ba73199a5355ecf102db6a0a&quot; data-watermark-src=&quot;v2-6020c94bdd1609a74196b89555a2dd77&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;B. 其他指数的换月效应假设检验结果&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-8132fdda0130b0698552cab1eecb62c2_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;442&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-8132fdda0130b0698552cab1eecb62c2&quot; data-watermark-src=&quot;v2-11d8d056092c547c7e0aa6ee6d25e75b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f84b08e43e1b8bef17f45f29a782ce60_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;442&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f84b08e43e1b8bef17f45f29a782ce60&quot; data-watermark-src=&quot;v2-7c2eb723da3e6a2237bec6e762b5298c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e1b8510639f0120a3e736ad1e65d5c4f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;767&quot; data-rawheight=&quot;446&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e1b8510639f0120a3e736ad1e65d5c4f&quot; data-watermark-src=&quot;v2-e178c9bce0ea7092dcdd2eb4987e5b8f&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9f8edfb32be6bd73b54bf213aee36cd1_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;769&quot; data-rawheight=&quot;447&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9f8edfb32be6bd73b54bf213aee36cd1&quot; data-watermark-src=&quot;v2-ab04cae3b334dc0819ddff01b366fd2b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-1c6bece30271504f0d8e80928502b572_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;715&quot; data-rawheight=&quot;305&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-1c6bece30271504f0d8e80928502b572&quot; data-watermark-src=&quot;v2-03dead93f97ee9c2d627d6266f208856&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;C. 其他指数的换年及换季效应对换月效应的解释&lt;/b&gt;&lt;/p&gt;&lt;p&gt;上证 50：&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-77971de345bed54dc8d0dc09049642b0_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;641&quot; data-rawheight=&quot;313&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-77971de345bed54dc8d0dc09049642b0&quot; data-watermark-src=&quot;v2-1cb8445cd5f942070ec87dd305be0f9f&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ca78d4a1c2278f50e8a80f937b657f25_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;628&quot; data-rawheight=&quot;322&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ca78d4a1c2278f50e8a80f937b657f25&quot; data-watermark-src=&quot;v2-1adfc326321d1e24a34141c5d2480fcc&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;沪深 300：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-3470a676dd6ac468528b405b15b8be78_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;634&quot; data-rawheight=&quot;313&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-3470a676dd6ac468528b405b15b8be78&quot; data-watermark-src=&quot;v2-f7b928ab9e253670f01b43871e8db9f6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0cbf214724c4a5a535110d215ecdd45f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;628&quot; data-rawheight=&quot;321&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0cbf214724c4a5a535110d215ecdd45f&quot; data-watermark-src=&quot;v2-dee3e2c08f42876112f897261298572a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;中证 500：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-bbcf388c8cd9fedbe978092f07b366df_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;632&quot; data-rawheight=&quot;308&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bbcf388c8cd9fedbe978092f07b366df&quot; data-watermark-src=&quot;v2-3577f8e95de709681265eeec38a959a6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-68767d61959570baabd5d0346c09eb29_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;629&quot; data-rawheight=&quot;324&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-68767d61959570baabd5d0346c09eb29&quot; data-watermark-src=&quot;v2-2e2c384efa5f7f8c9e0d6b88a0b1b493&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;中小板：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-a4cc31bb7f3ef7496d80b12bdc9d6ba7_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;638&quot; data-rawheight=&quot;304&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-a4cc31bb7f3ef7496d80b12bdc9d6ba7&quot; data-watermark-src=&quot;v2-d2fc8253722a7129b57b7df0caf5e722&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-4e669b895ca6535d83380a8b56a4f865_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;627&quot; data-rawheight=&quot;323&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-4e669b895ca6535d83380a8b56a4f865&quot; data-watermark-src=&quot;v2-98be9df28452c8dcf5ec4722f1c97049&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;创业板：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-239bc40f9047e7e3b305bc99ac8c1821_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;629&quot; data-rawheight=&quot;304&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-239bc40f9047e7e3b305bc99ac8c1821&quot; data-watermark-src=&quot;v2-5cf089658ec51ee681135fe5de2499d6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7d39113cfb1b6f53d67099ab7143b042_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;632&quot; data-rawheight=&quot;321&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-7d39113cfb1b6f53d67099ab7143b042&quot; data-watermark-src=&quot;v2-d38780bf7ff5451bf7b8ae0b5663cb48&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-09-41687401</guid>
<pubDate>Thu, 09 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>用 IC 评价因子效果靠谱吗？</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-07-41454197.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41454197&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-1d73f8816ba49ace8d28e63e225fc73a_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;摘要&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;传统的 IC 或者 Rank IC 在评价因子选股效果时不够合理，有一些陷阱。基于 IC 进行因子配置不十分靠谱。本文提出对 IC 的一些改进，并建议使用加权 IC 来评判因子效果。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 IC 和 Rank IC&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在多因子选股实务中，人们热衷于动态评价因子在单期截面上的选股效果。为实现这个目标，&lt;b&gt;通常的做法是用当期个股的因子取值（记为 &lt;/b&gt; &lt;equation&gt;x&lt;/equation&gt; &lt;b&gt;）和下一期个股的收益率（记为 &lt;/b&gt; &lt;equation&gt;y&lt;/equation&gt; &lt;b&gt;）在截面上计算信息系数（information correlation），简称 IC。&lt;/b&gt;IC 的计算方法通常有两种： &lt;equation&gt;x&lt;/equation&gt;  和 &lt;equation&gt;y&lt;/equation&gt; 的相关系数，以及 &lt;equation&gt;x&lt;/equation&gt; 和  &lt;equation&gt;y&lt;/equation&gt;  的秩相关系数（见下图）。第一种就是我们常说的 IC，第二种可以称作 Rank IC。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-87d9081b7aa994ea073a5c87b4d9a05f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1117&quot; data-rawheight=&quot;509&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-87d9081b7aa994ea073a5c87b4d9a05f&quot; data-watermark-src=&quot;v2-59b9763e140b5a16a0b295f01fb2b4d3&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这里简单介绍下秩相关系数。&lt;/p&gt;&lt;p&gt;&lt;b&gt;秩相关系数（rank&lt;/b&gt; &lt;b&gt;correlation coefficient）&lt;/b&gt;和相关系数类似，不同的是它考察的是两个随机变量之间的&lt;b&gt;单调相关性（monotonic correlation）&lt;/b&gt;。秩相关性对变量之间的线性或非线性相关性不做假设。在计算秩相关系数时，使用的并不是观测值本身的数值，而是它们在各自样本中的排序。秩相关系数的取值在 -1 到 1 之间。&lt;/p&gt;&lt;p&gt;在统计学中，有多种计算秩相关系数的方法，其中最流行的要数 Spearman 秩相关系数，它以 Charles Spearman 命名。假设有两个随机变量 &lt;equation&gt;x&lt;/equation&gt; 和  &lt;equation&gt;y&lt;/equation&gt;  的  &lt;equation&gt;n&lt;/equation&gt;  对儿观测值，Spearman 秩相关系数 &lt;equation&gt;r_s&lt;/equation&gt; 的计算过程如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;首先将 &lt;equation&gt;x&lt;/equation&gt; 和  &lt;equation&gt;y&lt;/equation&gt;  的观测值转换成它们对应的排序 &lt;equation&gt;x_r&lt;/equation&gt; 和 &lt;equation&gt;y_r&lt;/equation&gt; 。&lt;/li&gt;&lt;li&gt;对 &lt;equation&gt;x_r&lt;/equation&gt; 和 &lt;equation&gt;y_r&lt;/equation&gt; 采用传统的线性相关系数公式，则可得到 &lt;equation&gt;r_s&lt;/equation&gt; ：&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;equation&gt;r_s=\displaystyle\frac{\mbox{cov}(x_r,y_r)}{\sigma_{x_r}\sigma_{y_r}}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;下图是某因子在一段时间内的滚动 Rank IC 移动平均，从中我们能对常见选股因子 IC 的取值范围有个大概的了解。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-68999c31c32f5ba25a76ac81ecb50c75_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1441&quot; data-rawheight=&quot;401&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-68999c31c32f5ba25a76ac81ecb50c75&quot; data-watermark-src=&quot;v2-62f1823cd7f8021c3d23e262852265b7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;从上面的定义可知，&lt;b&gt;无论使用 IC 还是 Rank IC，都希望它越大越好，越大说明因子选股的能力越强（也可以越小越好，那就反过来用因子）。&lt;/b&gt;我们也经常能在一些策略中看到使用 IC（或者 IR，即 IC 的均值除以标准差）的高低来动态进行因子的配置。&lt;/p&gt;&lt;p&gt;上面这些用法的核心前提是 IC 能够正确反映因子选股的能力。然而，真的是这样吗？&lt;b&gt;如果这个核心前提不成立，那么基于 IC 的各种因子择时、因子配置、因子打分恐怕难言靠谱。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 IC 中的陷阱&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本节通过一个假想的例子说明 IC 和 Rank IC 计算中存在的陷阱。假设有十支股票，它们的因子取值从大到小如下表所示。此外，考虑这十支股票的两组假想的收益率序列。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f41cebaac8efa9160d431f3528073074_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;534&quot; data-rawheight=&quot;390&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f41cebaac8efa9160d431f3528073074&quot; data-watermark-src=&quot;v2-f97c224ecc58c48b38ab2fdac22daf83&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;很容易计算该因子和这两组收益率序列的相关系数均为 0.2909。&lt;b&gt;如果仅仅看 IC 这个单一指标的话，我们会认为该因子在当期的选股能力很不错。&lt;/b&gt;但 IC 背后还有很多故事可讲。我们不妨把因子和这两组收益率序列画出来，并各自做一条线性回归线来看一看。&lt;/p&gt;&lt;p&gt;另 &lt;equation&gt;y&lt;/equation&gt; 代表收益率， &lt;equation&gt;x&lt;/equation&gt; 代表因子，则线性回归表达式为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;y=a+b x+\varepsilon&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上式中斜率  &lt;equation&gt;b&lt;/equation&gt;  和 &lt;equation&gt;x&lt;/equation&gt; 与 &lt;equation&gt;y&lt;/equation&gt; 的相关系数 &lt;equation&gt;ρ&lt;/equation&gt; 满足如下关系：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;b=\displaystyle\rho\frac{\sigma_y}{\sigma_x}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;由于这两组收益率和因子的相关系数均为 0.2909，因此我们也以预期它们和因子的线性回归斜率相同。事实上，结果也正是如此（下图，斜率均为 0.0058）：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e7347071a9297ffe1710d17b7941d413_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;979&quot; data-rawheight=&quot;358&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e7347071a9297ffe1710d17b7941d413&quot; data-watermark-src=&quot;v2-a2fa84b1638a1b9f51d754b5320ce143&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;虽然 IC 一样，但是画出图来才看到这两组收益率序列和因子的关系大相径庭。假设从业务逻辑来说，个股的收益率和因子呈正相关，因此我们要选因子取值大的股票。但是，这个逻辑在上面两组收益率序列中会得到截然不同的结果：对于序列一，使用最大的因子取值可以选出收益率最高的股票；而对于序列二，使用最大的因子取值却选出了收益率相当差的股票。面对如此结果，IC 无辜吗？&lt;/p&gt;&lt;p&gt;如果使用 Rank IC 代替 IC，得到的也是同样的结论。这两组收益率和因子的秩相关系数均等于 0.3212。从这个数字背后解读不出任何超过这个数字本身的东西。&lt;/p&gt;&lt;p&gt;在量化投资中，我们喜欢并追寻能够精确计算出的数字。但这么做的前提是该数字有意义。在统计学家中流传着一个说法：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;Numerical calculations are exact, but graphs are rough.&lt;/i&gt;&lt;br&gt;&lt;i&gt;译：数值计算是精确的，而图形是粗糙的。&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;单一的统计量，比如上面的 IC 或者 Rank IC 却难以体现出图形反映出来的因子和收益率之间更多的关系。这说明如果我们仅仅看中 IC，可能会步入数据的陷阱。&lt;/p&gt;&lt;p&gt;仅关注统计量而忽视图形信息本身最著名的例子当属&lt;b&gt;安斯库姆四重奏（Anscombe’s quartet）&lt;/b&gt;。安斯库姆四重奏是四组基本的统计特性一致的数据，但由它们绘制出的图形则截然不同。每一组数据都包括了 11 个 &lt;equation&gt;(x_i, y_i)&lt;/equation&gt; 点。这四组数据由统计学家弗朗西斯·安斯库姆（Francis Anscombe）于 1973 年构造，他的目的是用来说明在分析数据前先绘制图表的重要性，以及离群值对统计的影响之大。&lt;/p&gt;&lt;p&gt;下图就是这四组数据绘制出来的图形，可见它们截然不同：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;第一组描绘了  &lt;equation&gt;x&lt;/equation&gt;  和  &lt;equation&gt;y&lt;/equation&gt;  之间近似的线性关系；&lt;/li&gt;&lt;li&gt;第二组中  &lt;equation&gt;x&lt;/equation&gt;  和  &lt;equation&gt;y&lt;/equation&gt;  表现出了明显的非线性关系；&lt;/li&gt;&lt;li&gt;第三组中  &lt;equation&gt;x&lt;/equation&gt;  和 &lt;equation&gt;y&lt;/equation&gt; 之间存在线性关系，但由于一个明显的 outlier 的存在改变了数据的统计结果；&lt;/li&gt;&lt;li&gt;第四组  &lt;equation&gt;x&lt;/equation&gt;  和  &lt;equation&gt;y&lt;/equation&gt;  本来没有线性关系，但由于一个显著 outlier 的存在也使得它们“好像有线性关系”。&lt;/li&gt;&lt;/ol&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-1d73f8816ba49ace8d28e63e225fc73a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;659&quot; data-rawheight=&quot;292&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-1d73f8816ba49ace8d28e63e225fc73a&quot; data-watermark-src=&quot;v2-603319976d3591b965c47b2f2396c128&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这四组数据和它们的统计特征如下图所示。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-00f5dc2d9078923a7fa50dd0cabca6ac_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1069&quot; data-rawheight=&quot;424&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-00f5dc2d9078923a7fa50dd0cabca6ac&quot; data-watermark-src=&quot;v2-f27776ae5997508bd4e237a2ede18197&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;这个例子完美的诠释了统计量（比如本文的 IC）不能反映出数据的全部信息。更危险的是，一旦它们被错误解读和使用，将会导致完全错误的结果。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 改进的 IC&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;上一节的例子是为了说明当使用个股的因子取值和下期收益率在截面上回归时，得到的 IC 或者 Rank IC 不能很好的反映出因子选股的效果。对于这种情况，可以考虑以下两种改进方法。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第一种方法是按照因子取值把个股分成 &lt;/b&gt; &lt;equation&gt;n&lt;/equation&gt; &lt;b&gt; 档（比如十档），然后将每一档视作一个投资组合，计算投资组合收益率和投资组合因子在截面上的 IC 或 Rank IC。&lt;/b&gt;每一个投资组合中，可以按照等权或者市值加权来计算投资组合的收益率和因子取值。&lt;/p&gt;&lt;p&gt;&lt;b&gt;因子描述的是一揽子股票所共同承担（或者暴露于的）的某一方面的系统性风险。使用因子选股是为了规避个股特异性收益率的风险。&lt;/b&gt;因此，比起个股，我们更应该关注一揽子股票的收益率和相应因子取值之间的相关性。这就是使用因子构建投资组合、再计算 IC 的初衷。投资组合的收益率是一揽子股票的均值，也可以更好的消除收益率上的噪音。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第二种方法仍然从个股收益率和因子取值的 IC 出发，但是在计算时根据因子的业务逻辑（大到小、还是小到大的关系）来给 &lt;/b&gt; &lt;equation&gt;x&lt;/equation&gt; &lt;b&gt; 和 &lt;/b&gt; &lt;equation&gt;y&lt;/equation&gt; &lt;b&gt; 的取值赋权，从而得到&lt;/b&gt; &lt;b&gt;weighted IC。&lt;/b&gt;由于结合了从业务逻辑出发的权重，这个加权 IC 能更好的反映因子的选股能力。&lt;/p&gt;&lt;p&gt;下面以上一节的因子取值和两组收益率序列为例解释这一做法。假设从业务出发，因子取值越大越好。将十组 &lt;equation&gt;(x_i, y_i)&lt;/equation&gt; 样本点按照因子值  &lt;equation&gt;x&lt;/equation&gt;  从大到小排序，并假设它们的权重按指数衰减，系数为 0.9。这十组样本点的权重为：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-70463357eb8a7819473bdcd4e09caaef_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;576&quot; data-rawheight=&quot;394&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-70463357eb8a7819473bdcd4e09caaef&quot; data-watermark-src=&quot;v2-e9a22d5f0ed869e0f26abf5dfe177005&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;有了权重向量（记为 w），就可以计算  &lt;equation&gt;x&lt;/equation&gt;  和  &lt;equation&gt;y&lt;/equation&gt;  之间的&lt;b&gt;加权均值、加权方差、加权协方差、以及加权相关系数（weighted correlation coefficient）&lt;/b&gt;：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \mbox{E}_w[x]&amp;amp;=&amp;amp;\sum_i w_ix_i\\ \mbox{E}_w[y]&amp;amp;=&amp;amp;\sum_i w_iy_i\\\\ \mbox{cov}(x,y,w)&amp;amp;=&amp;amp;\sum_iw_i(x_i-\mbox{E}_w[x])(y_i-\mbox{E}_w[y])\\ &amp;amp;=&amp;amp;\sum_iw_ix_iy_i-\left(\sum_iw_ix_i\right)\left(\sum_iw_iy_i\right)\\\\ \mbox{var}(x,w)&amp;amp;=&amp;amp;\sum_iw_ix_i^2-\left(\sum_iw_ix_i\right)^2\\ \mbox{var}(y,w)&amp;amp;=&amp;amp;\sum_iw_iy_i^2-\left(\sum_iw_iy_i\right)^2\\\\ \rho(x,y,w)&amp;amp;=&amp;amp;\displaystyle\frac{\sum_iw_ix_iy_i-\left(\sum_iw_ix_i\right)\left(\sum_iw_iy_i\right)}{\sqrt{\sum_iw_ix_i^2-\left(\sum_iw_ix_i\right)^2}\sqrt{\sum_iw_iy_i^2-\left(\sum_iw_iy_i\right)^2}} \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;根据上述定义，很容易计算出因子和这两组收益率序列的加权相关系数。它们分别为 0.4494（因子和第一组收益率序列），以及 0.0908（因子和第二组收益率序列）。从加权 IC 来看，显然&lt;b&gt;第一组的收益率序列比第二组收益率序列更能说明因子的选股能力。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;同样的，为了绘图说明加入权重的优势，对  &lt;equation&gt;x&lt;/equation&gt;  和 &lt;equation&gt;y&lt;/equation&gt; 进行 &lt;b&gt;weighted least squares 回归（WLS）&lt;/b&gt;：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\left[\begin{array}{c} y_1\\\vdots\\y_{10} \end{array}\right]= \left[\begin{array}{cc} 1&amp;amp;x_1\\ \vdots&amp;amp;\vdots\\ 1&amp;amp;x_{10} \end{array}\right]\left[\begin{array}{c} a\\b \end{array}\right]+\left[\begin{array}{c} \varepsilon_1\\\vdots\\\varepsilon_{10} \end{array}\right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;令  &lt;equation&gt;\bf X&lt;/equation&gt;  代表系数矩阵（包括截距项系数 1 和  &lt;equation&gt;x&lt;/equation&gt; ）， &lt;equation&gt;\bf W&lt;/equation&gt;  表示由权重 &lt;equation&gt;w_i&lt;/equation&gt; 作为第  &lt;equation&gt;i&lt;/equation&gt;  个对角元素构成的对角矩阵，则带权重回归的解为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\left[\begin{array}{c} a\\b \end{array}\right]=(\mathbf{X^TWX})^{-1}(\mathbf{X^TWy}) &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;利用线性代数的运算法则，不难求出上式右侧的第一项逆矩阵为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;(\mathbf{X^TWX})^{-1}=\left[ \begin{array}{cc} \displaystyle\frac{\sum w_ix_i^2}{\sum w_ix_i^2-(\sum w_ix_i)^2},&amp;amp;\displaystyle\frac{\sum w_ix_i}{(\sum w_ix_i)^2-\sum w_i x_i^2}\\ \displaystyle\frac{\sum w_ix_i}{(\sum w_ix_i)^2-\sum w_ix_i^2},&amp;amp;\displaystyle\frac{1}{\sum w_i x_i^2-(\sum w_ix_i)^2} \end{array} \right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;回归式中右侧第二项为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;(\mathbf{X^TWy})=\left[ \begin{array}{cc} \displaystyle\sum w_iy_i\\ \displaystyle\sum w_ix_iy_i \end{array} \right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;因此，加权回归的系数为（其中  &lt;equation&gt;a&lt;/equation&gt;  为截距， &lt;equation&gt;b&lt;/equation&gt; 为斜率）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\left[\begin{array}{cc} \displaystyle a\\ \displaystyle b \end{array}\right]=\left[ \begin{array}{cc} \displaystyle\frac{(\sum w_ix_i^2)(\sum w_iy_i)-(\sum w_ix_i)(\sum w_ix_iy_i)}{\sum w_ix_i^2-(\sum w_ix_i)^2}\\ \displaystyle\frac{\sum w_ix_iy_i-(\sum w_ix_i)(\sum w_iy_i)}{\sum w_ix_i^2-(\sum w_ix_i)^2} \end{array} \right] &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;费了半天劲写出了  &lt;equation&gt;a&lt;/equation&gt;  和  &lt;equation&gt;b&lt;/equation&gt;  的表达式（其实从求解的角度，给出矩阵形式的求解足够了）只是想说明下面这件事儿。如果我们比较加权相关系数 &lt;equation&gt;ρ(x, y, w)&lt;/equation&gt; 以及加权方差（标准差） &lt;equation&gt;\mbox{var}(x, w)&lt;/equation&gt; 和 &lt;equation&gt;\mbox{var}(y, w)&lt;/equation&gt; ，以及斜率  &lt;equation&gt;b&lt;/equation&gt; ，则不难发现，和 OLS 一样，在加权回归中， &lt;equation&gt;\rho&lt;/equation&gt; 和  &lt;equation&gt;b&lt;/equation&gt;  仍然满足如下关系：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;b=\displaystyle\rho(x,y,w)\frac{\sigma(y,w)}{\sigma(x,w)}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;下面就来画图比较一下 WLS 回归和上一节 OLS 回归的结果。对于这两组收益率序列，OLS 回归的结果相同。但从选股的角度，我们知道如果因子对应的是第一组收益率，则该因子远比其对应第二组收益率有效。但是 OLS 回归（和普通的 IC）无法体现这一点。而采用改进的 WLS（以及 weighted IC）来衡量的话，如果因子产生了第一组收益率序列，则它的 WLS 回归斜率为 0.01（大于 OLS 的斜率 0.0058）；如果因子产生了第二组收益率序列，则它的 WLS 回归斜率仅为 0.0017（小于 OLS 的斜率）。&lt;b&gt;这说明通过使用基于因子业务规则的权重系数，WLS 比 OLS 更能判断因子和收益率之间的关系。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-15e96b468c9ddc02f9d2b9c217c30e43_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;979&quot; data-rawheight=&quot;351&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-15e96b468c9ddc02f9d2b9c217c30e43&quot; data-watermark-src=&quot;v2-22e6a9f09e02d6b1ae0139a8cff931b9&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;4 结语&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在我上统计课的时候，教授总是反复强调，拿来数据先画出来看一看。&lt;b&gt;我们之所以能够相信统计量，是以搞清楚了数据内在的结构、形态为前提的。&lt;/b&gt;如果没有这个前提，盲目的相信统计量就会导致错误的判断。金融数据已经信噪比极低了，我们当然不希望因为自己使用不当再加入不必要的噪音。&lt;/p&gt;&lt;p&gt;&lt;b&gt;很多时候数据关系越复杂，统计量传递出来的信息可能越失真。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;2017 年，来自 Autodesk Research 的 Matejka 和  Fitzmaurice 构建了当代版的“安斯库姆四重奏”（Matejka and Fitzmaurice 2017）。他们用计算机算法可以生成  &lt;equation&gt;x&lt;/equation&gt;  均值、 &lt;equation&gt;y&lt;/equation&gt;  均值、 &lt;equation&gt;x&lt;/equation&gt;  标准差、 &lt;equation&gt;y&lt;/equation&gt;  标准差、以及  &lt;equation&gt;x&lt;/equation&gt;  和 &lt;equation&gt;y&lt;/equation&gt; 相关系数相同的复杂数据集。比如下图中的 12 个完全不同的数据集就在上述五个统计量中取值完全一致 —— &lt;equation&gt;x&lt;/equation&gt; 均值 54.26， &lt;equation&gt;y&lt;/equation&gt; 均值 47.83， &lt;equation&gt;x&lt;/equation&gt;  标准差 16.76， &lt;equation&gt;y&lt;/equation&gt;  标准差 26.93， &lt;equation&gt;x&lt;/equation&gt; 和 &lt;equation&gt;y&lt;/equation&gt; 相关系数 -0.06。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d858e7c1b50f974667594aa68514b05c_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1175&quot; data-rawheight=&quot;611&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d858e7c1b50f974667594aa68514b05c&quot; data-watermark-src=&quot;v2-b0361c86019735eda70e2407ea81d3f5&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;先别忙着惊讶，上述这些数据集都是由下面这张恐龙数据集（也有同样的统计量）构建来的（请点击 GIF 看动画）！&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2346918863d4dfe069a0531271e0420e_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;544&quot; data-rawheight=&quot;195&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-2346918863d4dfe069a0531271e0420e&quot; data-watermark-src=&quot;v2-b1ac47228cdd28ac63bd4dc4e9258f18&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-30d91e04235f12b644fcdf15081d164b_r.gif&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;827&quot; data-rawheight=&quot;332&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot; data-thumbnail=&quot;https://pic3.zhimg.com/v2-30d91e04235f12b644fcdf15081d164b_b.jpg&quot;&gt;&lt;p&gt;有的朋友也许会说，IC 不够，再引入更多的统计量就行了。我们当然可以计算更高阶矩的统计量，但是因为数据的信噪比极低，这些样本数据计算出来的高阶统计量也存在大量误差。本文提出的改进方法属于从因子和收益率之间的内在逻辑出发 —— 比如分档构建组合、或者给不同的权重。这些都是&lt;b&gt;以内在的逻辑为先验&lt;/b&gt;，以期更好的判断因子的选股能力。&lt;/p&gt;&lt;p&gt;如果你在使用 IC 或者 Rank IC（以及 IR）来动态的评价、配置因子，那么本文希望能引发你的思考。在评价因子选股效果的道路上，我们也许还有很长的路要走。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Matejka, J. and G. Fitzmaurice (2017). &lt;i&gt;Same Stats, Different Graphs: Generating Datasets with Varied Appearance and Identical Statistics through Simulated Annealing.&lt;/i&gt; CHI 2017 Conference proceedings: ACM SIGCHI Conference on Human Factors in Computing Systems.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com/&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-07-41454197</guid>
<pubDate>Tue, 07 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>构建一个技术分析策略需要考虑哪些因素？</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-06-41424336.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41424336&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-da351251a0e7f37653a29c49fde3ba87_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;写在前面&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;之前铺垫了一篇技术分析，今天再放一篇原来写的，算是个学习笔记吧。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 技术分析&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;技术分析（technical analysis）是量化投资的一个重要组成部分。技术分析通过研究投资品历史量价信息来预测价格走势、决定投资策略。&lt;/b&gt;技术分析只考虑市场的价格行为，认为“历史会不断重演”、试图借由大量的统计资料来预测行情走势。&lt;/p&gt;&lt;p&gt;技术分析的发展长河已有百年历史，在这其中出现了很多“大神”、也诞生了很多家喻户晓的技术指标，比如人们耳熟能详的 MACD、KDJ 以及布林带（Bollinger bands）等。与基本面投资不同，技术分析完全不考虑投资品（比如股票或者商品期货）的基本面信息，仅仅根据量价的特征来产生开仓、平仓信号，捕捉交易机会。因此，与基本面投资相比，技术分析似乎更容易上手。作为技术分析代表的海龟交易法在上世纪七、八十年代的大获成功更是让人跃跃欲试。&lt;/p&gt;&lt;p&gt;毫无疑问，技术分析是任何量化投资的践行者应该了解并掌握的一项技能。那么，使用技术分析手段来构建投资策略都需要注意些什么呢？本文抛砖引玉，浅谈一些我们的理解。构建一个技术分析策略大致需要考虑以下六点、归类为三大部分：基础、风控和微调。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-03844cfed36a27e7a15bb6028f1e2f44_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;545&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-03844cfed36a27e7a15bb6028f1e2f44&quot; data-watermark-src=&quot;v2-b83fa9f43afda296c9b26fb0f905233e&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;接下来的二、三、四小节会使用国内商品期货数据构建策略对这三部分进行说明。我们从一个“基础版”技术分析策略出发，随着文章的深入，把上述不同组成部分逐渐添加到该策略中，说明这些组件在构建一个成功的技术分析策略时发挥的作用。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 基础篇：确定市场形态 &amp;amp; 选择技术指标&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;在技术分析中，首先要考虑的是希望交易的市场形态。&lt;/b&gt;市场形态可以从多个角度解读，比如从市场趋势可以把策略分为趋势追踪和均值回归策略；从交易的频率可以把策略分为以日频（或周频）数据为主的中低频策略、和以分钟及小时数据为主的日内中高频数据。&lt;b&gt;假设我们选择以日线数据构建一个趋势追踪类的技术分析策略。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;在确定了要交易的市场形态后，紧接着就是选择适合自己的技术指标了。任何技术指标，都是根据历史量价数据计算而来。技术指标仅仅是对量价数据的一个高度提炼、降噪的过程，以期捕捉到一些更泛化的信息；它们并不能提供任何量价以外的信息。&lt;/b&gt;同一类的技术指标多少都有一些大同小异。&lt;/p&gt;&lt;p&gt;以趋势追踪策略为例，我们在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41345652&quot;&gt;《趋势追踪：均线 vs 通道突破》&lt;/a&gt;比较了两大类趋势技术指标 —— 均线和通道突破，通过实证解释了它们在风险收益特征上的差异（下图）。投资者需要根据自己的风险偏好选择适合自己的技术指标。对于不同的技术交易指标和系统，Kaufman (2013) 是一本很不错的参考书。作者本人也是技术分析大牛，这本书写的非常清楚。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d0e2abeffdd1973b7a0be0737a2df51c_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;569&quot; data-rawheight=&quot;207&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d0e2abeffdd1973b7a0be0737a2df51c&quot; data-watermark-src=&quot;v2-7053c7e72fedf099bc185a72bd4134ca&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;针对日频趋势追踪策略这个目标，我们采用唐奇安通道（Donchian channel）突破作为技术指标，构建我们的“基础版”策略。唐奇安通道由期货交易大师 Richard Donchian 发明、是海龟交易法的重要部分。它利用一段时间窗口的最高价和最低价作为通道，以价格突破通道上、下限作为多、空的开仓信号。具体的，我们的“基础版”策略如下：&lt;/p&gt;&lt;p&gt;&lt;b&gt;在没有任何头寸时的开仓信号：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;如果当日的收盘价高于前 50 日的最高价，则按下一日开盘价做多；&lt;/li&gt;&lt;li&gt;如果当日的收盘价低于前 50 日的最低价，则按下一日开盘价做空。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;平仓信号：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;当持有多头头寸时，如果当日收盘价低于前 10 日的最低价时，则在下一日开盘时平掉多头仓位；&lt;/li&gt;&lt;li&gt;当持有空头头寸时，如果当日收盘价高于前 10 日的最高价时，则在下一日开盘时平掉空头仓位。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;仓位计算：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;在计算每次开仓的仓位时，我们以分配的资金对于目标交易商品收益暴露为 1 这个原则（即如果目标商品收益率变化 1%，我们的净值也变化 1%）。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;交易成本：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;交易成本方面，假设每笔交易（包括开多、开空、平多、平空）的手续费和滑点一共为千分之一。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;为了测试这个交易策略，我们使用下列来自国内商品交易所的商品的合成指数作为投资标的。回测期为 2011 年 1 月 1 日到 2017 年 6 月 23 日。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-53580950b9a12deb3798bb06404b556f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;437&quot; data-rawheight=&quot;218&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-53580950b9a12deb3798bb06404b556f&quot; data-watermark-src=&quot;v2-d41e797006c5db94171a555d3b35579c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;该“基础版”策略在回测期内的净值和最大回撤曲线如下图所示。它虽然取得了惊人的年化 71.01% 的收益率，夏普率也高达 1.074，但是&lt;b&gt;它的最大回撤却高达 -71.14%&lt;/b&gt;。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ba8dcb7c6cbe4bcde3ff8acfb809f7ba_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;560&quot; data-rawheight=&quot;355&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ba8dcb7c6cbe4bcde3ff8acfb809f7ba&quot; data-watermark-src=&quot;v2-73561d9d288d5b6fa4f08ec6d7a52f3c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这样的结果说明以下两点：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;b&gt;以唐奇安通道作为技术指标的趋势追踪策略在收益端非常有效；&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;该“基础版”策略有着不当的风险收益特性；它的风险过大，在风险端的控制非常失败。&lt;/b&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;下面我们就来看看如何在风险端改进上述策略。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 风控篇：仓位控制 &amp;amp; 跟踪止损&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在风控方面，技术分析策略的两大利器是&lt;b&gt;“仓位控制”&lt;/b&gt;和&lt;b&gt;“跟踪止损”&lt;/b&gt;。&lt;b&gt;仓位控制相当于在交易前就有针对性的计算好每笔交易的最大可能亏损，以此来确定仓位。跟踪止损则相当于在交易后随着价格走势是否有利于交易的方向来决定是否及时平仓、退出该交易。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;为了解释“仓位控制”和“跟踪止损”，就不得不先说另外一个指标 —— &lt;b&gt;ATR（average true range，真实波动幅度均值）&lt;/b&gt;。它通过过去一段时间的最高价、最低价和收盘价计算出投资品的波动范围。比如一个投资品现在的价格是 500，而它的 ATR 是 20，这意味着它最近一段时间的交易区间在 500 上下 20 左右。&lt;b&gt;ATR 有助于帮助我们判断某商品的价格在未来一段时间的波动范围。这对于风控至关重要。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在进行仓位控制时，常见的目标是&lt;b&gt;“计算仓位以使得每次交易的最大亏损不超过给定上限”&lt;/b&gt;。具体实施上面，假设每笔交易的给定损失是 2% 的资金量，使用一定倍数的 ATR 计算仓位（比如 4 倍）。举个例子，假如通道上限被突破，我们选择做多。但在建仓后，投资品的价格开始下跌。那么，当价格下跌到达 4ATR 时（一个非常差的情况，即投资品的跌幅较我们的开仓价来说是 4ATR / 开仓价 × 100%），我们要求本次的交易仅仅亏损资金量的 2%，以此反推计算出仓位。&lt;/p&gt;&lt;p&gt;&lt;b&gt;加入了上述仓位控制后，策略的风险较“基础版”得到了明显的控制，虽然牺牲了很多收益，但是夏普率却较“基础版”有了显著提高，说明“基础版 + 仓位控制”策略有着更好的收益风险比。&lt;/b&gt;该策略的年化收益率为 33.45%，夏普率 1.251，最大回撤 -24.25%；净值和最大回撤曲线如下。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0bbcb348d09e93ea0f9d4f2c990b0fe7_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;359&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0bbcb348d09e93ea0f9d4f2c990b0fe7&quot; data-watermark-src=&quot;v2-082bf4733900a7880d7ebd1ef274e643&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;上面我们仅仅考虑了开仓前的仓位控制。在风控方面，开仓之后的止损也至关重要。具体的，止损有两个目的：&lt;/p&gt;&lt;p&gt;1. 当价格走势和我们的开仓信号相左时，我们的开仓量并不能够保证亏损不超过限制。这是因为如果技术指标没有发出平仓信号，那么哪怕是投资品价格下跌已经超过我们的资金量所愿意承受的亏损时，我们仍然不会平仓，而是会继续等待平仓信号。这时，如果策略中存在止损线，那么就可以在此时强行止损。&lt;/p&gt;&lt;p&gt;2. 当价格走势和我们的开仓信号相同时，如果趋势不强，那么在趋势结束时平仓信号给出的交易价格不一定优于我们的开仓价格。换句话说，在趋势弱的时候，我们虽然会在持仓过程中有浮盈，但是最终还会“竹篮打水一场空”。针对这种情况，一般采用动态改变止损线（称为跟踪止损），这有助于策略锁住一部分利润。比如当我们做多时，随着价格的上升，我们的止损线也相应上移。当价格回调时，如果它触及了上移后的止损线，策略就会平仓，锁定那部分利润。&lt;/p&gt;&lt;p&gt;假设我们用每天的收盘价 ± 2ATR 作为相应的空、多单的止损线，并根据最新的收盘价进行跟踪止损。把这个想法加入到上述“基础版 + 仓位控制”策略之上，得到新的“基础版 + 仓位控制 + 跟踪止损”策略。该策略的年化收益率为 28.09%，夏普率 1.204，最大回撤 -22.66%；净值和最大回撤曲线如下。&lt;b&gt;该策略的夏普率虽然略逊于不带跟踪止损的版本，但它进一步降低了最大回撤。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-0fccd63a853ca38c3dd31c4686dacedb_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;553&quot; data-rawheight=&quot;358&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0fccd63a853ca38c3dd31c4686dacedb&quot; data-watermark-src=&quot;v2-0e452dbc46f6f57293f4d7ec8f836c50&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;“止损”是一把双刃剑。&lt;/b&gt;它确实能够规避价格继续向不利于交易的方向发展的风险，但同时以牺牲“价格在到达止损线之后发生反转从而减小亏损甚至产生收益”为代价。&lt;b&gt;不当的止损线更是会大大降低策略的表现。&lt;/b&gt;但是从控制风险的角度，止损无疑是技术分析策略中的重要一环。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 微调篇：多指标确认 &amp;amp; 波动率过滤&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;清晰的技术指标加上合理的止损，我们的趋势策略已经有了不错的基础。本节就来看看常见的&lt;b&gt;微调（fine tuning）&lt;/b&gt;手段。这主要包括多指标确认和使用波动率对投资品进行过滤。&lt;/p&gt;&lt;p&gt;对于围绕任何技术指标构建的策略，胜率和盈亏比都是鱼和熊掌不可兼得的一对矛盾。&lt;b&gt;一个系统的胜率越高，它的盈亏比通常越低，反之亦然。为了提高胜率，技术分析领域常见的做法时同时使用多个技术指标，当这些指标均发出开仓信号时才交易。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在实证中，我们给唐奇安通道加入一个新的动量指标，用来描述趋势的强弱。该指标是 &lt;b&gt;Stochastic oscillator（随机波动指标）&lt;/b&gt;，也是根据过去一段时间的最高、最低和收盘价计算得来。它的取值范围是 0 到 100 之间，越高说明买入的动量越强；越低说明卖出的趋势越强。有人使用它作为超买超卖的指标，但大量实证显示，它被当作动量指标使用效果更好。&lt;/p&gt;&lt;p&gt;将它和唐奇安通道突破结合，我们的开、平仓规则改为：&lt;/p&gt;&lt;p&gt;&lt;b&gt;在没有任何头寸时的开仓信号：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;如果当日的收盘价高于前 50 日的最高价&lt;b&gt;且当日随机波动指标大于 70&lt;/b&gt;，则按下一日开盘价做多；&lt;/li&gt;&lt;li&gt;如果当日的收盘价低于前 50 日的最低价&lt;b&gt;且当日随机波动指标小于 30&lt;/b&gt;，则按下一日开盘价做空。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;平仓信号：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;当持有多头头寸时，如果当日收盘价低于前 10 日的最低价&lt;b&gt;或当日随机波动指标小于 50&lt;/b&gt;，则在下一日开盘时平掉多头仓位；&lt;/li&gt;&lt;li&gt;当持有空头头寸时，如果当日收盘价高于前 10 日的最高价&lt;b&gt;或当日随机波动指标大于 50&lt;/b&gt;，则在下一日开盘时平掉空头仓位。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;此外，同样考虑仓位控制以及跟踪止损，由此得到新的“基础版 + 仓位控制 + 跟踪止损 + 复合指标确认”策略。该策略的年化收益率为 27.02%，夏普率 1.266，最大回撤 -17.26%；净值和最大回撤曲线如下。&lt;b&gt;较之前的版本，该策略将系统的胜率从 43% 左右提高至 48% 左右，且获得了更高的夏普率和更小的最大回撤。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e1b6d479e569d6d45386d59e26aa878f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;551&quot; data-rawheight=&quot;360&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e1b6d479e569d6d45386d59e26aa878f&quot; data-watermark-src=&quot;v2-32f1161892e4337211ecf90117941667&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;由于同类型技术指标之间的高相似性，基于单一指标的策略的相关性非常高。构建策略时切记不宜使用过多的指标。使用的指标越多，样本内拟合的越精准，策略在样本外的普适性就越低。&lt;/b&gt;一般来说，使用两个技术指标来确认交易信号足以。&lt;/p&gt;&lt;p&gt;最后再来看看另一种微调思路，即使用波动率来过滤投资品。只有大起大落的投资品才能产生明显的趋势，那些死气沉沉、价格在买一卖一之间来回扭的投资品则没有趋势交易一展身手的空间。从这个观点出发，我们可以给策略加一个波动率过滤器，动态的过滤掉在当前波动率不足的投资品，而仅仅交易那些波动率高的品种。&lt;/p&gt;&lt;p&gt;具体的，利用过去 60 天的收益率计算其标准差作为波动率的代理指标。&lt;b&gt;每当某品种产生交易信号时，如果它的波动率在所有投资品中处于后 20% 则放弃该信号，不进行交易。&lt;/b&gt;如此，我们得到最终的“基础版 + 仓位控制 + 跟踪止损 + 复合指标确认 + 波动率过滤”策略。该策略的年化收益率为 23.41%，夏普率 1.206，最大回撤 -15.97%；净值和最大回撤曲线如下。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-21278d5aa6e40533c7a5cadfd290b386_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;362&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-21278d5aa6e40533c7a5cadfd290b386&quot; data-watermark-src=&quot;v2-07ff88c6870e44c66e7a513d25594efa&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;由于交易的品种减少，该策略更有效的控制了回撤，但是夏普率却不及前者。此外，由于我们是根据历史波动率来判断投资品未来的波动程度、决定这个投资品是否交易，这相当于变相择时，也注定加入了不确定性。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5 “廉颇老矣，尚能饭否？”&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文从一个基本的趋势追踪策略出发，依次加入了构建技术分析策略的重要组成部分：仓位控制、跟踪止损、多指标确认、以及波动率过滤。希望通过本文的介绍让小伙伴们看到，在开发一个技术分析策略时，哪些因素是必须考虑的，以及它们之间是如何取舍的。&lt;/p&gt;&lt;p&gt;这五个策略的表现汇总于下表。从风险控制的角度来说，每一个因素的加入都有效降低了最大回撤。但是，这个&lt;b&gt;市场上从来就没有“圣杯”&lt;/b&gt;，因此每一个因素的加入有都会改变策略本身的风险收益特征，需要我们根据自己的风险偏好来取舍。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-74f6ade098aa3706c43394de64a50c6a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;679&quot; data-rawheight=&quot;155&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-74f6ade098aa3706c43394de64a50c6a&quot; data-watermark-src=&quot;v2-97c73c54f1502d900eb0ddf6f00ab98c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;技术分析的最大价值在于它能由计算机产生明确的交易信号；一个全自动化的交易系统更能够代替人来自动进行交易，从而完全摒除在面对交易时人性的弱点。&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;一个好的交易者其实是应该逆人性的，而量化系统其实是最好的克服人性操作的一个工具。&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;正如我们在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/38417800&quot;&gt;《追求卓越，但接受交易中的不完美》&lt;/a&gt;阐释的那样，人性的弱点永远是交易中的最大障碍。如果交易者不能够严格按照技术指标给出的信号进行买、卖，而是掺杂了大量的主观操作，再好的策略也无能为力。&lt;/p&gt;&lt;p&gt;技术分析已经发展了百年，大多数现在被广泛使用的指标或者 K 线形态都是几十年前发展出来的东西。当时计算机尚未普及，绝大多数人还在看蜡烛线甚至是单一的收盘价交易。&lt;b&gt;在当时，技术指标较蜡烛线和收盘价来说绝对有它的先进性；使用技术分析交易的人也绝对比那些眼儿瞪看线的人有信息优势。这些优势让技术分析的佼佼者在那个时代脱颖而出，成为一代传奇。&lt;/b&gt;而如今，随便一个看盘软件都能画出各种技术指标，像样一点的交易终端都可以通过简单的设定便能根据技术指标来交易。&lt;/p&gt;&lt;p&gt;我曾经看过一本根据 K 线形态来交易的短线策略经典书《Street Smarts: High Probability Short-Term Trading Strategies》（Raschke and Connors 1996）并简单实证了其中的策略，但是它们的效果没有书中描述的令人印象深刻（当然也有可能是我学艺不精）。&lt;/p&gt;&lt;p&gt;随着使用技术指标的门槛大大降低，使用的人也越来越多。&lt;b&gt;任何指标能够赚钱都是在利用了市场在某方面的非有效性，当越来越多的人使用它，这个非有效性就会降低，直至该指标失效。&lt;/b&gt;这就是为什么&lt;b&gt;在当下，技术分析策略似乎逐渐褪去神奇的光环&lt;/b&gt;。技术分析中对仓位和风险控制非常值得借鉴，但仅仅使用传统的技术分析就想取得非凡的投资收益的日子恐怕一去不复返了。市场在发展，量化投资的践行者唯有不断学习新的知识和技术，才能跟上时代的步伐。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Kaufman, P. J. (2013). &lt;i&gt;Trading systems and methods + website (5th ed).&lt;/i&gt; John Wiley &amp;amp; Sons, Inc., Hoboken, NJ.&lt;/li&gt;&lt;li&gt;Raschke, L. B. and L. A. Connors (1996). &lt;i&gt;Street Smarts: High Probability Short-Term Trading Strategies&lt;/i&gt;. M. Gordon Publishing Group.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-06-41424336</guid>
<pubDate>Mon, 06 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>趋势追踪：均线 vs 通道突破</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-05-41345652.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41345652&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1d1344db04ea75a8af2a67945ee4dc99_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;写在前面&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;放一篇关于技术分析的老文（写于 2017 年 6 月）；为的是之后再放另外一篇技术分析的老文……&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 引言&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在技术分析领域的趋势类策略中，&lt;b&gt;均线&lt;/b&gt;和&lt;b&gt;通道突破&lt;/b&gt;无疑是两大门派。虽然目的都是为了抓住价格走势的趋势，但是&lt;b&gt;这两类策略的交易哲学以及风险特征截然不同&lt;/b&gt;。&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;There is no best system, only trade-offs.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;这是被技术分析的使用者广为接受的一句话：&lt;b&gt;没有最好的交易系统，只能在不同系统的收益风险特征之间权衡，找到适合使用者的交易系统。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;那么，我们又当如何在均线和通道突破间权衡的？看完本文，也许你会认可上面这句话。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 不同的交易哲学&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;均线，一般又称为趋势线（trend line），是趋势策略中的一大战将。&lt;/p&gt;&lt;p&gt;&lt;b&gt;均线策略一般是利用固定长度的价格均线作为多、空趋势的判断：滑动均线随时间增加说明趋势向上；反之滑动均线随时间减少说明趋势向下。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;由于每一期的价格只在均线的计算中占一小部分，&lt;b&gt;均线随时间的变化是相对连续的&lt;/b&gt;，即使某一期价格发生急涨或者急跌也很难直接造成均线方向的变化。然而，&lt;b&gt;使用均线作为交易信号又不可避免的引入了滞后&lt;/b&gt;，这是因为均线相对当前价格来说都是有滞后性的（见&lt;a href=&quot;https://zhuanlan.zhihu.com/p/38276041&quot;&gt;《移动平均：你知道的和你不知道的》&lt;/a&gt;）。&lt;/p&gt;&lt;p&gt;通道突破则是趋势策略中的另一个利器。&lt;/p&gt;&lt;p&gt;&lt;b&gt;通道突破策略使用给定的技术指标计算当前的价格区间，认为当价格有效突破这个价格区间时就是新的趋势形成之时。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;特别的，如果价格向上突破了通道上限，则新的上涨趋势形成；如果价格向下突破了通道下限，则新的下跌趋势形成。正因如此，单期价格的大涨或者大跌就有可能使得之前的通道被突破，从而触发交易信号。因此，&lt;b&gt;突破系统也可以被认为是“事件驱动型”的策略&lt;/b&gt;。与均线策略存在滞后性不同，&lt;b&gt;通道突破策略在价格突破的一瞬间就可以发出交易信号，因此这类策略没有滞后性。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;现在我们已经了解了这两类策略不同的交易哲学。以此发展出的交易系统虽然都是为了捕捉价格中的大趋势，但是却体现出了完全不同的收益和风险特征。接下来通过两组对比来说明这两类策略收益、风险特征的区别。这两组对比是：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;基础版 PK：单均线策略 vs 唐奇安通道突破策略&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;加强版 PK：双均线策略 vs 布林带突破策略&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;3 实验说明&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在下面两节的两组比较中，我们会测试四组基于&lt;b&gt;日线&lt;/b&gt;的交易系统。它们的区别仅仅在于使用不同的技术指标来产生多空的买卖交易信号。除此之外，在交易品种、回测时间以及风险控制方面没有任何区别。在此先对它们的共同之处做一个说明。&lt;/p&gt;&lt;p&gt;交易品为如下五个商品期货的合成指数：郑商所的棉花、大商所的豆粕以及上期所的螺纹钢、橡胶和沪锌。之所以选这些只是因为它们的数据足够长，回测起来更有说服力。另外一个原因就是这几个品种分别来自农产品、基本金属和能源化工。回测期为 2011 年 1 月 1 日到 2017 年 6 月 23 日。&lt;/p&gt;&lt;p&gt;风控方面，每笔交易使用 2% 的资金量，采用 ATR（average true range）进行跟踪止损。在交易执行方面，均假设在每日收盘后利用已有的价格数据计算是否有交易信号；如果产生了交易信号，则按下一个交易日的开盘价执行。交易成本方面，假设每笔交易（包括开多、开空、平多、平空）的手续费和滑点一共为千分之一。&lt;/p&gt;&lt;p&gt;最后需要说明的是，&lt;b&gt;无论是哪种趋势类策略，选择计算趋势的时间窗口都格外重要&lt;/b&gt;。如果窗口太短，则价格噪声太大而趋势太弱；如果窗口太长，则策略对价格的反应时间就会被拉长。&lt;b&gt;在本文的研究中，我们不做任何参数优化的尝试。但是，为了使不同的策略有可比性，我们尽量选取同样的时间窗口。在这样的设定下，实验结果很好的给出了这两类策略收益、风险特征。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 基础版 PK：单均线 vs 唐奇安通道&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;单均线策略如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;时间窗口为 50 个交易日。如果当日的均线大于上一个交易日的均线则做多（同时平掉任何空头仓位）；如果当日的均线小于上一个交易日的均线则做空（同时平掉任何多头仓位）。当持有任何仓位时，如果价格触及止损线则平仓止损。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;唐奇安通道（Donchian channel，由期货交易大师 Richard Donchian 发明）是著名的海龟交易法则的重要部分。它利用一段时间窗口的最高价和最低价作为通道。唐奇安通道策略如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;在没有任何头寸时，如果当日的收盘价高于前 50 日的最高价，则做多；如果当日的收盘价低于前 50 日的最低价，则做空。持有多头头寸时，如果当日收盘价低于前 10 日的最低价时，平掉多头仓位。持有空头头寸时，如果当日收盘价高于前 10 日的最高价时，平掉空头仓位。当持有任何仓位时，如果价格触及止损线则平仓止损。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;选择两个时间窗口计算建仓和平仓信号的原因是：唐奇安通道的常见建仓、平仓时间窗口都是 20。为了和单均线策略有可比性，我们把建仓的时间窗口设定为 50。如果再用它作为平仓窗口，则会使得策略的反应非常慢。因此，选择了一个更短的平仓时间窗口。&lt;/p&gt;&lt;p&gt;在使用单均线交易系统时，得到的净值曲线和最大回撤曲线如下图：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-7c6845d9ba82b584503e23266df876bf_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;583&quot; data-rawheight=&quot;378&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-7c6845d9ba82b584503e23266df876bf&quot; data-watermark-src=&quot;v2-0dcfe6fd21b40d004a8748760410ec68&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;在使用唐奇安通道突破交易系统时，得到的净值曲线和最大回撤曲线如下图：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9b3543b2193972718f7fd967e4df9e48_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;578&quot; data-rawheight=&quot;379&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9b3543b2193972718f7fd967e4df9e48&quot; data-watermark-src=&quot;v2-040bd02cdccccb928a3a582e8b6335d5&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;一眼望去，这两个交易系统的净值曲线十分接近（总收益也很像），这说明它们都有效地捕捉了这些投资品价格的大趋势。不过，通过比较策略评价指标（下图）还是能看出来它们截然不同的风险收益特征。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-359617d021e0d22d08052eebc4d5c57f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;569&quot; data-rawheight=&quot;334&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-359617d021e0d22d08052eebc4d5c57f&quot; data-watermark-src=&quot;v2-a9c946a6e9eb22ac3822aa120fd2eb8b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;我们先来总结，待到本文第 6 节再分析：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;单均线策略较唐奇安通道突破策略有：更多的交易次数、更低的胜率；从每笔交易来看，盈利交易有更低的平均收益率，而亏损交易也有更少的平均亏损。&lt;/b&gt;最后一个指标利润因子为总收益和总亏损的比值。从这组对比来看，均线策略的利润因子比通道策略略低。&lt;/li&gt;&lt;li&gt;&lt;b&gt;这样的回测结果不仅仅是这两个交易系统的区别，更是代表了这两类（均线类和通道突破类）策略的区别，这些区别源自它们不同的交易哲学。&lt;/b&gt;为了说明这个区别是大类策略的区别，而不仅仅是来自个别策略的偶然，我们再来看看两类策略加强版的 PK。&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;5 加强版再 PK：双均线 vs 布林带&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;顾名思义，双均线是利用两个不同周期的均线进行交易的策略。&lt;b&gt;双均线系统由一个短周期趋势和一个长周期趋势构成。投资品的大趋势依然由长周期均线捕捉，而短周期均线起到的是择时的作用。&lt;/b&gt;因此，双均线可以看成是单均线的加强版。&lt;/p&gt;&lt;p&gt;双均线策略如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;长、短均线的时间窗口分别为 50 和 10 个交易日。在没有头寸时，如果当日的长均线大于上一个交易日的长均线、且短均线在自下而上穿越长均线则做多；如果当日的长均线小于上一个交易日的长均线、且短均线自上而下穿越长均线则做空。当持有多头头寸时，如果短均线自上而下穿越长均线则平仓；当持有空头头寸是，如果短均线自下而上穿越长均线则平仓。持有任何仓位时，如果价格触及止损线则平仓止损。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;布林带（Bollinger bands）由技术分析大师 John Bollinger 发明。与唐奇安通道不同，它利用价格自身的波动率计算通道的宽度。&lt;b&gt;相比于唐奇安使用的最高最低价，布林带在构建通道时更加直接的考虑了价格波动。&lt;/b&gt;因此，我们姑且称它是唐奇安通道的升级版。&lt;/p&gt;&lt;p&gt;布林带策略如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;时间窗口为 50 个交易日。建仓的波动率标准差为 2，平仓的波动率标准差为 1。在没有任何头寸时，如果当日的收盘价高于 2 个标准差计算的布林带上轨，则做多；如果当日的收盘价低于 2 个标准差计算的布林带下轨，则做空。当持有多头头寸时，如果当日收盘价低于 1 个标准差计算的布林带下轨，则平仓；持有空头头寸时，如果当日收盘价高于 1 个标准差计算的布林带上轨，则平仓。当持有任何仓位时，如果价格触及止损线则平仓止损。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;选择两个标准差计算建仓和平仓信号和唐奇安通道类似：布林带中，常见的时间窗口是 20、常见的标准差是 2。为了和均线策略有可比性，我们把时间窗口设定为 50。为了避免因此造成的策略的平仓反应过慢，我们将平仓使用的标准差参数选为 1。&lt;/p&gt;&lt;p&gt;双均线交易系统的净值曲线和最大回撤曲线如下图：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2ae4f3cc6bea9d16370656bcc0ccd304_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;597&quot; data-rawheight=&quot;388&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-2ae4f3cc6bea9d16370656bcc0ccd304&quot; data-watermark-src=&quot;v2-e40f06384ad7d0ceaf64ea701fa41c74&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;布林带突破交易系统的净值曲线和最大回撤曲线如下图：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4089cd9bebadb94aa819729900be4462_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;586&quot; data-rawheight=&quot;391&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-4089cd9bebadb94aa819729900be4462&quot; data-watermark-src=&quot;v2-57926060138dd46e9b290ee062c3ea18&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;它们的风险收益特征为：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-6ec06dfbec7dcf034064d6daf4dfd8f2_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;570&quot; data-rawheight=&quot;334&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-6ec06dfbec7dcf034064d6daf4dfd8f2&quot; data-watermark-src=&quot;v2-f97d487bd2f177c6206254a996634294&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;毫无悬念的，在加强版的 PK 中，我们再次看到了这两类策略的特点：&lt;b&gt;双均线策略较布林带突破策略有：更多的交易次数、更低的胜率；从每笔交易来看，盈利交易有更低的平均收益率，而亏损交易也有更少的平均亏损。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;那么，这两类策略到底孰优孰虑呢？&lt;/p&gt;&lt;h2&gt;&lt;b&gt;6 没有最好的交易系统&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;如果我们画出任何趋势策略的收益和亏损分布，都会和下面这个图类似。它表明了趋势类策略的核心：&lt;b&gt;以不断的小亏损作为风险成本来换取大趋势中的高收益。&lt;/b&gt;这当然和价格的走势有关，因为大趋势不常有，而趋势类策略只有在做好严格风控的情况下不断地对可能的趋势信号做出反应。这样做的结果是，这类策略的胜率不会很高（因此会有很多小的亏损交易）；而一旦成功，就会捕捉到一波大的趋势（轻松覆盖之前的小亏损）。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-b157bae535afe41031e895525a1dfa9e_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;685&quot; data-rawheight=&quot;361&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-b157bae535afe41031e895525a1dfa9e&quot; data-watermark-src=&quot;v2-5c3ae87a975aeb79281fd1be8dea48bb&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;了解了趋势类策略的收益亏损特征后，我们可以从风险特征（即亏损）的角度有效地说明均线和通道突破系统的区别。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;对于均线策略，当价格震荡时，均线的方向可能会发生频繁的变化。因此，这样的价格走势会产生大量的错误开仓信号，从而造成更多的交易次数以及较低的胜率。但由于信号出现的比较频繁，因此持仓时间较短，每次错误信号造成的亏损也不会很大、正确信号带来的收益也相对较低。&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;反观通道突破策略，由于通道不易经常被突破，因此交易次数会少得多，不过胜率会更高。一旦突破建仓后，系统必须等到通道再次被突破才能做出反应。在这个过程中，由于持仓时间较长，因此错误信号造成的亏损也会比较大，而正确信号带来的收益也会更高。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;这两类策略的收益、风险特征总结如下。这些特征在上面四个实验中得到了很好的体现。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d0e2abeffdd1973b7a0be0737a2df51c_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;569&quot; data-rawheight=&quot;207&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d0e2abeffdd1973b7a0be0737a2df51c&quot; data-watermark-src=&quot;v2-7053c7e72fedf099bc185a72bd4134ca&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;所以，有没有最好的交易系统？&lt;/p&gt;&lt;p&gt;&lt;b&gt;两个字的答案是：没有；四个字的答案是：因人而异。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;很多交易员都喜欢通道突破策略的高胜率，以及每笔交易的高收益。但是他们当然知道，这是靠更大的持仓风险换来的。并没有太多交易员都喜欢长期持仓（持仓和空仓的心理压力是完全不同的）。想象一下，如果一个策略的信号让一个交易者持仓 100 天，那这不是交易（trading），而是投资（investing）了。这显然是交易员不习惯的，他们更倾向于均线策略中平均持仓较短的特征。&lt;b&gt;想要以较短的持仓时间来享受大趋势带来的高收益本身就是个伪命题。必须有所取舍。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一个交易员选择什么样的系统显然和他的风险偏好直接相关。&lt;b&gt;明确自己的交易目标、正确认识每个系统的收益风险特征、找到让自己最舒服的策略，这些怎么强调都不过分。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;At the end of the day, it is just a matter of personal taste.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-05-41345652</guid>
<pubDate>Sun, 05 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>用 Bootstrap 进行参数估计大有可为</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-08-02-41099219.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/41099219&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-920667eda7c3055111388431dcad84bc_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;1 从 t 分布说起&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;在量化投资领域，有大量需要进行参数估计（parameter estimation）的场景。&lt;/b&gt;比如在按照马科维茨的均值方差框架配置资产时，就必须计算投资品的收益率均值和协方差矩阵。&lt;b&gt;很多时候，对于需要的统计量，仅有点估计（point estimate）是不够的，我们更感兴趣的是从样本数据得到的点估计和该统计量在未知总体中的真实值之间的误差。&lt;/b&gt;在这方面，区间估计 —— 即计算出目标统计量的&lt;b&gt;置信区间（confidence interval）&lt;/b&gt;—— 可以提供我们需要的信息。&lt;/p&gt;&lt;p&gt;谈到置信区间，人们最熟悉的当属计算&lt;b&gt;总体均值（population mean）&lt;/b&gt;的置信区间。这是因为在&lt;b&gt;中心极限定理（Central Limit Theorem）&lt;/b&gt;和&lt;b&gt;正态分布假设（Normal distribution）&lt;/b&gt;下，总体均值的置信区间存在一个优雅的解析表达。具体的，利用样本的标准差将样本均值转化成满足 t 分布（Student&#39;s t-distribution）的 t 统计量（t-statistic），然后通过查表找到置信区间两边各自对应的 t 统计量的临界值（critical value）便可以方便的求出置信区间。由于 t 分布是对称的，因此总体均值的置信区间是关于样本均值对称的。&lt;/p&gt;&lt;p&gt;让我们称上述计算置信区间的方法为传统的 Normal Theory 方法。我想花点时间来聊聊该方法背后的两个强大假设：中心极限定理和正态分布。&lt;/p&gt;&lt;p&gt;假设总体满足正态分布，而我们想计算均值的置信区间。如果总体的标准差 &lt;equation&gt;σ&lt;/equation&gt; 已知，则可以使用正态分布计算均值的置信区间；如果  &lt;equation&gt;σ&lt;/equation&gt;  未知，则使用样本的标准差  &lt;equation&gt;s&lt;/equation&gt;  代替，并且利用 t 分布来代替正态分布计算均值的计算区间。这就是 t 分布被提出来的初衷。因此，&lt;b&gt;使用 t 分布计算均值的置信区间隐含着总体分布满足正态分布这个假设。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;但是，对于实际中的问题，总体并不满足正态分布，因此看起来我们不能使用 t 分布计算均值的置信区间。好消息是，我们还有另外一个“大招”：中心极限定理。中心极限定理告诉我们，不管总体的分布是什么样，总体的均值近似满足正态分布，因此我们仍然可以使用 t 分布计算置信区间。&lt;/p&gt;&lt;p&gt;中心极限定理是概率论中的一组定理。中心极限定理说明，大量相互独立的随机变量，其均值的分布以正态分布为极限。这组定理是数理统计学和误差分析的理论基础，指出了大量随机变量之和近似服从正态分布的条件。&lt;/p&gt;&lt;p&gt;可见，对于一个未知分布总体均值的推断，我们必须倚赖中心极限定理和正态分布的假设。&lt;b&gt;如果未知分布非常不规则或样本数不足，则中心极限定理指出的均值近似为正态分布便难以成立，而基于 t 分布计算出来的均值置信区间也不够准确。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;除了均值外，对于人们关心的许多其他统计量，比如中位数、分位数、标准差、或者相关系数，它们与均值不同，无法从 Normal Theory 中可以得到优雅的解析表达式来计算其置信区间，因此上述传统方法无能为力。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;从上面的分析可知，仅仅掌握传统的 Normal Theory 方法局限性很大，使得我们在求解置信区间的很多问题面前举步维艰。因此，今天就给大家介绍一个利器 —— &lt;b&gt;Bootstrap 方法&lt;/b&gt;。它在计算统计量的置信区间时大有可为。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 Bootstrap 的由来和原则&lt;/b&gt;&lt;/h2&gt;&lt;blockquote&gt;&lt;i&gt;The bootstrap is a computer-based method for assigning measures of accuracy to statistical estimates. -- Efron &amp;amp; Tibshirani, An introduction to the bootstrap, 1993&lt;/i&gt;&lt;br&gt;&lt;i&gt;译：Bootstrap 是一个基于计算机的方法，它可以计算统计估计的准确性。&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;自 1979 年以来，Bootstrap 方法得到了广泛的推广，其始作俑者是 Bradley Efron （Bootstrap 这个词也是他发明的）。&lt;b&gt;它的核心思想是通过使用数据本身，从而估计从该数据中计算出来的统计数据的变化。&lt;/b&gt;现代计算机强大的计算能力使得该方法的实现非常简单。&lt;/p&gt;&lt;p&gt;有些费解？别着急，马上解释 Bootstrap 的意思和它的核心思想。&lt;/p&gt;&lt;p&gt;Bootstrap 一词出自英文习语“pull yourself up by your bootstraps”，它的直译是“通过拉你自己靴子的鞋带把你自己从地面上拉起来”。它的隐含意是“improve your situation by your own efforts”，即“通过你自己的努力（而非他人帮助）来解决困难改善处境”。因此，&lt;b&gt;Bootstrap 一词就代表了“自力更生”。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;放到参数估计的上下文中，&lt;b&gt;Bootstrap 意味着我们仅仅通过使用手头上的样本数据（样本数据“自力更生”）而不对总体的分布做任何假设（比如传统方法中的正态分布假设），来计算样本统计量在估计总体统计量时的误差。&lt;/b&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;The central idea is that it may sometimes be better to draw conclusions about the characteristics of a population strictly from the sample at hand, rather than by making perhaps unrealistic assumptions about the population. -- Mooney &amp;amp; Duval, Bootstrapping, 1993&lt;/i&gt;&lt;br&gt;&lt;i&gt;译：Bootstrap 的核心思想是，通过手头的样本数据本身对总体统计量进行推论，而非基于对于总体分布做出不切实际的假设。&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;目标够伟大（样本数据自力更生），但具体要怎么做呢？&lt;b&gt;如何仅仅通过（反复的）使用手头的数据来对同样从这些数据中得到的统计量进行误差估计呢？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这里面要用到一个非常重要的技巧：&lt;b&gt;可置换的重采样（resampling with replacement）&lt;/b&gt;。在这个定义中，“可置换”是核心。什么是“可置换”呢？举个例子。假设袋子里有标号 1 到 10 的小球。我们“可置换”地不断地从袋子里随机抽出小球。第一次抽出了 3 号小球；“可置换”是说在下一次抽取之前把 3 号小球重新放回到袋子里；即在第二次抽取的时候，我们仍然有可能再次抽到 3 号小球（它和其他 9 个球被抽到的概率是一样的），这便是可置换的含义。作为对比，生活中更多的是“无置换的抽取”，比如体彩 36 中 7 或者世界杯抽签，抽出的小球都不会再放回池子中。&lt;/p&gt;&lt;p&gt;下面就来看看 Bootstrap 的原则。假设我们有如下设定：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;令  &lt;equation&gt;v&lt;/equation&gt;  代表我们感兴趣的一个总体统计量（比如均值、中位数、标准差等），它来自未知的总体分布 &lt;equation&gt;F&lt;/equation&gt; 。&lt;/li&gt;&lt;li&gt;令 &lt;equation&gt;x_1, x_2,\cdots, x_n&lt;/equation&gt; 为来自总体的一组样本数据，它们称为原始样本数据。&lt;/li&gt;&lt;li&gt;令 &lt;equation&gt;u&lt;/equation&gt; 代表从该样本中计算出的统计量。&lt;/li&gt;&lt;li&gt;以原始样本数据中的数据作为“总体”，进行可置换的重采样，得到一个重采样样本（又称为 Bootstrap 样本），记为 &lt;equation&gt;x_1^\star, x_2^\star,\cdots, x_n^\star&lt;/equation&gt; （重采样样本中的数据个数必须和原始样本数据中的数据个数相同）。&lt;/li&gt;&lt;li&gt;令 &lt;equation&gt;u^\star&lt;/equation&gt; 代表利用上述 Bootstrap 样本数据计算出来统计量。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;Bootstrap 原则指出：“Bootstrap 样本统计量 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt; &lt;b&gt;围绕原始样本统计量 &lt;/b&gt;&lt;equation&gt;u&lt;/equation&gt;&lt;b&gt; 的变化（简称为 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的变化）” 是 “原始样本统计量 &lt;/b&gt;&lt;equation&gt;u&lt;/equation&gt;&lt;b&gt; 围绕总体统计量 &lt;/b&gt; &lt;equation&gt;v&lt;/equation&gt; &lt;b&gt; 的变化（简称为 &lt;/b&gt; &lt;equation&gt;u&lt;/equation&gt; &lt;b&gt; 的变化）” 的一个很好的近似。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;为了计算 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的变化，我们只需要对原始样本数据进行大量的可置换重采样&lt;/b&gt;（为此需要使用计算机的计算能力，在没有计算机的年代，手动进行大量重采样的工作量可想而知）&lt;b&gt;，得到许多 Bootstrap 样本，并从每个样本中计算出统计量 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的一个取值，这些取值便构成 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的分布。使用 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的分布计算出 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 如何围绕 &lt;/b&gt; &lt;equation&gt;u&lt;/equation&gt; &lt;b&gt; 变化，以此来推断统计量 &lt;/b&gt; &lt;equation&gt;u&lt;/equation&gt; &lt;b&gt; 如何围绕 &lt;/b&gt; &lt;equation&gt;v&lt;/equation&gt; &lt;b&gt; 变化。显然，统计量 &lt;/b&gt; &lt;equation&gt;u&lt;/equation&gt; &lt;b&gt; 的变化与样本大小有关。因此用 &lt;/b&gt;&lt;equation&gt;u^\star&lt;/equation&gt;&lt;b&gt; 的变化作为 &lt;/b&gt;&lt;equation&gt;u&lt;/equation&gt;&lt;b&gt; 的变化的近似的前提是每个 Bootstrap 样本的大小和原始样本大小相同。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;根据 Bootstrap 原则，使用经验 Bootstrap 方法（empirical Bootstrap method）就可以计算任何总体统计量的置信区间。&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 经验 Bootstrap 方法&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;我们以计算某未知分布均值的置信区间为例说明经验 Bootstrap 方法。假设我们从某未知分布的总体中得到下面 10 个样本数据：30，37，36，43，42，48，43，46，41，42。&lt;/p&gt;&lt;p&gt;我们的问题有两个：（1）估计总体的均值（点估计），（2）计算置信水平为 80% 的 Bootstrap 置信区间。&lt;/p&gt;&lt;p&gt;第一个问题很容易回答，样本均值 40.8 就是总体均值 &lt;equation&gt;μ&lt;/equation&gt; 的点估计。对于第二个问题，由于样本点太少（仅有 10 个）且总体分布未知（无法做正态分布假设），因此我们摒弃传统的方法，而采用经验 Bootstrap 方法计算其置信区间。&lt;/p&gt;&lt;p&gt;&lt;b&gt;计算 &lt;/b&gt; &lt;equation&gt;μ&lt;/equation&gt; &lt;b&gt; 的置信区间的本质是回答这样一个问题：样本均值 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 的分布是如何围绕总体均值 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 变化的。换句话说，我们想知道 &lt;/b&gt;&lt;equation&gt;δ = \bar x - μ&lt;/equation&gt;&lt;b&gt; 的分布。&lt;/b&gt; &lt;equation&gt;δ&lt;/equation&gt; &lt;b&gt; 就是当我们使用 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 来估计 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 时的误差。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;如果我们知道  &lt;equation&gt;δ&lt;/equation&gt;  的分布，则可以找到待求置信区间左右两端的临界值。在本例中，因为我们关心的是置信水平为 80% 的置信区间，因此 &lt;equation&gt;δ&lt;/equation&gt; 的临界值是 10% 和 90% 分位对应的 &lt;equation&gt;δ_{0.9}&lt;/equation&gt; 和 &lt;equation&gt;δ_{0.1}&lt;/equation&gt; 。由此计算出 &lt;equation&gt;μ&lt;/equation&gt; 置信区间为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;[\bar x-\delta_{0.1},\bar x-\delta_{0.9}]&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;这是因为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rl} &amp;amp;\mbox{prob}(\delta_{0.9}\le\bar x-\mu\le \delta_{0.1}|\mu)=0.8\\ \Rightarrow&amp;amp;\mbox{prob}(\bar x-\delta_{0.1}\le\mu\le\bar x-\mu\le \delta_{0.9})=0.8 \end{array}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;值得一提的是，上面的概率是&lt;b&gt;条件概率&lt;/b&gt;，它表示假设总体均值为  &lt;equation&gt;μ&lt;/equation&gt;  的条件下，样本均值 &lt;equation&gt;\bar x&lt;/equation&gt; 围绕总体均值  &lt;equation&gt;μ&lt;/equation&gt;  的变化在 &lt;equation&gt;δ_{0.1}&lt;/equation&gt; 和 &lt;equation&gt;δ_{0.9}&lt;/equation&gt; 之间的概率。&lt;/p&gt;&lt;p&gt;&lt;b&gt;不幸的是，由于来自总体的样本只有一个（上面的 10 个数）且&lt;/b&gt; &lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 的真实值未知，我们并不知道 &lt;/b&gt; &lt;equation&gt;δ&lt;/equation&gt; &lt;b&gt; 的分布（因此也就不知道 &lt;/b&gt;&lt;equation&gt;δ_{0.9}&lt;/equation&gt;&lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;δ_{0.1}&lt;/equation&gt; &lt;b&gt;）。但是我们仍然利器在手，那就是 Bootstrap 原则。它指出虽然我们不知道 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 如何围绕 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 变化（即 &lt;/b&gt; &lt;equation&gt;δ&lt;/equation&gt; &lt;b&gt; 的分布），但是它可以由 &lt;/b&gt; &lt;equation&gt;\bar x^\star&lt;/equation&gt; &lt;b&gt; 如何围绕 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 变化（即 &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布）来近似&lt;/b&gt;，这里  &lt;equation&gt;δ^\star&lt;/equation&gt;  是利用 Bootstrap 样本计算的均值与原始样本均值之间的差：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\delta^\star=\bar x^\star-\bar x&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;通过进行多次有置换的重采样，得到多个 Bootstrap 样本，每一个样本中都可以计算出一个均值。使用每一个 Bootstrap 样本均值减去原始样本均值（40.8）就得到 &lt;equation&gt;δ^\star&lt;/equation&gt; 的一个取值。利用计算机，很容易产生足够多的 Bootstrap 样本，即足够多的 &lt;equation&gt;δ^\star&lt;/equation&gt; 的取值。&lt;b&gt;根据大数定理（law of large numbers），当样本个数足够多时， &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布是 &lt;/b&gt;&lt;equation&gt;\delta&lt;/equation&gt;  &lt;b&gt;的分布好的近似。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;有了 &lt;equation&gt;δ^\star&lt;/equation&gt; 的分布，就可以找到 &lt;equation&gt;δ^\star_{0.9}&lt;/equation&gt; 和 &lt;equation&gt;δ^\star_{0.1}&lt;/equation&gt; ，并用它们作为 &lt;equation&gt;δ_{0.9}&lt;/equation&gt; 和 &lt;equation&gt;δ_{0.1}&lt;/equation&gt; 的估计，从而计算出  &lt;equation&gt;μ&lt;/equation&gt;  的置信区间：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;[\bar x-\delta_{0.1}^\star,\bar x-\delta_{0.9}^\star]&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上述思路就是经验 Bootstrap 方法的强大所在。&lt;/p&gt;&lt;p&gt;回到上面这个例子中。利用计算机产生 200 个 Bootstrap 样本（下图显示了前 10 个 Bootstrap 样本，每列一个）。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e823449d59f7d107bf324fd84ce2fe75_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;344&quot; data-rawheight=&quot;229&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e823449d59f7d107bf324fd84ce2fe75&quot; data-watermark-src=&quot;v2-909ae0894cd01fe74e261154ffbeea39&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;由这 200 个 Bootstrap 样本计算出 200 个 &lt;equation&gt;δ^\star&lt;/equation&gt; ，它们的取值范围在 -4.4 到 4.0 之间， &lt;equation&gt;δ^\star&lt;/equation&gt; 的累积密度函数如下图所示。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-8297a4e17b7f6283266ca4df98003c2d_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;556&quot; data-rawheight=&quot;397&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-8297a4e17b7f6283266ca4df98003c2d&quot; data-watermark-src=&quot;v2-42d2847327494f966330a457e87805bc&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;接下来，从这 200 个 &lt;equation&gt;δ^\star&lt;/equation&gt; 中找出 &lt;equation&gt;δ^\star_{0.9}&lt;/equation&gt; 和 &lt;equation&gt;δ^\star_{0.1}&lt;/equation&gt; 。由于 &lt;equation&gt;δ^\star_{0.9}&lt;/equation&gt;&lt;b&gt; 对应的是 10% 分位数，而 &lt;/b&gt;&lt;equation&gt;δ^\star_{0.1}&lt;/equation&gt;&lt;b&gt; 对应的是 90% 分位数&lt;/b&gt;，我们将 200 个  &lt;equation&gt;δ^\star&lt;/equation&gt;  从小到大排序，其中第 20 个和第 181 个就是我们需要的数值：&lt;equation&gt;δ^\star_{0.9} = -1.9&lt;/equation&gt; 以及 &lt;equation&gt;δ^\star_{0.1} = 2.2&lt;/equation&gt; 。由于原始样本均值为 40.8，因此求出 &lt;equation&gt;\mu&lt;/equation&gt; 的 80% 的置信区间为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;[\bar x-\delta_{0.1}^\star,\bar x-\delta_{0.9}^\star]=[40.8-2.2,40.8+1.9]=[38.6,42.7]&lt;/equation&gt; &lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 Bootstrap 百分位法&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;让我们来看看另外一种方法：&lt;b&gt;Bootstrap 百分位法（Bootstrap percentile method）&lt;/b&gt;。它与经验 Bootstrap 方法的不同之处在于，&lt;b&gt;它不是用 &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布去近似 &lt;/b&gt;&lt;equation&gt;δ&lt;/equation&gt;&lt;b&gt; 的分布，而是直接使用来自 Bootstrap 样本的统计量的分布作为原始样本统计量的分布。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;让我们仍然用上一节中的例子来说明这种方法。&lt;/p&gt;&lt;p&gt;在那个例子中，我们对原始样本数据进行有置换的重采样，得到了 200 个 Bootstrap 样本。对于每个样本，计算出样本均值，因此一共有 200 个均值，它们构成了 Bootstrap 样本统计量 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的分布（下图）。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f72561aa47840574702458c8b590933a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;562&quot; data-rawheight=&quot;401&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f72561aa47840574702458c8b590933a&quot; data-watermark-src=&quot;v2-e0be40ec76423c95827e4117050240ba&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;Bootstrap 百分位法使用来自 Bootstrap 样本统计量 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的分布作为原始样本统计量 &lt;equation&gt;\bar x&lt;/equation&gt; 的分布的一个近似。因此，在这种方法下，我们只需要找到 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 分布中 10% 分位和 90% 分位对应的 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的取值，它们就构成了  &lt;equation&gt;μ&lt;/equation&gt;  的置信区间。在本例中，这两个分位对应的 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的取值分别为 38.9 和 43，因此按这种方法得到的 &lt;equation&gt;μ&lt;/equation&gt; 的置信区间为：[38.9, 43]。&lt;/p&gt;&lt;p&gt;不难发现，上述两种方法得到的置信区间并不相同。&lt;b&gt;它们是各有千秋还是说其中一个更准确呢？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;经验 Bootstrap 法和 Bootstrap 百分位法的区别如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;经验 Bootstrap 法&lt;b&gt;用 &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布去近似 &lt;/b&gt; &lt;equation&gt;δ&lt;/equation&gt; &lt;b&gt; 的分布&lt;/b&gt;；之后再把误差加到原始样本均值的两侧，该置信区间是以样本均值 &lt;equation&gt;\bar x&lt;/equation&gt; 为中心的。&lt;/li&gt;&lt;li&gt;Bootstrap 百分位法直接&lt;b&gt;用 &lt;/b&gt;&lt;equation&gt;\bar x^\star&lt;/equation&gt;&lt;b&gt; 的分布来近似 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 的分布&lt;/b&gt;（由于我们只有一个来自于总体的样本，因此我们没有 &lt;equation&gt;\bar x&lt;/equation&gt; 的分布，而这种方法说我们可以是使用  &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的分布代替）；它直接用从 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的分布找到的置信区间作为总体均值的置信区间。&lt;b&gt;这里一个很强的假设是 &lt;/b&gt; &lt;equation&gt;\bar x^\star&lt;/equation&gt; &lt;b&gt; 的分布是 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 分布的一个很好的近似。然而在现实中这是无法保证的，因此这种方法不好，它的准确性存疑。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Bootstrap 原则传达的是这样一个意思：&lt;b&gt;样本统计量 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 是以总体统计量 &lt;/b&gt;&lt;equation&gt;\mu&lt;/equation&gt;&lt;b&gt; 为中心围绕其波动；Bootstrap 样本统计量 &lt;/b&gt;&lt;equation&gt;\bar x^\star&lt;/equation&gt;&lt;b&gt; 是以原始样本统计量 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 为中心围绕其波动。如果 &lt;/b&gt; &lt;equation&gt;\bar x&lt;/equation&gt; &lt;b&gt; 和 &lt;/b&gt; &lt;equation&gt;\mu&lt;/equation&gt; &lt;b&gt; 有较大的差异，则 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;\bar x^\star&lt;/equation&gt;&lt;b&gt; 的分布也会不同（即 Bootstrap 百分位法的假设不成立）。反观 &lt;/b&gt; &lt;equation&gt;δ&lt;/equation&gt; &lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt; &lt;b&gt;，它们的分布各自描述 &lt;/b&gt; &lt;equation&gt;\bar x&lt;/equation&gt; &lt;b&gt; 如何围绕 &lt;/b&gt; &lt;equation&gt;μ&lt;/equation&gt; &lt;b&gt; 波动以及 &lt;/b&gt;&lt;equation&gt;\bar x^\star&lt;/equation&gt;&lt;b&gt; 如何围绕 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 波动。Bootstrap 原则指出即使 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;\bar x^\star&lt;/equation&gt;&lt;b&gt; 分布不同，&lt;/b&gt; &lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布仍然是 &lt;/b&gt;&lt;equation&gt;δ&lt;/equation&gt;&lt;b&gt; 的分布的一个很好的近似，因此以原始样本均值 &lt;/b&gt;&lt;equation&gt;\bar x&lt;/equation&gt;&lt;b&gt; 为中心，以 &lt;/b&gt;&lt;equation&gt;δ^\star&lt;/equation&gt;&lt;b&gt; 的分布计算出误差，最终得到的 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 的置信区间是比较准确的。由此可知，经验 Bootstrap 方法优于 Bootstrap 百分位法。在实践中，应该使用前者。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;下图概括了上文中对二者的比较。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-98220c72c2ed1426a594c7d1a83676cc_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1231&quot; data-rawheight=&quot;802&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-98220c72c2ed1426a594c7d1a83676cc&quot; data-watermark-src=&quot;v2-0b3f741713977a12b284aa5e3fd4bf18&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;5 Bootstrapped-t 方法&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;除了上面介绍的两种方法外，最后我还想再提另一种方法：&lt;b&gt;Bootstrapped-t 方法&lt;/b&gt;。&lt;/p&gt;&lt;p&gt;这种方法和第一节中介绍的传统方法十分接近。在传统方法中，基于 Normal Theory 的假设，我们只需要知道 t 统计量的临界值就可以计算均值的置信区间。&lt;b&gt;传统方法假设待估计的统计量的分布是对称的。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;然而在现实问题中，这个假设可能无法满足，所以假设对称并通过查表找出 t 统计量的临界值会有问题（因为得到的置信区间是对称的）。由此提出了 Bootstrapped-t 方法。&lt;/p&gt;&lt;p&gt;&lt;b&gt;这种方法的核心思想是将每个 Bootstrap 样本中计算的统计量转化成一个对应的 t 统计量。这样，有多少个 Bootstrap 样本我们就有多少个 Bootstrapped t 统计量。由此，可以计算出 Bootstrapped t 统计量的分布。用这个分布代替查表来找到计算置信区间时所需的 t 统计量的临界值，从而计算置信区间：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;equation&gt;[\bar x-t^\star_{\alpha/2}s_{\bar x},\bar x-t^\star_{1-\alpha/2}s_{\bar x}]&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;equation&gt;s_{\bar x}&lt;/equation&gt; 是原始样本数据的标准误。&lt;/p&gt;&lt;p&gt;以均值为例，可以通过下面的关系式将每个 Bootstrap 样本的均值转化为对应的 Bootstrapped t 统计量（注：如果研究的对象不是均值，则 Bootstrapped t 统计量会出现不存在解析式的情况）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;t_i^\star=\frac{\bar x_i^\star-\bar x}{s_i^\star/\sqrt n}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中， &lt;equation&gt;\bar x^\star_i&lt;/equation&gt; 和 &lt;equation&gt;s^\star_i&lt;/equation&gt; 分别为第 i 个 Bootstrap 样本的均值和标准差； &lt;equation&gt;n&lt;/equation&gt;  为样本大小。&lt;/p&gt;&lt;p&gt;仍以前面的例子说明这种方法如何计算 &lt;equation&gt;μ&lt;/equation&gt; 的置信区间。对于每个 Bootstrap 样本，计算其 Bootstrapped t 统计量，它们的累积密度函数为：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f231ce30dd334be660ccf5b01c5d412a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;558&quot; data-rawheight=&quot;391&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f231ce30dd334be660ccf5b01c5d412a&quot; data-watermark-src=&quot;v2-2663da6727ba045a4cddf7254f71bd21&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;通过 Bootstrapped t 统计量很容易找到临界值 -1.17 和 1.81。因此， &lt;equation&gt;μ&lt;/equation&gt; 的置信区间为：[31.82, 46.62]。这个置信区间的范围远远大于前面两种方法的置信区间。这是因为这种方法中使用了原始样本的标准差。由于在本例中，原始样本只有十个数据，因此样本的标准差太大，从而造成置信区间很宽。&lt;/p&gt;&lt;p&gt;介绍这种方法的目的是为了给读者开拓思路。在实践中，我仍然推荐使用经验 Bootstrap 方法。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;6 远远不止均值&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;到目前未知，本文的例子中均已均值作为目标统计量，这便于将不同的 Bootstrap 方法得到的置信区间进行比较。然而，Bootstrap 方法在计算置信区间时可以考虑各种传统方法无能为力的统计量。&lt;/p&gt;&lt;p&gt;下面就来看看中位数的例子。仍然以第三节中的十个数（30，37，36，43，42，48，43，46，41，42）作为来自某个未知总体的一组样本。采用经验 Bootstrap 方法，我们来计算中位数的 95% 的置信区间。&lt;/p&gt;&lt;p&gt;使用之前用到的 200 个 Bootstrap 样本，可以得到中位数误差的临界值。由于考虑的是 95% 的置信区间，因此临界值为 2.5% 和 97.5% 分位对应的误差：-5.0 和 2.5。从原始数据易知，样本的中位数是 42。因此，中位数的 95% 的置信区间为：[39.5, 47]。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;7 Bootstrap 与量化投资&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文介绍了如何使用 Bootstrap 技术计算参数估计的误差。Bootstrap 方法对总体分布不做假设，且可以被应用于我们感兴趣的各种统计量，这些特点使得它非常强大。当然，需要说明的是 &lt;b&gt;Bootstrap 中的重采样并不能够帮助我们改进点估计（point estimate）&lt;/b&gt;。以均值为例，原始样本均值 &lt;equation&gt;\bar x&lt;/equation&gt; 就是总体均值 &lt;equation&gt;μ&lt;/equation&gt; 的点估计。我们使用重采样得到很多 Bootstrap 样本，并且得到很多 Bootstrap 样本均值 &lt;equation&gt;\bar x^\star&lt;/equation&gt; ，则这些 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的平均值将会非常接近 &lt;equation&gt;\bar x&lt;/equation&gt; （事实上，可以证明 &lt;equation&gt;\mbox{E}[\bar x^\star]&lt;/equation&gt; —— &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的期望 —— 就是 &lt;equation&gt;\bar x&lt;/equation&gt; ）。换句话说，对于点估计，Bootstrap 样本均值并不能比 &lt;equation&gt;\bar x&lt;/equation&gt; 提供任何新的信息。但是，这些 &lt;equation&gt;\bar x^\star&lt;/equation&gt; 的取值对于估计 &lt;equation&gt;\bar x&lt;/equation&gt; 如何围绕 &lt;equation&gt;μ&lt;/equation&gt; 变化非常有效，这便是我们在全文中反复强调的 Bootstrap 的核心。&lt;/p&gt;&lt;p&gt;在量化投资领域，Bootstrap 也有广泛的应用。例如，Bootstrap 可以用来对参数估计的偏差进行修正，比如投资品收益率之间的相关系数。投资品的历史收益率数据就是我们仅有的样本，通过重采样并利用经验 Bootstrap 方法，可以求出各种统计量的估计误差，这无疑有助于我们更好的构建投资策略，进行风险防控。又比如，简单的分类算法（比如分类树）可以用来进行选股，但是它对样本数据比较敏感，预测的方差较大。在这方面可以采用 Bootstrap 技巧作为元算法技术用于一般分类算法（比如结合 Bootstrap 和分类树得到的装袋算法），这可以明显地降低分类算法的方差，从而提高预测的准确性。在多因子模型中，Barra 在协方差矩阵的 Eigenfactor 调整时也用到了 Bootstrap 思想。&lt;/p&gt;&lt;p&gt;最后，本文介绍的几种方法都属于无参数 Bootstrap 方法，即对总体分布不做任何假设。在一些应用中，如果能够明确总体分布的类型，也可以使用 Bootstrap 方法进行参数估计，这称之为参数化 Bootstrap 方法。比如，我们已知总体分布满足指数分布，但是不知道其参数  &lt;equation&gt;λ&lt;/equation&gt; 。这时，可以利用参数化 Bootstrap 方法计算出 Bootstrap 样本中 &lt;equation&gt;λ^\star&lt;/equation&gt; 的误差的分布，用它来估计 λ 的置信区间。由于空间有限，本文不再展开介绍。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com/&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-08-02-41099219</guid>
<pubDate>Thu, 02 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>股票多因子模型的回归检验</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-07-31-40984029.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/40984029&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-09635d94e6ca4c3b37e36bad9f79f0ef_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;摘要&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;收益率均值和因子暴露在截面上的关系就是多因子模型研究的问题。本文讨论一些平时在使用多因子模型时遇到的常见问题，如截面回归 vs 时序回归、使用 portfolio returns 和宏观经济指标作为因子有什么不同、以及因子暴露应该如何确定等。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0 引言&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文的题目是股票多因子模型的回归检验。说它重要，是因为在多因子模型被用于资产定价（选股）越来越普及的今天，&lt;b&gt;很多人不一定搞清楚了多因子模型中常见的时间序列回归、截面回归之间到底有什么区别，以及它们在本质上又是何其相似；不一定搞清楚在使用多因子模型给资产定价时，需要关注的 statistical tests 目标到底是什么；不一定搞清楚在回归残差存在时序或截面相关性时，模型参数的 standard errors 可能完全是不准确的以至于给出错误的推断……&lt;/b&gt;&lt;/p&gt;&lt;p&gt;本文旨在讨论一些平时在使用多因子模型时可能遇到的各种困惑（比如什么时候用截面回归、什么时候用时序回归；使用 portfolio returns 作为因子和其他比如宏观经济指标作为因子有什么不同等）。由于篇幅有限，我会把写作重点放在对核心概念的解读上。此外，在本文中还会涉及对 Barra 模型的一些思考。&lt;/p&gt;&lt;p&gt;文章的最后一节将会安利写作时使用的主要参考文献（下文中对于时序和截面回归的讲解、以及对 Fama-MacBeth 回归的说明来自 John Cochrane 的经典教材 Asset Pricing 以及他在芝加哥大学的同名网上课程的相关部分），感兴趣的小伙伴在阅读本文后可以进一步参考。&lt;/p&gt;&lt;p&gt;最后一个小建议：请在一个能静下心来思考的心境下和环境中阅读此文。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 多因子模型的回归测试&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;多因子模型是 Asset Pricing（资产定价）的一种常见方法&lt;/b&gt;（其他的方法还包括 consumption-based model 等）。一个多因子模型（假设 K 个因子）的表达式如下：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mbox{E}[R_i]=\beta_i&#39;\lambda,~~i=1,2,\cdots,N&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;equation&gt;R_i&lt;/equation&gt; 代表股票 i 的超额收益； &lt;equation&gt;β_i&lt;/equation&gt; 为股票 i 的 K × 1 阶因子暴露（factor exposure，也称因子载荷 factor loading）向量； &lt;equation&gt;λ&lt;/equation&gt; 为 K × 1 阶因子收益率均值向量； &lt;equation&gt;\mbox{E}[.]&lt;/equation&gt; 为数学求期望公式。&lt;/p&gt;&lt;p&gt;&lt;b&gt;多因子模型研究的核心问题是股票的（超额）收益率期望在截面上（即不同的股票之间）为什么会有差异&lt;/b&gt; —— 根据模型，如果一支股票在因子上的暴露（ &lt;equation&gt;β_i&lt;/equation&gt; ）高，则它的期望收益（ &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; ）也应该更高。&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;The central economic question is why&lt;/i&gt; &lt;b&gt;&lt;i&gt;average returns&lt;/i&gt;&lt;/b&gt; &lt;i&gt;vary&lt;/i&gt; &lt;i&gt;&lt;b&gt;across&lt;/b&gt;&lt;/i&gt; &lt;i&gt;assets;&lt;/i&gt; &lt;i&gt;&lt;b&gt;expected returns&lt;/b&gt;&lt;/i&gt; &lt;i&gt;of an asset should be high if that asset has high&lt;/i&gt; &lt;b&gt;&lt;i&gt;betas&lt;/i&gt;&lt;/b&gt; &lt;i&gt;or&lt;/i&gt; &lt;i&gt;&lt;b&gt;risk exposure to factors&lt;/b&gt;that carry high risk premia.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;虽然本文才刚开始，不过让我们停一停，take a break。我想再强调一下上面这句话：&lt;b&gt;多因子模型研究的是个股收益率均值在截面上（cross-sectional）的差异。我们不关心个股的收益率 &lt;/b&gt;&lt;equation&gt;R_i&lt;/equation&gt;&lt;b&gt; 在时间序列上是如何随着每期因子收益率来波动的（这是 model of variance），我们只关心&lt;/b&gt; &lt;equation&gt;R_i&lt;/equation&gt;&lt;b&gt; 的期望&lt;/b&gt; &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt;&lt;b&gt; 在截面上和对应的 &lt;/b&gt;&lt;equation&gt;β_i&lt;/equation&gt;&lt;b&gt; 之间的关系（这是 model of the mean）。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们选择的因子代表了收益率的一种结构。一旦结构给定后，个股（或者任何一个投资组合）的预期收益率就完全由它在这些因子上的暴露决定了 —— 暴露高，预期收益率就高；预期收益率是因子暴露的线性函数。&lt;b&gt;怎样找到最好的因子结构 —— 即哪些因子使得个股在截面上的预期收益率区分度高 —— 就是因子模型研究的问题。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;仍然晦涩？用下面这个图解释一下（因为要做图，所以假设单因子，比如 CAPM 模型）。下图中横坐标为 &lt;equation&gt;β_i&lt;/equation&gt; ，纵坐标为 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; ，每个点代表一支股票。根据因子模型，每个股票的预期收益率 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; 成正比。图中这条直线就代表 &lt;equation&gt;\mbox{E}[R_i] = β_i × λ&lt;/equation&gt; ，它的斜率 λ 就是因子的预期收益。由于所有的股票收益率都仅仅是样本数据，因此即便 &lt;equation&gt;\mbox{E}[R_i] = β_i × λ&lt;/equation&gt; 完美满足，在每个样本内， &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i × λ&lt;/equation&gt; 之间也有残差，正如图中的 &lt;equation&gt;α_i&lt;/equation&gt;  所示。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-ff198705b11cc4503682a99d70ecabe3_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;843&quot; data-rawheight=&quot;560&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ff198705b11cc4503682a99d70ecabe3&quot; data-watermark-src=&quot;v2-b5bc747bd419da76ec278fe3d6a95af1&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;因为一共有 N 支股票，因此这张图中的直线反映的是 N 个 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 N 个对应的 &lt;equation&gt;β_i&lt;/equation&gt; 在截面上的关系 —— 正如前文反复强调的，&lt;b&gt;多因子模型反映的是收益率均值和因子暴露在截面上的关系。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们最熟悉的因子模型无疑是 CAPM，它因为只有一个市场因子所以是多因子模型的一个特例。人们最早的猜测是市场因子的收益率和个股在该因子上的 &lt;equation&gt;β&lt;/equation&gt; 就可以解释截面上不同股票收益率之间的区别。但大量的实证结果显示如果我们把个股的 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和它们针对市场因子的 &lt;equation&gt;\beta_i&lt;/equation&gt; 画出来，则实际的斜率较模型的结果来说太小了，说明仅仅用单一市场因子无法很好的解释 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 在截面上的差别。&lt;/p&gt;&lt;p&gt;这之后，Black、Jensen 以及 Scholes 提出了 Black CAPM，它在 CAPM 的基础上又加入了一个因子，使得这个双因子模型更好的解释 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 在截面上的差别。再后来，Fama 和 French 提出了大名鼎鼎的三因子模型，它在市场因子的基础上加入 HML 和 SMB 两个因子。这些努力都是为了能够更好的解释我们在股票收益率数据中观察到的 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 在截面上的差别。&lt;/p&gt;&lt;p&gt;拿来一个多因子模型，应该怎么定量的评估它能否很好的解释 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 呢？我们应该关注三点：&lt;b&gt;Estimate（估计）&lt;/b&gt;、&lt;b&gt;Standard Errors（标准误）&lt;/b&gt;、以及 &lt;b&gt;Test（检验）&lt;/b&gt;，见下表。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-948d9b32252c6e8cf348ee836a4ed0bf_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;631&quot; data-rawheight=&quot;141&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-948d9b32252c6e8cf348ee836a4ed0bf&quot; data-watermark-src=&quot;v2-a61954b81831e85e83ae8909c4aa505c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;对于截面关系式 &lt;equation&gt;\mbox{E}[R_i] = β_i&#39;λ + α_i&lt;/equation&gt; ，我们使用回归分析（既可以通过时序回归、也可以是截面回归，后面会具体讲）确定参数 &lt;equation&gt;α&lt;/equation&gt; 、 &lt;equation&gt;β&lt;/equation&gt; 、 &lt;equation&gt;λ&lt;/equation&gt; 的估计值和标准误。&lt;b&gt;只有有了准确的（无偏且相合）估计值和正确的标准误，才能评价因子是否有效&lt;/b&gt;（比如正确计算因子收益率 λ 的置信区间，从而判断这个因子是否有风险溢价）。下文会谈到，由于残差  &lt;equation&gt;α&lt;/equation&gt;  在截面以及时序（特别是截面）上有相关性，因此在标准误的计算上必须格外小心。&lt;/p&gt;&lt;p&gt;在上述截面关系式中， &lt;equation&gt;α_i&lt;/equation&gt; 代表了个股 i 的&lt;b&gt;定价错误（pricing error）&lt;/b&gt;。如果我们能够在统计上证明所有股票的 &lt;equation&gt;α_i&lt;/equation&gt; 都很接近零，那么这个多因子模型就是很好的模型 —— 这些因子能够较好的解释个股截面预期收益率的差别。因此，多因子模型的回归检验中的重中之重、也是&lt;b&gt;我们唯一关注的 test，就是所有这些 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt; 联合起来是否在统计上足够接近零。&lt;/b&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;We want to know whether all the pricing errors are&lt;/i&gt; &lt;i&gt;&lt;b&gt;jointly&lt;/b&gt;&lt;/i&gt; &lt;i&gt;equal to zero.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;根据上述说明，多因子模型的回归检验可以简单总结成以下几点：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;挑选因子，计算个股在这些因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; ；&lt;/li&gt;&lt;li&gt;找到个股（超额）收益率均值 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和因子暴露 &lt;equation&gt;β_i&lt;/equation&gt; 在截面上的关系；&lt;/li&gt;&lt;li&gt;计算每个个股的定价错误 &lt;equation&gt;α_i&lt;/equation&gt; ，联合检验这些 &lt;equation&gt;α_i&lt;/equation&gt; 是否在统计上为零。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;无论我们用什么因子（基本面因子、宏观经济因子、技术面因子）；无论在确定截面关系时我们采用时序回归还是截面回归；对多因子模型的最终评判都转化成一个核心问题 —— 这些 &lt;equation&gt;α_i&lt;/equation&gt; 联合起来是否在统计上为零。&lt;/p&gt;&lt;p&gt;下面先来看看如何通过时间序列回归找到截面关系。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 时间序列回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;如果模型中的&lt;b&gt;因子是 portfolio returns（即使用投资组合收益率作为因子）&lt;/b&gt;，那么可以通过&lt;b&gt;时间序列回归（time-series regression）&lt;/b&gt;来分析 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; 在截面上的关系。&lt;/p&gt;&lt;p&gt;例如，Fama and French (1993) 提出了影响深远的三因子模型，它里面的三个因子，即市场、HML、SMB 都是投资组合的收益率。其中 HML 和 SMB 是通过 BP 和市值将股票排序然后做多一部分并同时做空一部分来构建的投资组合。以 HML 为例，它代表着 high book-to-market ratio 公司相对于 low book-to-market ratio 公司的超额收益。该因子叫做 HML 因子而非 BP 因子，其意义也是强调因子本身是一个投资组合的收益率，而非 BP。Fama 和 French 用这三个投资组合的收益率来解释个股或者其他投资组合在截面上的收益率。顺便提一句，关于三因子模型的重要性以及其作用，Fama and French (1996) 给出了非常详尽的解读，非常值得一读。&lt;/p&gt;&lt;p&gt;令 &lt;equation&gt;f_t&lt;/equation&gt; 表示 t 期因子向量（不同投资组合的收益率）；使用 &lt;equation&gt;f_t&lt;/equation&gt; 对每支个股 i 的收益率 &lt;equation&gt;R_{it}&lt;/equation&gt; 做时间序列回归：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;R_{it}=\alpha_i+\beta_i&#39;f_t+\varepsilon_{it},~~t=1,2,\cdots,T,\forall i&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上述时间序列回归中，回归方程右侧的 regressors 是因子收益率 &lt;equation&gt;f_t&lt;/equation&gt; ，左侧的变量是 &lt;equation&gt;R_{it}&lt;/equation&gt; ，回归得到的系数是个股 i 在因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; ，截距 &lt;equation&gt;α_i&lt;/equation&gt; ，以及随机的残差 &lt;equation&gt;ε_{it}&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;将上述时间序列回归结果在时序上取均值可得（下式中 &lt;equation&gt;\mbox{E}_T[.]&lt;/equation&gt; 中下标 T 表示在时序上取均值）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mbox{E}_T[R_i]=\alpha_i+\beta_i&#39;\mbox{E}_T[f_t]&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上式正是个股期望收益率和因子暴露在截面上的关系式。&lt;b&gt;当因子本身是投资组合时，我们只需要在时序上做回归得到因子暴露和截距。虽然只做了时序回归，但是通过在时序上取均值就可以从时序回归中得出 &lt;/b&gt;&lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt;&lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;β_i&lt;/equation&gt;&lt;b&gt; 在截面上的关系。&lt;/b&gt;比较上面两个关系式不难发现，&lt;b&gt;时间序列回归中的截距 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt; 恰恰就是截面关系式中的个股 i 的定价错误。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Black, Jensen and Scholes (1972) 基于如上的论述给出了时序回归法中求解因子预期收益率的简单方法 —— &lt;b&gt;因子收益率 &lt;/b&gt;&lt;equation&gt;f_t&lt;/equation&gt;&lt;b&gt; 在时序上的均值就是因子的预期收益率&lt;/b&gt;：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\lambda=\mbox{E}_T [f]&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;下面仍然以单因子这种最简单的情况来画图看看通过上述时间序列回归得到的预期收益率和 &lt;equation&gt;β_i&lt;/equation&gt; 的截面关系长什么样子。图中的红色直线为 &lt;equation&gt;\mbox{E}[R_i] = β_i\mbox{E}[f]&lt;/equation&gt; ，当 &lt;equation&gt;β_i = 0&lt;/equation&gt; 时， &lt;equation&gt;\mbox{E}[R_i] = 0&lt;/equation&gt; ；此外，如果我们用给因子模型解释因子投资组合自己，由于因子组合的 &lt;equation&gt;β_i = 1&lt;/equation&gt; ，因此有 &lt;equation&gt;\mbox{E}[R_i] = \mbox{E}[f]&lt;/equation&gt; 。以上论述说明&lt;b&gt;时间序列回归得到的 &lt;/b&gt;&lt;equation&gt;\mbox{E}[R_i] = β_i\mbox{E}[f]&lt;/equation&gt;&lt;b&gt; 这条直线一定会经过 &lt;/b&gt;&lt;equation&gt;(0, 0)&lt;/equation&gt;&lt;b&gt; 和 &lt;/b&gt;&lt;equation&gt;(1, \mbox{E}[f])&lt;/equation&gt;&lt;b&gt; 两点。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-34bfd67122b564e477749349bb0b4b29_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;902&quot; data-rawheight=&quot;601&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-34bfd67122b564e477749349bb0b4b29&quot; data-watermark-src=&quot;v2-e28811ada931b2d8d19db7f58060e35b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;图中所有蓝黑色的点代表着个股；红色的点代表着因子投资组合。时间回归再按时间求均值而得到的因子模型 &lt;equation&gt;\mbox{E}[R_i] = β_i\mbox{E}[f]&lt;/equation&gt; 就是经过原点和红点的那条红色直线。&lt;b&gt;所有蓝黑色点（个股）到这条红线的距离就是个股的定价错误 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt;，这条时序回归得到的直线并不是以最小化 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt; 的平方和为目的求出的，这是时序回归和下一节要介绍的截面回归的最大差别（截面回归是以最小化 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt; 的平方和为目标的）。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;得到了回归模型的参数，下一步就是计算各种参数的标准误、以及检验我们唯一关注的问题：所有股票的错误定价 &lt;equation&gt;α_i&lt;/equation&gt; 联合起来是否在统计上为零。&lt;/p&gt;&lt;p&gt;在时间序列回归残差 &lt;equation&gt;ε_{it}&lt;/equation&gt; 不相关且方差相同（homoskedastic）时，时序回归参数的标准误可以由 OLS（ordinary least square）的标准公式给出。此外，如果 &lt;equation&gt;ε_{it}&lt;/equation&gt; 满足 IID Normal，Gibbons, Ross and Shanken (1989) 给出了 &lt;equation&gt;α_i&lt;/equation&gt; 的检验统计量（又称为 GRS test statistic）：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-b534aeb88f09c16b02c7d3ca1abc75c0_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;649&quot; data-rawheight=&quot;267&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-b534aeb88f09c16b02c7d3ca1abc75c0&quot; data-watermark-src=&quot;v2-9c3f199f0065f035be62e71b5c922473&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;然而，一旦 &lt;equation&gt;ε_{it}&lt;/equation&gt; 之间存在相关性或者异方差性，传统 OLS 的标准误公式就是错误的，且上述 &lt;equation&gt;α_i&lt;/equation&gt; 的检验统计量也是有问题的。在这种情况下，就要请出大杀器 Generalized Method of Momentums（GMM）。它由 Lars Peter Hansen 于 1982 年提出（Hansen 1982），GMM 可以解决 OLS 中残差的相关性和异方差性的问题，得到准确的估计以及标准误。GMM 是 Hansen 于 2013 获得诺贝尔经济学奖的原因之一，足见其在计量经济学中的重要性。具体如何使用 GMM 超出本文的范畴，感兴趣的读者可以参考本文最后一节安利的参考文献。&lt;/p&gt;&lt;p&gt;以上就是通过时间序列回归得到多因子模型的过程。最重要的三点总结如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;因子必须是 portfolio returns，才可只进行时间序列回归而无需进一步的截面回归；时序回归得到了投资品在这些因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; ；时序回归中得到的 &lt;equation&gt;α_i&lt;/equation&gt; （截距项）就是截面关系上个股的定价错误。&lt;/li&gt;&lt;li&gt;将时序回归结果在时间上取均值，就得到个股收益率和因子暴露在截面上的关系。该关系的确定不以最小化 &lt;equation&gt;α_i&lt;/equation&gt; 的平方和为目标。&lt;/li&gt;&lt;li&gt;在时序回归残差 &lt;equation&gt;ε_{it}&lt;/equation&gt; 满足 IID Normal 的条件下，可以通过 GRS test 来检验 &lt;equation&gt;α_i&lt;/equation&gt; ；否则可以通过 GMM 来检验 &lt;equation&gt;α_i&lt;/equation&gt; 。&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;&lt;b&gt;3 截面回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;下面来看看&lt;b&gt;截面回归（cross-sectional regression）&lt;/b&gt;。&lt;b&gt;截面回归的最大好处是，因子可以不是 portfolio returns。&lt;/b&gt;比如因子可以是 GDP、CPI、利率这些宏观经济指标。显然，它们的因子取值不是收益率，因子收益率需要通过截面回归得到。但是在那之前，我们必须先通过时间序列回归得到个股在不同因子上的暴露。&lt;b&gt;因此，截面回归的第一步仍然是时序回归，以确定因子暴露。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;有的小伙伴可能会问，那些因子取值（比如 GDP 的取值、CPI 的取值）不能直接当作 &lt;equation&gt;β_i&lt;/equation&gt; 吗？答案是否定的。首先这没有意义，因为时序上我们关注的是这些因子的变化对个股收益率变化的解释程度（model of variance），这由个股收益率对这些因子的&lt;b&gt;敏感程度&lt;/b&gt;，即时序回归的系数 &lt;equation&gt;β_i&lt;/equation&gt; ，而非因子本身的大小决定。第二，行业不同、基本面存在差异的公司受宏观经济的影响也不同，因此它们在同样宏观经济指标上的暴露势必不同。&lt;/p&gt;&lt;p&gt;一般的，假设因子不是 portfolio returns，首先进行时序回归确定 &lt;equation&gt;β_i&lt;/equation&gt; ：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;R_{it}=a_i+\beta_i&#39;f_t+\varepsilon_{it},~~t=1,2,\cdots,T,\forall i&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;上式和前一节时序回归中的表达式几乎一样，唯一的例外是这里的截距项我特意用了 &lt;equation&gt;a_i&lt;/equation&gt; ，而非 &lt;equation&gt;α_i&lt;/equation&gt; ，这是因为如果因子本身不是投资组合收益率，则该截距并不是稍后我们通过截面回归得到的个股的定价错误。&lt;/p&gt;&lt;p&gt;得到 &lt;equation&gt;β_i&lt;/equation&gt; 后，进行第二步 —— &lt;b&gt;截面回归，从而确定每个因子的预期收益率。&lt;/b&gt;在截面回归时，回归表达式的右侧 regressors 是 &lt;equation&gt;\beta_i&lt;/equation&gt; ，左侧是个股的预期收益率（即在整个 T 期的收益率均值） &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 。因此，截面回归的表达式为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\mbox{E}[R_i]=\beta_i&#39;\lambda+\alpha_i,~~i=1,2,\cdots,N&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;回归的目标是找到因子预期收益率 &lt;equation&gt; λ&lt;/equation&gt;，和代表股票定价错误的残差 &lt;equation&gt;α_i&lt;/equation&gt; 。仍以单因子为例说明通过截面回归得到的个股收益率均值和因子暴露的关系（下图）。假设在截面回归时采用 OLS。此外，定价理论暗示除 &lt;equation&gt;α_i&lt;/equation&gt; 之外，截面收益率均值应该仅由 &lt;equation&gt;β_i&lt;/equation&gt; 决定，因此&lt;b&gt;一般来说截面回归没有截距项&lt;/b&gt;（当然我们也可以加上）。在这样的假定下，&lt;b&gt;截面回归 OLS 将通过原点并最小化所有个股残差 &lt;/b&gt;&lt;equation&gt;α_i&lt;/equation&gt;&lt;b&gt; 的平方和。&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-8ab17ffc699c7400700e4238a1d7ee3d_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;843&quot; data-rawheight=&quot;606&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-8ab17ffc699c7400700e4238a1d7ee3d&quot; data-watermark-src=&quot;v2-3ecd8033bc7df8d764a49565d85f3970&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;当残差 &lt;equation&gt;α_i&lt;/equation&gt; 满足 IID 时，回归测试的 estimate、standard errors、以及我们关注的 &lt;equation&gt;α_i&lt;/equation&gt; 的检验分别为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \beta&amp;amp;\equiv&amp;amp;[\beta_1,\beta_2,\cdots,\beta_N]&#39;\\ \varepsilon_t&amp;amp;\equiv&amp;amp;[\varepsilon_{1t},\varepsilon_{2t},\cdots,\varepsilon_{Nt}]&#39;\\ \mbox{E}[R]&amp;amp;\equiv&amp;amp;[\mbox{E}[R_1],\mbox{E}[R_2],\cdots,\mbox{E}[R_N]]&#39;\\ \alpha&amp;amp;\equiv&amp;amp;[\alpha_1,\alpha_2,\cdots,\alpha_3]&#39;\\\\ \hat\lambda&amp;amp;=&amp;amp;(\beta&#39;\beta)^{-1}\beta&#39;\mbox{E}[R]\\ \hat\alpha&amp;amp;=&amp;amp;\mbox{E}[R]-\beta&#39;\hat\lambda\\ \Sigma&amp;amp;=&amp;amp;\mbox{E}[\varepsilon\varepsilon&#39;]\\ \sigma^2(\lambda)&amp;amp;=&amp;amp;\displaystyle\frac{1}{T}(\beta&#39;\beta)^{-1}\beta&#39;\Sigma\beta(\beta&#39;\beta)^{-1}\\ \mbox{cov}(\hat\alpha)&amp;amp;=&amp;amp;\displaystyle\frac{1}{T}\left(I-\beta(\beta&#39;\beta)^{-1}\beta&#39;\right)\Sigma\left(I-\beta(\beta&#39;\beta)^{-1}\beta&#39;\right)\\ \hat\alpha&#39;\mbox{cov}(\alpha)^{-1}\hat\alpha&amp;amp;\sim&amp;amp;\chi^2_{N-K} \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;虽然上面给出了 OLS 截面回归下各种关注变量的表达式，但不幸的是，这并没有太多用。这是因为在&lt;b&gt;截面上个股的残差存在明显的相关性。&lt;/b&gt;这种相关性虽然不会影响 OLS 的估计，但是会使 OLS 给出的标准误存在巨大的误差（低估）。为此，可以使用 &lt;b&gt;GLS（generalized least squares）&lt;/b&gt;取代 OLS。GLS 考虑了残差的协方差因此可以得到准确的标准误。&lt;b&gt;但是，由于必须估计残差的协方差矩阵，在现实中使用 GLS 存在巨大的障碍。&lt;/b&gt;如果有上千支股票，那么协方差矩阵中有太多的参数需要估计，不切实际。&lt;/p&gt;&lt;p&gt;怎么办呢？再次请出大杀器 —— GMM，它可以轻松的求出我们需要的各种量（Hansen 功不可没啊）。另外值得一提的是，在截面回归时用到的 &lt;equation&gt;β_i&lt;/equation&gt; 并不是已知、真实的，而是从时间序列回归得出的估计值，它们称为 generated regressors，存在误差。Shanken (1992) 给出了解决该问题的修正方法，称为 Shanken correction。利用 Shanken correction 和 GMM，就可以检验 &lt;equation&gt;α_i&lt;/equation&gt; 是否为零了。&lt;/p&gt;&lt;p&gt;好了，又到了我们小结的时候了：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;截面回归不要求因子是 portfolio returns，应用更加广泛（当然因子也可以是 portfolio returns）。但是截面回归的第一步仍然是通过时间序列回归得到投资品在因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; 。第二步才是截面回归。因此截面回归又称为 two-pass regression estimate。&lt;/li&gt;&lt;li&gt;得到 &lt;equation&gt;β_i&lt;/equation&gt; 后，使用个股的平均收益率 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; 进行截面回归（一共 N 个点，每个点对应一对儿 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; ），回归得到因子的期望收益率 &lt;equation&gt;λ&lt;/equation&gt; 和个股的残差 &lt;equation&gt;α_i&lt;/equation&gt; 。常见的回归方法是 OLS —— 以最小化残差平方和为目标，或 GLS —— 考虑残差之间的相关性。&lt;/li&gt;&lt;li&gt;由于 &lt;equation&gt;β_i&lt;/equation&gt; 是估计值，且 &lt;equation&gt;α_i&lt;/equation&gt; 的协方差矩阵难以估计，更方便的办法是使用大杀器 GMM 得到准确的估计以及检验 &lt;equation&gt;α_i&lt;/equation&gt; 是否为零。&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;&lt;b&gt;4 时序回归 vs 截面回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;前面两节分别介绍了时序回归和截面回归。有意思的一点是，当因子是投资组合收益率时，我们既可以使用时序回归又可以使用截面回归。那么它们二者的区别是什么呢？&lt;/p&gt;&lt;p&gt;下图以单因子为例，直观的比较了二者的区别。在时序回归中，我们仅仅在时序上对每支个股做一次回归，然后通过在在时序上取均值（ &lt;equation&gt;\mbox{E}_T[.]&lt;/equation&gt; ）来得到隐含的截面关系，因此时序回归的 &lt;equation&gt;\mbox{E}[R_i] = β_iλ&lt;/equation&gt; 必然经过原点和作为因子投资组合的平均收益率所对应的点 &lt;equation&gt;(1, \mbox{E}_T[f])&lt;/equation&gt; 。反观截面回归，它利用时序回归得到的 &lt;equation&gt;β_i&lt;/equation&gt; 和股票在时序上的均值 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 进行了第二次回归。以 OLS 为例，这个截面回归将要最小化所有个股残差 &lt;equation&gt;α_i&lt;/equation&gt; 的平方和。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-7ca37ec31b9789e5c7bbe080a401a385_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1049&quot; data-rawheight=&quot;608&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-7ca37ec31b9789e5c7bbe080a401a385&quot; data-watermark-src=&quot;v2-926395f1d47d853adff031258d1d805d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;和时序回归得到的最终 &lt;/b&gt;&lt;equation&gt;\mbox{E}[R_i] = β_iλ&lt;/equation&gt;&lt;b&gt; 关系式相比，截面回归利用了所有个股的数据。从某种意义上来说，这更合理。对于时序回归，因子的平均收益率就是该因子组合在 T 期收益率上的均值：&lt;/b&gt; &lt;equation&gt;λ = \mbox{E}_T[f]&lt;/equation&gt; &lt;b&gt;。而对于截面回归来说，因子收益率通过 OLS 或 GLS 确定，取值和 &lt;/b&gt;&lt;equation&gt;\mbox{E}_T[f]&lt;/equation&gt;&lt;b&gt; 不同。这是二者最大的区别。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;此外，当多个因子同时进行截面回归时，根据 Barra 纯因子模型的理论，得到的因子收益率是纯因子组合的收益率 —— 即截面回归后得到的因子组合中个股的权重与最初构建因子时使用的个股权重会有所不同。纯因子组合较其他因子组合有一定的优势，这有助于更好的评判因子的风险溢价。&lt;/p&gt;&lt;p&gt;时序回归和截面回归有时也被同时使用来检验模型（选择的因子）是否有意义。考虑下面这个例子。假如我们选了一个因子， &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; 在截面上的关系如图中那些蓝黑色圆点表示。如果我们进行时序回归（图中红线），会得到一个正的因子预期收益率；而如果我们进行带有截距项 &lt;equation&gt;γ&lt;/equation&gt; 的截面回归，即 &lt;equation&gt;\mbox{E}[R_i] = γ + β_iλ + α_i&lt;/equation&gt; ，则会得到完全不同的结果（图中蓝线）：负的因子预期收益率。两个模型的背离说明因子的选择有问题，需要进一步考察。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9210882b26a1c1e7324b5c43cc517912_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;972&quot; data-rawheight=&quot;606&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9210882b26a1c1e7324b5c43cc517912&quot; data-watermark-src=&quot;v2-9e87d5d585d64c6084895f5c823cbfea&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;5 Fama-MacBeth 回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;1973 年，Fama 和 MacBeth 提出了 Fama-MacBeth Regression（Fama and MacBeth 1973），目的是为了检验 CAPM。Fama-MacBeth 也是一个&lt;b&gt;两步截面回归检验方法&lt;/b&gt;；&lt;b&gt;它非常巧妙排除了残差在截面上的相关性对标准误的影响&lt;/b&gt;，在业界被广泛使用。这篇文章也是计量经济学领域被引用量最高的文章之一。&lt;/p&gt;&lt;p&gt;Fama-MacBeth 回归的第一步仍然是通过时间序列回归得到个股收益率在因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; ，这一步和本文第三节截面回归中的第一步一致。&lt;/p&gt;&lt;p&gt;在第二步截面回归中，&lt;b&gt;Fama-MacBeth 在每个时间 t&lt;/b&gt; &lt;b&gt;上进行了一次截面回归，&lt;/b&gt;这是 Fama-MachBeth 和上面的截面回归最大的不同：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;R_{it}=\beta_i&#39;\lambda_t+\alpha_{it},~~i=1,2,\cdots,N~\mbox{for each}~t&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;比较一下上式和本文第三节截面回归中的表达式。在一般的截面回归中，我们首先在时序上对 &lt;equation&gt;R_{it}, t = 1, 2,…,T&lt;/equation&gt; 取均值，得到个股的平均收益率 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 。之后用 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 和 &lt;equation&gt;β_i, i = 1, 2, …, N&lt;/equation&gt; 在截面上做回归，因此这里只做了一次截面回归。&lt;/p&gt;&lt;p&gt;而 Fama-MacBeth 截面回归时在每个 t 做一次独立的截面回归（如果有 T = 500 期数据，这就意味着进行 500 次截面回归），然后把这 T 次截面回归得到的参数取均值作为回归的 estimate：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \hat\lambda&amp;amp;=&amp;amp;\displaystyle\frac{1}{T}\sum_{t=1}^T\hat\lambda_t\\ \hat\alpha_i&amp;amp;=&amp;amp;\displaystyle\frac{1}{T}\sum_{t=1}^T\hat\alpha_{it} \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;&lt;b&gt;上述方法的巧妙之处在于它把 T 期的回归结果当作 T 个独立的样本。&lt;/b&gt;参数的 standard errors 刻画的是样本统计量在不同样本间是如何变化的。在传统的截面回归中，我们只进行一次回归，得到  &lt;equation&gt;λ&lt;/equation&gt;  和  &lt;equation&gt;α&lt;/equation&gt;  的一个样本估计。而在 Fama-MacBeth 截面回归中，我们把T期样本点独立处理，得到 T 个 &lt;equation&gt;λ&lt;/equation&gt; 和 &lt;equation&gt;α&lt;/equation&gt; 的样本估计。由此便能很容易且正确的求出 &lt;equation&gt;λ&lt;/equation&gt; 和  &lt;equation&gt;α&lt;/equation&gt;  的标准误：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \sigma^2(\hat\lambda)&amp;amp;=&amp;amp;\displaystyle\frac{1}{T^2}\sum_{t=1}^T\left(\hat\lambda_t-\hat\lambda\right)^2\\ \sigma^2(\hat\alpha_i)&amp;amp;=&amp;amp;\displaystyle\frac{1}{T^2}\sum_{t=1}^T\left(\hat\alpha_{it}-\hat\alpha_i\right)^2 \end{array} &lt;/equation&gt; &lt;/p&gt;&lt;p&gt;此外，通过 T 个 &lt;equation&gt;α&lt;/equation&gt;  的估计值，很容易求出残差的协方差矩阵并由此检验个股的定价错误是否联合为零。从上面的描述不难看出，Fama-MacBeth 截面回归和传统截面回归的区别是：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Fama-MacBeth 截面回归先在不同的 t 上分别用 &lt;equation&gt;R_{it}&lt;/equation&gt; 和 &lt;equation&gt;\beta_i&lt;/equation&gt; 做回归，再把回归的结果 &lt;equation&gt;λ_t&lt;/equation&gt; 和 &lt;equation&gt;α_{it}&lt;/equation&gt; 在时序上取均值得到 &lt;equation&gt;λ = \mbox{E}[λ_t]&lt;/equation&gt; 和 &lt;equation&gt;α_i = \mbox{E}[α_{it}]&lt;/equation&gt; ；&lt;/li&gt;&lt;li&gt;传统截面回归是先把 &lt;equation&gt;R_{it}&lt;/equation&gt; 在时序上取均值得到 &lt;equation&gt;\mbox{E}[R_{i}]&lt;/equation&gt; 然后再进行一次截面回归，直接得到  &lt;equation&gt;λ&lt;/equation&gt;  和  &lt;equation&gt;α_i&lt;/equation&gt; 。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;所以简单来说，&lt;b&gt;Fama-MacBeth&lt;/b&gt; &lt;b&gt;先回归再均值；而传统截面回归先均值再回归。当截面回归中的 regressor，即 &lt;/b&gt; &lt;equation&gt;β_i&lt;/equation&gt; &lt;b&gt;，在所有 T 期上不变时，上述两种截面回归得到的 estimate 是一致的&lt;/b&gt;（Fama-MacBeth 在处理残差的截面相关性上仍然有优势）。&lt;/p&gt;&lt;p&gt;在 Fama and MacBeth (1973) 中，作者在时序回归求解 &lt;equation&gt;β_i&lt;/equation&gt; 时采用了滚动窗口，因此  &lt;equation&gt;β_i&lt;/equation&gt;  在不同的 t 是会发生变化的。如果我们用所有样本数据来一次估计 &lt;equation&gt;β_i&lt;/equation&gt; ，那么它们在所有 T 期的取值相同。&lt;/p&gt;&lt;p&gt;由上面的介绍可知，Fama-MacBeth 回归的最大优点是它排除了残差截面相关性对标准误的影响。股票的残差收益率在截面上具有很高的相关性，因此该修正对于准确计算标准误至关重要。下面来说说它的不足。&lt;/p&gt;&lt;p&gt;首先，&lt;b&gt;Fama-MacBeth 回归对于残差在时序上的相关性无能为力。&lt;/b&gt;如果残差在时序上存在相关性，则需要对 Fama-MacBeth 回归得到的标准误进一步修正。Petersen (2009) 分析了不同的回归技术在分析面板数据（panel data）时由于忽略残差的时序或截面相关性而导致不准确的标准误（低估了其真实值）。这篇文章非常值得一读。其次，上文提到，在截面回归中用到的 &lt;equation&gt;β_i&lt;/equation&gt; 并不是已知的，而是通过时间序列得到的估计值（generated regressors），因此存在误差。Fama-MacBeth 回归对此也无能为力，需要 Shanken correction。&lt;/p&gt;&lt;p&gt;如今我们有了 GMM 这样的大杀器，能够方便的处理残差的各种相关性。但不要忘记，Fama-MacBeth 回归比 GMM 早提出了近 10 年！在没有 GMM 或其他更先进方法的年代，Fama-MacBeth 回归通过在截面回归时“先回归、再均值”的思路巧妙的排除了残差截面相关性的影响，得到了学术界的广泛认可，影响深远。时至今日，在计量经济学做面板分析的文章中，仍有约 1/3 的文章采用 Fama-MacBeth 回归（Petersen 2009）。&lt;/p&gt;&lt;p&gt;Fama-MacBeth 回归的要点总结如下：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Fama-MacBeth 回归也是一种截面回归，因子可以是 portfolio returns，也可以是别的指标。和普通截面回归一样，它的第一步也是通过时间序列回归得到投资品在因子上的暴露 &lt;equation&gt;β_i&lt;/equation&gt; 。&lt;/li&gt;&lt;li&gt;得到 &lt;equation&gt;β_i&lt;/equation&gt; 后，在每期（共 T 期）的截面上使用个股的收益率 &lt;equation&gt;R_{it}&lt;/equation&gt; 和 &lt;equation&gt;β_i&lt;/equation&gt; 进行截面回归，回归得到该期因子的收益率 &lt;equation&gt;λ_t&lt;/equation&gt; 和个股的残差 &lt;equation&gt;α_{it}&lt;/equation&gt; 。通过 T 次截面回归、得到 T 个的估计后，将它们取均值得到因子收益率均值 &lt;equation&gt;λ = \mbox{E}[λ_t]&lt;/equation&gt; 和个股残差均值 &lt;equation&gt;α _i= \mbox{E}[α_{it}]&lt;/equation&gt; 。&lt;/li&gt;&lt;li&gt;Fama-MacBeth 回归排除了残差截面相关性对标准误的影响，但是对时序相关性无能为力。&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;&lt;b&gt;6 对 Barra 模型的思考&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本节是开放性的讨论，陈述对 Barra 模型的一些思考。Barra 模型和本文第二、三节介绍的时序和截面回归都有所不同。&lt;/p&gt;&lt;p&gt;Barra 的多因子模型考虑了行业因子和来自基本面和技术面的风格因子。&lt;b&gt;Barra 的模型也是截面回归模型。&lt;/b&gt;但是和本文中介绍的模型不同之处是：&lt;b&gt;在 Barra 模型中，因子暴露并非来自时间序列回归，而是直接来自基本面或者技术面数据本身。&lt;/b&gt;我查阅了前后几代 Barra 的文档，比如 Grinold and Kahn (1994)，Menchero et al. (2011)，Orr et al. (2012)，得到的都是上述结论。&lt;/p&gt;&lt;p&gt;举个例子，比如我们熟悉的 Book-to-Market ratio。在 Fama-French 三因子模型中，BP 被用来构建了一个 HML 投资组合，而这个投资组合的收益率作为因子，个股在这个因子上的暴露由时间序列回归确定，与个股实际的 BP 无关。而在 Barra 模型中，BP 直接被用来当作因子，个股在因子上的暴露就是使用财报中 Book value 和股价计算出来的比例经过必要的标准化确定的。&lt;/p&gt;&lt;p&gt;有了因子暴露后，Barra 和传统截面回归一样，是通过截面回归来确定每个因子的收益率（纯因子模型）。所以，&lt;b&gt;Barra 模型（业界代表）和学术界流行的因子模型最大的不同就是因子暴露 &lt;/b&gt; &lt;equation&gt;β&lt;/equation&gt; &lt;b&gt; 的确定。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;对于风格因子来说（行业因子我们一会儿另说），这两种确定  &lt;equation&gt;β&lt;/equation&gt;  的方法在我看来各有千秋。&lt;b&gt;时间序列回归得到的 &lt;/b&gt; &lt;equation&gt;β&lt;/equation&gt; &lt;b&gt;，它的变化注定是缓慢的，且回归中也有大量的噪声。直接用基本面或者技术面数据作为 &lt;/b&gt;&lt;equation&gt;β&lt;/equation&gt; &lt;b&gt;，可以更快的捕捉公司的变化。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;然而，&lt;b&gt;使用基本面或者技术面数据直接作为 &lt;/b&gt; &lt;equation&gt;β&lt;/equation&gt; &lt;b&gt; 则必须进行标准化（原始数据拿来直接当作因子暴露会有很大问题）。&lt;/b&gt;我在本文反复强调了因子模型是分析个股平均收益率在截面上随 β 的变化，即预期收益率的大小完全由股票在因子上的暴露大小决定。试想一下，如果我们用不经过标准化的市值作为因子暴露，如果公司 A 的市值是 B 的市值的 100 倍，那难道我们能说市值因子的收益率对 A 的收益率的影响是对 B 的收益率的影响的 100 倍吗？显然是不能的。所以对于市值因子，常见的是首先取对数，然后再进行标准化。对于其他的风格因子，也需要采用相应的标准化处理。在 Barra 的文档中对如何标准化因子暴露有详细的说明。&lt;/p&gt;&lt;p&gt;对于行业因子，Barra 将因子暴露处理成 binary 变量 —— 比如工商银行在银行业的暴露是 1，在其他行业的暴露为 0（对于业务涉及不同行业的大公司，Barra 允许该公司以不同权重属于多个行业）。我认为这个处理值得考量。假如某个公司属于行业 X，但是它的收益率和行业 Y 更相关，那么从建模的角度是不是把该公司算作行业 Y 更有道理？对于行业因子暴露，可以尝试使用个股的收益率和行业的收益率做时间序列回归，将回归系数当作行业因子的暴露。我不清楚 Barra 是否尝试过上述方法，但这是一个值得思考的问题。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;7 结语&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;首先，感谢你看到这里。我知道文章很长，我写的也很痛苦，但我觉着它很重要。&lt;/p&gt;&lt;p&gt;本文介绍了股票多因子模型的回归检验。希望你看完后能够对常见的时序回归、截面回归、Fama-MacBeth 回归、以及 Barra 模型等有更深的理解；对如何确定因子暴露，如何计算因子收益率，以及回归检验的终极目标是什么（所有残差 &lt;equation&gt;α_i&lt;/equation&gt; 是否在统计上为零）有清晰的认识。&lt;/p&gt;&lt;p&gt;作为你看到这里的感谢和鼓励，我放个彩蛋 —— &lt;b&gt;检验 is NOT everything！&lt;/b&gt;&lt;/p&gt;&lt;p&gt;考虑下面两个因子模型，图中每个点代表一个股票。图中给出了它们残差 &lt;equation&gt;α_i&lt;/equation&gt; 的置信区间。按照统计检验的思路，左图中大部分残差的置信区间都和那条截面回归关系式没有交集，说明我们要拒绝原假设，即 &lt;equation&gt;α_i&lt;/equation&gt; 统计上不为零；右图中大部分残差的置信区间和截面回归关系式相交，我们接受原假设。但显然，左边的模型更好的反映出股票收益率和因子暴露在截面上的关系；而右边的模型表现出的关系则非常弱（从这些点看不出 &lt;equation&gt;\mbox{E}[R_i]&lt;/equation&gt; 随 &lt;equation&gt;β_i&lt;/equation&gt; 的增大而增大）。所以，从 economic sense 来说，显然左边的模型更好。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-09635d94e6ca4c3b37e36bad9f79f0ef_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1306&quot; data-rawheight=&quot;492&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-09635d94e6ca4c3b37e36bad9f79f0ef&quot; data-watermark-src=&quot;v2-b9fea0b8f70248c8e85cc82fdb83ae6d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;最后再来一点点评价。&lt;b&gt;从投资的角度，我们希望因子本身有清晰合理的解释，但是从多因子模型的角度来说，只要这些因子收益率均值能在截面上解释个股的预期收益率，那这个模型就是好模型&lt;/b&gt;（所以在因子选股时，我们会重点关注因子的 IC 和 IR 这些指标）。因子开发属于 empirical work，HML、SMB 是从 real stock return 中挖掘出来的，它们在解释截面收益率均值时有很好的效果。至于 HML，SMB 为什么有效、背后的含义是什么，搞清楚它们能提升我们使用因子的信心，但是对于评价一个因子模型的好坏并不重要。&lt;/p&gt;&lt;p&gt;好了，这回真的写完了！最后就是来安利我写作本文时最重要的参考文献：芝加哥大学 Booth 商学院的 John Cochrane 教授的著作 Asset Pricing（Cochrane 2005）。该书曾获得 Paul A. Samuelson Award for Outstanding Scholarly Writing on Lifelong Financial Security，足见其地位。它值得任何对资产定价感兴趣的人认真读、仔细读、反复读。&lt;/p&gt;&lt;p&gt;除了这本书外，对我帮助巨大的是 UChicago Online 发布到网上的 Cochrane 教授的 Asset Pricing 这门课程。感兴趣的朋友可以搜来看一看（大概要翻墙）。Cochrane 教授讲的非常生动、到位，听完再结合他的书一看，那收获自然是大大的。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-b73e5497c0d9d2f084beccb4343b7590_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;623&quot; data-rawheight=&quot;315&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-b73e5497c0d9d2f084beccb4343b7590&quot; data-watermark-src=&quot;v2-1df93b1e68ec58aca315c201462b15a6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;在介绍 Asset Pricing 这门课的时候，Cochrane 教授谈到：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;The math in real, academic, finance is not actually that hard. Understanding how to use the equations, and see what they really mean about the world... that&#39;s hard, and that&#39;s what I hope will be uniquely rewarding about this class.&lt;/i&gt;&lt;br&gt;&lt;i&gt;译：在现实和学术中，金融中的数学其实并不难。难的是理解如何使用这些方程，以及它们对这个世界的真正意义。这是我希望这门课能带给你独特收获的地方。&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;我也真心希望本文在你使用多因子模型的道路上起到一点点帮助。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Black, F., M. C. Jensen, and M. Scholes (1972). The Capital Asset Pricing Model: Some empirical Tests. In &lt;i&gt;Michael Jensen, Ed., Studies in the Theory of Capital Markets&lt;/i&gt;, Praeger, New York NY.&lt;/li&gt;&lt;li&gt;Cochrane, J. H (2005). &lt;i&gt;Asset Pricing (revised edition)&lt;/i&gt;. Princeton University Press.&lt;/li&gt;&lt;li&gt;Fama, E. F. and K. R. French (1993). Common Risk Factors in the Returns on Stocks and Bonds. &lt;i&gt;Journal of Financial Economics&lt;/i&gt;, Vol. 33(1), 3 – 56.&lt;/li&gt;&lt;li&gt;Fama, E. F. and K. R. French (1996). Multifactor Explanations of Asset Pricing Anomalies.&lt;i&gt;The Journal of Finance&lt;/i&gt;, Vol. 51(1), 55 – 84.&lt;/li&gt;&lt;li&gt;Fama, E. F. and J. D. MacBeth (1973). Risk, Return, and Equilibrium: Empirical Tests. &lt;i&gt;The Journal of Political Economy&lt;/i&gt;, Vol. 81(3), 607 – 636.&lt;/li&gt;&lt;li&gt;Gibbons, M. R., S. A. Ross, and J. Shanken (1989). A Test of the Efficiency of a Given Portfolio. &lt;i&gt;Econometrica&lt;/i&gt;, Vol. 57(5), 1121 – 1152.&lt;/li&gt;&lt;li&gt;Grinold R. and R. N. Kahn (1994). Multiple-Factor Models of Portfolio Risk. In &lt;i&gt;A Practitioners Guide to Factor Models&lt;/i&gt;.&lt;/li&gt;&lt;li&gt;Hansen, L. P. (1982). Large Sample Properties of Generalized Method of Moments Estimators. &lt;i&gt;Econometrica&lt;/i&gt;, Vol. 50(4), 1029 – 1054.&lt;/li&gt;&lt;li&gt;Menchero, J., D. J. Orr, and J. Wang (2011). &lt;i&gt;The Barra US Equity Model (USE4).&lt;/i&gt; MSCI Barra Research Notes.&lt;/li&gt;&lt;li&gt;Orr, D. J., I. Mashtaler, and A. Nagy (2012). &lt;i&gt;The Barra China Equity Model (CNE5), Empirical Notes.&lt;/i&gt; MSCI.&lt;/li&gt;&lt;li&gt;Petersen, M. A. (2009). Estimating Standard Errors in Finance Panel Data Sets: Comparing Approaches. &lt;i&gt;The Review of Financial Studies&lt;/i&gt;, Vol. 22(1), 435 – 480.&lt;/li&gt;&lt;li&gt;Shanken, J. (1992). On the Estimation of Beta-Pricing Models. &lt;i&gt;The Review of Financial Studies&lt;/i&gt;, Vol. 5(1), 1 – 33.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com/&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-07-31-40984029</guid>
<pubDate>Tue, 31 Jul 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>用 Quantile Regression 分析变量相关性</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-07-27-40681570.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/40681570&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-aa3734d9d1c97514962966a5a7d19c1d_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;1 分位数和分位数回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;分位数（quantile）是概率中的一个概念。对一个随机变量  &lt;equation&gt;X&lt;/equation&gt;  和任意一个 0 到 1 之间的数 &lt;equation&gt;τ&lt;/equation&gt; ，如果  &lt;equation&gt;X&lt;/equation&gt;  的取值 &lt;equation&gt;x&lt;/equation&gt; 满足  &lt;equation&gt;\mbox{prob}(X ≤ x) = τ&lt;/equation&gt; ，那么  &lt;equation&gt;x&lt;/equation&gt;  就是  &lt;equation&gt;X&lt;/equation&gt;  的  &lt;equation&gt;τ&lt;/equation&gt;  分位数。换句话说， &lt;equation&gt;τ&lt;/equation&gt; &lt;b&gt; 分位数说明：如果我们按该随机变量的分布产生足够多的样本点，那么在这些样本点的取值中，有 &lt;/b&gt;&lt;equation&gt;τ × 100\%&lt;/equation&gt;&lt;b&gt; 个小于该分位数；有 &lt;/b&gt;&lt;equation&gt;(1 - τ) × 100\%&lt;/equation&gt;&lt;b&gt; 个大于该分位数。&lt;/b&gt;最常见的分位数非中位数（median）莫属，它是 50% 分位数 —— 在  &lt;equation&gt;X&lt;/equation&gt;  的分布中，有一半比中位数小，一半比中位数大。&lt;/p&gt;&lt;p&gt;也许你仍觉着上面的定义抽象，但是你对下面的儿童成长图（child growth chart）一定不陌生。它给出了儿童（这个表中是男孩）在不同年龄时身高和体重的不同分位数（3%、10%、25%、50%、75%、90% 以及 97%）曲线，这有助于儿医和父母判断宝宝成长过程中发育是否正常。如果一个娃的体重落在 90% 分位线上，说明他的体重比同龄的 90% 的小伙伴要高；如果一个娃的身高或体重在表外了（off the chart），那多半就说明他营养不良或过剩了。分位数在生活中作用很大。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-be7f6750bb6f6a978e03916c1ae24726_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;643&quot; data-rawheight=&quot;895&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-be7f6750bb6f6a978e03916c1ae24726&quot; data-watermark-src=&quot;v2-5aff752a7dc69881211e72dc3cdd3191&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;上面这个图说明两点：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;随着年龄的增加，低分位数和高分位数之间的间隔越来越大；&lt;/li&gt;&lt;li&gt;年龄变量的单位增量对身高（或体重）分布的右侧（高分位数部分）的影响大于其对身高（或体重）分布的左侧（低分位数数的部分）。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;显然，这两点向我们展示了身高（或体重）与年龄在整个分布上的一些关系。试想一下，如果我们仅有年龄和平均身高（平均体重）的关系，我们是无法得到上面两点结论的。&lt;b&gt;分位数定量描述了中心趋势和统计离散度，这有助于更我们全面地分析变量之间的关系。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;如何得到如上图中的分位数曲线呢？答案是&lt;b&gt;分位数回归（quantile regression）&lt;/b&gt;。&lt;/p&gt;&lt;p&gt;分位数回归由 Koenker and Bassett, Jr. (1978) 提出，是一种回归分析。在传统回归中，我们构建回归模型由自变量求出因变量的条件期望；而&lt;b&gt;在分位数回归中，我们构建回归模型由自变量求出因变量的条件分位数。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;近年来，分位数回归在计量经济学中的应用越来越广泛。利用分位数回归，Saastamoinen (2008) 研究了芬兰市场中的羊群效应；Alagidede and Panagiotidis (2012) 讨论了通货膨胀和股票收益率之间的关系；Badshah (2012) 分析了美股中恐慌指数（VIX）和收益率分布之间的不对称性。&lt;/p&gt;&lt;p&gt;本文简要介绍分位数回归，并通过一个简单的例子说明它在量化投资中的潜在作用。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 最优化视角下求解均值和中位数&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;让我们先把回归问题放在一边，仅仅考虑一个随机变量 &lt;equation&gt;Y&lt;/equation&gt; 的一组样本 &lt;equation&gt;\{y_1, y_2, \cdots, y_n\}&lt;/equation&gt; 。在本节中，&lt;b&gt;我们从求解最优化问题的角度说明如何求出样本均值和中位数。&lt;/b&gt;这对于后面介绍分位数回归很有帮助。&lt;/p&gt;&lt;p&gt;我们都知道，这组样本的均值就是这  &lt;equation&gt;n&lt;/equation&gt;  个数的平均值。从最优化的角度来说，该样本均值正是下列&lt;b&gt;最小化残差平方和（即我们常说的最小二乘法）&lt;/b&gt;问题的解：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\min_{\mu}f=\sum_{i}^n(y_i-\mu)^2&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;最优的  &lt;equation&gt;μ&lt;/equation&gt;  应满足 &lt;equation&gt;df/dμ = 0&lt;/equation&gt; 。经过简单的推导不难看出，&lt;b&gt;最小二乘法得到的解就是样本均值&lt;/b&gt;：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rrll} &amp;amp;\displaystyle\frac{df}{d\mu}&amp;amp;=&amp;amp;\displaystyle-2\sum_{i}^n(y_i-\mu)=0\\ \Rightarrow&amp;amp;\displaystyle\sum_{i}^n(y_i-\mu)&amp;amp;=&amp;amp;0\\ \Rightarrow&amp;amp;\displaystyle\sum_{i}^ny_i-n\mu&amp;amp;=&amp;amp;0\\ \Rightarrow&amp;amp;\mu&amp;amp;=&amp;amp;\displaystyle\frac{1}{n}\sum_{i}^n y_i\end{array}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;与之类似的，&lt;b&gt;最小化残差绝对值之和的解就是样本的中位数&lt;/b&gt;（这里的残差是样本点相对于中位数而言的），即这组样本的样本中位数  &lt;equation&gt;M&lt;/equation&gt;  是如下最优化问题的解：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\begin{array}{rll} \displaystyle\min_M f&amp;amp;=&amp;amp;\displaystyle\sum_{i}^n|y_i-M|\\ &amp;amp;=&amp;amp;\displaystyle\sum_{i:y_i&amp;lt;M}^s(M-y_i)+\sum_{i:y_i\ge M}^{n-s}(y_i-M) \end{array}&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;对 &lt;equation&gt;M&lt;/equation&gt; 求导得：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\frac{df}{dM}=s-(n-s)&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;可见， &lt;equation&gt;df/dM&lt;/equation&gt; 等于 0 的必要条件是 &lt;equation&gt;s = n - s&lt;/equation&gt; ，其中 &lt;equation&gt;s&lt;/equation&gt; 是小于 &lt;equation&gt;M&lt;/equation&gt; 的样本点的个数，而 &lt;equation&gt;n - s&lt;/equation&gt; 是大于 &lt;equation&gt;M&lt;/equation&gt; 的样本点的个数。这意味着 &lt;equation&gt;M&lt;/equation&gt; 的取值满足在其两侧的样本点个数相同，即 &lt;equation&gt;M&lt;/equation&gt; 是中位数。&lt;/p&gt;&lt;p&gt;来看一个例子。&lt;/p&gt;&lt;p&gt;假设随机变量 &lt;equation&gt;Y&lt;/equation&gt; 的一组样本是 1 到 9 这 9 个数。按照上述最优化的思路，我们想找到 &lt;equation&gt;M&lt;/equation&gt; 使得目标方程 &lt;equation&gt;f = \sum_i|y_i - M|&lt;/equation&gt; 最小。在 1 到 9 内遍历 &lt;equation&gt;M&lt;/equation&gt; 并求出 &lt;equation&gt;f&lt;/equation&gt; 对应的值有：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-74d57b88840b8c91e5cba16e4515596b_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;579&quot; data-rawheight=&quot;129&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-74d57b88840b8c91e5cba16e4515596b&quot; data-watermark-src=&quot;v2-c8ae1d678c32f5fcaf8431f134afd00a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;可见，当 &lt;equation&gt;M = 5&lt;/equation&gt; 时 &lt;equation&gt;f&lt;/equation&gt; 的取值最小，因此这组样本的中位数为 5。现在我们已经知道如何从求解最优化问题的角度找到样本的均值和中位数（一个特殊的分位数 —— 50% 分位数），接下来就来看看如何将这个思路推广到分位数回归上。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 分位数回归&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;推广上一节的最优化思路引出分位数回归十分简单，仅需要两步走。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第一步：引入回归问题。&lt;/b&gt;在上一节中，为了简化讨论，我们考虑的是随机变量  &lt;equation&gt;Y&lt;/equation&gt;  自身。在（线性）回归问题中，我们关注的是因变量 &lt;equation&gt;Y&lt;/equation&gt; 和某些自变量 &lt;equation&gt;X&lt;/equation&gt; 之间的（线性）关系。（这里， &lt;equation&gt;X&lt;/equation&gt;  可以代表一个自变量或者多个自变量组成的向量。下文中为了简化讨论，假设自变量只有一个。）&lt;/p&gt;&lt;p&gt;对于均值来说，将上一节中的标量 &lt;equation&gt;μ&lt;/equation&gt; 变成自变量  &lt;equation&gt;X&lt;/equation&gt;  的线性方程 &lt;equation&gt;μ(X, β)&lt;/equation&gt; —— 其中 &lt;equation&gt;β&lt;/equation&gt; 是 &lt;equation&gt;X&lt;/equation&gt; 的系数，并将最优化问题转化为（在这个问题中，求解的对象是  &lt;equation&gt;X&lt;/equation&gt;  的系数 &lt;equation&gt;β&lt;/equation&gt; ）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\min_{\beta}\sum_{i}^n(y_i-\mu(x_i,\beta))^2&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;求解得到 &lt;equation&gt;β&lt;/equation&gt; 后，线性方程 &lt;equation&gt;μ(X, β)&lt;/equation&gt; 就是因变量 &lt;equation&gt;Y&lt;/equation&gt; 的&lt;b&gt;条件期望方程&lt;/b&gt; &lt;equation&gt;\mbox{E}[Y|X]&lt;/equation&gt; 。我们熟悉的求解线性回归的最小二乘法正是如此找到  &lt;equation&gt;Y&lt;/equation&gt;  和  &lt;equation&gt;X&lt;/equation&gt;  的关系的，它得到的  &lt;equation&gt;Y&lt;/equation&gt;  和  &lt;equation&gt;X&lt;/equation&gt;  之间的关系正是 &lt;equation&gt;\mbox{E}[Y|X]&lt;/equation&gt; 。&lt;/p&gt;&lt;p&gt;对于中位数也可以做相同的推演。令上一节中的标量 &lt;equation&gt;M&lt;/equation&gt; 变为自变量的线性方程 &lt;equation&gt;ξ(X, β)&lt;/equation&gt; 。因此该最优化问题转化为：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\min_\beta\sum_i^n|y_i-\xi(x_i,\beta)|&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;求解得到  &lt;equation&gt;β&lt;/equation&gt;  后，线性方程 &lt;equation&gt;ξ(X, β)&lt;/equation&gt; 就是因变量  &lt;equation&gt;Y&lt;/equation&gt;  的&lt;b&gt;条件中位数方程&lt;/b&gt;。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第二步：将中位数推广到一般分位数。&lt;/b&gt;在所有分位数中间，中位数 —— 又称 50% 分位数 —— 比较特殊是在于在求解最优化问题中，其两侧样本点的残差是等权重的。把上述最小化残差绝对值的问题推广到一般的  &lt;equation&gt;τ&lt;/equation&gt;  分位数时，只需把  &lt;equation&gt;τ&lt;/equation&gt;  分位数两侧的残差赋予不同的权重即可。&lt;/p&gt;&lt;p&gt;具体的，对于 &lt;equation&gt;τ&lt;/equation&gt; 分位数左侧样本点的残差，赋予它们 &lt;equation&gt;1 - τ&lt;/equation&gt; 的权重；对于 &lt;equation&gt;τ&lt;/equation&gt; 分位数右侧样本点的残差，赋予它们  &lt;equation&gt;τ&lt;/equation&gt;  的权重。最优化问题由此变为（求解的对象为  &lt;equation&gt;τ&lt;/equation&gt;  分位数对应的系数 &lt;equation&gt;β&lt;/equation&gt; ，记为 &lt;equation&gt;β_τ&lt;/equation&gt; ）：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\min_{\beta_\tau}\sum_{i:y_i\ge\xi(x_i,\beta_\tau)}\tau(y_i-\xi(x_i,\beta_\tau))+\sum_{i:y_i&amp;lt;\xi(x_i,\beta_\tau)}(1-\tau)(\xi(x_i,\beta_\tau)-y_i)&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;使用线性规划求解这个最优化问题，得到最优解 &lt;equation&gt;β_τ&lt;/equation&gt; 后，线性方程 &lt;equation&gt;ξ(X, β_τ)&lt;/equation&gt; 就是因变量  &lt;equation&gt;Y&lt;/equation&gt;  的&lt;b&gt;条件 &lt;/b&gt; &lt;equation&gt;τ&lt;/equation&gt; &lt;b&gt; 分位数方程&lt;/b&gt;。对于不同的 &lt;equation&gt;τ&lt;/equation&gt; 的取值（如 5%、10%、15%、……、85%、90%、95%），只需要对每个  &lt;equation&gt;τ&lt;/equation&gt;  分别求解上述最优化问题，就可以得到  &lt;equation&gt;Y&lt;/equation&gt;  的不同条件  &lt;equation&gt;τ&lt;/equation&gt;  分位数方程。&lt;/p&gt;&lt;p&gt;值得一提的是，如果我们仅有一个自变量 &lt;equation&gt;X&lt;/equation&gt; ，并用它来对  &lt;equation&gt;Y&lt;/equation&gt;  进行分位数回归，那么任何一个  &lt;equation&gt;τ&lt;/equation&gt;  分位数回归方程都是一条直线（有截距项、斜率为 &lt;equation&gt;β_τ&lt;/equation&gt; ）。但是在第一节的儿童成长图中，身高（体重）的条件  &lt;equation&gt;τ&lt;/equation&gt;  分位数方程随年龄的变化明显不是直线。这是因为在构建成长曲线时，通常对年龄先进行了某种非线性变化以更好的反应它和儿童的成长的关系。从分位数回归的角度，我们做的依然是线性回归，只不过这时自变量已经从身高变成了身高的某个非线性函数而已。&lt;/p&gt;&lt;p&gt;在下文的第 4、5 节我们考虑两个例子，在这两个例子中我们都不会对自变量进行任何变换。因此这两个例子中的条件 &lt;equation&gt;τ&lt;/equation&gt; 分位数方程都是线性的。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 收入和食物消费支出的关系&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;来看一个大概是介绍分位数回归的文章都要提的例子（抱歉没能免俗）…… &lt;/b&gt;Engel (1857) 研究了家庭收入和家庭食物消费支出之间的关系。对该数据同时进行最小二乘法回归（得到条件均值的方程）和分位数回归（得到 10 个条件 &lt;equation&gt;τ&lt;/equation&gt; 分位数方程， &lt;equation&gt;τ&lt;/equation&gt; 的取值为 5%，15%，……，95%）如下图所示。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-b31724eb3b206089781897358d92ecad_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;583&quot; data-rawheight=&quot;441&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-b31724eb3b206089781897358d92ecad&quot; data-watermark-src=&quot;v2-e979124011ba41bf534b8978eeecd082&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;从这个图中可以观察到以下结论：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;食物消费支出随收入而增加；&lt;/li&gt;&lt;li&gt;食物消费的分布随收入增加变得越来越宽（高分位数和低分位数之间的间隔越来越大）；&lt;/li&gt;&lt;li&gt;最小二乘法回归对于低收入对应的观测点的拟合度较差；从图中可见，最小二乘法的红色曲线处于很多低收入观测点之上。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;上述分位数回归的结果说明，在食物消费支出分布的不同位置（不同分位数），家庭收入对其的影响是不同的。下图展示了这一点。图中横坐标为食物消费支出的分位数，纵坐标为不同分位数回归的系数 &lt;equation&gt;β_τ&lt;/equation&gt; ，它表示一个单位的家庭收入变化带来多大的食物消费支出。对于最小二乘法（红色）来说，它假设收入对食物消费支出的影响在整个分布上是恒定的；但是分位数回归（黑色）正好得到不同的结论。显然，分位数回归提供了收入和食物支出之间更为丰富的关系。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9ec63b6e58bd28bb607d6f1b4747423e_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;568&quot; data-rawheight=&quot;403&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9ec63b6e58bd28bb607d6f1b4747423e&quot; data-watermark-src=&quot;v2-bcd5ae6b855ae2661d44d63246627235&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;5 分位数回归在量化投资中的应用一例&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;最后通过一个简单的例子介绍分位数回归在量化投资中的应用。&lt;/p&gt;&lt;p&gt;具体的，我们关注风险和收益之间的关系。为此，需要给风险和收益各找一个代理指标。以上证指数（2005 年 1 月 1 日至 2017 年 7 月 31 日）为例，风险的代理指标为每周已实现波动率（日频收益率的平方和）的变化率，记为 &lt;equation&gt;ΔVol&lt;/equation&gt; ；收益的代理指标为周收益率的绝对值，记为 &lt;equation&gt;|R_m|&lt;/equation&gt; 。对该数据同时进行最小二乘法回归和分位数回归如下图所示。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-bc8de35a642da87ef176aa90aabca2b9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;763&quot; data-rawheight=&quot;567&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bc8de35a642da87ef176aa90aabca2b9&quot; data-watermark-src=&quot;v2-68bec54f0189fa1c6a1a73f211a3737d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;可见，对于 &lt;equation&gt;ΔVol&lt;/equation&gt; 的不同分位数， &lt;equation&gt;|R_m|&lt;/equation&gt; 对其的影响不同。下图是 &lt;equation&gt;τ&lt;/equation&gt; 和系数 &lt;equation&gt;β_τ&lt;/equation&gt; 的关系。当 &lt;equation&gt;ΔVol&lt;/equation&gt; 处于低分位数通常意味着市场一般比较平稳，因此周波动率也比较稳定、 &lt;equation&gt;ΔVol&lt;/equation&gt; 较小。这时收益率的单位变化对 &lt;equation&gt;ΔVol&lt;/equation&gt; 的影响为负，有助于进一步维持平稳的市场状态。当 ΔVol 处于高分位数通常意味着市场一般比较震荡，因此周波动率变化剧烈、 &lt;equation&gt;ΔVol&lt;/equation&gt; 较大。这时收益率的单位变化对 &lt;equation&gt;ΔVol&lt;/equation&gt; 的影响为正，即它会进一步加剧市场的波动。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-069f5c9c16cccba442bfd331215f6ed9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;724&quot; data-rawheight=&quot;562&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-069f5c9c16cccba442bfd331215f6ed9&quot; data-watermark-src=&quot;v2-60b5fa2c28fe06cc3f0bf2b695cbf284&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;6 结语&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;对于金融投资中的很多变量，比如收益率，我们往往更关心它在分布尾部的特性。在这方面，分位数回归是一个有力的工具，它让我们研究收益率和不同的解释变量在全分布上的相关性。&lt;/p&gt;&lt;p&gt;当变量的分布明显偏离正态分布或者存在异常值（outliers）时，传统的最小二乘法回归就不那么有效了。然而分位数回归不受这些弊端的影响。此外，&lt;b&gt;分位数回归满足单调变换不变性（invariant to monotonic transformations）&lt;/b&gt;。对于随机变量  &lt;equation&gt;Y&lt;/equation&gt;  和它的单调变换 &lt;equation&gt;h(Y)&lt;/equation&gt; —— 比如 &lt;equation&gt;\ln(Y)&lt;/equation&gt; ， &lt;equation&gt;h(Y)&lt;/equation&gt; 的分位数正好是 &lt;equation&gt;h(Q_τ(Y))&lt;/equation&gt; ，即对  &lt;equation&gt;Y&lt;/equation&gt;  的分位数 &lt;equation&gt;Q_τ(Y)&lt;/equation&gt; 直接做同样的变换；而均值并不满足类似的性质，即 &lt;equation&gt;\mbox{E}[h(Y)] ≠ h(\mbox{E}[Y])&lt;/equation&gt; 。投资品收益率的分布以不满足正态性并存在很多异常值而闻名，因此上述优点使分位数回归在分析收益率时有着不错的潜力。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Alagidede, P. and T. Panagiotidis (2012). &lt;i&gt;Stock returns and Inflation: Evidence from Quantile Regressions.&lt;/i&gt; Discussion Paper Series, Department of Economics, University of Macedonia.&lt;/li&gt;&lt;li&gt;Badshah, I. U. (2012). Quantile regression analysis of the asymmetric return-volatility relation. &lt;i&gt;Journal of Futures Markets&lt;/i&gt;, Vol. 33(3), 235 – 265.&lt;/li&gt;&lt;li&gt;Engel, E. (1857). Die Produktions- und Konsumptionverhaltnisse des Konigreichs Sachsen. Reprinted in “Die Lebenkosten Belgischer Arbeiter-Familien Fruher und Jetzt.” &lt;i&gt;International Statistical Institute Bulletin&lt;/i&gt;. Vol. 9, 1 – 125.&lt;/li&gt;&lt;li&gt;Koenker, R. and G. Bassett, Jr. (1978). Regression Quantiles. &lt;i&gt;Econometrica&lt;/i&gt;, Vol. 46(1), 33 – 50.&lt;/li&gt;&lt;li&gt;Saastamoinen, J. (2008). &lt;i&gt;Quantile regression analysis of dispersion of stock returns – evidence of herding?&lt;/i&gt; Working paper, Joensuun yliopisto, Taloustieteet.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com/&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-07-27-40681570</guid>
<pubDate>Fri, 27 Jul 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>给你的动量选股策略加点“料”</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-07-24-40468929.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/40468929&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2a498f325ae45d29690ea71bfbe7058f_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;摘要&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;对于那些过程驱动、以长期盈利为目标、能够严格遵守交易纪律的投资者来说，动量策略值得配置。本文介绍两个改进动量策略的技巧，让动量变成高质量动量。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;1 动量策略的一点历史&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;2013 年，Asness、Moskowitz 以及 Pedersen 在著名的 Journal of Finance 上发表了一篇影响深远的文章，题为 Value and Momentum Everywhere（无处不在的价值和动量，Asness et al. 2013）。这篇长度为 57 页的文章从最初提交到最终发表历时 4 年，通过大量实证指出价值和动量存在于全球所有市场中（股票、外汇、固定收益、商品期货等）。比如，下表展示了美国、英国、欧洲和日本四个股票市场上的动量策略结果。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-dd2dea628b91d3ac78f2f09fe70f09a1_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;767&quot; data-rawheight=&quot;345&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-dd2dea628b91d3ac78f2f09fe70f09a1&quot; data-watermark-src=&quot;v2-673b124ce71c487e8d2efeb3be71094c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;在股票市场，动量策略指的是挑选过去一段时间涨幅高的那些股票在未来持有，从而获取超额收益。&lt;/b&gt;在能够做空的市场，也可以通过做多过去一段时间涨幅高的并且做空跌幅高的来对冲市场风险。对于纯多头的策略，在选股时可以考虑时序动量、截面动量、又或二者皆而有之。&lt;/p&gt;&lt;p&gt;&lt;b&gt;如今，动量（momentum）已经作为一个风格因子被市场广泛接受。此外，由于动量和价值这两个因子在长期来看存在负相关性，动量因子的配置价值就显得格外重要。&lt;/b&gt;然而，在最初的那段岁月里，市场对动量却是嗤之以鼻。&lt;/p&gt;&lt;p&gt;动量策略最初进入人们的视线是在 1967 年。当年，Robert Levy 在 Journal of Finance 上发表了一篇题为 Relative Strength as a Criterion for Investment Selection 的文章（当年动量 —— momentum —— 一词还没有被造出来）。在该文中，Levy 给出的结论是：&lt;b&gt;通过买入过去一段时间最强势的股票要比随机选股获得更高的收益。&lt;/b&gt;这个发现令人惊喜，但关于动量的研究并没有因此而拉开大幕。因为在同时期，&lt;b&gt;有效市场假说（efficient-market hypothesis，EMH）&lt;/b&gt;诞生了。&lt;/p&gt;&lt;p&gt;在 19 世纪 60 到 70 年代，在金融领域占有举足轻重地位的芝加哥大学（具体的，Eugene Fama）提出了有效市场假说。从 EMH 的观点出发，Levy 的发现根本不值一提，一定是搞错了。在 EMH 被提出之后的 25 多年里，该理论被学术界广泛认可、获得了飞速发展。&lt;b&gt;而这段 EMH 的繁荣时期恰恰是动量策略的一段黑暗时刻。&lt;/b&gt;在那 25 年里，学术界的顶级期刊上的所有篇幅都预留给了 EMH 的追随者；任何挑战 EMH 的发现都被禁止。&lt;/p&gt;&lt;p&gt;这期间唯一的例外大概要数价值投资。从 19 世纪 70 年代开始，一些和价值投资相关的异象逐渐被发表和接受。这里面有两个主要原因。第一个原因是以 Ben Graham 和 Warren Buffett 为代表的价值投资取得了巨大的成功 —— 巨大到学术界那些 EMH 的守护者们根本无法忽视它。第二个原因是以 Daniel Kahneman 和 Amos Tversky 为代表的心理学家在行为金融学的研究上取得了巨大进展，将人们的行为偏差和市场上观察到的各种异象完美的结合起来。终于，EMH 变的不再那么“权威”。&lt;/p&gt;&lt;p&gt;然而，上述这些突破并没有为动量投资带来任何帮助。颇为讽刺的是，在对动量策略的看法上，价值投资的先知们和 EMH 的拥趸持有完全相同的看法 —— &lt;b&gt;动量投资是“一种黑色艺术，一种巫术魔力，只有愚人和异端者才会尝试”。&lt;/b&gt;这其实不难理解，在价值投资者看来，价值投资是对基本面的充分挖掘、从而找到价值和价格的背离，这需要对行业和公司的深入理解、这是一门科学；而动量呢？只需要傻买过去涨的猛的就行了，毫无技术含量。&lt;/p&gt;&lt;p&gt;但是，就像所有真理一样，事实胜于雄辩、更胜于诡辩。1993 年 Narasimhan Jegadeesh 和 Sheridan Titman 在 Journal of Finance 上发表了一篇对于动量策略来说是里程碑式的文章，题为 Returns to Buying Winners and Selling Losers: Implications for Stock Market Efficiency。在大量的实证数据分析之下，动量策略终于走上台面；所有否定者都明白，如果再忽视它就只能说明自己的无知与傲慢。&lt;/p&gt;&lt;p&gt;如今，动量选股广泛被人接受。就连 EMH 之父 Eugene Fama 也承认动量的存在。在 2008 年，美国金融协会的金融大师系列访谈节目中，Fama 坦言“动量策略确实存在于世界各国，除了日本”（下图）。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9769424e1b3b4b9d02e98ede17ca3c4c_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;839&quot; data-rawheight=&quot;464&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9769424e1b3b4b9d02e98ede17ca3c4c&quot; data-watermark-src=&quot;v2-33ebfb98db311bd35e28e5e0d55103d6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;颇有意思的是， Fama 的学生 Clifford Asness（在上面的这个访谈中，Fama 评价 Asness 是近 20 年内最好的学生）似乎非要和他当年的恩师唱唱反调。在 2011 年，Asness 发表了一篇题为 Momentum in Japan 的文章，和 Fama 隔空喊话。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-87d3edcb4c08b072973d037a2304671d_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;739&quot; data-rawheight=&quot;225&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-87d3edcb4c08b072973d037a2304671d&quot; data-watermark-src=&quot;v2-7aef97d121f76f20e61e200ec7d5de97&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;不过，在这篇文章中，Asness 指出日本市场的动量策略的价值更多的体现在它在投资组合中的配置作用。具体的，动量和价值因子长期负相关，因此在日本市场的投资组合中同时配置这两种因子可以取得性价比更高的风险收益。此外，Asness 在讨论日本动量策略的时候考虑的是多空对冲的组合，并没有对纯多头的动量组合进行太多的探讨。&lt;/p&gt;&lt;p&gt;这似乎稍显不足，但是在 Gray and Vogel (2016) 所著的一本名为&lt;b&gt;量化动量（Quantitative Momentum）&lt;/b&gt;的书中，作者用 Asness 的数据复制了纯多头的日本动量策略，并指出即使是纯多头策略也能战胜市场，从而说明了动量存在于日本市场（本文最开始表格中日本市场的动量策略结果就来自 Gray and Vogel 2016）。&lt;/p&gt;&lt;p&gt;本文的题目为“给你的动量选股策略加点料”，是为了介绍 Gray and Vogel (2016) 提出的两种改进动量策略的技巧，从而把动量变成“高质量”动量（有条件的话，我同时非常推荐大家读一读这本 Quantitative Momentum）。为此，我们会在下文中介绍这两个小技巧，并以中证 500 成分股为选股池进行动量策略的实证。&lt;/p&gt;&lt;p&gt;在介绍这两个小技巧之前，先来看一个基础版的动量策略。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 基础版动量策略&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;我之前写过一篇文章验证 Jegadeesh 和 Titman 的思路，当初的结论是，在大 A 股，反转要明显强于动量。但我们今天既然聊动量，那就无论如何要找个合适的基础版动量策略（在美股上动量策略的效果更明显，而下文介绍的改进也是针对美股提出的，因此有条件交易美股的小伙伴更应该关注）。&lt;/p&gt;&lt;p&gt;本文实证以中证 500 的成分股为选股池。对于中证 500，过去 60 个交易日风险调整后的涨幅（即累积涨幅减去风险厌恶系数 50 乘以这段时间内日收益率的方差）是个不错的动量指标（这么做的主要目的是为了排除小市值的影响）。以此为动量选股的依据，并使用如下的交易策略：&lt;/p&gt;&lt;p&gt;每日更新动量指标并重新对股票排名，新股理想仓位为 1%、等权配置；卖出条件为最新动量排名超过 100；为降低换手率，要求每支股票买入后持有不少于 40 个交易日，假设单边交易费用为千分之一、假设按照收盘价交易。排除 ST 股票并考虑因停牌不能买、卖的股票。&lt;/p&gt;&lt;p&gt;假设回测期为 2009 年 1 月 1 日到 2018 年 7 月 23 日。在这段时期内，上述动量选股策略和中证 500 指数的表现如下表所示，&lt;b&gt;动量策略战胜了指数&lt;/b&gt;（动量策略是等权配置，相当于偏向小市值，因此用等权的 500 指数作为基准更合理；但经分析发现动量策略的因子和小市值因子的相关性仅为 0.085，因此认为使用市值加权的中证 500 指数作为基准是可以接受的）。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-c9182b05e88278b9f269bf6fe4d981f9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;588&quot; data-rawheight=&quot;254&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-c9182b05e88278b9f269bf6fe4d981f9&quot; data-watermark-src=&quot;v2-23441da94819a461f1e63370dc951eb4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;下图为基准版动量因子的选股效果。可见，它的单调性还不错，但是在截面上的区分度不够。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-17b9c9fbec45d599f4b0e0f6cd7bfc45_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1107&quot; data-rawheight=&quot;464&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-17b9c9fbec45d599f4b0e0f6cd7bfc45&quot; data-watermark-src=&quot;v2-3bd5adbcd33d8408baf26e5b16cc0a00&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;以上就是我们的基础版动量策略。下一节就来看看如何提高它。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 对动量策略的两点改进&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;Gray and Vogel (2016) 提出的对动量的改进方法源自一个信仰：&lt;b&gt;the path matters（动量积累的路径很重要）。&lt;/b&gt;为了说明这一点，他们给出了一个例子。考察下面两只股票，它们的动量因子是相同的（Gray and Vogel 2016 采用了海外常见的过去 12 个月排除最近 1 个月的收益率作为衡量动量的标准；排除最近 1 个月的原因是观察到最近 1 个月的收益率容易在样本外出现反转）。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-74987f6a7ade690ea85c41b38a116251_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;654&quot; data-rawheight=&quot;520&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-74987f6a7ade690ea85c41b38a116251&quot; data-watermark-src=&quot;v2-81fa5d58288b31a17f2a5095b7ae265a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;在上图中，选股时点是 2000 年 3 月 31 日，计算动量的窗口是 1999 年 3 月 31 日到 2000 年 2 月 29 日。&lt;b&gt;这两支股票的动量相同，然而它们动量累积的路径却大相径庭。&lt;/b&gt;图中，实线对应公司的股价涨幅明显更加平滑，而虚线对应公司的股价涨幅则更加无序。在过去一年内，实线公司有 55% 的时间上涨，而虚线公司则仅有 49% 的时间上涨。&lt;/p&gt;&lt;p&gt;不同的路径带来了样本外的不同走势（当然，这个例子是精心挑选的，从而最大化的说明路径的重要性）。这两支动量相同、路径不同的股票在样本外的三个月，实线对应的公司涨幅高达 46.9%，而虚线对应的公司则惨跌 24.7%。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-b091bd99948940261cb6376d6fa7720b_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;648&quot; data-rawheight=&quot;531&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-b091bd99948940261cb6376d6fa7720b&quot; data-watermark-src=&quot;v2-ef3e1369f5419716c48f9517554845b8&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这个例子强调了从动量到高质量动量所需的两个技巧（其实是同一问题的两面）：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;b&gt;寻找依靠价格缓慢增长实现的高动量；&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;避免大波动造成的高动量。&lt;/b&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;价格稳定缓慢增长带来的高动量在样本外更有可能持续走高，而依靠大波动造成的高动量则在样本外难有作为。&lt;b&gt;这两点其实和行为金融学中的两个行为偏差有关。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;先说第一点。我们都熟悉温水煮青蛙这个故事：如果将一只青蛙放进沸水中，它会马上跳出来；但如果将它放进冷水中慢慢加热，将会察觉不到危险而被煮死。这个故事经常被用来比喻&lt;b&gt;人们不能注意逐渐产生的变化，因此无法对此做出适当的反应。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在行为金融学中，人的这种缺陷叫做 &lt;b&gt;limited attention（有限注意力）&lt;/b&gt;。由于人们的认知资源是有限的，在任何给定的时刻，我们的大脑都偏好去处理那些最显著、最重要的信息，而忽视那些不显著的、经济效应微弱的因素。针对这个偏差，Da et al. (2014) 提出了一个假设：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;A series of frequent gradual changes attracts less attention than infrequent dramatic changes. Investors therefore underreact to continuous information.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;它说的是&lt;b&gt;一系列频繁但微小的变化对于人的吸引力远不如少数却显著的变化；因此投资者对于连续信息造成的股价变化反应不足。&lt;/b&gt;针对这个假设，作者提出了&lt;b&gt;信息离散性（information discreteness，ID）&lt;/b&gt;这个概念，并猜想 &lt;b&gt;ID 低（说明信息连续性强）的动量才是高质量动量&lt;/b&gt;，而 ID 高（信息离散性高）的动量是低质量动量。作者使用如下这个代理指标来计算信息离散性：&lt;/p&gt;&lt;p&gt;ID = sign(过去一段时间的收益率) × (这段时间内下跌交易日% - 这段时间内上涨收益日%)&lt;/p&gt;&lt;p&gt;Da et al. (2014) 通过实证说明 ID 是一个优秀的选股因子（越低越好），且它能获得 Fama-French 三因子无法解释的超额收益。&lt;b&gt;与传统动量相比，通过 ID 因子删选找到的高质量动量能够获得更高的超额收益，且该收益在样本外的持续性更强（这有助于我们降低调仓频率、减少换手率、节约交易成本）。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;再来看第二点 —— 避免大波动造成的高动量。&lt;b&gt;我们经常观察到某些股票的收益率分布是明显右偏的（positively skewed），这些股票称为“lottery-like”股票。&lt;/b&gt;行为金融学中重要的理论 —— 前景理论 —— 指出，&lt;b&gt;人们对于极小概率事件发生的主观感受存在认知偏差，会高估它们发生的概率。&lt;/b&gt;Barberis (2012) 总结了人们在赌场中的这一行为偏差。而人们在股市中的行为也比在赌场中好不了哪去。&lt;b&gt;对于小概率事件发生可能性的高估导致投资者会过度追逐具有正偏度分布的股票，造成它们的高动量。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Bali et al. (2011) 使用一个称作 MAX 的代理指标研究了这个问题。MAX 是过去 1 个月内日收益率的最大值（美股不设涨跌停板限制，因此更能反映人们对 lottery-like 股票追逐的疯狂程度）。使用 MAX 将股票分成 10 组，MAX 值最高的那一组为 lottery-like 股票，而 MAX 值最低的那一组称为“无聊”股票。&lt;b&gt;数据显示，“无聊”股票能显著跑赢 lottery-like 股票。在挑选高动量股票时，我们可以主动避免那些 lottery-like 股票。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;通过以上的说明，我们接下来尝试使用信息离散性和 lottery-like 股票的代理指标来改进基础版动量策略。经过我的简单实测，对于中证 500，Da et al. (2014) 一文给出的 ID 定义作用不大。为此我们按照这个思路来选择其他的代理指标。&lt;b&gt;考虑到目标是为了挑选平时投资者关注度低的股票，我们选择三个月内日换手率的标准差作为 ID 的代理指标，其越低越好。&lt;/b&gt;对于 lottery-like 的代理指标，我们则就选用 MAX 指标，即过去 20 天的日收益率最大值，它也是越低越好。&lt;/p&gt;&lt;p&gt;将原始的 120 天收益率（动量因子）结合上面这两点改进就得到了升级版的“高质量动量”策略。使用这三个标准的合成因子选股，大大提升了不同档投资组合收益率的单调性，同时显著提升了因子 IC 和 IR。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-841e804f0972c399584c7857d18293a5_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1095&quot; data-rawheight=&quot;462&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-841e804f0972c399584c7857d18293a5&quot; data-watermark-src=&quot;v2-efe4e89ad45abacbbe8bcd4e381680fe&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;在回测期内，该升级版动量策略和中证 500 指数以及基础版策略的效果如下。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-5293d3e247a5e788cdb782180b04e51d_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;709&quot; data-rawheight=&quot;254&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-5293d3e247a5e788cdb782180b04e51d&quot; data-watermark-src=&quot;v2-05109aa765a444949a77cd09f7b79131&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;可见，加入两个改进让我们获得了更高质量的动量；它们提升了动量策略的收益风险比。升级版的策略获得了更高的收益率、夏普率以及更低的波动率和最大回撤。&lt;/p&gt;&lt;p&gt;最后需要强调的是，上面的实证仅仅是为了给大家介绍改进的思路。具体是否使用上述代理指标以及参数需要结合不同的动量选股策略来考量。比如我观察到同样的指标和参数在沪深 300 的成分股上的效果就不如它们在中证 500 上的效果，但是这个思路是值得借鉴的。此外，如果单加入 MAX 的话并不能战胜基础版动量策略，但是加入 MAX 后可以提升最终因子的 IC 和 IR。&lt;/p&gt;&lt;p&gt;路径很重要！&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 动量策略并不适合所有人&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;高质量动量策略打败了市场。这样的结果令人振奋。这是因为动量非常简单，只需要买过去涨的多的就行了，它不像价值投资那样需要投资者深谙上市公司的基本面。&lt;/p&gt;&lt;p&gt;但是，在这里必须适时地泼一盆冷水。&lt;b&gt;动量投资虽然简单，但它并不容易。动量投资并不适合所有人。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;上面提到的这个升级版动量策略，它在过去十年和中证 500 指数的收益率比较如下：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d621300b6c21432cde987dc22ab88cfb_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;582&quot; data-rawheight=&quot;393&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d621300b6c21432cde987dc22ab88cfb&quot; data-watermark-src=&quot;v2-50eba7d3b246e2ccf1ba95cb06bc9570&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;可见，&lt;b&gt;动量策略并不能每年都跑赢指数&lt;/b&gt;，而且在最近的两年里均跑输指数。这样的特点说明，&lt;b&gt;要想交易动量策略，必须 100% 从心理上接受它的 down time，但这无疑是一种煎熬。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在面对一个策略低潮的时候，我们非常容易动摇，怀疑市场风格已经切换了，它不再适用。那么，动量策略的背后到底有没有站得住脚的原因呢？任何一个策略要想在逻辑上说的通都需要满足两个条件：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;b&gt;噪音交易者的行为（基于认知偏差）造成了市场的错误定价；&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;聪明投资者有很高的套利成本因此无法及时消除错误定价。&lt;/b&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;我们来看看动量投资是否满足这两点。&lt;/p&gt;&lt;p&gt;对于第一点，Barberis、Shleifer、以及 Vishny 研究了投资者情绪（现在这被称为著名的 BSV 模型，Barberis et al. 1998），并指出：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;当好的盈利消息接二连三出现时，会引起投资者的过度反应，&lt;/b&gt;因为他们会出现 &lt;b&gt;representative bias&lt;/b&gt;，过度看中最近发生的这些连续的利好消息、并把这种预期外推到对公司未来股价的预测上；一旦未来的盈利没有达到预期，就会引起他们的恐慌，造成股价的下跌，这恰恰是&lt;b&gt;成长投资（growth investment）&lt;/b&gt;的特点。&lt;/li&gt;&lt;li&gt;另一方面，&lt;b&gt;当好的盈利消息离散的、非连续的出现时，投资者会对它们反应不足。&lt;/b&gt;这时投资者会出现 &lt;b&gt;conservatism bias（保守主义）&lt;/b&gt;。他们会对这个利好持怀疑态度、不情愿更新他们对于该公司基本面的认知，这导致他们无法有效的对股价做出调整。随着时间的推移，当该公司又逐渐出现新的盈利利好时，其股价才会慢慢对其新的基本面反映到位，这就是动量投资。Bernard 和 Thomas 于 1989 提出了&lt;b&gt;盈余动量现象（post-earnings-announcement drift，PEAD）&lt;/b&gt;，也是投资者对利好消息反应不足的体现、符合上面这种解释。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;再来看看第二点。既然对于利好消息的反应不足导致了错误定价，那么为什么聪明的投资者（通常是机构）没有去充分套利消除这个定价错误呢？原因是这么做涉及到高昂的&lt;b&gt;套利成本（arbitrage cost）&lt;/b&gt;。假设 A 和 B 两地都卖苹果，A 地价格 5 块一斤，B 地价格 10 块一斤；苹果 B 地存在错误定价。面对这个情况，&lt;b&gt;理论上&lt;/b&gt;的做法是从 A 地买苹果然后拿到 B 地去卖，赚取 5 块钱一斤的差价。这么做的人多了，就会造成 B 地价格下降，最终消除定价错误。&lt;/p&gt;&lt;p&gt;但那仅仅是理论上。在现实中，套利者必须考虑各种成本，比如 A 和 B 两地的运输成本，对苹果的储藏成本，两地出租商铺的不同开销甚至是所得税的区别；此外，还要有苹果价格下跌的风险 —— 在它把苹果从 A 运到 B 的过程中，可能苹果在 B 地已经下跌了，甚至跌破他的成本，那无疑就是“赔了夫人又折兵”。正是由于各种各样的成本，使得任何聪明的人都不敢毫无顾虑的套利，这在学术上被称为 &lt;b&gt;limits to arbitrage（有限套利）&lt;/b&gt;。&lt;/p&gt;&lt;p&gt;凯恩斯（Keynes）曾经说过一句非常著名的话：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;Markets can remain irrational longer than you can remain solvent.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;对于动量策略，错误定价是由于噪音交易者对好的盈利消息反应不足造成的。长期来看，这个错误虽然一定会被修正，但是就短期而言，它不一定会修复，而且可能还会进一步扩大（remain irrational）。对于聪明交易者来说，&lt;b&gt;交易动量策略最大的套利风险是由于动量策略在短期相对于基准指数的弱势表现而造成的职业风险（career risk）。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;职业风险产生的原因是，市场上的资金委托专业机构代表他们管理自己的资本。不幸的是，这些资金大多都是 short-sighted performance chasers，他们往往仅根据&lt;b&gt;短期&lt;/b&gt;相对于基准的表现来评估基金经理的业绩。这让基金经理于进退两难的局面。一方面，基金经理希望利用错误定价机会交易动量策略，因为长期来看这么做的期望收益能够战胜基准；但另一方面，他们这样做的前提是，利用错误定价在短期不会威胁到他们手中的资金 —— 投资者不会因为业绩短期跑输基准而撤回资金。&lt;/p&gt;&lt;p&gt;上面的分析说明，认知偏差存在于噪音交易者中间，而有限套利摆在聪明交易者面前。这二者导致了动量策略如下的特点：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;动量策略在短期可能会（大幅）跑输市场，因此并不适合所有人（资金）；&lt;/li&gt;&lt;li&gt;长期来看，动量策略会战胜市场。对于那些过程驱动、以长期盈利为目标（而忽视短期波动）、能够严格遵守交易纪律的投资者来说，动量策略值得配置。&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;如果动量策略是你的菜，那么也许本文介绍的提高动量质量的方法值得一试。&lt;/p&gt;&lt;p&gt;&lt;b&gt;动量和价值是 Barra（现 MSCI）因子库中的两个雷打不动因子。&lt;/b&gt;下图来自 MSCI 的文章 What is Going on with Factor Returns? 该文分析了 2018 年以来一些因子在美股上的表现，从中我们能够观察到价值（enhanced value）和动量因子之间的负相关性。颇有意思的是在今年六月，两个因子双双跑输市场，这造成了一定的“恐慌”，这就是 MSCI 出来写此文的原因，安抚大家说这样的表现也实属正常。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-78f510364059581a4cdfdc1a62df74c4_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;851&quot; data-rawheight=&quot;432&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-78f510364059581a4cdfdc1a62df74c4&quot; data-watermark-src=&quot;v2-0a330feef7bc062cbf9f5dff8fc5a7bf&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;也许正如 Value and Momentum Everywhere 一文指出的那样，&lt;b&gt;动量策略的最好归宿是和价值策略配合在一起&lt;/b&gt;，提高投资组合的风险收益特征。&lt;/p&gt;&lt;p&gt;这也正应了市场中的那句老话：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;Buy&#39;em cheap, buy&#39;em strong; and hold&#39;em long.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;如果你想躲避市场下跌时多头策略的亏损，那就再加一句：&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;but only when the trend is your friend.&lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;b&gt;参考文献&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Asness, C. S., T. J. Moskowitz, and L. H. Pedersen (2013). Value and Momentum Everywhere. &lt;i&gt;The Journal of Finance&lt;/i&gt;, Vol. 68(3), 929 – 985.&lt;/li&gt;&lt;li&gt;Bali, T. G., N. Cakici, and R. F. Whitelaw (2011). Maxing Out: Stocks as Lotteries and the Cross-section of Expected Returns. &lt;i&gt;Journal of Financial Economics&lt;/i&gt;, Vol. 99(2), 427 – 446.&lt;/li&gt;&lt;li&gt;Barberis, N. (2012). A Model of Casino Gambling. &lt;i&gt;Management Science&lt;/i&gt;, Vol. 58(1), 35 – 51.&lt;/li&gt;&lt;li&gt;Barberis, N., A. Shleifer, and R. Vishny (1998). A Model of Investor Sentiment. &lt;i&gt;Journal of Financial Economics&lt;/i&gt;, Vol. 49(3), 307 – 343.&lt;/li&gt;&lt;li&gt;Bernard, V. L. and J. K. Thomas (1989). Post-Earnings-Announcement Drift: Delayed Price Response or Risk Premium? &lt;i&gt;Journal of Accounting Research&lt;/i&gt;, Vol. 27, 1 – 36.&lt;/li&gt;&lt;li&gt;Da, Z., U. Gurun, and M. Warachka (2012). &lt;i&gt;Frog in the Pan: Continuous Information and Momentum&lt;/i&gt;. AFA 2012 Chicago Meetings Paper. Available at SSRN: https://ssrn.com/abstract=1777988.&lt;/li&gt;&lt;li&gt;Gray, W. R. and J. R. Vogel (2016). &lt;i&gt;Quantitative Momentum, a Practitioner’s Guide to Building a Momentum-Based Stock Selection System&lt;/i&gt;. John Wiley &amp;amp; Sons, Inc., Hoboken, New Jersey.&lt;/li&gt;&lt;li&gt;Jegadeesh, N. and S. Titman (1993). Returns to Buying Winners and Selling Losers: Implications for Stock Market Efficiency. &lt;i&gt;The Journal of Finance&lt;/i&gt;, Vol. 48(1), 65 – 91.&lt;/li&gt;&lt;li&gt;Levy, R. (1967). Relative Strength as a Criterion for Investment Selection. &lt;i&gt;The Journal of Finance&lt;/i&gt;, Vol. 22(4), 595 – 610.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-07-24-40468929</guid>
<pubDate>Tue, 24 Jul 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>什么样的收益率特性适合趋势追踪策略</title>
<link>https://henix.github.io/feeds/zhuanlan.mitcshi/2018-07-23-40358079.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/40358079&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5463408f8e23ba5e3651c0c59a5433d2_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;1 引言&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在交易中如果想挣钱，就必须借助市场的“大势”：在牛市中做多；在熊市中做空。事实上，在商品期货交易中的大部分 CTA 策略都是趋势追踪策略。在股票交易中，虽然不易做空，但是只做多的趋势策略依然有很好的效果。&lt;/p&gt;&lt;p&gt;听起来，趋势追踪像是“包治百病的良药”。不过，来看两个例子。&lt;/p&gt;&lt;p&gt;&lt;b&gt;例子 1：上证指数&lt;/b&gt;&lt;/p&gt;&lt;p&gt;以上证指数为标的，下图为某个纯做多的简单&lt;b&gt;日频&lt;/b&gt;趋势追踪策略的净值曲线（这其中采用收盘价进行信号触发的计算，用第二天开盘价作为交易价格；每笔交易考虑了千分之一的成本）。可见它有效的捕捉到了 2006 至 2007 年和 2015 年的两拨大趋势。该策略在十五年中净值从 1 涨到 7 以上，远超同期指数。毋庸置疑，在 2015 年股灾之前的中国股市（或者更严谨的说：上证指数）是非常适合上述趋势追踪策略的（至于今后怎么样，这里先卖个关子，看完本文您就知道了）。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6f0729696e98d04aa4ed5f2139415c2a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;637&quot; data-rawheight=&quot;247&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-6f0729696e98d04aa4ed5f2139415c2a&quot; data-watermark-src=&quot;v2-22a8a42422c63d1fa317d079c979b078&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;例子 2：标普 500&lt;/b&gt;&lt;/p&gt;&lt;p&gt;让我们再来看看以标普 500 指数为标的的情况。在同样的回测期内，该趋势追踪策略的净值曲线如下（同样采用收盘价计算信号，用第二天开盘价作为交易价格；每笔交易考虑了千分之一的成本）。令人大跌眼镜的是，它几乎稳健下行，逐步迈向万丈深渊，远远跑输同期的标普指数（不要忘了，标普 500 可是经历了 .com 泡沫和金融危机呢！）。标普 500 指数在回测的这段时间内至少是不适合我们这个趋势追踪策略的。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-7c657e8b1303fa94fa56e7cf8734d5a9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;677&quot; data-rawheight=&quot;244&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-7c657e8b1303fa94fa56e7cf8734d5a9&quot; data-watermark-src=&quot;v2-7ca219ea4016ad6c03fa3831eb5e71f7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这两个例子说明&lt;b&gt;每个趋势跟踪策略都有着特定的参数；参数的背后是使用者对于投资品（对数）收益率的基本假设。&lt;/b&gt;比如该投资品在什么频率上有趋势？分钟线？小时线？日线？周线？月线？年线？又如该收益率的趋势相对于噪声的强弱程度等。在上面这两个例子中，显然上证指数符合该策略的假设，而标普 500 和它的假设背道而驰。&lt;/p&gt;&lt;p&gt;&lt;b&gt;任何一个趋势追踪策略仅对收益率符合其假设的投资品适用。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;那么，投资品的收益率一般有哪些特性呢？我们又如何利用它们来选择合适的趋势追踪策略呢？这就是本文的话题。需要说明的是，虽然下文中定义了严谨的数学模型，且包含了大量的仿真实验，但是本文仍属于&lt;b&gt;定性&lt;/b&gt;的文章。文中并没有给出太过定量的结论，我们的重点是想从定性的角度来回答提出的问题。另外，为了简化讨论，我们仅考虑只能做多的趋势追踪策略&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2 均值、自相关、白噪声&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;投资品的收益率一般包含三个部分：（长期）均值，自相关性和白噪声。&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;长期均值：&lt;/b&gt;它代表长期下来，单位时间内收益率的均值。&lt;/li&gt;&lt;li&gt;&lt;b&gt;自相关性：&lt;/b&gt;为了简化讨论我们这里仅考虑间隔为 1 的自相关性；它代表相邻两个单位时间内收益率的相关性。&lt;/li&gt;&lt;li&gt;&lt;b&gt;白噪声：&lt;/b&gt;每个单位时间内收益率自身的随机波动；不同时刻的随机波动相互独立。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;在这三部分中，白噪声是随机扰动；对于另外两个部分，&lt;b&gt;当长期均值越高，自相关性越强，趋势追踪策略的效果则越好&lt;/b&gt;。那么长期均值和自相关性这两个因素之间哪个更重要呢？它们分别又对趋势追踪策略有什么样的影响呢？&lt;/p&gt;&lt;p&gt;为了便于分析，我们利用数学模型来人工合成&lt;b&gt;对数&lt;/b&gt;收益率。这些对数收益率满足给定的长期均值  &lt;equation&gt;μ&lt;/equation&gt; ，自相关性  &lt;equation&gt;ρ&lt;/equation&gt; ，以及白噪声的波动率 &lt;equation&gt;σ&lt;/equation&gt; 。该数学模型如下所示：&lt;/p&gt;&lt;p&gt;&lt;equation&gt;\left\{ \begin{array}{rll} b_0&amp;amp;\sim&amp;amp;\mathcal{N}(0,\sigma)\\ e_t&amp;amp;\sim&amp;amp;\mathcal{N}(0,\sigma)\\ b_t&amp;amp;=&amp;amp;\rho\times b_{t-1}+e_t,~~~t=1,2,\cdots\\ r_t&amp;amp;=&amp;amp;b_t-\mu_b+\mu,~~~t=0,1,2,\cdots \end{array} \right.&lt;/equation&gt; &lt;/p&gt;&lt;p&gt;其中， &lt;equation&gt;e_t&lt;/equation&gt; 是白噪声序列，它满足均值为 0，标准差为 &lt;equation&gt;σ&lt;/equation&gt; 的正态分布。 &lt;equation&gt;r_t&lt;/equation&gt; 是我们构造的人工对数收益率序列。为了使它满足给定的长期均值 &lt;equation&gt;μ&lt;/equation&gt; 和自相关性 &lt;equation&gt;ρ&lt;/equation&gt; ，构造过程中使用了辅助序列 &lt;equation&gt;b_t&lt;/equation&gt; 。首先利用迭代构造出满足自相关性 &lt;equation&gt;ρ&lt;/equation&gt; 的序列 &lt;equation&gt;b_t&lt;/equation&gt; 。由于在构造 &lt;equation&gt;b_t&lt;/equation&gt; 时可能会引入意外的均值 &lt;equation&gt;μ_b&lt;/equation&gt; ，因此在利用 &lt;equation&gt;b_t&lt;/equation&gt; 构造 &lt;equation&gt;r_t&lt;/equation&gt; 时，将 &lt;equation&gt;μ_b&lt;/equation&gt; 去除并把给定的均值 &lt;equation&gt;μ&lt;/equation&gt; 加回来。这样最终生成的对数收益率序列 &lt;equation&gt;r_t&lt;/equation&gt; 同时满足的长期均值 &lt;equation&gt;μ&lt;/equation&gt; 和自相关性 &lt;equation&gt;ρ&lt;/equation&gt; 。这就是上面四个式子所表述的过程。&lt;/p&gt;&lt;p&gt;利用这个数学模型，以 &lt;equation&gt;μ&lt;/equation&gt; 、 &lt;equation&gt;ρ&lt;/equation&gt; 、 &lt;equation&gt;σ&lt;/equation&gt;  作为输入，就可以人工生成对数收益率序列。当然，为了使这个研究对投资实践有借鉴意义，这三个参数的取值需要贴近实际。此外，由于研究的重点是收益率的 &lt;equation&gt;μ&lt;/equation&gt; 和 &lt;equation&gt;ρ&lt;/equation&gt; 对趋势策略的影响，研究中将  &lt;equation&gt;σ&lt;/equation&gt;  的取值固定。&lt;/p&gt;&lt;p&gt;假设我们合成的是日收益率序列，则 &lt;equation&gt;σ&lt;/equation&gt; 的合理取值为 0.01。在决定 &lt;equation&gt;μ&lt;/equation&gt; 和 &lt;equation&gt;ρ&lt;/equation&gt; 的取值时，考虑如下一些参照（本文最早写于 2017 年，因此下面的数据只到 2017 年）：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;参照 1：&lt;/b&gt;过去十二年的上证指数（2005 年 5 月 26 日至 2017 年 5 月 25 日）：均值 0.00037，自相关 0.023。&lt;/li&gt;&lt;li&gt;&lt;b&gt;参照 2：&lt;/b&gt;2015 年大牛市中的上证指数（2015 年 2 月 9 日至 2015 年 6 月 12 日）：均值 0.006，自相关 0.09。&lt;/li&gt;&lt;li&gt;&lt;b&gt;参照 3：&lt;/b&gt;股灾 3.0 之后的上证指数（2016 年 3 月 1 日至 2017 年 5 月 25 日）：均值 0.00049，自相关 0.048。&lt;/li&gt;&lt;li&gt;&lt;b&gt;参照 4：&lt;/b&gt;金融危机之后的标普 500 指数（2010 年 1 月 1 日至 2017 年 1 月 1 日）：均值 0.0004，自相关 -0.049。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;可见，除了 A 股的大牛市那段神一样的存在外（&lt;b&gt;注意，那一段收益率的均值比平时高出了一个数量级！我们后面会针对这点来特别论述&lt;/b&gt;），其他时候对数日收益率的均值在 0.0004 左右。在自相关性方面，除了标普为负之外（虽然是负的，但是事实也非常接近 0），A 股不同阶段的自相关性在 0.02 到 0.1 之间。鉴于以上的数据，我们决定  &lt;equation&gt;μ&lt;/equation&gt;  和  &lt;equation&gt;ρ&lt;/equation&gt;  的取值如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;equation&gt;μ&lt;/equation&gt; &lt;b&gt;：0.0001，0.0005，0.001&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt;：0.01，0.1，0.2&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;将它们两两组合便得到 9 组不同的 &lt;equation&gt;μ&lt;/equation&gt; 和 &lt;equation&gt;ρ&lt;/equation&gt; ，由此便可以根据上述数学模型构建任意长度的对数收益率序列。在实验中，每一组序列包括 2500 个点（假设一年有 250 个交易日，则这个长度相当于十年）。此外，由于生成的是对数收益率，因此该序列的累加和就是其对应的（以初始价格的对数值为偏移量的）对数价格曲线，将该偏移量消除并将对数价格曲线的每一项进行指数运算就可以得到价格曲线。在实验中，假设投资品的原始价格为 100。&lt;/p&gt;&lt;p&gt;下图为这 9 组 &lt;equation&gt;μ&lt;/equation&gt; 和 &lt;equation&gt;ρ&lt;/equation&gt; 参数下生成的一组样本人造价格曲线（由于在生成对数收益率的过程中引入了随机误差，因此即便是给定了 &lt;equation&gt;μ&lt;/equation&gt; 和 &lt;equation&gt;ρ&lt;/equation&gt; ，每次生成的价格曲线也不相同。因此下图仅仅是每组参数下的一条样本价格曲线）。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-043276aee1793633f724012f0f56ff63_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;919&quot; data-rawheight=&quot;751&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-043276aee1793633f724012f0f56ff63&quot; data-watermark-src=&quot;v2-c4aabd3597ae20dd6851e37ec6d6d97a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;从这 9 条人造价格曲线中可以看出：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;当均值 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 相对于波动 &lt;/b&gt; &lt;equation&gt;σ&lt;/equation&gt; &lt;b&gt; 很小时（小两个数量级左右），价格曲线的局部走势由自相关性 &lt;/b&gt;&lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt;（以及随机噪声）主宰：&lt;/b&gt; &lt;equation&gt;ρ&lt;/equation&gt;&lt;b&gt; 越大，局部波动越频繁。由于 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 相对于随机噪声 &lt;/b&gt;&lt;equation&gt;σ&lt;/equation&gt;&lt;b&gt; 太小，在任何就局部的尺度上都观测不到明显的上涨趋势，这种现象在 &lt;/b&gt;&lt;equation&gt;ρ&lt;/equation&gt;&lt;b&gt; 变大时更加明显。&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;当均值 &lt;/b&gt;&lt;equation&gt;μ&lt;/equation&gt;&lt;b&gt; 比 &lt;/b&gt; &lt;equation&gt;σ&lt;/equation&gt; &lt;b&gt; 小一到两个数量级之间时（这是一般市场的情况，就像上面提到的参照 1、3 和 4），&lt;/b&gt; &lt;equation&gt;μ&lt;/equation&gt; &lt;b&gt; 对价格走势的重要性逐渐增加。这时，小的自相关性 &lt;/b&gt; &lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt; 对价格的影响较小；当自相关性 &lt;/b&gt; &lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt; 足够大时，它仍然能引起局部的阶段性涨跌区间。我们能够在某些尺度下观察到明显的上涨趋势。&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;当均值 &lt;/b&gt; &lt;equation&gt;μ&lt;/equation&gt; &lt;b&gt; 变大到仅比波动 &lt;/b&gt; &lt;equation&gt;σ&lt;/equation&gt; &lt;b&gt; 小一个数量级甚至更大时（这是大牛市的情况，如同上面提到的参照 2），均值对价格的影响将使得任何合理的自相关性 &lt;/b&gt; &lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt; 对价格的影响微乎其微。在如此大的趋势面前，自相关性 &lt;/b&gt;&lt;equation&gt;ρ&lt;/equation&gt; &lt;b&gt;（和随机噪声）的影响几乎可以忽略不计；在价格序列的整段范围内，它基本呈现持续的上涨。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;这些不同的参数对趋势追踪策略有什么样的影响呢？下面就来看看一个给定的趋势追踪策略会在不同的参数下有什么样的表现。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3 不同 μ 和 ρ 参数下的趋势追踪策略效果&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;在展开本节的讨论之前，必须说清楚两个问题：&lt;/p&gt;&lt;p&gt;1. 本节的标题事实上是一个非常“宏伟”的课题。如果想要系统的考察 &lt;equation&gt;μ&lt;/equation&gt; 和  &lt;equation&gt;ρ&lt;/equation&gt;  如何影响趋势追踪策略，则必须考虑不同的趋势追踪策略，并且对于每个策略考察不同时间尺度下的参数。这显然远远超出本文的范畴。&lt;b&gt;在本文中，我们仅考虑一个技术分析领域中非常常见的趋势追踪策略 —— 双均线策略；以及该策略的一组非常常见的参数：慢均线为 50 日简单均值；快均线为 13 日简单均值。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;由于价格曲线是人工生成的，因此每个交易日只有一个价格数据，我们假设它就是收盘价。由于仅有收盘价而没有其他数据，我们无法使用诸如“以收盘价计算，以下个开盘价购买”这种更合理的方式构建策略；我们只能以收盘价作为交易价格，而通过考虑足够大的交易成本来使得仿真实验更加接近现实。具体策略为：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;空仓时，在每个交易日收盘，如果快均线上穿慢均线则按收盘价满仓买入；交易成本千分之一。&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;满仓时，在每个交易日收盘，如果快均线下穿慢均线则按收盘价卖出清仓；交易成本千分之一。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;2. 前文提到，由于在生成人造价格曲线时引入了随机噪声，因此即便对于给定  &lt;equation&gt;μ&lt;/equation&gt;  和  &lt;equation&gt;ρ&lt;/equation&gt; ，每次生成的价格曲线也都完全不同。这意味着，对于任一组参数，我们都必须生成足够多的样本价格曲线，然后使用上面的趋势追踪策略来对它们逐一进行交易，以此统计该策略的收益和风险分布情况。唯有这样才能客观的评价该策略在这组参数下的表现。为此，对于每组 &lt;equation&gt;μ&lt;/equation&gt; 和  &lt;equation&gt;ρ&lt;/equation&gt; ，我们进行 500 次实验。&lt;/p&gt;&lt;p&gt;在评价策略时，考察六个指标，它们分别为：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;策略&lt;b&gt;绝对&lt;/b&gt;年化复合收益率；&lt;/li&gt;&lt;li&gt;策略&lt;b&gt;绝对&lt;/b&gt;夏普率；&lt;/li&gt;&lt;li&gt;策略&lt;b&gt;绝对&lt;/b&gt;最大回撤；&lt;/li&gt;&lt;li&gt;策略&lt;b&gt;相对&lt;/b&gt;年化复合收益率；&lt;/li&gt;&lt;li&gt;策略&lt;b&gt;相对&lt;/b&gt;夏普率；&lt;/li&gt;&lt;li&gt;策略&lt;b&gt;相对&lt;/b&gt;最大回撤。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;所谓相对，是指策略较价格曲线本身的表现。&lt;/b&gt;下面就分别来看看在这 9 组参数下，上述双均线策略的表现。对于每一组参数，我们使用六张图分别显示 500 次实验后上述六个指标的分布。上面三张图为绝对指标；下面三张图为相对指标。黄色的竖线为每个指标的均值。接下来首先呈现 9 组参数的指标分布，然后总结它们传达的信息。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第一组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.01&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-517ed8c524fb69bff4c8143fd9c24b7f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1134&quot; data-rawheight=&quot;727&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-517ed8c524fb69bff4c8143fd9c24b7f&quot; data-watermark-src=&quot;v2-58b39d18cc699477c33d667beccb2dd7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第二组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.1&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9a0604836be5de4f0e26a226bb326c26_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1135&quot; data-rawheight=&quot;728&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9a0604836be5de4f0e26a226bb326c26&quot; data-watermark-src=&quot;v2-e0d15e89e914a00e72ef1147eba55114&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第三组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.2&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-dee948236f30b946cc11ebe118bab40f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1039&quot; data-rawheight=&quot;661&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-dee948236f30b946cc11ebe118bab40f&quot; data-watermark-src=&quot;v2-24c8ea951ab0d748712e329e7c3c9ccc&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第四组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0005&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.01&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e5c520917812709509bb71dbfed38bd9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1140&quot; data-rawheight=&quot;727&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e5c520917812709509bb71dbfed38bd9&quot; data-watermark-src=&quot;v2-def78dfb0d7191c73b33643772a4ffa7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第五组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0005&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.1&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-1a55c6953c01eb10d4d24d092b3daa95_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1091&quot; data-rawheight=&quot;695&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-1a55c6953c01eb10d4d24d092b3daa95&quot; data-watermark-src=&quot;v2-8430a4ca45504c0154b52d3ac8ed5db4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第六组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.0005&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.2&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-69fde7e606b136b6f3658b1d446abd41_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1089&quot; data-rawheight=&quot;699&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-69fde7e606b136b6f3658b1d446abd41&quot; data-watermark-src=&quot;v2-f84cc0992054dd5e172119d08bd8f065&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第七组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.01&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-81a7cc98df3c997328e777ece63f4673_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1085&quot; data-rawheight=&quot;697&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-81a7cc98df3c997328e777ece63f4673&quot; data-watermark-src=&quot;v2-30299e5088548855c312b6524ac16abd&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第八组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.1&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-bac242131ca7e9764975211aecdfe260_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1094&quot; data-rawheight=&quot;698&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bac242131ca7e9764975211aecdfe260&quot; data-watermark-src=&quot;v2-0cb6b2c1f1b2a8349f9cf91dc4f46a37&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;第九组参数：&lt;/b&gt; &lt;equation&gt;μ = 0.001&lt;/equation&gt; &lt;b&gt;，&lt;/b&gt; &lt;equation&gt;ρ = 0.2&lt;/equation&gt; &lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-147eae4c121c89e17e16eebd11007be1_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1087&quot; data-rawheight=&quot;700&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-147eae4c121c89e17e16eebd11007be1&quot; data-watermark-src=&quot;v2-38b47539f9429a5e0f80c3017691f578&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这 9 组参数的实验结果说明：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;第一组到第三组参数中，由于长期均值较随机噪声小两个数量级，长期来看价格曲线在不同的时间尺度上均呈现频繁的波动。由此双均线趋势策略产生了错误的信号。无论从绝对收益率还是相对收益率来看，该策略的平均水平在这三组参数下均无法获得有效的正收益。&lt;/li&gt;&lt;li&gt;第四组到第六组参数中，随着长期均值的增大，均值和自相关性配合作用使得价格曲线克服随机噪声、并在不同的时间尺度上呈现出明显的上涨趋势。当上涨趋势的尺度满足双均线策略的参数设定时，该策略可以取得显著的正收益。虽然从相对收益率分布图中看到策略的收益率仍然大概率的跑输价格曲线本身，但是仍然可以有一小部分策略的夏普率大于价格曲线本身的夏普率。这说明对于这些价格曲线，趋势策略有效的降低了最大回撤。&lt;/li&gt;&lt;li&gt;第七组到第九组参数中，由于长期均值的数量级进一步增大，趋势策略的效果也有所改进。但有意思的是，在所有这三组参数中的一共 1500 个价格曲线中，趋势策略无一例外全部跑输价格曲线本身。可见，当长期均值足够大时，价格曲线本身就在整段时间范围内呈现出强大的上涨趋势，无需再用任何趋势策略来“捕捉”趋势。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;下面就来总结一下这九组实验带给我们的启发。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4 长期均值主宰自相关，趋势尺度需满足策略参数&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;对于“如何根据收益率的特性选择适合的趋势追踪策略”这个问题，上面九组实验说明以下两点：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;长期均值主宰自相关性；&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;趋势尺度需满足策略参数。&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;首先来看第一条。实验结果说明，当投资品的长期均值较随机波动的数量级太小时，无论它表现出多么强的自相关性，趋势策略都无法有效获得正收益。换句话说，&lt;b&gt;均值决定了趋势的强弱（尽管我们不知道确切的时间尺度），而一个趋势策略有效的必要条件是该趋势不能被随机波动所抵消。&lt;/b&gt;如果这一点无法满足，那么趋势追踪显然是徒劳。&lt;/p&gt;&lt;p&gt;第七组到第九组的参数接近 A 股大牛市时的情况。在那种盛世下，趋势追踪显然能够获得非常不错的效果。尽管在大牛市阶段，趋势追踪不能够战胜基准本身，但是考虑到大牛市之后往往伴随着大熊市的一落千丈，因此&lt;b&gt;在一个完整的牛熊周期之后，趋势追踪策略必然会战胜基准。在过去的十几年中，正因为 A 股有这样的特性（3 波牛熊周期），才使得趋势追踪策略脱颖而出。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;第四组到第六组的参数其实很接近股灾 3.0 后的 A 股和金融危机后美股标普 500 指数的特性。&lt;/b&gt;在这种特性下，价格曲线呈现一个长期慢牛的形态，但收益率的波动率较均值仍然较大。&lt;b&gt;由于无法保证阶段性上涨的趋势一定满足趋势策略的参数假设，因此趋势策略的效果就无法保证。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这边引出了我们的第二点：&lt;b&gt;趋势尺度需满足策略参数&lt;/b&gt;。来看下面三个例子。它们的收益率长期均值均为 0，而自相关系数为 0.3（非常强的自相关）。在这三个例子中，同样的双均线趋势策略表现出了完全不同的效果。而趋势策略的效果完全取决于趋势的尺度是否满足策略的参数。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-d9df763426554ad0004268864d49ef49_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;349&quot; data-rawheight=&quot;754&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d9df763426554ad0004268864d49ef49&quot; data-watermark-src=&quot;v2-9f8c18ca3e8cae527a0de4485465cf0c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;在这三个价格序列中，由于随机噪声的影响，趋势持续的时间尺度自上而下逐渐减小，从而离策略假设的时间尺度相差的越来越远，这便直接造成策略的效果越来越差。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这个结果对策略研发非常重要。因为在实际中，我们的历史数据仅仅是未知分布的一个实现（比如，我们仅仅会有上面三个价格曲线的一个）。假设第一个价格曲线是真实的历史数据，而我们针对它开发了一个趋势策略，那么我们能否预期它在样本外有同样的表现呢？答案是否定的。其原因正是因为没有更多的历史样本，我们根本无法在统计上正确的评价该策略的参数对这个未知收益率分布是否有效。我们得到的“有效”的结论仅仅源于对一个来自该分布的特定样本价格序列优化的结果。因此，该策略在样本外的表现也很有可能和其在样本内的表现大相径庭。&lt;/p&gt;&lt;p&gt;因此，对于第四组到第六组的参数所描述的价格曲线采用趋势追踪是有风险的。&lt;b&gt;风险来自于无法合理的评价该策略在未来的效果。&lt;/b&gt;那么我们应该怎么办呢？&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5 结语：对 A 股的启示&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;股灾 3.0 后，上证指数的日收益率均值、方差、自相关性这些指标乃至是走势都和金融危机之后的标普 500 有些类似。&lt;b&gt;这说明在短时间尺度内，随机的扰动对于日收益率的均值影响比较大。这就迫使我们把投资周期拉长，从而把扰动略去。周期拉长什么意思？就是迫使我们把持仓时间变长。如果我们原来做短线，那么现在就只能变成长线。这么做的结果就是，投机者被迫变成投资者。价值投资就回归了！&lt;/b&gt;&lt;/p&gt;&lt;p&gt;因此，股灾 3.0 后的 A 股应该怎么搞？&lt;b&gt;美股怎么搞，我们就应该怎么搞。&lt;/b&gt;在这种收益率特征下，趋势追踪很难超过买入持有策略。国外有很多策略针对美股搞趋势类择时并且声称战胜了指数。但仔细想想不难发现，用标普 500 做回测，只要能把金融危机躲过去，就几乎一定跑赢指数（而且那些策略还在金融危机的时候做空美股），但那叫耍流氓。如果从 2010 年后对美股使用仅做多的趋势追踪策略，那么想要超过买入持有策略难度堪比登天。&lt;b&gt;因此，美股对我们的第一个借鉴就是买入持有。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;如果我们想在买入持有的基础上更进一步，那么巴菲特的价值投资无疑是黑夜中的一盏明灯。&lt;b&gt;在价值投资回归的背景下，通过选股做指数增强是更好的选择。&lt;/b&gt;较趋势追踪无法保证跑赢基准，指数增强可以稳定的赚取  &lt;equation&gt;α&lt;/equation&gt;  收益率（或者说是结构性的  &lt;equation&gt;β&lt;/equation&gt;  收益率）。&lt;/p&gt;&lt;p&gt;这篇文章是我在 2017 年写的。而今天，2018 年 7 月 23 日，有条最新消息称股指期货交易将恢复常态！这无疑为选股策略提供了更好的生存环境。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(&lt;a href=&quot;http://rightknights.com&quot;&gt;维权骑士_免费版权监测/版权保护/版权分发&lt;/a&gt;) 为进行维权行动。&lt;/p&gt;</description>
<author>石川</author>
<guid isPermaLink="false">2018-07-23-40358079</guid>
<pubDate>Mon, 23 Jul 2018 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>
